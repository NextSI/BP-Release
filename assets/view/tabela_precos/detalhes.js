var isMobile=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(isMobile=!0),define(["react","react-dom","./../componentes_react/CboClientes"],function(e,i,a){return function(t){"use strict";var d=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.title="Detalhes Tabela de Preços",this.onclose=null,this.onselect=null,this.onsave=null,this.ondelete=null,this.parametro_busca_automatica=!0,this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.menu_item=this.dialog.find(".menu_item"),this.menu_entidade=this.dialog.find(".menu_entidade"),this.aba_item=this.dialog.find(".aba_item"),this.aba_entidade=this.dialog.find(".aba_entidade"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.cbo_entidades=this.dialog.find(".cbo_entidades"),this.edt_entidades=this.dialog.find(".edt_entidades"),this.cbo_regiao_vendas=this.dialog.find(".cbo_regiao_vendas"),this.edt_regiao_vendas=this.dialog.find(".edt_regiao_vendas"),this.edt_ini=this.dialog.find(".edt_ini"),this.edt_fim=this.dialog.find(".edt_fim"),this.btn_incluir_item=this.dialog.find(".btn_incluir_item"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_filtra_descricao=this.dialog.find(".btn_filtra_descricao"),this.btn_limpar_filtro=this.dialog.find(".btn_limpar_filtro"),this.div_component_cbo_clientes=this.dialog.find(".div_component_cbo_clientes"),this.tab_listagem_entidade=this.dialog.find(".tab_listagem_entidade"),this.coluna_desconto=this.dialog.find(".coluna_desconto"),this.div_carregar_mais=this.dialog.find(".div_carregar_mais"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.txt_carregar_mais=this.dialog.find(".txt_carregar_mais"),this.edt_filtro_descricao=this.dialog.find(".edt_filtro_descricao"),this.cboClientes=e.createElement(a,{initial_values:{placeholder:"Pesquisar por nome/cnpj"}},null),this.somente_consulta_tabela_precos="N",this.limite=0,this.limite_a_cada=50,this.bloqueia_limite=!0,this.tabela_precos_id=null,this.entidade_tipo=null,this.entidade_id=null,this.cliente_id=null,this.prospect_id=null,this.arr_itens=[],this.cbo_table_itens=null,this.arr_listar_itens=[],this.somente_consulta_tabela_precos="N",this.arr_novos_itens=[],this.limpa_listagem=!1,this.arr_deletados=[],this.filtros=[],this.arr_entidades=[],this.arr_entidades_filtrados=[],this.show=function(e,i){d.aba_item.attr("id","aba_item"+d.html_id),d.aba_entidade.attr("id","aba_entidade"+d.html_id),d.menu_item.attr("href","#"+d.aba_item.attr("id")),d.menu_entidade.attr("href","#"+d.aba_entidade.attr("id")),d.parametro_busca_automatica="N"==App.sessao.dados.busca_automatica,WS.get("itens/get_parametros/",null,function(e){"N"==e.item_desconto&&(d.coluna_desconto.addClass("hidden"),d.coluna_desconto.removeClass("visible-xs"),d.coluna_desconto.removeClass("visible-sm"),d.coluna_desconto.removeClass("visible-md"),d.coluna_desconto.removeClass("visible-lg"))}),WS.get("tabela_precos/get_parametros/",null,function(a){switch(d.somente_consulta_tabela_precos=a.somente_consulta_tabela_precos,"S"==d.somente_consulta_tabela_precos&&(i=FORMULARIO.VISUALIZAR),i){case FORMULARIO.NOVO:d.btn_salvar.show(),d.btn_excluir.hide(),App.titulo_aba(d.html_id,"Novo - Tabela de Preços"),d.permite_alterar(!0);break;case FORMULARIO.EDITAR:d.btn_salvar.show(),d.btn_excluir.hide(),d.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:d.btn_salvar.hide(),d.btn_excluir.hide(),d.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:d.btn_salvar.hide(),d.btn_excluir.show(),d.permite_alterar(!1);break;case FORMULARIO.CRIAR_UNIDADE:d.btn_salvar.show(),d.btn_excluir.hide(),d.permite_alterar(!0)}create_combobox(d.cbo_regiao_vendas,d.listar_regiao_vendas),d.edt_regiao_vendas=d.cbo_regiao_vendas.parent().find(".edt_combobox"),set_datepicker(d.edt_ini),set_datepicker(d.edt_fim),void 0!==e&&e&&(d.tabela_precos_id=e,d.preencher()),set_focus(d.edt_descricao),d.listar_tabela_entidades(),d.renderiza_componentes()})},this.renderiza_componentes=function(){d.renderiza_combobox_cliente(),d.cboClientes.props.setFunctionSelect(d.evt_alterar_cliente)},this.renderiza_combobox_cliente=function(){i.render(d.cboClientes,d.div_component_cbo_clientes[0]),d.cboClientes.props.setConfiguracoes={rota:"agenda_contatos/listar/",main_externo:d,exibe_tipo_entidade:!0,placeholder:"Filtrar Entidade",WS_params:{tabela_precos_id:d.tabela_precos_id,desconsiderar_fornecedor:!0,desconsiderar_empresa:!0,limite:0}}},this.evt_alterar_cliente=function(){var e=d.cboClientes.props.ClienteSelecionado;d.filtros=spread({},d.filtros,{cliente_id:d.cboClientes.props.ClienteSelecionado.id,cliente_nome:d.cboClientes.props.ClienteSelecionado.nome_fantasia,tipo:d.cboClientes.props.ClienteSelecionado.tipo}),d.entidade_tipo=d.filtros.tipo,d.entidade_id=d.filtros.cliente_id,null!=e&&d.arr_entidades.map(function(e){return e.id||e.entidade_id}).indexOf(e.id)<0&&(d.arr_entidades.push({entidade_id:e.id,entidade_tipo:e.tipo,nome:e.nome_fantasia,tabela_preco_id:d.tabela_preco_id}),d.render_tabela_entidades())},this.close=function(){void 0!==d.onclose&&d.onclose&&d.onclose()},this.unload=function(){d.close(),View.unload(this.html_id)},d.btn_filtra_descricao.unbind("click"),d.btn_filtra_descricao.click(function(e){d.limpa_listagem=!0,d.lista_itens()}),d.btn_limpar_filtro.unbind("click"),d.btn_limpar_filtro.click(function(e){d.limpa_listagem=!0,d.edt_filtro_descricao.val(""),d.lista_itens()}),this.permite_alterar=function(e){d.edt_codigo.prop("disabled",!e),d.edt_descricao.prop("disabled",!e),d.cbo_entidades.prop("disabled",!e),d.edt_entidades.prop("disabled",!e),d.cbo_regiao_vendas.prop("disabled",!e),d.edt_regiao_vendas.prop("disabled",!e),d.edt_ini.prop("disabled",!e),d.edt_fim.prop("disabled",!e),d.btn_incluir_item.prop("disabled",!e);var i=d.tab_listagem.find("tbody").find("tr:first");$(i.find("[template-field='cbo_item']")).prop("disabled",!e),$(i.find("[template-field='edt_codigo_entidade']")).prop("disabled",!e),$(i.find("[template-field='edt_preco_base']")).prop("disabled",!e),$(i.find("[template-field='edt_qtde_minima']")).prop("disabled",!e),$(i.find("[template-field='edt_qtde_maxima']")).prop("disabled",!e),$(i.find("[template-field='edt_preco_minimo']")).prop("disabled",!e),$(i.find("[template-field='edt_preco_maximo']")).prop("disabled",!e),$(i.find("[template-field='edt_desconto']")).prop("disabled",!e),$(i.find("[template-field='edt_preco_desconto']")).prop("disabled",!e),$(i.find(".btn_deletar_item")).prop("disabled",!e),d.exibir_divs_codigo_entidade()},this.exibir_divs_codigo_entidade=function(){parseInt(d.entidade_id,10)>0?d.dialog.find(".divs_edt_codigo_entidade").removeClass("hidden"):d.dialog.find(".divs_edt_codigo_entidade").addClass("hidden")},this.preencher=function(){WS.get("tabela_precos/objeto/",{tabela_precos_id:d.tabela_precos_id},function(e){App.titulo_aba(d.html_id,e.descricao+" - Tabela de Preços"),d.edt_codigo.val(e.codigo),d.edt_descricao.val(e.descricao),set_datepicker(d.edt_ini,e.data_inicial),set_datepicker(d.edt_fim,e.data_final),set_value_combobox(d.cbo_regiao_vendas,e.regiao_vendas_id,e.regiao_vendas_nome),d.entidade_tipo=e.entidade_tipo,d.entidade_id=e.entidade_id,d.filtros={cliente_id:e.entidade_id,cliente_nome:e.entidade_nome},d.exibir_divs_codigo_entidade(),"S"==e.bloqueado&&d.chk_bloqueado.bootstrapSwitch("state",!0),d.lista_itens(!1)})},this.listar_tabela_entidades=function(){WS.get("tabela_preco_entidade/listar_entidades/",{tabela_precos_id:d.tabela_precos_id},function(e){d.arr_entidades=e,$(d.arr_entidades).each(function(e,i){d.arr_entidades[e].entidade_id=d.arr_entidades[e].id,d.arr_entidades[e].entidade_tipo=d.arr_entidades[e].tipo,delete d.arr_entidades[e].id,delete d.arr_entidades[e].tipo}),d.render_tabela_entidades()})},this.render_tabela_entidades=function(){var e=d.tab_listagem_entidade.find("tbody"),i=e.find("tr:first");$(d.arr_entidades).each(function(e,i){void 0===d.arr_entidades[e].removido&&(d.arr_entidades[e].removido=!1)}),d.arr_entidades_filtrados=d.arr_entidades.filter(function(e){var i=!0;return!0===e.removido&&(i=!1),i}),d.tab_listagem_entidade.find("tr:gt(1)").remove(),$(d.arr_entidades_filtrados).each(function(a,t){!function(a){var t=i.clone();t.removeAttr("template-row"),t.css("display",""),$(t.find("[template-field='nome']")).text(a.nome);var o=$(t.find(".btn_deletar_entidade"));o.unbind("click"),o.click(function(){alert_modal("Entidade","Deseja remover a entidade?","Remover",function(){$(d.arr_entidades).each(function(e,i){i.entidade_id==a.entidade_id&&(d.arr_entidades[e].removido=!0,d.render_tabela_entidades())})},!0)}),t.appendTo(e)}(t)}),App.aplicar_mascaras(e)},this.btn_carregar_mais.unbind("click").click(function(){d.bloqueia_limite||($(this).find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),d.div_carregar_mais.find("span.btn_carregar_mais").find("span.icn_carregar_mais").remove(),d.div_carregar_mais.find("span.btn_carregar_mais").append('<span class="icn_carregar_mais fa fa-spinner fa-spin"></span>'),d.limite+=d.limite_a_cada,d.lista_itens(!1))}),this.lista_itens=function(){WS.get("tabela_precos_item/listar/",{tabela_preco_id:d.tabela_precos_id,limite:d.limite,limite_a_cada:d.limite_a_cada,busca:d.edt_filtro_descricao.val()},function(e){e.length<d.limite_a_cada?d.bloqueia_limite=!0:d.bloqueia_limite=!1,d.tab_listagem.find("tr:gt(1)").not("[linha-nova]").remove(),d.arr_itens=e,d.render_itens()})},this.listar_entidades=function(e){WS.get("agenda_contatos/listar/",{campo_pesquisa_varias_colunas:d.edt_entidades.val(),desconsiderar_fornecedor:!0,limite:0},function(i){limpar_combobox(d.cbo_entidades),$(i).each(function(e,i){var a=[];a["Nome Fantasia"]=i.nome_fantasia,a["Razão Social"]=i.razao_social,a.Telefone=i.telefone1;var t=$('<span class="label lb_tipo" title="Organização" data-original-title="Organização" style="margin-right: 5px;"></span>');"C"==i.tipo?(t.addClass("label-info"),t.attr("title","Cliente")):"F"==i.tipo?(t.addClass("label-warning"),t.attr("title","Fornecedor")):"O"==i.tipo&&(t.addClass("label-primary"),t.attr("title","Organização")),t.tooltip(),t.text(i.tipo),add_option_combobox(d.cbo_entidades,e,i.id,a,t)}),d.cbo_entidades.parent().find(".ul_row").click(function(){var e=$(this).parent().attr("id_registro"),i=$(this).find(".detalhe_col").find(".lb_tipo").text();d.entidade_tipo=i,d.entidade_id=e,d.exibir_divs_codigo_entidade()}),e(!0)})},this.listar_regiao_vendas=function(e){var i={descricao:d.edt_regiao_vendas.val()};WS.get("regiao_vendas/listar/",i,function(i){limpar_combobox(d.cbo_regiao_vendas),$(i).each(function(e,i){var a=[];a.Descricao=i.descricao,add_option_combobox(d.cbo_regiao_vendas,e,i.regiao_vendas_id,a)}),e(!0)})},this.listar_itens=function(e,i){var a=i.parent(),t={item_descricao:a.find(".edt_combobox").val(),filtrar_por_codigo_ou_nome:!0,modulo_crm:!0};WS.get("itens/listar/",t,function(t){limpar_combobox(i),d.arr_listar_itens=t,$(t).each(function(e,a){var t=[];t["Código"]=null==a.codigo||""==a.codigo?" ":a.codigo,t.Descricao=a.descricao,add_option_combobox(i,e,a.item_id,t,null,null,"col2")});var o=$(a.find(".header_col"));if(o[0]){o[0].style.width="97px",o[1].style.width="";var n=$(a.find(".ul_row"));$(n).each(function(e,i){(i=$(i)).find("li")[0].style.width="97px",i.find("li")[1].style.width=""})}e(!0),a.find(".ul_row").click(function(){var e=$(this).parent().attr("id_registro"),i=$(this).parent().parent().parent().parent().parent().parent(),a=($(this).parent(),i.find("input"));a.attr("selected-value",e),a.trigger({type:"keypress",keyCode:13,selected_value:e})})})},this.table_body=d.tab_listagem.find("tbody"),this.template_row=this.table_body.find("tr:first"),this.add_row=function(e,i,a,t){var o=!1;if($.each(d.arr_deletados,function(e,a){if(a==i.item_id)return o=!0,!1}),!o){var n=d.template_row.clone();n.removeAttr("template-row"),n.css("display",""),"S"==i.excluido&&$(n).addClass("hidden");var s=$(n.find("[template-field='cbo_item']"));create_combobox(s,d.listar_itens,"col2",!1,{pesquisar_enter:d.parametro_busca_automatica,pesquisar_tudo_seta:!1});var r=s.parent().find(".edt_combobox"),_=$(n.find(".edt_codigo_item"));_.removeClass("hidden"),_.text(i.codigo),a[e].tabela_preco_item_id=i.tabela_preco_item_id,r.keypress(function(i){var t=i.selected_value?i.selected_value:get_value_combobox(s);$(n.find("[template-field='cbo_item']")).parent().find(".edt_combobox").val(this.value),t>0&&(13==i.keyCode||"click"==i.type)&&(a[e].item_id=t,a[e].item_descricao=this.value,$(d.arr_listar_itens).each(function(i,d){d.item_id==t&&(a[e].codigo_entidade=d.codigo_entidade,a[e].preco_base=d.preco,a[e].preco_minimo=d.preco_minimo,a[e].preco_desconto=d.preco,$(n.find("[template-field='edt_codigo_entidade']")).val(void 0!==d.codigo_entidade?d.codigo_entidade:""),$(n.find("[template-field='edt_preco_base']")).maskMoney("mask",parseFloat(a[e].preco_base)).trigger("change"),$(n.find("[template-field='edt_preco_minimo']")).maskMoney("mask",parseFloat(a[e].preco_minimo)).trigger("change"),$(n.find("[template-field='edt_preco_desconto']")).maskMoney("mask",parseFloat(a[e].preco_desconto)).trigger("change"),a[e].item_descricao=d.descricao,a[e].codigo=d.codigo,_.text(d.codigo))}))}),r.val(i.item_descricao);var l=$(n.find("[template-field='edt_codigo_entidade']"));l.val(void 0!==i.codigo_entidade?i.codigo_entidade:""),l.change(function(){a[e].codigo_entidade=this.value});var c=$(n.find("[template-field='edt_preco_base']"));c.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),c.unbind("change"),c.change(function(){$(n.find("[template-field='edt_preco_base']")).val(this.value),a[e].preco_base=c.maskMoney("unmasked")[0];var i=$(n.find("[template-field='edt_preco_desconto']")),t=d.calcular_desconto(a[e].preco_base,parseFloat(a[e].desconto));i.maskMoney("mask",parseFloat(t)).trigger("change")}),c.keyup($.debounce(100,function(i){$(n.find("[template-field='edt_preco_base']")).val(this.value),a[e].preco_base=c.maskMoney("unmasked")[0];var t=$(n.find("[template-field='edt_preco_desconto']")),o=d.calcular_desconto(a[e].preco_base,parseFloat(a[e].desconto));t.maskMoney("mask",parseFloat(o)).trigger("change")})),c.maskMoney("mask",parseFloat(i.preco_base)).trigger("change");var m=$(n.find("[template-field='edt_qtde_minima']"));m.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),m.unbind("change"),m.change(function(){$(n.find("[template-field='edt_qtde_minima']")).val(this.value),a[e].quantidade_minima=m.maskMoney("unmasked")[0]}),m.maskMoney("mask",parseFloat(i.quantidade_minima)).trigger("change");var p=$(n.find("[template-field='edt_qtde_maxima']"));p.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),p.unbind("change"),p.change(function(){$(n.find("[template-field='edt_qtde_maxima']")).val(this.value),a[e].quantidade_maxima=p.maskMoney("unmasked")[0]}),p.maskMoney("mask",parseFloat(i.quantidade_maxima)).trigger("change");var b=$(n.find("[template-field='edt_preco_minimo']"));b.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),b.unbind("change"),b.change(function(){$(n.find("[template-field='edt_preco_minimo']")).val(this.value),a[e].preco_minimo=b.maskMoney("unmasked")[0]}),b.maskMoney("mask",parseFloat(i.preco_minimo)).trigger("change");var f=$(n.find("[template-field='edt_preco_maximo']"));f.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),f.unbind("change"),f.change(function(){$(n.find("[template-field='edt_preco_maximo']")).val(this.value),a[e].preco_maximo=f.maskMoney("unmasked")[0]}),f.maskMoney("mask",parseFloat(i.preco_maximo)).trigger("change");var u=$(n.find("[template-field='edt_desconto']"));u.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),u.unbind("change"),u.change(function(){$(n.find("[template-field='edt_desconto']")).val(this.value),a[e].desconto=u.maskMoney("unmasked")[0];var i=d.calcular_desconto(a[e].preco_base,a[e].desconto);$(n.find("[template-field='edt_preco_desconto']")).maskMoney("mask",parseFloat(i)).trigger("change")}),u.keyup($.debounce(100,function(i){$(n.find("[template-field='edt_desconto']")).val(this.value),a[e].desconto=u.maskMoney("unmasked")[0];var t=d.calcular_desconto(a[e].preco_base,a[e].desconto);$(n.find("[template-field='edt_preco_desconto']")).maskMoney("mask",parseFloat(t)).trigger("change")})),u.maskMoney("mask",parseFloat(i.desconto)).trigger("change");var g=$(n.find("[template-field='edt_preco_desconto']"));g.prop("readonly",!0),g.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),g.unbind("change"),g.change(function(){$(n.find("[template-field='edt_preco_desconto']")).val(this.value),a[e].preco_desconto=g.maskMoney("unmasked")[0]}),g.maskMoney("mask",parseFloat(i.preco_desconto)).trigger("change");var h=$(n.find(".btn_deletar_item"));h.unbind("click"),h.click(function(){var i=new Validation;i.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Deseja Remover?")),alert_modal("Atenção",i,"Remover",function(){a[e].excluido="S",n.remove(),a[e].item_id>0&&d.arr_deletados.push(a[e].item_id)},!0)}),i.item_id||($(n).attr("linha-nova",""),n.css("background","#969696")),n.appendTo(d.table_body),r.focus()}},this.render_novo_item=function(){$(d.arr_novos_itens).each(function(e,i){"S"==i.novo&&(d.add_row(e,i,d.arr_novos_itens,!0),delete i.novo)})},this.render_itens=function(){d.div_carregar_mais.removeClass("hidden"),d.div_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),d.div_carregar_mais.find("span.btn_carregar_mais").find("span.icn_carregar_mais").remove(),d.div_carregar_mais.find("span.btn_carregar_mais").append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),$(d.arr_itens).each(function(e,i){d.limpa_listagem&&(d.limpa_listagem=!1,d.tab_listagem.find("tr:gt(1)").not("[linha-nova]").remove()),"S"!=i.excluido&&d.add_row(e,i,d.arr_itens,!0)}),App.aplicar_mascaras(d.table_body)},this.calcular_desconto=function(e,i){var a=e*i/100;return a=a.toFixed(2),a=(a=parseFloat(e)-parseFloat(a)).toFixed(2)},this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){for(var e=!1,i=[],a=d.arr_itens.length,t=0;t<a;t++)for(var o=t;o<a;o++)t!=o&&"S"!=d.arr_itens[t].excluido&&"S"!=d.arr_itens[o].excluido&&d.arr_itens[t].item_id==d.arr_itens[o].item_id&&(e=!0,i.push(d.arr_itens[t].item_descricao));if(1==e)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Os itens abaixo estão duplicados: <br />"+i)),void alert_modal("Atenção",n);"C"==d.entidade_tipo?d.cliente_id=d.entidade_id:"O"==d.entidade_tipo&&(d.prospect_id=d.entidade_id),Object.assign(d.arr_itens,d.arr_novos_itens);var n,s={tabela_precos_id:d.tabela_precos_id,arr_entidades:JSON.stringify(d.arr_entidades),entidade_id:d.entidade_id,entidade_tipo:d.entidade_tipo,codigo:d.edt_codigo.val(),descricao:d.edt_descricao.val(),bloqueado:d.chk_bloqueado.bootstrapSwitch("state"),cliente_id:d.cliente_id,prospect_id:d.prospect_id,dt_ini:get_datepicker(d.edt_ini),dt_fim:get_datepicker(d.edt_fim),regiao_vendas_id:get_value_combobox(d.cbo_regiao_vendas),arr_itens:JSON.stringify(d.arr_itens)};if(get_datepicker(d.edt_ini)>get_datepicker(d.edt_fim))return e=!0,(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Data Inválida ! <br /><br /> A Data Inicial não pode ser inferior a Data Final.")),void alert_modal("Atenção",n);WS.post("tabela_precos/salvar",s,function(e){d.tabela_precos_id=e.id,alert_saved("Operação realizada com sucesso!"),d.unload()},[d.btn_salvar,d.btn_cancelar])}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){d.unload()}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("tabela_precos/excluir",{tabela_precos_id:d.tabela_precos_id},function(e){alert_saved(e.descricao+" excluído com sucesso"),d.unload()})}),this.btn_incluir_item.unbind("click"),this.btn_incluir_item.click(function(){d.arr_novos_itens.push({tabela_preco_item_id:null,excluido:"N",tabela_precos_id:null,item_id:null,item_descricao:null,preco_base:0,quantidade_minima:0,quantidade_maxima:0,preco_minimo:0,preco_maximo:0,desconto:0,preco_desconto:0,novo:"S"}),d.render_novo_item(!1)})}});