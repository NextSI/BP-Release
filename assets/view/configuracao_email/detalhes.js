define([],function(){return function(a){"use strict";var e=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_testar_conexao_smtp=this.dialog.find(".btn_testar_conexao_smtp"),this.btn_testar_conexao_pop=this.dialog.find(".btn_testar_conexao_pop"),this.lbl_tab_geral=this.dialog.find(".lbl_tab_geral"),this.lbl_tab_interacao=this.dialog.find(".lbl_tab_interacao"),this.edt_email_nome=this.dialog.find(".edt_email_nome"),this.edt_email=this.dialog.find(".edt_email"),this.cbo_envio_protocolo=this.dialog.find(".cbo_envio_protocolo"),this.cbo_leitura_protocolo=this.dialog.find(".cbo_leitura_protocolo"),this.edt_smtp_usuario=this.dialog.find(".edt_smtp_usuario"),this.edt_pop_usuario=this.dialog.find(".edt_pop_usuario"),this.edt_smtp_senha=this.dialog.find(".edt_smtp_senha"),this.edt_pop_senha=this.dialog.find(".edt_pop_senha"),this.edt_smtp_endereco=this.dialog.find(".edt_smtp_endereco"),this.edt_pop_endereco=this.dialog.find(".edt_pop_endereco"),this.edt_smtp_porta=this.dialog.find(".edt_smtp_porta"),this.edt_pop_porta=this.dialog.find(".edt_pop_porta"),this.cbo_smtp_seguranca=this.dialog.find(".cbo_smtp_seguranca"),this.cbo_pop_seguranca=this.dialog.find(".cbo_pop_seguranca"),this.smtp_btn=$("#smtp_btn"),this.pop_btn=$("#pop_btn"),this.chk_smtp_requer_autenticacao=this.dialog.find(".chk_smtp_requer_autenticacao"),this.chk_ignorar_emails_antigos=this.dialog.find(".chk_ignorar_emails_antigos"),this.div_quantidade_dias_email_antigo=this.dialog.find(".div_quantidade_dias_email_antigo"),this.edt_quantidade_dias_email_antigo=this.dialog.find(".edt_quantidade_dias_email_antigo"),this.chk_notificacao=this.dialog.find(".chk_notificacao"),this.chk_emails_desconhecidos=this.dialog.find(".chk_emails_desconhecidos"),this.chk_emails_agenda=this.dialog.find(".chk_emails_agenda"),this.chk_abertura_chamado=this.dialog.find(".chk_abertura_chamado"),this.chk_interacao_chamado=this.dialog.find(".chk_interacao_chamado"),this.chk_enviar_email_usuario_sem_cadastro=this.dialog.find(".chk_enviar_email_usuario_sem_cadastro"),this.chk_enviar_email_usuario_sem_cadastro_para=this.dialog.find(".chk_enviar_email_usuario_sem_cadastro_para"),this.div_lista_emails=this.dialog.find(".div_lista_emails"),this.edt_lista_emails=this.dialog.find(".edt_lista_emails"),this.table_interacao=this.dialog.find(".table_interacao"),this.edt_deletar_email_numero_tentativa=this.dialog.find(".edt_deletar_email_numero_tentativa"),this.i_ajuda_apagar_x_tentativas=this.dialog.find(".i_ajuda_apagar_x_tentativas"),this.senha_smtp="",this.senha_pop="",this.show=function(){e.preencher(),show_modal(e.modal.attr("id")),set_focus(e.edt_email)},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.preencher=function(){WS.get("conta_email/get_parametros/",null,function(a){e.edt_email.val(a.email),e.cbo_envio_protocolo.val(a.envio_protocolo),e.edt_smtp_usuario.val(a.smtp_usuario),e.edt_smtp_endereco.val(a.smtp_endereco),e.edt_smtp_porta.val(a.smtp_porta),e.cbo_smtp_seguranca.val(a.smtp_seguranca),e.cbo_leitura_protocolo.val(a.leitura_protocolo),e.edt_pop_usuario.val(a.pop_usuario),e.edt_pop_endereco.val(a.pop_endereco),e.edt_pop_porta.val(a.pop_porta),e.cbo_pop_seguranca.val(a.pop_seguranca),e.chk_smtp_requer_autenticacao.prop("checked",a.smtp_requer_autenticacao).trigger("change"),App.sessao.dados.senhas_ocultas?(e.edt_pop_senha.attr("placeholder","Alterar senha"),e.edt_smtp_senha.attr("placeholder","Alterar senha"),e.senha_smtp=a.smtp_senha,e.senha_pop=a.pop_senha):(e.edt_pop_senha.val(a.pop_senha),e.edt_smtp_senha.val(a.smtp_senha)),e.chk_ignorar_emails_antigos.prop("checked","S"==a.ignorar_emails_antigos).change(),e.edt_quantidade_dias_email_antigo.val(a.quantidade_dias_email_antigo),e.chk_emails_agenda.prop("checked","S"==a.exclui_interacao_agenda).change(),e.chk_interacao_chamado.prop("checked","S"==a.exclui_interacao_chamado).change(),e.chk_notificacao.prop("checked","S"==a.exclui_interacao_servidor).change(),e.chk_abertura_chamado.prop("checked","S"==a.exclui_interacao_abertura_chamado).change(),e.chk_emails_desconhecidos.prop("checked","S"==a.exclui_interacao_desconhecidos).change(),e.chk_enviar_email_usuario_sem_cadastro.prop("checked","S"==a.enviar_email_usuario_sem_cadastro).change(),e.chk_enviar_email_usuario_sem_cadastro_para.prop("checked","S"==a.enviar_email_usuario_sem_cadastro_para).change(),e.edt_lista_emails.val(a.lista_emails),e.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")?e.div_lista_emails.removeClass("hidden"):e.div_lista_emails.addClass("hidden"),e.edt_deletar_email_numero_tentativa.val(a.deletar_email_numero_tentativa),e.i_ajuda_apagar_x_tentativas.tooltip({title:'Informe a quantidade de tentativas de envio, após essa quantidade, caso não tenha sucesso o e-mail será excluído<br /><b>OBS: para não excluir e-mails coloque "0".</b>',html:!0,placement:"auto",container:"body"})})},this.atualizar_tabela=function(){e.table_interacao.find("tr:not(.hidden)").each(function(a){$(this).toggleClass("active",!!(1&a))})},this.chk_ignorar_emails_antigos.change(function(){e.chk_ignorar_emails_antigos.prop("checked")?e.div_quantidade_dias_email_antigo.removeClass("hidden"):e.div_quantidade_dias_email_antigo.addClass("hidden"),e.atualizar_tabela()}),this.chk_enviar_email_usuario_sem_cadastro_para.change(function(){e.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")?e.div_lista_emails.removeClass("hidden"):e.div_lista_emails.addClass("hidden"),e.atualizar_tabela()}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){e.unload()}),this.btn_testar_conexao_smtp.unbind("click"),this.btn_testar_conexao_smtp.click(function(){View.load("configuracao_email/teste_smtp",function(a,t){t.show(e.cbo_envio_protocolo.val(),e.edt_email.val(),e.edt_smtp_usuario.val(),e.edt_smtp_senha.val(),e.edt_smtp_endereco.val(),e.edt_smtp_porta.val(),e.cbo_smtp_seguranca.val(),e.chk_smtp_requer_autenticacao.prop("checked"))})}),this.btn_testar_conexao_pop.unbind("click"),this.btn_testar_conexao_pop.click(function(){WS.post("conta_email/testar_conexao_pop",{leitura_protocolo:e.cbo_leitura_protocolo.val(),pop_usuario:e.edt_pop_usuario.val(),pop_senha:e.edt_pop_senha.val(),pop_endereco:e.edt_pop_endereco.val(),pop_porta:e.edt_pop_porta.val(),pop_seguranca:e.cbo_pop_seguranca.val()},function(a){},[e.btn_testar_conexao_pop,e.btn_testar_conexao_smtp,e.btn_salvar])}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){e.chk_enviar_email_usuario_sem_cadastro_para.prop("checked")&&""==e.edt_lista_emails.val()?alert_modal("Nenhum e-mail informado.",'Informe pelo menos um e-mail ou desabilite a opção:<br /> "Enviar e-mail de usuário inválido para".'):WS.post("conta_email/salvar_config_email",{email:e.edt_email.val(),envio_protocolo:e.cbo_envio_protocolo.val(),smtp_usuario:e.edt_smtp_usuario.val(),smtp_senha:""==e.edt_smtp_senha.val()?e.senha_smtp:e.edt_smtp_senha.val(),smtp_endereco:e.edt_smtp_endereco.val(),smtp_porta:e.edt_smtp_porta.val(),smtp_seguranca:e.cbo_smtp_seguranca.val(),leitura_protocolo:e.cbo_leitura_protocolo.val(),pop_usuario:e.edt_pop_usuario.val(),pop_senha:""==e.edt_pop_senha.val()?e.senha_pop:e.edt_pop_senha.val(),pop_endereco:e.edt_pop_endereco.val(),pop_porta:e.edt_pop_porta.val(),pop_seguranca:e.cbo_pop_seguranca.val(),smtp_requer_autenticacao:e.chk_smtp_requer_autenticacao.prop("checked"),ignorar_emails_antigos:e.chk_ignorar_emails_antigos.prop("checked"),quantidade_dias_email_antigo:e.edt_quantidade_dias_email_antigo.val(),exclui_interacao_agenda:e.chk_emails_agenda.prop("checked"),exclui_interacao_desconhecidos:e.chk_emails_desconhecidos.prop("checked"),exclui_interacao_chamado:e.chk_interacao_chamado.prop("checked"),exclui_interacao_servidor:e.chk_notificacao.prop("checked"),exclui_interacao_abertura_chamado:e.chk_abertura_chamado.prop("checked"),enviar_email_usuario_sem_cadastro:e.chk_enviar_email_usuario_sem_cadastro.prop("checked"),enviar_email_usuario_sem_cadastro_para:e.chk_enviar_email_usuario_sem_cadastro_para.prop("checked"),lista_emails:e.edt_lista_emails.val(),deletar_email_numero_tentativa:e.edt_deletar_email_numero_tentativa.val()},function(a){alert_saved("Configurações salvas com sucesso"),e.unload()},[e.btn_testar_conexao_pop,e.btn_testar_conexao_smtp,e.btn_salvar,e.btn_cancelar])}),this.smtp_btn.click(function(){var a=$("#edt_smtp_senha"),e=$("#ico_smtp_senha");e.removeClass(),"password"==a.attr("type")?(a.attr("type","text"),e.addClass("glyphicon glyphicon-eye-close")):(a.attr("type","password"),e.addClass("glyphicon glyphicon-eye-open"))}),this.pop_btn.click(function(){var a=$("#edt_pop_senha"),e=$("#ico_pop_senha");e.removeClass(),"password"==a.attr("type")?(a.attr("type","text"),e.addClass("glyphicon glyphicon-eye-close")):(a.attr("type","password"),e.addClass("glyphicon glyphicon-eye-open"))}),e.chk_smtp_requer_autenticacao.change(function(){const a=!e.chk_smtp_requer_autenticacao.prop("checked");e.edt_smtp_usuario.prop("readonly",a),e.edt_smtp_senha.prop("readonly",a)})}});