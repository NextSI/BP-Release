define([],function(){return function(a){"use strict";var e=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.arr_eventos=[],this.view_aviso=this.dialog.find("[aviso]"),this.view_eventos=this.dialog.find("[container-eventos]"),this.agenda_recorrente_id=null,this.agenda_evento_id=null,this.dia_evento=null,this.agenda_ativo_id=null,this.tipo_reprogramacao=null,this.loading=this.dialog.find("[loading]"),this.scheme_parametros={usuario_id:null,agenda_recorrente_id:null,agenda_ativo_id:null,limite:0,agenda_evento_origem_id:null,dia_evento:null,tipo_reprogramacao:null},this.show=function(a){a=extender_parametros(e.scheme_parametros,a),e.agenda_recorrente_id=a.agenda_recorrente_id,e.agenda_evento_id=a.agenda_evento_origem_id,e.agenda_ativo_id=a.agenda_ativo_id,e.dia_evento=a.dia_evento,e.tipo_reprogramacao=a.tipo_reprogramacao,e.listar(a),show_modal(e.modal.attr("id"))},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose()},this.listar=function(a){var t=function(a,t){var i=$.Tabela_Padrao_Next.create_row(e.tab_listagem),o=null!=a.hora_inicio?a.hora_inicio:"-",n=null!=a.hora_fim?a.hora_fim:"-",r=null!=a.dia?a.dia.format_date():"-",d=$.Tabela_Padrao_Next.getColumn(i,"dia");$(d).html(r+d.html());var l=$.Tabela_Padrao_Next.getColumn(i,"hora_inicio"),s=$.Tabela_Padrao_Next.getColumn(i,"hora_fim"),_=$.Tabela_Padrao_Next.getColumn(i,"gerar div"),c=$.Tabela_Padrao_Next.getColumn(d,"gerar div"),g=$(c).find(".template_switch");$(g).attr("data-size","mini"),$(g).removeClass("template_switch");var h=$(_).find(".template_switch");$(h).attr("data-size","mini"),$(h).removeClass("template_switch"),App.aplicar_checkbox(_),App.aplicar_checkbox(c),e.arr_eventos.push({id:a.id,data:a.dia,registrar:h.prop("checked")}),"R"==a.tipo?($(h).change(function(a){var i=$(this).prop("checked");$(g).prop("checked",i),e.arr_eventos[t].registrar=i}),$(g).change(function(a){var i=$(this).prop("checked");$(h).prop("checked",i),e.arr_eventos[t].registrar=i})):($(h).addClass("disabled").attr("disabled","disabled"),$(g).addClass("disabled").attr("disabled","disabled")),$.Tabela_Padrao_Next.getColumn(d,"dia").attr("data-bp-column-value",r);var m=$.Tabela_Padrao_Next.getColumn(d,"hora_inicio").attr("data-bp-column-value",o),p=$.Tabela_Padrao_Next.getColumn(d,"hora_fim").attr("data-bp-column-value",n),v=document.createElement("div"),u=document.createElement("div");$(v).text(o),$(u).text(n),"S"==a.excede&&($(v).attr("title",App.lang.gestao_agenda.recorrencia_excede_calendario).tooltip(),$(u).attr("title",App.lang.gestao_agenda.recorrencia_excede_calendario).tooltip(),$(l).addClass("bg-danger"),$(s).addClass("bg-danger"),$(m).attr("data-destacar","").attr("title",App.lang.gestao_agenda.recorrencia_excede_calendario).tooltip(),$(p).attr("data-destacar","").attr("title",App.lang.gestao_agenda.recorrencia_excede_calendario).tooltip()),$(l).append(v),$(s).append(u),$.Tabela_Padrao_Next.RenderRow(e.tab_listagem,i)};e.loading.removeClass("hidden"),WS.get("agenda_evento/listar_eventos_recorrentes/",a,function(a){if(a){for(var i=0;i<a.length;i++){var o=a[i];t(o,i)}e.loading.addClass("hidden"),$(e.tab_listagem.tabela).removeClass("hidden")}},[e.btn_confirmar])},this.unload=function(){e.close(),View.unload(this.html_id)},this.btn_confirmar.unbind("click").click(function(a){e.view_eventos.addClass("hidden"),e.view_aviso.removeClass("hidden");var t={eventos:e.arr_eventos,agenda_evento_id:e.agenda_evento_id,tipo_reprogramacao:e.tipo_reprogramacao},i={eventos:JSON.stringify(t)};WS.post({route:"agenda_evento/confirmar_eventos_recorrentes/",data:i,type:"POST",func_response:function(a){a?(alert_saved(App.lang.gestao_agenda.eventos_recorrentes_criados),e.unload()):(alert_fail(App.lang.gestao_agenda.eventos_recorrentes_nao_criados),e.unload())},disable_buttons:[e.btn_confirmar]})})}});