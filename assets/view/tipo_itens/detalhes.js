define([],function(){return function(o){"use strict";var i=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.title=App.lang.tipo_item.aba_detalhes,this.onclose=null,this.params={tipo_itens_id:null,tipo:FORMULARIO.NOVO},this.codigo_automatico=!1,this.cbo_motivo=this.dialog.find(".cbo_motivo"),this.cbo_local=this.dialog.find(".cbo_local"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.aba_geral=this.dialog.find(".aba_geral"),this.aba_modulo=this.dialog.find(".aba_modulo"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_modulo=this.dialog.find(".menu_modulo"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.chk_modulo_crm=this.dialog.find(".chk_modulo_crm"),this.chk_modulo_projeto=this.dialog.find(".chk_modulo_projeto"),this.cbo_vincular_form=this.dialog.find(".cbo_vincular_form"),this.frm_personalizados=this.dialog.find(".frm_personalizados"),this.menu_personalizados_tab=this.dialog.find(".menu_personalizados_tab"),this.formulario_id=null,this.formulario_alterado_id=null,this.tipo_formulario=1,this.show=function(o){switch(i.params=extender_parametros(i.params,o),i.inicializar_componentes(),null!=i.params.tipo_itens_id?i.preencher():i.render_formulario(null),i.params.tipo){case FORMULARIO.NOVO:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0),set_focus(i.edt_codigo);break;case FORMULARIO.EDITAR:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}},this.preencher=function(){WS.get({route:"tipo_itens/objeto/",data:{tipo_itens_id:i.params.tipo_itens_id},func_response:function(o){if(o){var a=spread({},{codigo:"",descricao:"",bloqueado:i.chk_bloqueado.prop("checked"),modulo_projeto:i.chk_modulo_projeto.prop("checked"),modulo_crm:i.chk_modulo_crm.prop("checked"),formulario_id:null},{codigo:o.codigo,descricao:o.descricao,bloqueado:o.bloqueado,modulo_projeto:o.modulos.projeto,modulo_crm:o.modulos.crm,formulario_id:o.formulario_id||null});i.formulario_id=a.formulario_id,i.formulario_alterado_id=a.formulario_id,i.render_formulario(a.formulario_id),i.edt_codigo.val(a.codigo),i.edt_descricao.val(a.descricao),i.chk_bloqueado.prop("checked",a.bloqueado).trigger("change"),i.chk_modulo_crm.prop("checked",a.modulo_crm).trigger("change"),i.chk_modulo_projeto.prop("checked",a.modulo_projeto).trigger("change"),i.params.tipo!=FORMULARIO.NOVO&&i.params.tipo!=FORMULARIO.EDITAR&&(i.chk_modulo_crm.prop("disabled",!0),i.chk_modulo_projeto.prop("disabled",!0),i.chk_bloqueado.prop("disabled",!0))}}})},this.render_formulario=function(o){WS.get("formulario/listar/",{tipo_formulario:i.tipo_formulario},function(a){i.cbo_vincular_form.find("option").remove(),add_option(i.cbo_vincular_form,"0","Nenhum"),$(a).each(function(a,t){add_option(i.cbo_vincular_form,t.formulario_id,t.nome),i.formulario_id==t.formulario_id&&t.nome,o&&setTimeout(()=>{i.cbo_vincular_form.val(o).trigger("change")}),i.cbo_vincular_form.selectpicker("refresh")})})},i.cbo_vincular_form.unbind("change"),i.cbo_vincular_form.change(function(o){i.formulario_alterado_id=i.cbo_vincular_form.val()}),this.permite_alterar=function(o){i.edt_descricao.prop("readonly",!o),i.edt_codigo.prop("readonly",!o)},this.close=function(){void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){null==i.params.tipo_itens_id&&i.carregar_configuracoes(function(){i.codigo_automatico&&i.get_next_codigo()}),i.aba_geral.attr("id","aba_geral"+i.html_id),i.aba_modulo.attr("id","aba_modulo"+i.html_id),i.frm_personalizados.attr("id","frm_personalizados"+i.html_id),i.menu_geral.attr("href","#"+i.aba_geral.attr("id")),i.menu_modulo.attr("href","#"+i.aba_modulo.attr("id")),i.menu_personalizados_tab.attr("href","#"+i.frm_personalizados.attr("id"))},this.get_next_codigo=function(){WS.get("tipo_itens/gerar_codigo/",null,function(o){o&&i.edt_codigo.val(o)})},this.carregar_configuracoes=function(o){WS.get("tipo_itens/get_parametro/",null,function(a){a&&(i.codigo_automatico="S"==a.tipo_itens_codigo_automatico,void 0!==o&&o())})},this.btn_salvar.unbind("click").click(function(o){i.formulario_alterado_id!=i.formulario_id&&null!=i.formulario_id?alert_modal("Atenção","Tem certeza que deseja alterar o formulário vinculado?","Confirmar",i.salvar,!0,"Cancelar",null,null,"modal-lg"):i.salvar()}),this.salvar=function(){var o={tipo_itens_id:i.params.tipo_itens_id,descricao:i.edt_descricao.val(),codigo:i.edt_codigo.val(),bloqueado:i.chk_bloqueado.prop("checked"),modulos:JSON.stringify({projeto:i.chk_modulo_projeto.prop("checked"),crm:i.chk_modulo_crm.prop("checked")})},a=extender_parametros({tipo_itens_id:null,descricao:null,codigo:null,formulario_id:i.formulario_alterado_id},o);WS.post({route:"tipo_itens/salvar",data:a,type:"POST",func_response:function(o){o&&(alert_saved(App.lang.tipo_item.alerta+a.descricao+App.lang.tipo_item.alerta_salvo),i.unload())},disable_buttons:[i.btn_salvar,i.btn_cancelar]})},this.btn_excluir.unbind("click").click(function(o){WS.post({route:"tipo_itens/excluir",data:{tipo_itens_id:i.params.tipo_itens_id},type:"POST",func_response:function(o){o&&(alert_saved(App.lang.tipo_item.alerta+i.edt_descricao.val()+App.lang.tipo_item.alerta_exclusao),i.unload())},disable_buttons:[i.btn_excluir,i.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(o){i.unload()})}});