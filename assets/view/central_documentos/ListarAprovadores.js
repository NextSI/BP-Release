"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,a,r){return a&&_defineProperties(e.prototype,a),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,a){return!a||"object"!==_typeof(a)&&"function"!=typeof a?_assertThisInitialized(e):a}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&_setPrototypeOf(e,a)}function _setPrototypeOf(e,a){return(_setPrototypeOf=Object.setPrototypeOf||function(e,a){return e.__proto__=a,e})(e,a)}define(["react","react-dom"],function(e,a){return function(a){function r(e){var a;return _classCallCheck(this,r),(a=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).state={arrAprovadores:{},arrAprovadoresManual:[],documento_id:0,documento_pasta_id:0},a.handleDeletarLinha=a.handleDeletarLinha.bind(_assertThisInitialized(a)),a.handleAlterarNivel=a.handleAlterarNivel.bind(_assertThisInitialized(a)),a.handleAlterarTipoAprovacao=a.handleAlterarTipoAprovacao.bind(_assertThisInitialized(a)),a.props.arrAprovadores=[],a.props.arrAprovadoresManual=[],a.props.setAlcadaSelecionada=function(e){a.listar_aprovadores_predefinida(e,!1)},a.props.setDocumentoPastaSelecionada=function(e){a.setState({documento_pasta_id:e}),a.listar_aprovadores_manual(e)},a.props.setDocumentoSelecionado=function(e){a.setState({documento_id:e}),a.listar_aprovadores_manual_documento(e)},a.props.setAprovadoresManual=function(e){if(null==e)a.setState({arrAprovadoresManual:[]});else if("usuarios"==e.tipo){var r={},t=a.state.arrAprovadoresManual.length;r.usuario_id=e.id,r.aprovador_usuario_nome=e.nome,r.nivel=0==t?"1":parseInt(a.state.arrAprovadoresManual[t-1].nivel),r.tipo_aprovacao="2",r.tipo_aprovador=TIPO_APROVADOR.USUARIO;var o=a.state.arrAprovadoresManual.slice();o.push(r),a.setState({arrAprovadoresManual:o})}else if("grupo_usuarios"==e.tipo){var n={};n.grupo_usuarios_id=e.id,n.aprovador_grupo_nome=e.nome,n.nivel="1",n.tipo_aprovacao="2",n.tipo_aprovador=TIPO_APROVADOR.GRUPO_USUARIOS;var l=a.state.arrAprovadoresManual.slice();l.push(n),a.setState({arrAprovadoresManual:l})}else if("alcada_generica"==e.tipo){var i=_assertThisInitialized(a);a.state.arrAprovadores.length||a.state.arrAprovadoresManual.length?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Esta ação irá limpar os aprovadores selecionados, deseja continuar ?","Sim",function(){i.state.arrAprovadores.length&&i.setState({arrAprovadores:[]}),i.state.arrAprovadoresManual.length&&i.setState({arrAprovadoresManual:[]}),i.listar_aprovadores_predefinida(e.id,!0)},!0):i.listar_aprovadores_predefinida(e.id,!0)}},a}return _inherits(r,e.Component),_createClass(r,[{key:"listar_aprovadores_predefinida",value:function(e,a){var r=this;null==e?r.setState({arrAprovadores:[]}):WS.get("alcada_aprovadores/objeto/",{alcada_generica_id:e},function(e){if(null!==e)if(a){var t=r.state.arrAprovadoresManual.slice();e.aprovadores.forEach(function(a){a.tipo_aprovador=null!=a.usuario_id?TIPO_APROVADOR.USUARIO:TIPO_APROVADOR.GRUPO_USUARIOS,a.nome_alcada_predefinida=e.nome_alcada_generica,t.push(a)},this),r.setState({arrAprovadoresManual:t})}else r.setState({arrAprovadores:e})})}},{key:"listar_aprovadores_manual",value:function(e){var a=this;null==e?a.setState({arrAprovadoresManual:[]}):WS.get("alcada_aprovadores/listar_aprovadores_manual/",{documento_pasta_id:e},function(e){e&&(e.forEach(function(e){1==e.tipo_aprovador?(delete e.grupo_usuario_id,delete e.aprovador_grupo_nome):2==e.tipo_aprovador&&(delete e.usuario_id,delete e.aprovador_usuario_nome)},this),a.setState({arrAprovadoresManual:e}))})}},{key:"listar_aprovadores_manual_documento",value:function(e){var a=this;null==e?a.setState({arrAprovadoresManual:[]}):WS.get("alcada_aprovadores/listar_aprovadores_manual_documento/",{documento_id:e},function(e){e&&(e.forEach(function(e){1==e.tipo_aprovador?(delete e.grupo_usuario_id,delete e.aprovador_grupo_nome):2==e.tipo_aprovador&&(delete e.usuario_id,delete e.aprovador_usuario_nome)},this),a.setState({arrAprovadoresManual:e}))})}},{key:"OrdenarVetor",value:function(){this.setState({arrAprovadoresManual:this.state.arrAprovadoresManual.sort(function(e,a){var r=e.nivel,t=a.nivel;return parseInt(r)<parseInt(t)?-1:parseInt(r)>parseInt(t)?1:0})})}},{key:"handleAlterarNivel",value:function(e,a){e.nivel=a.target.value,this.OrdenarVetor()}},{key:"handleAlterarTipoAprovacao",value:function(e,a){e.tipo_aprovacao=a.target.value}},{key:"handleDeletarLinha",value:function(e,a){var r=this,t={usuario_id:a.usuario_id,documento_id:this.state.documento_id,documento_pasta_id:this.state.documento_pasta_id,grupo_usuario_id:a.grupo_usuarios_id};WS.get("documento/verifica_aprovador/",t,function(t){if(t.length>0){var o="";if(a.usuario_id>0)o="Usuário não pode ser removido, pois, tem aprovação pendente.";else if(a.grupo_usuarios_id>0){var n=[];t.forEach(function(e){n.push(e.nome)}),o="Grupo não pode ser removido, pois, existe um ou mais usuários com aprovação pendente: ["+n.join(", ")+"]"}alert_modal("Aprovador",o)}else r.state.arrAprovadoresManual.splice(e,1),r.OrdenarVetor()})}},{key:"render",value:function(){this.props.arrAprovadores=this.state.arrAprovadores,this.props.arrAprovadoresManual=this.state.arrAprovadoresManual;var a=[],r=[];if(Object.keys(this.state.arrAprovadores).length)$(this.state.arrAprovadores.aprovadores).each(function(r,t){a.push(e.createElement("tr",{"template-row":!0,style:{cursor:"not-allowed",opacity:"0.5"},key:"Aprovadores"+r},e.createElement("td",{style:{width:"10%"},key:t.nivel},e.createElement("input",{type:"number","template-field":"nivel",className:"form-control edt_nivel",value:t.nivel,style:{pointerEvents:"none"}})),e.createElement("td",{style:{fontSize:"12px"}},e.createElement("span",{"template-field":"label_tipo",className:"label "+(null!=t.aprovador_usuario_nome?"label-info":"label-warning"),style:{verticalAlign:"middle"}},null!=t.aprovador_usuario_nome?"U":"GU")," ",e.createElement("span",{"template-field":"aprovador",style:{verticalAlign:"middle"}},null!=t.aprovador_usuario_nome?t.aprovador_usuario_nome:t.aprovador_grupo_nome)),e.createElement("td",null,e.createElement("select",{"template-field":"tipo_aprovacao",className:"form-control",value:t.tipo_aprovacao,style:{pointerEvents:"none"}},e.createElement("option",{value:"1"},"Apenas um usuário"),e.createElement("option",{value:"2"},"Todos os usuários")))))}),r.push(e.createElement("tr",null,e.createElement("td",null,"Nível"),e.createElement("td",null,"Aprovador"),e.createElement("td",null,"Tipo de aprovação")));else if(Object.keys(this.state.arrAprovadoresManual).length){var t=this;$(this.state.arrAprovadoresManual).each(function(r,o){var n=this,l=md5(Math.random()+new Date+Math.random()+md5(Math.random()));a.push(e.createElement("tr",{"template-row":!0,key:"AprovadoresManual"+l},e.createElement("td",{style:{width:"10%"}},e.createElement("input",{type:"number","template-field":"nivel",className:"form-control edt_nivel",defaultValue:o.nivel,onChangeCapture:function(){return t.handleAlterarNivel(n,event)}})),e.createElement("td",{style:null!=o.nome_alcada_predefinida?{fontSize:"12px"}:{fontSize:"initial"}},null!=o.nome_alcada_predefinida?e.createElement("div",null,e.createElement("span",{"template-field":"alcada_predefinida",className:"label label-danger",style:{verticalAlign:"middle"}},"AP")," ",e.createElement("span",{"template-field":"alcada_predefinida_nome",style:{verticalAlign:"middle"}},o.nome_alcada_predefinida)):"",e.createElement("span",{"template-field":"label_tipo",className:"label "+(null!=o.aprovador_usuario_nome?"label-info":"label-warning"),style:{verticalAlign:"middle"}},null!=o.aprovador_usuario_nome?"U":"GU")," ",e.createElement("span",{"template-field":"aprovador",style:{verticalAlign:"middle"}},null!=o.aprovador_usuario_nome?o.aprovador_usuario_nome:o.aprovador_grupo_nome)),e.createElement("td",null,e.createElement("select",{"template-field":"tipo_aprovacao",className:"form-control",defaultValue:o.tipo_aprovacao,onChangeCapture:function(){return t.handleAlterarTipoAprovacao(n,event)}},e.createElement("option",{value:"1"},"Apenas um usuário"),e.createElement("option",{value:"2"},"Todos os usuários"))),e.createElement("td",null,e.createElement("button",{type:"button",className:"btn btn-default btn_remover_aprovador pull-right",onClick:function(){return t.handleDeletarLinha(r,n)}},e.createElement("span",{className:"glyphicon glyphicon-trash"}),e.createElement("span",{className:"hidden-xs"},"Remover")))))}),r.push(e.createElement("tr",null,e.createElement("td",null,"Nível"),e.createElement("td",null,"Aprovador"),e.createElement("td",null,"Tipo de aprovação"),e.createElement("td",null," ")))}return(0!=this.state.arrAprovadores.length||0!=this.state.arrAprovadoresManual.length)&&e.createElement("div",{className:"row"},e.createElement("table",{className:"tab_listagem table table-striped table-hover"},e.createElement("thead",null,r),e.createElement("tbody",null,a)))}}]),r}()});