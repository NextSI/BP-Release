define(["react","react-dom","./../componentes_react/InformativoPrazo","./../componentes_react/InputArquivo","./../oportunidade/DashboardRepresentante"],function(e,a,i,o,t){return function(n){"use strict";var r=this;this.html_id=n,this.dialog=$("#"+this.html_id),this.title="Home",this.drawer=this.dialog.find(".drawer"),this.divLadoEsquerdo=this.dialog.find(".divLadoEsquerdo"),this.divMeio=this.dialog.find(".divMeio"),this.div_painel_modulos=this.dialog.find(".div_painel_modulos"),this.div_menu=this.dialog.find(".div_menu"),this.template_menu_modulos=this.dialog.find(".template_menu_modulos"),this.painel_mensagem_mural=this.dialog.find(".painel_mensagem_mural"),this.div_load=this.dialog.find(".div_load"),this.mural_mensagem_div=this.dialog.find(".mural_mensagem_div"),this.div_marcar=this.dialog.find(".div_marcar"),this.div_marcar_resposta=this.dialog.find(".div_marcar_resposta"),this.div_cockpit=this.dialog.find(".div_cockpit"),this.div_cockpit_header=this.dialog.find(".div_cockpit_header"),this.cockpitComponent=this.dialog.find(".cockpitComponent"),this.div_dashboard_representante_grafico_meta=this.dialog.find(".div_dashboard_representante_grafico_meta"),this.dx_listagem_timeline=this.dialog.find(".dx_listagem_timeline"),this.scrollview=this.dialog.find(".scrollview"),this.txt_timeline=this.dialog.find(".txt_timeline"),this.nome_usuario_timeline=this.dialog.find(".nome_usuario_timeline"),this.itens_timeline=this.dialog.find(".itens_timeline"),this.ul_supervisionados=this.dialog.find(".ul_supervisionados"),this.edt_nome_supervisionado=this.dialog.find(".edt_nome_supervisionado"),this.btn_refresh=this.dialog.find(".btn_refresh"),this.btn_view_wrap=this.dialog.find(".btn_view_wrap"),this.btn_view_inline=this.dialog.find(".btn_view_inline"),this.btn_expandir_cockpit=this.dialog.find(".btn_expandir_cockpit"),this.btn_retrair_cockpit=this.dialog.find(".btn_retrair_cockpit"),this.list_timeline=this.dialog.find(".list_timeline"),this.list_mural=this.dialog.find(".list_mural"),this.btn_mural_nova_mensagem=this.dialog.find(".btn_mural_nova_mensagem"),this.btn_mural_nova_votacao=this.dialog.find(".btn_mural_nova_votacao"),this.btn_gestao_mural=this.dialog.find(".btn_gestao_mural"),this.div_mural_nova_votacao=this.dialog.find(".div_mural_nova_votacao"),this.div_nova_votacao=r.div_mural_nova_votacao.find(".media-body"),this.react_component_nova_votacao=null,this.btn_toggle_notas=this.dialog.find(".btn_toggle_notas"),this.btn_toggle_favoritos=this.dialog.find(".btn_toggle_favoritos"),this.btn_expandir_timeline=this.dialog.find(".btn_expandir_timeline"),this.btn_retrair_timeline=this.dialog.find(".btn_retrair_timeline"),this.btn_config_timeline=this.dialog.find(".btn_config_timeline"),this.div_mostar_mais_mensagem=this.dialog.find(".div_mostar_mais_mensagem"),this.btn_mostrar_mais_mensagem=this.dialog.find(".btn_mostrar_mais_mensagem"),this.btn_voltar_ao_topo=this.dialog.find(".btn_voltar_ao_topo"),this.opt_realizado=this.dialog.find(".opt_realizado"),this.div_dashboard_representante=this.dialog.find(".div_dashboard_representante"),this.div_dashboard_crm=this.dialog.find(".div_dashboard_crm"),this.graficos_dashboard_crm=this.dialog.find(".graficos_dashboard_crm"),this.btn_expandir_dashboard=this.dialog.find(".btn_expandir_dashboard"),this.btn_retrair_dashboard=this.dialog.find(".btn_retrair_dashboard"),this.div_dashboard_header=this.dialog.find(".div_dashboard_header"),this.btn_expandir_aniversariantes=this.dialog.find(".btn_expandir_aniversariantes"),this.btn_retrair_aniversariantes=this.dialog.find(".btn_retrair_aniversariantes"),this.div_aniversariantes=this.dialog.find(".div_aniversariantes"),this.div_aniversariantes_header=this.dialog.find(".div_aniversariantes_header"),this.div_card_notas=this.dialog.find(".div_card_notas"),this.divComponenteAniversariantes=this.dialog.find(".divComponenteAniversariantes"),this.dropdown=this.dialog.find(".dropdown"),this.documento_confirmacao_distribuicao=e.createElement(o,null,null),this.dashboard_representante=e.createElement(t,null,null),this.context_menu_oportunidade=this.dialog.find(".context_menu_oportunidade"),this.menu=[],this.arr_mural=[],this.arr_mural_comentario=[],this.arr_time_line=[],this.arr_time_line_toggle=[],this.ultima_mensagem_mural_id=null,this.nova_mensagem_mural=!1,this.maior_id=null,this.altura_mural=null,this.count_mensagem=null,this.mostrar_botao=!1,this.arr_usuario_marcado=[],this.arr_usuario_marcado_aux=[],this.exibir_dias_sem_evento=!0,this.qtd_dias=8,this.supervisor_id=null,this.supervisionado_id=null,this.supervisor_nome=null,this.supervisionado_nome=null,this.qtde_pub_mural=null,this.qtde_pub_mural_now=null,this.usuario_logado=App.sessao.usuario_id,this.token_sessao=App.sessao.token,this.usuario_id=null,this.lista_supervisionados=null,this.filtro_nome_supervisionado=null,this.instanceDxDocumentos=null,this.instanceDxSolicitacoes=null,this.dx_listagem_timeline_instance=null,this.instanceDrawer=null,this.mostra_div_cockpit=!0,this.mostra_div_dashboard=!0;var s=zebra_color();this.listagem_inicial=null,this.div_drawer_right=null,this.show=function(){detectmob()&&(r.divLadoEsquerdo.appendTo(r.divLadoEsquerdo.parent()),r.divLadoEsquerdo.toggleClass("divMeio divLadoEsquerdo"),r.divMeio.toggleClass("divMeio divLadoEsquerdo")),r.scrollview.dxScrollView({useNative:!0}).dxScrollView("instance"),r.scrollview.css("height","calc(100vh - 260px)"),1==App.sessao.dados.alterar_senha_proximo_login&&View.load("opcoes_usuario/senha",function(e,a){a.show(null,!0)}),App.sessao.dados.admin?r.btn_toggle_favoritos.removeClass("hidden"):(App.verifica_permissao(App.sessao.dados.empresa_filial_id,"gestao_documentos")||App.verifica_permissao(App.sessao.dados.empresa_filial_id,"gestao_processos"))&&r.btn_toggle_favoritos.removeClass("hidden"),r.render_drawer_right(),App.get_parametro_usuario("versao_ultimo_login"),void 0!==App.sessao.dados.parametro_usuario.cockpit&&(r.mostra_div_cockpit=App.sessao.dados.parametro_usuario.cockpit.exibe),void 0!==App.sessao.dados.parametro_usuario.dashboard&&(r.mostra_div_dashboard=App.sessao.dados.parametro_usuario.dashboard.exibe),$(".metro-md").hover(function(){$(this).addClass("text-primary")},function(){$(this).removeClass("text-primary")}),App.sessao.dados.menu_lateral||require(["./assets/view/menu/menu"],function(e){r.menu=(new e).menu;for(var a=0;a<r.menu.length;a++)void 0!==r.menu[a].permissao&&r.menu[a].permissao&&!App.verifica_permissao(App.temp.empresa,r.menu[a].permissao)||function(e){var a=r.template_menu_modulos.clone();a.removeClass("template_menu_modulos"),a.css("display",""),$(a.find(".icone")).attr("src",r.menu[e].icone),$(a.find("[template-field='modulo_nome']")).text(r.menu[e].nome),void 0!==r.menu[e].click&&r.menu[e].click&&a.click(r.menu[e].click).css("cursor","pointer"),$(a.find(".btn_menu")).click(function(a){a.stopPropagation(),View.hide(r.html_id),View.load("menu/menu_modulo",function(a,i){i.show(e)})}),r.div_menu.append(a)}(a);r.div_menu.append('<span class="list-group-item" style="height: 0px; padding: 0px; margin: 0px;"></span>'),r.div_painel_modulos.show()}),void 0!==App.sessao.dados.parametro_usuario.timeline_usuario&&App.sessao.dados.parametro_usuario.timeline_usuario.timeline_usuario_qtd_dias&&(r.qtd_dias=App.sessao.dados.parametro_usuario.timeline_usuario.timeline_usuario_qtd_dias),void 0!==App.sessao.dados.parametro_usuario.timeline_usuario&&App.sessao.dados.parametro_usuario.timeline_usuario.timeline_usuario_exibir_dias_sem_evento&&(r.exibir_dias_sem_evento="S"==App.sessao.dados.parametro_usuario.timeline_usuario.timeline_usuario_exibir_dias_sem_evento),View.setInterval(r.html_id,function(){WS.get("ping/",{},function(e){})},6e5),View.setInterval(r.html_id,function(){View.get_md5_tela_ativa()==r.html_id&&(r.usuario_logado==App.sessao.usuario_id&&r.token_sessao==App.sessao.token?(App.count_notificacao(),r.refresh_timeline(),r.nova_mensagem_mural=!0,r.listar_mural(!0)):(r.qtde_pub_mural=null,r.qtde_pub_mural_now=null))},3e5),r.nova_mensagem_mural=!1,r.carregar_timeline(!0),View.setInterval(r.html_id,function(){r.verificar_eventos()},3e4)},this.get_home_drawer_right_opcoes=function(){return spread({componente:null},App.get_parametro_usuario("home_drawer_right_opcoes"))},this.render_drawer_right=function(){if(r.instanceDrawer)return!1;View.setShowEvent(r.html_id,function(){var e=r.get_home_drawer_right_opcoes();r.drawer_right_resize(!!e.componente)});var e=r.get_home_drawer_right_opcoes(),a=function(e){r.home_drawer_right_alterar_opcoes=e};r.instanceDrawer=r.drawer.dxDrawer({opened:!!e.componente,position:"right",revealMode:"expand",animationEnabled:!1,template:function(e){var i=r.get_home_drawer_right_opcoes();return e.addClass("hidden-xs"),r.div_drawer_right=$("<div>").width(300).css({marginLeft:10,paddingRight:14}),ReactDOM.render(React.createElement(window.components.HomeDrawerRight.default,{componente:i.componente,callbackAlterarOpcoes:a}),r.div_drawer_right[0]),r.div_drawer_right}}).dxDrawer("instance"),setTimeout(function(){r.instanceDrawer.repaint()})},this.contar_mural=function(){null!=r.qtde_pub_mural?(WS.get("mural_mensagem/contar_mural/",{usuario_id:App.sessao.usuario_id},function(e){if(r.qtde_pub_mural_now=e[0].qtde_publicacoes,r.qtde_pub_mural<r.qtde_pub_mural_now){var a=r.qtde_pub_mural_now-r.qtde_pub_mural==1?"Você tem uma nova Mensagem":"Você tem novas Mensagens",i=r.qtde_pub_mural_now-r.qtde_pub_mural==1?"Você possui 1 nova Mensagem":"Você possui "+(parseInt(r.qtde_pub_mural_now)-parseInt(r.qtde_pub_mural))+" Mensagens";r.qtde_pub_mural=r.qtde_pub_mural_now,mostrar_notificacao(a,i,function(){View.load("menu/home",function(e){r.ultima_mensagem_mural_id=null,r.maior_id=null,r.nova_mensagem_mural=!1,r.listar_mural(null),App.count_notificacao()},View.ABA.MULTIPLAS)})}}),document.body.style.overflow="auto",$(".img_ajax_loader").hide()):(r.listar_mural(null),WS.get("mural_mensagem/contar_mural/",{usuario_id:App.sessao.usuario_id},function(e){r.qtde_pub_mural=e[0].qtde_publicacoes}))},this.atualizar_usuario_notificado=function(e){WS.post("agenda_evento/atualizar_usuario_notificado/",{convidado:e.convidado,agenda_evento_id:e.agenda_evento_id,usuario_id:App.sessao.usuario_id},function(e){})},this.verificar_eventos=function(){$.each(r.arr_time_line,function(e,a){11==e.length&&$.each(a.agenda,function(e,a){if("N"==a.notificado_bp){var i=null!=a.notificar_antes&""!=a.notificar_antes?parseInt(a.notificar_antes.substr(0,2)):0,o=null!=a.notificar_antes&""!=a.notificar_antes?parseInt(a.notificar_antes.substr(3,2)):0,t=new Date(a.dia+"T"+a.hora_inicio),n=new Date;n.setDate(t.getDate()),n.setHours(t.getHours()-i),n.setMinutes(t.getMinutes()-o),n.setSeconds(0),n.setMilliseconds(0);var s=new Date,d=get_time_difference(s,t);if(n<s){var l="",_=d.days,m=d.hours,c=d.minutes;if(s>t)var p=" iniciou à: ";else p=" irá iniciar em: ";_>0?(l+="o Evento: "+a.descricao+p+_+" Dia(s)",m>0&&(l+=" "+m+" Hora(s)",c>0&&(l+=" e "+c+" Minuto(s)"))):m>0?(l+="o Evento: "+a.descricao+p+m+" Hora(s)",c>0&&(l+=" e "+c+" Minuto(s)")):l+=c>0?"o Evento: "+a.descricao+p+c+" Minuto(s)":"o Evento: "+a.descricao+" irá iniciar agora !",mostrar_notificacao("Notificação de Evento",l,function(){View.load("agenda/agenda_evento",function(e,i){i.show(a.agenda_evento_id,null,null,null,null,null,null,null,null,!0)})}),r.atualizar_usuario_notificado(a),a.notificado_bp="S"}}})})},this.listar_mural=function(e){var a=null;App.verifica_permissao(App.temp.empresa,"rede_social")?(a="mural_mensagem/pagina_inicial/",r.mostrar_botao=!1):(a="mural_mensagem/listar/",r.mural_mensagem_div.hasClass("hidden-xs")&&r.mural_mensagem_div.removeClass("hidden-xs")),WS.get({route:a,data:{ultima_mensagem_mural_id:r.ultima_mensagem_mural_id,parametro_limitador:!0,usuario_id:App.sessao.usuario_id,maior_id:r.maior_id,perfil:PERFIL_REDE_SOCIAL.MENSAGENS_DO_MURAL,nova_mensagem_mural:e},func_response:function(a){null==e?(r.list_mural.find(".class-rows").remove(),r.btn_voltar_ao_topo.hasClass("hidden")||r.btn_voltar_ao_topo.addClass("hidden"),r.arr_mural=a,r.render_mural()):(e&&(a=$(a).sort(function(e,a){return parseInt(e.mural_mensagem_id,10)>parseInt(a.mural_mensagem_id,10)?1:-1})),a&&$.each(a,function(e,a){r.render_mural(a)}),r.nova_mensagem_mural=!1)},ignore_error:!0})},this.refresh_timeline=(()=>{null!=r.supervisor_id&&null!=r.supervisor_nome?r.carregar_timeline(!0,r.supervisor_id,r.supervisor_nome):null!=r.supervisionado_id&&null!=r.supervisionado_nome?r.carregar_timeline(!0,r.supervisionado_id,r.supervisionado_nome):r.carregar_timeline(!0,App.sessao.dados.usuario_id,App.sessao.dados.nome)}),this.carregar_timeline=function(e,a,i){r.list_timeline.find(".li_refresh").addClass("hidden"),r.div_cockpit.show(),void 0===a&&(a=App.sessao.dados.usuario_id),r.usuario_id=a,WS.get({route:"time_line/listar/",data:{qtd_dias:r.qtd_dias,exibir_dias_sem_evento:r.exibir_dias_sem_evento,usuario_id:a},func_response:function(e){r.arr_time_line=e,null==i||""==i?r.nome_usuario_timeline.text(App.sessao.dados.nome):r.nome_usuario_timeline.text(i),r.render_timeline(App.sessao.dados.parametro_processo.numero_solicitacao_por_processo),r.contar_mural()},ignore_error:e,html_id:r.html_id})},this.var_mural_mensagem_id=null,this.render_mural=function(e){var a=r.dialog.find("[template-mensagem]"),i=function(e){var i=a.clone();i.removeAttr("template-mensagem"),i.css("display",""),i.addClass("class-rows"),i.attr("id",e.mural_mensagem_id);var o=!0;r.count_mensagem=e.count_mensagem;var t=$(i.find(".lbl_mensagem")),n=$(i.find(".div_votacao"));e.votacao_id>0&&function(e,a,i){ReactDOM.render(React.createElement(window.components.Votacao.default,i),a[0])}(0,n,{votacao_id:e.votacao_id,pergunta:e.votacao_pergunta,expiracao:e.votacao_expiracao,voto_secreto:"S"==e.votacao_voto_secreto}),t.html(e.mensagem).find("img").css({maxWidth:"100%",display:"block",margin:"0 auto",boxShadow:"1px 1px 1px rgb(218, 218, 218)",border:"1px solid rgb(218, 218, 218)"});var s=$(i.find(".imagens_mensagem"));e.anexos.length>0&&$.each(e.anexos,function(e,a){if("image/png"==a.mime_type||"image/bmp"==a.mime_type||"image/jpeg"==a.mime_type||"image/jpg"==a.mime_type||"image/gif"==a.mime_type){var i=WS_URI+"documento/midia_social/?documento_id="+a.documento_id+"&tipo=v&tamanho=350&token_midia="+App.sessao.token_midia,o=$("<img />",{id:a.documento_id}).attr("src",i).addClass("text-center row-mensagem-img").css({maxWidth:"100%",boxShadow:"1px 1px 1px rgb(218, 218, 218)",border:"1px solid rgb(218, 218, 218)"});o.appendTo(s),r.nova_mensagem_mural||o.lazyload(),s.css("text-align","center"),$("<p/>").appendTo(s)}else if("video/mp4"==a.mime_type){i=WS_URI+"documento/midia_social/?documento_id="+a.documento_id+"&tipo=player&token_midia="+App.sessao.token_midia;var t=WS_URI+"documento/midia_social/?documento_id="+a.documento_id+"&tipo=v&tamanho=350&token_midia="+App.sessao.token_midia;$('<video class="video_responsive" controls preload="none" poster="'+t+'"><source src="'+i+'" type="video/mp4"></source></video>').appendTo(s)}});var d=$(i.find(".lbl_data_publicacao"));d.text(e.data_publicacao?moment(e.data_publicacao).fromNow():""),d.attr("title",e.data_publicacao?e.data_publicacao.format_date_time():"");let l=setInterval(()=>{$.contains(document.documentElement,d[0])||clearInterval(l),d.text(e.data_publicacao?moment(e.data_publicacao).fromNow():"")},3e4);var _=$(i.find(".img_mensagem_publica"));"S"==e.publica&&_.show();var m=$(i.find(".carrega_img_mensagem"));m.attr("src","assets/img/imagem_usuario_padrao.svg"),null!=e.foto_id&&(m.attr(r.nova_mensagem_mural?"src":"data-original",WS_URI+"documento/midia_imagens_menores/?documento_id="+e.foto_id+"&tamanho=32&token_midia="+App.sessao.token_midia),r.nova_mensagem_mural||m.lazyload());var c=$(i.find(".btn_menu_editar_mensagem")),p=$(i.find(".btn_menu_editar")),u=$(i.find(".btn_menu_excluir"));e.autor_id==App.sessao.usuario_id&&c.hasClass("hidden")&&c.removeClass("hidden");var v=$(i.find(".btn_perfil_usuario"));$(i.find(".lbl_autor")).text(e.autor_nome);var h=$(i.find(".div_enviar_comentario")),g=$(i.find(".edt_enviar_comentario")),f=$(i.find(".mural_curtir")),b=$(i.find(".mural_descurtir")),w=$(i.find(".mural_comentar")),x=$(i.find(".img_enviar_comentario")),A=($(i.find(".div_comentario")),$(i.find(".div_mostar_mais_comentarios"))),k=$(i.find(".btn_mostrar_mais_comentarios")),y=($(i.find(".btn_perfil")),$(i.find(".field_lb_grupo_home"))),O=$(i.find(".btn_grupo_pagina_inicial_home"));null!=e.grupo_nome&&y.text(e.grupo_nome),O.unbind("click"),O.click(function(){View.load("grupo_rede_social_pagina/listar",function(a,i){i.show(e.grupo_id)},View.ABA.MULTIPLAS)});var C=2,S=null;e.autor_id!=App.sessao.usuario_id&&(v.unbind("click"),v.click(function(){View.load("perfil/listar",function(a,i){i.show(e.autor_id,e.autor_nome,!0)},View.ABA.MULTIPLAS)})),function(e){var a=function(t,n,s,d,l){if(e.mural_mensagem_id==t.mural_mensagem_id){var _=$(i.find("[template-comentario]")).clone();_.removeAttr("template-comentario"),_.removeClass("hidden"),_.attr("id",t.comentario_id),_.attr("id_mural_mensagem",t.mural_mensagem_id);var m=$(_.find(".btn_excluir")),c=$(_.find(".div_mostrar_respostas")),p=$(_.find(".btn_mostrar_respostas")),u=$(_.find(".carrega_img_comentario"));u.attr("src","assets/img/imagem_usuario_padrao.svg"),null!=t.foto_id&&(u.attr(r.nova_mensagem_mural?"src":"data-original",WS_URI+"documento/midia_imagens_menores/?documento_id="+t.foto_id+"&tamanho=32&token_midia="+App.sessao.token_midia),r.nova_mensagem_mural||u.lazyload()),$(_.find(".lbl_comentario_autor")).text(t.usuario_autor_nome);var v=$(_.find(".lbl_comentario_comentarios"));v.text(t.comentario);var h=$(_.find(".btn_mural_curtir_comentario")),g=$(_.find(".btn_mural_descurtir_comentario")),f=$(_.find(".mural_comentar_comentario")),b=$(_.find(".div_enviar_comentario_resposta")),w=$(_.find(".edt_enviar_comentario_resposta")),x=$(_.find(".img_enviar_comentario_resposta")),A=$(_.find(".lbl_count_curtida_comentario"));t.mensagem_curtida.length>0?A.text("("+t.mensagem_curtida.length+")"):A.text("");var y=$(_.find(".btn_perfil_usuario_comentario"));t.usuario_autor_comentario!=App.sessao.usuario_id&&(y.unbind("click"),y.click(function(){View.load("perfil/listar",function(e,a){a.show(t.usuario_autor_comentario,!0)},View.ABA.MULTIPLAS)}));var O="",S=t.mensagem_curtida.length;S-=10,""==t.mensagem_curtida&&null==t.mensagem_curtida||$.each(t.mensagem_curtida,function(e,a){1==t.usuario_logado_curtida_comentario?(h.hasClass("hidden")||h.addClass("hidden"),g.hasClass("hidden")&&g.removeClass("hidden")):A.removeClass("text-info"),e<9?O=""!=O?O+"<br>"+a.usuario_curtida_nome:a.usuario_curtida_nome:10==e&&(O+="<br>e mais "+S+" ...")}),A.tooltip({title:O,placement:"top",html:!0}),h.unbind("click"),h.click(function(){var e=t.comentario_id;WS.post("mural_mensagem/curtir_comentario",{mural_mensagem_id:t.mural_mensagem_id,usuario_id:App.sessao.usuario_id,comentario_id:t.comentario_id},function(a){$.each(a,function(a,i){e==i.comentario_id&&(A.text("("+i.count_curtida_comentario+")"),h.addClass("hidden"),g.removeClass("hidden"),A.addClass("text-info"))})},[h])}),g.unbind("click"),g.click(function(){var e=t.comentario_id;WS.post("mural_mensagem/descurtir_comentario",{mural_mensagem_id:t.mural_mensagem_id,usuario_id:App.sessao.usuario_id,comentario_id:t.comentario_id},function(a){-1!=a?$.each(a,function(a,i){e==i.comentario_id&&(A.text(i.count_curtida_comentario>0?"("+i.count_curtida_comentario+")":""),h.removeClass("hidden"),g.addClass("hidden"),A.removeClass("text-info"))}):(A.text(""),h.removeClass("hidden"),g.addClass("hidden"),A.removeClass("text-info"))},[g])}),A.unbind("click"),A.click(function(){o=!1,View.load("menu/usuario_curtida",function(e,a){a.show(t.comentario_id,o)})}),f.unbind("click"),f.click(function(){x.attr("src",App.img_perfil.attr("src")),b.removeClass("hidden"),w.val(""),w.unbind("keypress"),set_focus(w),w.keydown(function(i){if(13==i.which){if(1==w.prop("disabled"))return;var o=w.val();w.prop("disabled",!0),null==o&&""==o||WS.post("mural_mensagem/comentar",{mural_mensagem_id:e.mural_mensagem_id,usuario_id:App.sessao.usuario_id,comentario:o,predecessor_id:t.comentario_id},function(e){alert_saved("comentário salvo com sucesso"),b.addClass("hidden"),w.val(""),r.list_mural.find('[id_mural_mensagem="'+e[0].mural_mensagem_id+'"]').remove(),$.each(e,function(e,i){a(i)}),$(document).trigger("scroll")})}else 27==i.which&&b.addClass("hidden")})}),App.sessao.usuario_id==t.usuario_autor_comentario&&(x.attr("src",App.img_perfil.attr("src")),v.dblclick(function(){b.removeClass("hidden");var i=w.val(t.comentario);w.unbind("keypress"),set_focus(w),w.keydown(function(o){13==o.which?null==(i=w.val())&&""==i||WS.post("mural_mensagem/alterar_comentario",{mural_mensagem_id:e.mural_mensagem_id,comentario:i,comentario_id:t.comentario_id},function(e){alert_saved("comentário salvo com sucesso"),b.addClass("hidden"),r.list_mural.find('[id_mural_mensagem="'+e[0].mural_mensagem_id+'"]').remove(),$.each(e,function(e,i){a(i,!1)}),$(document).trigger("scroll")}):27==o.which&&b.addClass("hidden")})}));var I=t.resposta_comentario.length;App.sessao.dados.admin||App.sessao.usuario_id==t.usuario_autor_comentario||App.sessao.usuario_id==e.autor_id?(m.removeClass("hidden"),m.unbind("click"),m.click(function(){t.comentario_id,alert_modal("Validação","Deseja excluir comentário?","Ok",function(){WS.post("mural_mensagem/excluir_comentario",{mural_mensagem_id:e.mural_mensagem_id,comentario_id:t.comentario_id},function(e){close_modal("alert_modal"),(I-=1)>1?r.list_mural.find(".btn_mostrar_respostas").html('<span class="small span_mostrar_resposta">Mostrar respostas ('+I+")</span>"):1==I?r.list_mural.find(".btn_mostrar_respostas").html('<span class="small span_mostrar_resposta">Mostrar resposta ('+I+")</span>"):r.list_mural.find(".div_mostrar_respostas").addClass("hidden"),e.length>0&&(e[0].count_comentario>2?r.list_mural.find(".div_mostar_mais_comentarios").removeClass("hidden"):r.list_mural.find(".div_mostar_mais_comentarios").addClass("hidden")),_.remove()})},!0)})):m.hasClass("hidden")||m.addClass("hidden"),!t.predecessor_id&&I>0&&c.removeClass("hidden"),!0===n?($.each(t.resposta_comentario,function(e,o){a(o,!0,i.find(".comentario"),d,!0)}),$(document).trigger("scroll"),1==l?_.css("padding-left","75px"):_.css("padding-left","45px"),$(s.find('[id = "'+d+'"]')).after(_)):_.appendTo(i.find(".comentario"));var D=!1;I>1?p.html('<span class="small span_mostrar_resposta">Mostrar respostas ('+I+")</span>"):p.html('<span class="small span_mostrar_resposta">Mostrar resposta ('+I+")</span>"),p.unbind("click"),p.click(function(){var e=_.attr("id");D||($.each(t.resposta_comentario,function(o,t){a(t,!0,i.find(".comentario"),e)}),$(document).trigger("scroll")),D=!0})}k.unbind("click"),k.click(function(){var i=t.comentario_id;C+=25,WS.get("mural_mensagem/listar_comentario/",{mural_mensagem_id:e.mural_mensagem_id,limite_comentario:C,ultimo_comentario_id:i},function(e){$(e).each(function(e,i){a(i,!1)}),$(document).trigger("scroll")})})};"S"!=e.permite_comentario?w.addClass("hidden"):w.removeClass("hidden"),w.unbind("click"),w.click(function(){x.attr("src",App.img_perfil.attr("src")),h.removeClass("hidden"),g.unbind("keypress"),g.prop("disabled",!1),g.val(""),set_focus(g),g.keydown(function(i){if(13==i.which){if(1==g.prop("disabled"))return;var o=g.val();g.prop("disabled",!0),null==o&&""==o||WS.post("mural_mensagem/comentar",{mural_mensagem_id:e.mural_mensagem_id,usuario_id:App.sessao.usuario_id,comentario:o},function(e){alert_saved("comentário salvo com sucesso"),h.addClass("hidden"),g.val(""),r.list_mural.find('[id_mural_mensagem="'+e[0].mural_mensagem_id+'"]').remove(),e[0].count_comentario>2?r.list_mural.find(".div_mostar_mais_comentarios").removeClass("hidden"):r.list_mural.find(".div_mostar_mais_comentarios").addClass("hidden"),$.each(e,function(e,i){a(i,!1)}),$(document).trigger("scroll")})}else 27==i.which&&h.addClass("hidden")})}),e.count_comentario>2&&A.removeClass("hidden"),$(e.resposta_comentario).each(function(e,i){a(i,!1)}),$(document).trigger("scroll")}(e);var I="",D=e.count_curtida;D-=10,""==e.mensagem_curtida&&null==e.mensagem_curtida||$.each(e.mensagem_curtida,function(a,i){1==e.usuario_logado_curtida&&(f.hasClass("hidden")||f.addClass("hidden"),b.hasClass("hidden")&&b.removeClass("hidden")),a<9?I=""!=I?I+"<br>"+i.usuario_curtida_nome:i.usuario_curtida_nome:I+="<br>e mais "+D+" ..."});var E=$(i.find(".lbl_mensagem_curtir")),M=$(i.find(".div_mensagem_curtir"));if(e.mensagem_curtida.length>0?(M.removeClass("hidden"),E.text("("+e.count_curtida+")")):M.addClass("hidden"),E.tooltip({title:I,placement:"top",html:!0}),E.unbind("click"),E.click(function(){o=!0,View.load("menu/usuario_curtida",function(a,i){i.show(e.mural_mensagem_id,o)})}),f.unbind("click"),f.click(function(){WS.post("mural_mensagem/curtir",{mural_mensagem_id:e.mural_mensagem_id,usuario_id:App.sessao.usuario_id},function(e){var a;a=null!=e.count_curtida?e.count_curtida:0,M.removeClass("hidden"),E.text("("+a+")"),f.addClass("hidden"),b.removeClass("hidden")},[f])}),b.unbind("click"),b.click(function(){WS.post("mural_mensagem/descurtir",{mural_mensagem_id:e.mural_mensagem_id,usuario_id:App.sessao.usuario_id},function(e){var a;(a=null!=e.count_curtida?e.count_curtida:0)>0?(M.removeClass("hidden"),E.text("("+a+")")):M.addClass("hidden"),f.removeClass("hidden"),b.addClass("hidden")},[f])}),null!=e.anexos){var L=$(i.find(".mural_mensagem_anexos_dropdown")),R=$(i.find(".mural_mensagem_anexos_button"));e.anexos.length>0&&R.show(),$.each(e.anexos,function(e,a){var o=a.documento_revisao_id;$(i.find(".div_anexos")).removeClass("hidden");var t=$('<div class="input-group small" style="margin-top: 0px; margin-right: 5px;">'),n='<a href="javascript:;" class="input-group-addon" style="padding-left: 4px; padding-right: 0px; text-align: left; background-color: transparent; border: 0">';if("application/pdf"==a.mime_type)(r=$()).html($("<span>"+FileShortName(a.revisao_nome)+"</span>")),r.unbind("click"),r.click(function(){View.load("central_documentos/visualizar_pdf",function(e,a){a.show(o)})}),(d=$(n)).attr("title","Download "+a.revisao_nome),d.attr("value",a.documento_revisao_id),(s=$("<span>")).addClass("glyphicon glyphicon-download-alt"),d.append(s),t.append(r),t.append(d);else if("video/mp4"==a.mime_type||"video/ogg"==a.mime_type)(r=$(n)).html($("<span>"+FileShortName(a.revisao_nome)+"</span>")),r.unbind("click"),r.click(function(){View.load("central_documentos/visualizar_video",function(e,a){a.show(o)})}),(d=$(n)).attr("title","Download "+a.revisao_nome),d.attr("value",a.documento_revisao_id),(s=$("<span>")).addClass("glyphicon glyphicon-download-alt"),d.append(s),t.append(r),t.append(d);else if("image/png"==a.mime_type||"image/bmp"==a.mime_type||"image/jpeg"==a.mime_type||"image/jpg"==a.mime_type||"image/gif"==a.mime_type){var r,s;(r=$(n)).html($("<span>"+FileShortName(a.revisao_nome)+"</span>")),r.unbind("click"),r.click(function(){View.load("central_documentos/visualizar_documento",function(e,a){a.show(o)})}),(d=$(n)).attr("title","Download "+a.revisao_nome),d.attr("value",a.documento_revisao_id),(s=$("<span>")).addClass("glyphicon glyphicon-download-alt"),d.append(s),t.append(r),t.append(d)}else{var d;(d=$(n)).attr("title","Download "+a.revisao_nome),d.html($("<span>"+FileShortName(a.revisao_nome)+"</span>")),d.attr("value",a.documento_revisao_id),t.append(d)}d.unbind("click"),d.click(function(){App.obter_token_publico(function(e){App.download(WS_URI+"documento/download/?documento_revisao_id="+o+"&token_publico="+e)})}),L.append($("<li>").append(t))})}0==r.nova_mensagem_mural?r.list_mural.append(i):(S=r.list_mural.children().first().attr("id"),r.list_mural.find('[id="'+S+'"]').before(i));var T=function(){View.load("mural_mensagem/nova",function(a,i){i.onsave=function(e){r.list_mural.find('[id="'+e.id+'"]').find(".class-rows").remove(),r.list_mural.find('[id="'+e.id+'"]').addClass(".class-rows"),r.list_mural.find('[id="'+e.id+'"]').find(".lbl_mensagem").html(e.mensagem).find("img").css("max-width","100%"),e.anexos.length>0?$.each(e.anexos,function(a,i){if("image/png"==i.mime_type||"image/bmp"==i.mime_type||"image/jpeg"==i.mime_type||"image/jpg"==i.mime_type||"image/gif"==i.mime_type){var o=WS_URI+"documento/midia_social/?documento_id="+i.documento_id+"&tipo=v&tamanho=350&token_midia="+App.sessao.token_midia;$("<img />",{id:i.documento_id,src:o}).addClass("text-center row-mensagem-img").appendTo(r.list_mural.find('[id="'+e.id+'"]').find(".imagens_mensagem")).css("max-width","100%"),s.css("text-align","center"),$("<p/>").appendTo(r.list_mural.find('[id="'+e.id+'"]').find(".imagens_mensagem"))}}):r.list_mural.find('[id="'+e.id+'"]').find(".row-mensagem-img").remove()},i.show(e.mural_mensagem_id,FORMULARIO.EDITAR,!0)},View.ABA.MULTIPLAS)};App.sessao.usuario_id==e.autor_id&&(t.unbind("dblclick"),t.dblclick(T),p.unbind("click"),p.click(T),u.unbind("click"),u.click(function(){View.load("mural_mensagem/nova",function(a,i){i.onsave=function(e){r.list_mural.find('[id="'+e.id+'"]').remove()},i.show(e.mural_mensagem_id,FORMULARIO.EXCLUIR,!1)},View.ABA.MULTIPLAS)}))};e?(r.nova_mensagem_mural||(r.ultima_mensagem_mural_id=e.mural_mensagem_id),r.maior_id=e.maior_id,r.list_mural.find("li.media:nth-of-type(even)").css("background",""),i(e),$(document).trigger("scroll")):($(r.arr_mural).each(function(e,a){i(a),e==r.arr_mural.length-1&&0==r.nova_mensagem_mural&&(r.ultima_mensagem_mural_id=a.mural_mensagem_id,r.maior_id=a.maior_id)}),$(document).trigger("scroll")),r.list_mural.find("li.media:nth-of-type(even)").css("background",s);var o=r.list_mural.find("li.media:nth-of-type(odd)");o.find(".div_comentario_mensagem").css("background",s),o.find(".div_enviar_comentario_mensagem").css("background",s),o.find(".div_enviar_comentario_resposta_mensagem").css("background",s),r.count_mensagem>5?r.div_mostar_mais_mensagem.hasClass("hidden")&&r.div_mostar_mais_mensagem.removeClass("hidden"):r.div_mostar_mais_mensagem.hasClass("hidden")||r.div_mostar_mais_mensagem.addClass("hidden"),r.btn_mostrar_mais_mensagem.unbind("click"),r.btn_mostrar_mais_mensagem.click(function(){r.mostrar_botao=!0,r.div_load.removeClass("hidden"),r.listar_mural(!1,!0),(r.mostrar_botao=!0)&&r.btn_voltar_ao_topo.hasClass("hidden")&&r.btn_voltar_ao_topo.removeClass("hidden")})},this.render_supervisionados=function(){WS.get("supervisor/listar_supervisionados/",{usuario_supervisor:App.sessao.dados.usuario_id},function(e){r.lista_supervisionados=e,r.render_usuarios_supervisionados()})},this.render_usuarios_supervisionados=function(){var e=r.dialog.find("[template-meu-cockpit]"),a=r.dialog.find("[template-minha-timeline]"),i=r.dialog.find("[template-timeline-supervisionados]"),o=App.sessao.dados.usuario_id,t=a;t.removeAttr("template-minha-timeline"),t.css("display",""),t.find("*").attr("supervisor_id",o),t.click(function(e){r.carregar_timeline(!0,o,App.sessao.dados.nome),r.supervisor_id=o,r.supervisor_nome=App.sessao.dados.nome,r.supervisionado_id=null,r.supervisionado_nome=null}),e.removeAttr("template-meu-cockpit"),e.css("display",""),e.find("*").attr("supervisor_id",o),e.click(function(e){t.trigger("click")}),r.ul_supervisionados.find("li.li_supervisionado:not([template-timeline-supervisionados])").remove();var n=r.filtro_nome_supervisionado;if(n)var s=n.toLowerCase(),d=jQuery.grep(r.lista_supervisionados,function(e){return e.supervisionado_nome.toLowerCase().indexOf(s)>=0});else d=r.lista_supervisionados;var l=0;d.length>0&&(r.itens_timeline.removeClass("hidden"),r.nome_usuario_timeline.removeClass("hidden"),r.txt_timeline.addClass("dropdown-toggle"),r.txt_timeline.attr("data-toggle","dropdown"),r.txt_timeline.attr("role","button"),r.txt_timeline.attr("aria-expanded","false"),r.txt_timeline.css("cursor","pointer"),r.txt_timeline.on("click",function(e){$(this).dropdown("toggle"),e.stopImmediatePropagation()}),r.nome_usuario_timeline.addClass("dropdown-toggle"),r.nome_usuario_timeline.attr("data-toggle","dropdown"),r.nome_usuario_timeline.attr("role","button"),r.nome_usuario_timeline.attr("aria-expanded","false"),r.nome_usuario_timeline.css("cursor","pointer"),r.nome_usuario_timeline.on("click",function(e){$(this).dropdown("toggle"),e.stopImmediatePropagation()}),$(d).each(function(e,a){if(function(e){var a=i.clone();a.removeAttr("template-timeline-supervisionados"),a.css("display",""),a.find("*").attr("supervisionado_id",e.supervisionado_id),$(a.find("[template-field='nome_supervisionado']")).text(e.supervisionado_nome),a.click(function(a){r.carregar_timeline(!0,e.supervisionado_id,e.supervisionado_nome),r.supervisionado_id=e.supervisionado_id,r.supervisionado_nome=e.supervisionado_nome,r.supervisor_id=null,r.supervisor_nome=null}),a.appendTo(r.ul_supervisionados)}(a),l=e+1,e>=9)return!1})),r.ul_supervisionados.append('<li role="separator" class="divider li_supervisionado"></li><li class="dropdown-header li_supervisionado">Listando '+l+" de "+r.lista_supervisionados.length+" Supervisionados</li>")},this.render_cockpit=function(){if(void 0!==r.arr_time_line.cockpit){r.btn_view_wrap.on("click",function(){r.cockpit_view_wrap()}),r.btn_view_inline.on("click",function(){r.cockpit_view_inline()}),r.btn_expandir_cockpit.on("click",function(){r.expandir_cockpit()}),r.btn_retrair_cockpit.on("click",function(){r.retrair_cockpit()}),ReactDOM.render(React.createElement(window.components.Cockpit.default,{data:JSON.stringify(r.arr_time_line.cockpit),supervisor_id:r.supervisor_id,supervisor_nome:r.supervisor_nome,supervisionado_id:r.supervisionado_id,supervisionado_nome:r.supervisionado_nome}),r.cockpitComponent[0]);var e=App.get_parametro_usuario("cockpitOpcoes");!0===e.visible||void 0===e.visible?(r.expandir_cockpit(),e.viewType===COCKPIT_VIEW.INLINE?r.cockpit_view_inline():e.viewType===COCKPIT_VIEW.WRAP&&r.cockpit_view_wrap()):r.retrair_cockpit()}},this.render_dashboard=function(){if(r.arr_time_line.dashboard_representante?(r.div_dashboard_representante.removeClass("hidden"),r.div_dashboard_crm.removeClass("hidden"),a.render(r.dashboard_representante,r.div_dashboard_representante[0]),r.dashboard_representante.props.setParams({ObjRepresentante:r.arr_time_line.dashboard_representante})):(r.div_dashboard_representante.addClass("hidden"),r.div_dashboard_crm.addClass("hidden")),r.arr_time_line.meta_representante){r.div_dashboard_representante_grafico_meta.removeClass("hidden"),r.div_dashboard_crm.removeClass("hidden");for(var e=0,i="",o=0,t=0;t<r.arr_time_line.meta_representante.length;t++){var n=r.arr_time_line.meta_representante[t];e=parseFloat(e)+parseFloat(n.valor),i=i+n.meta_descricao+": "+n.valor.format_number(2,!0)}if(e>0){const a=r.arr_time_line.dashboard_representante.valor_ganho?r.arr_time_line.dashboard_representante.valor_ganho:0;o=parseFloat(a)/parseFloat(e)*100,o=parseFloat(o.toFixed(2))}var s=document.createElement("div");s.className="div_velocimetro",s.style="height: 252px;",r.div_dashboard_representante_grafico_meta.find(".div_velocimetro").remove(),r.div_dashboard_representante_grafico_meta.find(".col-md-12")[0].prepend(s),r.div_dashboard_representante_grafico_meta.find(".col-md-12").find(".div_velocimetro").dxCircularGauge({scale:{startValue:0,endValue:100,tickInterval:10,label:{customizeText:e=>`${e.valueText} %`}},rangeContainer:{ranges:[{startValue:0,endValue:60,color:"#DF5353"},{startValue:60,endValue:80,color:"#DDDF0D"},{startValue:80,endValue:95,color:"#55BF3B"},{startValue:95,endValue:100,color:"#0000cc"}]},export:{enabled:!0},title:{text:`${o} % Atingimento Meta \n ${i}`,font:{size:12}},tooltip:{enabled:!0,customizeTooltip:e=>({text:`${o} %`})},value:o})}else r.div_dashboard_representante_grafico_meta.addClass("hidden"),r.div_dashboard_crm.addClass("hidden");if(r.graficos_dashboard_crm){var d=App.get_parametro_usuario("dashboardOpcoes");!0===d.visible||void 0===d.visible?r.expandir_dashboard():r.retrair_dashboard()}},this.render_timeline=function(o){if(1==App.sessao.dados.admin||App.sessao.dados.tipo==USUARIO_TIPO.ANALISTA?r.render_aniversariantes():r.div_aniversariantes.addClass("hidden"),App.verifica_permissao(App.temp.empresa,"agenda")||App.verifica_permissao(App.temp.empresa,"gestao_tarefas")||App.verifica_permissao(App.temp.empresa,"gestao_chamados")||App.verifica_permissao(App.temp.empresa,"gestao_documentos")||App.verifica_permissao(App.temp.empresa,"gestao_processos")||App.verifica_permissao(App.temp.empresa,"gestao_projetos")||App.verifica_permissao(App.temp.empresa,"pdca")||App.verifica_permissao(App.temp.empresa,"gestao_relacionamento")){r.list_timeline.find("a").remove(),r.list_timeline.find("li:not(.li_refresh)").remove(),r.list_timeline.find("div").remove(),r.render_supervisionados(),r.render_cockpit(),r.render_dashboard(),r.listagem_inicial=!0;var t=document.createElement("div");t.className="div_listagem_timeline",t.style="min-width: 100%;",r.dx_listagem_timeline.find(".div_listagem_timeline").remove(),r.dx_listagem_timeline[0].appendChild(t),r.dx_listagem_timeline.find(".div_listagem_timeline").css("height","calc(100vh - 95px)");for(var n=0;n<r.arr_time_line.timeline.length;n++){const e=r.arr_time_line.timeline[n];switch(r.arr_time_line.timeline[n].data="",r.arr_time_line.timeline[n].timeline_modulo){case MODULOS.CHAMADO:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.PROJETO,r.arr_time_line.timeline[n].data+=e.id,r.arr_time_line.timeline[n].data+=e.assunto,r.arr_time_line.timeline[n].data+=e.entidade_nome,r.arr_time_line.timeline[n].data+=e.usuario_solicitante_nome,r.arr_time_line.timeline[n].data+=e.usuario_responsavel_nome,r.arr_time_line.timeline[n].data+=e.motivo,r.arr_time_line.timeline[n].data+=ChamadoDescSituacaoHumano(e.situacao),r.arr_time_line.timeline[n].data+=e.horas_previsao_retorno,r.arr_time_line.timeline[n].data+=e.data_previsao_retorno.format_date_time();break;case MODULOS.PROCESSO:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.RELACIONAMENTO;const a="S"==o?e.numero:e.solicitacao_id;r.arr_time_line.timeline[n].data+=a,r.arr_time_line.timeline[n].data+=e.atividade_descricao,r.arr_time_line.timeline[n].data+=e.cliente_nome,r.arr_time_line.timeline[n].data+=e.processo_nome,r.arr_time_line.timeline[n].data+=e.descricao,r.arr_time_line.timeline[n].data+=e.prazo_execucao,r.arr_time_line.timeline[n].data+=e.usuario_solicitacao_nome,r.arr_time_line.timeline[n].data+=e.usuario_grupos_responsavel_atividade;break;case MODULOS.PROJETO:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.AGENDA;const i=e.prazo_execucao?"S"==e.atrasado?e.prazo_execucao.format_date_time():e.prazo_execucao.substr(11,5):"";r.arr_time_line.timeline[n].data+=i,r.arr_time_line.timeline[n].data+=e.codigo,r.arr_time_line.timeline[n].data+=e.atividade_simplificada,r.arr_time_line.timeline[n].data+=e.cliente_nome,r.arr_time_line.timeline[n].data+=e.projeto_nome;break;case MODULOS.DOCUMENTO:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.DOCUMENTO,r.arr_time_line.timeline[n].data+=e.codigo,r.arr_time_line.timeline[n].data+=e.nome,r.arr_time_line.timeline[n].data+=filesize(parseInt(e.revisao_tamanho,10)||0),r.arr_time_line.timeline[n].data+=e.prazo_data?e.prazo_data.format_date_time():"",r.arr_time_line.timeline[n].data+=e.revisao_nome,r.arr_time_line.timeline[n].data+=e.data_prazo?e.data_prazo.format_date_time():"";break;case MODULOS.RELACIONAMENTO:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.EMPENHO,r.arr_time_line.timeline[n].data+=e.descricao,r.arr_time_line.timeline[n].data+=e.projeto_nome,r.arr_time_line.timeline[n].data+=e.atividade_projeto_nome,r.arr_time_line.timeline[n].data+=e.entidade_tipo,r.arr_time_line.timeline[n].data+=e.entidade_nome,r.arr_time_line.timeline[n].data+=e.tipo_agenda_oportunidade_descricao,r.arr_time_line.timeline[n].data+=e.dia.format_date(),r.arr_time_line.timeline[n].data+=e.hora_inicio,r.arr_time_line.timeline[n].data+=e.duracao;break;case MODULOS.AGENDA:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.CHAMADO,r.arr_time_line.timeline[n].data+=e.descricao,r.arr_time_line.timeline[n].data+=e.projeto_nome,r.arr_time_line.timeline[n].data+=e.atividade_projeto_nome,r.arr_time_line.timeline[n].data+=e.empresa_nome||e.cliente_nome||e.prospect_nome||e.fornecedor_nome,r.arr_time_line.timeline[n].data+=e.agenda_tipo_nome,r.arr_time_line.timeline[n].data+=e.agenda_local_nome,r.arr_time_line.timeline[n].data+=e.dia.format_date(),r.arr_time_line.timeline[n].data+=e.hora_inicio,r.arr_time_line.timeline[n].data+=e.hora_fim;break;case MODULOS.PDCA:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.SOCIAL,r.arr_time_line.timeline[n].data+=e.pdca_objetivo,r.arr_time_line.timeline[n].data+=e.que,r.arr_time_line.timeline[n].data+=e.pdca_progresso,r.arr_time_line.timeline[n].data+=e.data_inicio.format_date(),r.arr_time_line.timeline[n].data+=e.data_fim.format_date();break;case MODULOS.TAREFAS:r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo,r.arr_time_line.timeline[n].timeline_modulo=MODULOS.PROCESSO,r.arr_time_line.timeline[n].data+=e.arr_etiqueta.map(function(e){return e.nome}).toString(),r.arr_time_line.timeline[n].data+=e.nome,r.arr_time_line.timeline[n].data+=e.nome_lista,r.arr_time_line.timeline[n].data+=e.nome_quadro,r.arr_time_line.timeline[n].data+=e.data_prazo?e.data_prazo.format_date_time():"";break;case"Feriado":r.arr_time_line.timeline[n].timeline_modulo_original=r.arr_time_line.timeline[n].timeline_modulo}}r.dx_listagem_timeline_instance=r.dx_listagem_timeline.find(".div_listagem_timeline").dxDataGrid({dataSource:r.arr_time_line.timeline,sorting:!1,groupPanel:{visible:!0},searchPanel:{visible:!window.detectmob(),width:150,placeholder:"Pesquisa"},columnChooser:{enabled:!0},stateStoring:{enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("listagem_timeline")},customSave:function(e){e.searchText=null,App.set_parametro_usuario("listagem_timeline",e)}},columns:[{dataField:"timeline_dia",caption:"Dia",groupIndex:0,allowHiding:!1,allowGrouping:!1,groupCellTemplate:function(e,a){var i;e.append($("<div>"+(a.value<getDateNow(!0)?"Atrasados":(i=a.value)==getDateNow(!0)?"Hoje - "+dia_semana(format_ToDate(i).getDay()):i==formatDate(getDateNow().addDay(1),!0)?"Amanhã - "+dia_semana(format_ToDate(i).getDay()):formatar_data_humano(i)+" - "+dia_semana(format_ToDate(i).getDay()))+" ("+a.summaryItems[0].value+" registros)</div>"))}},{dataField:"timeline_modulo",caption:"Módulo",visible:!1,lookup:{dataSource:MODULOS_LOOKUP,displayExpr:"descricao",valueExpr:"ordem_timeline"}},{dataField:"data",headerCellTemplate:function(e){e.closest(".dx-header-row").remove()},cellTemplate:function(t,n){var s,d=null;switch(n.data.timeline_modulo_original){case MODULOS.CHAMADO:d=function(o){var t=App.sessao.dados.usuario_id,n=!1;"S"!=o.exibir_avaliacao||null!=o.nota_avaliacao_id||o.situacao!=CHAMADO_SITUACAO.ENCERRADO&&o.situacao!=CHAMADO_SITUACAO.ENCERRADO_INATIVIDADE||t!=o.usuario_abertura_id&&t!=o.usuario_cliente_id&&t!=o.usuario_empresa_id&&t!=o.usuario_fornecedor_id&&t!=o.usuario_prospect_id||(n=!0);var s=Colors(o.motivo_cor),d=o.usuario_solicitante_foto_id?window.WS_URI+"documento/midia/?&tamanho=20&documento_id="+o.usuario_solicitante_foto_id+"&token_midia="+App.sessao.token_midia:"assets/img/imagem_usuario_padrao.svg",l=o.foto_usuario_responsavel?window.WS_URI+"documento/midia/?&tamanho=20&documento_id="+o.foto_usuario_responsavel+"&token_midia="+App.sessao.token_midia:"assets/img/imagem_usuario_padrao.svg",_=$('<div class="'+("S"==o.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==o.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(o.timeline_modulo_original)+"</b>: #"+o.id+" "+o.assunto+'</h5><h6><span " data-toggle="tooltip" title="Entidade (Empresa)"><span class="label '+cor_label_entidade(o.tipo)+'">'+o.tipo+"</span> "+o.entidade_nome+'</span></h6><h6><span data-toggle="tooltip" title="Solicitante"><img style="height: 20px; width: 20px; border-radius: 50%; object-fit: cover class="imagem_responsavel" src="'+d+'">&nbsp;'+o.usuario_solicitante_nome+"</span>"+(o.usuario_responsavel_nome?'<span style="margin-left: 35px;" data-toggle="tooltip" title="Responsável"><img style="height: 20px; width: 20px; border-radius: 50%; object-fit: cover class="imagem_responsavel" src="'+l+'">&nbsp;'+o.usuario_responsavel_nome+"</span>":"")+'</h6><div><span class="label label-default" style="margin-right: 5px; background: '+s.hex+"; color: "+s.nome_hex+';">'+o.motivo+'</span><span class="label label-default">'+ChamadoDescSituacaoHumano(o.situacao)+'</span></div></div><div style="margin: 5px;"><h6 style="text-align: right;'+("S"==o.atrasado?" color: #959595;":"")+'" class="data"></h6><div class="div_informativo_prazo"></div>'+(n?'<div class="pull-right"><button class="btn btn-default btn_avaliar_chamado" template-button="btn_avaliar_chamado"><span class="fa fa-star-half-alt"></span></button></div>':"")+"</div></div>"),m=_.find(".div_informativo_prazo"),c=e.createElement(i,null,null);a.render(c,m[0]),c.props.setConfiguracoes({ViewParent:r.html_id,StyleWidth:"",ExibirBarraProgresso:!1,Alinhamento:"right",TipoGestaoTempo:o.tipo_gestao_tempo,HorasEstimadas:o.horas_previsao_retorno,DataPrazo:o.data_previsao_retorno,CalendarioTrabalhoId:o.calendario_trabalho_id_param,TituloDataPrazo:"Previsão de Retorno",LabelExcedente:"atrasado",LabelRestante:"restante"});var p=$(_.find(".div_informativo_prazo").find("div")[5]);return _.find(".data").text(p.text()),p.addClass("hidden"),_.find(".btn_avaliar_chamado").unbind("click").click(function(e){e.stopPropagation(),View.loadReact(window.views.chamado.Detalhes.default,{chamadoId:o.id,onClose:function(){r.btn_refresh.trigger("click")},botaoPressionadoAvaliar:!0},function(e,a){},View.ABA.MULTIPLAS)}),_}(n.data);break;case MODULOS.AGENDA:d=function(e){e.tipo=e.empresa_id?"E":e.cliente_id?"C":e.prospect_id?"O":e.fornecedor_id?"F":null,e.entidade_nome=e.empresa_nome||e.cliente_nome||e.prospect_nome||e.fornecedor_nome;var a="S"==e.agenda_tipo_particular||1==e.agenda_tipo_particular,i=Colors(e.agenda_tipo_cor),o=$('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>: "+("S"==e.convidado?'<i class="fas fa-id-card-alt" title="Você é um convidado nessa agenda"></i> ':"")+(a?'<span title="Evento Particular" class="fas fa-user-lock"></span> '+("S"!=e.convidado_evento&&e.usuario_id!=App.sessao.dados.usuario_id?"Evento Particular":e.descricao):e.descricao)+"</h5><h6"+("S"==e.atrasado?' style="color: #959595;"':"")+">"+(e.projeto_nome?e.projeto_nome:"")+" "+(e.atividade_projeto_nome?e.atividade_projeto_nome:"")+"</h6>"+(a?"":'<h6><span class="label '+cor_label_entidade(e.tipo)+'">'+e.tipo+"</span> "+e.entidade_nome+"</h6>")+"<div>"+(a?"":'<span class="label label-default" style="margin-right: 5px; background: '+i.hex+"; color: "+i.nome_hex+';">'+e.agenda_tipo_nome+"</span>")+(a?"":'<span class="label label-default" style="margin-right: 5px;">'+e.agenda_local_nome+"</span>")+'</div></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+("S"==e.atrasado?e.dia.format_date():"")+" <br />"+e.hora_inicio.substr(0,5)+"~"+e.hora_fim.substr(0,5)+"</h6>"+(e.atividade_projeto_nome&&!r.supervisionado_id?'<div class="pull-right"><button style="margin-right: 5px;" class="btn btn-primary btn_atividade_projeto"><span class="fas fa-tasks"></span></button><button class="btn btn-primary btn_apontamento"><span class="far fa-clock"></span></button></div>':"")+"</div></div>");return o.find(".btn_apontamento").unbind("click").click(function(a){a.stopPropagation(),View.load("apontamento_projeto/detalhes",function(a,i){i.onclose=r.refresh_timeline,i.show(null,FORMULARIO.NOVO,e.dia,e.projeto_id,e.cliente_id,e.cliente_nome,e.projeto_atividade_id,e.projeto_nome)},View.ABA.MULTIPLAS)}),o.find(".btn_atividade_projeto").unbind("click").click(function(a){a.stopPropagation(),View.load("atividade_projeto/detalhes",function(a,i){const o={projeto_id:e.projeto_id,projeto_atividade_id:e.projeto_atividade_id,tipo:FORMULARIO.EDITAR,template:e.projeto_template,nome:e.atividade_projeto_nome.substr(0,10),projeto_apontamento_por:e.projeto_apontamento_por};i.show(o)},View.ABA.MULTIPLAS,null,null,{projetoAtividadeId:e.projeto_atividade_id})}),o}(n.data);break;case MODULOS.TAREFAS:d=function(e){for(var a="<div style='margin-bottom: 5px;' class='etiqueta_cartao'>",i=0;i<e.arr_etiqueta.length;i++){var o=e.arr_etiqueta[i];a+='<span class="label" style="margin-right: 5px; background: '+o.cor_fundo+"; color: "+o.cor_fonte+';">'+o.nome+"</span>"}a+="</div>";var t=null,n=null;for(i=0;i<e.referencias.length;i++){var s=e.referencias[i];"projeto_atividade"==s.tabela&&1==s.registros.length?t=s.registros[0]:"solicitacao_atividade"==s.tabela&&1==s.registros.length&&(n=s.registros[0])}var d=$('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>: "+e.nome+"</h5><h6"+("S"==e.atrasado?' style="color: #959595;"':"")+"><b>Lista: </b>"+e.nome_lista+"</h6><h6"+("S"==e.atrasado?' style="color: #959595;"':"")+"><b>Quadro: </b>"+e.nome_quadro+"</h6><div>"+a+'</div></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+("S"==e.atrasado?e.data_prazo.format_date_time():e.data_prazo.substr(11,5))+'</h6><div class="pull-right"><button class="btn btn-primary btn_acessar_quadro" template-button="btn_acessar_quadro"><span class="fab fa-trello"></span></button></div>'+(t?'<div class="pull-right"><button style="margin-right: 5px;" class="btn btn-primary btn_apontamento"><span class="far fa-clock"></span></button></div>':"")+(n?'<div class="pull-right"><button style="margin-right: 5px;" class="btn btn-primary btn_solicitacao"><span class="fa fa-list-alt"></span></button></div>':"")+"</div></div>");return d.find(".btn_apontamento").unbind("click").click(function(e){e.stopPropagation(),View.load("apontamento_projeto/detalhes",function(e,a){a.onclose=r.refresh_timeline,a.show(null,FORMULARIO.NOVO,null,t.projeto_id,t.cliente_id,t.cliente_nome,t.id,t.projeto_nome)},View.ABA.MULTIPLAS)}),d.find(".btn_solicitacao").unbind("click").click(function(e){e.stopPropagation(),View.load("solicitacao/detalhes",function(e,a){a.show(n.solicitacao_atividade_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS,null,null,{solicitacaoAtividadeId:n.solicitacao_atividade_id})}),d.find(".btn_acessar_quadro").unbind("click").click(function(a){a.stopPropagation(),View.load("tarefa/detalhes",function(a,i){i.onclose=function(){r.btn_refresh.trigger("click")},i.show({id:e.tarefa_quadro_id,nome:e.nome_quadro})},View.ABA.MULTIPLAS)}),d}(n.data);break;case MODULOS.PDCA:s=n.data,d=$('<div class="'+("S"==s.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5'+("S"==s.atrasado?' style="color: #F33F66;"':"")+"><b>"+nome_modulo(s.timeline_modulo_original)+"</b>: "+s.pdca_objetivo+"</h5><h6"+("S"==s.atrasado?' style="color: #959595;"':"")+"><b>What (O quê?): </b>"+s.que+'</h6></div><div style="margin: 5px;"><h6'+("S"==s.atrasado?' style="color: #959595;"':"")+' class="data"><b>Conclusão: '+s.pdca_progresso+"%</b></h6><h6"+("S"==s.atrasado?' style="color: #959595;"':"")+' class="data">Início: '+s.data_inicio.format_date()+"</h6><h6"+("S"==s.atrasado?' style="color: #959595; text-align: right;"':"")+' class="data">Fim: '+s.data_fim.format_date()+"</h6></div></div>");break;case MODULOS.DOCUMENTO:d=n.data.documento_aprovacao_alcada_id?function(e){var a="image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type||"application/pdf"==e.mime_type,i=$('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>:"+(e.codigo?" #"+e.codigo:"")+' Pendente de aprovação</h5><h6 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'">'+e.nome+"<i> "+filesize(parseInt(e.revisao_tamanho,10)||0)+"</i></h6><div>"+(r.supervisionado_id?"":'<button style="margin-right: 5px;" class="btn btn-primary btn_aprovar"><span class="far fa-thumbs-up"></span></button><button style="margin-right: 5px;" class="btn btn-primary btn_reprovar"><span class="far fa-thumbs-down"></span></button>')+(App.verifica_permissao(App.temp.empresa,"substituir_revisao")?'<button class="btn btn-primary btn_substituir"><span class="fas fa-file-upload"></span></button>':"")+'</div></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #F33F66;"':"")+' class="data">'+(e.prazo_data?"S"==e.atrasado?e.prazo_data.format_date_time():e.prazo_data.substr(11,5):"")+'</h6><div class="pull-right">'+(a?'<button style="margin-right: 5px;" class="btn btn-primary btn_visualizar"><span class="fas fa-eye"></span></button>':"")+'<button class="btn btn-primary btn_download"><span class="fas fa-file-download"></span></button></div></div></div>');i.find(".btn_download").unbind("click").click(function(a){a.stopPropagation(),e.documento_revisao_id?App.obter_token_publico(function(a){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&token_publico="+a)}):alert_modal("Download","Nenhuma revisão do documento disponível para download")}),i.find(".btn_visualizar").unbind("click").click(function(a){a.stopPropagation(),"image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type?View.load("central_documentos/visualizar_documento",function(a,i){i.show(e.documento_revisao_id)}):"application/pdf"==e.mime_type&&View.load("central_documentos/visualizar_pdf",function(a,i){i.show(e.documento_revisao_id)})});var o=function(a,i,o){var t={documento_id:e.documento_id,documento_revisao_id:e.documento_revisao_id,aprovacao:i,documento_aprovacao_alcada_id:e.documento_aprovacao_alcada_id};null!=a&&(t.rejeitar=a,t.documento_revisao_reprovar_id=e.documento_revisao_reprovar_id,t.revisoes_reprovadas=e.revisoes_reprovadas),null!=o&&(t.consideracoes=o),WS.post("documento/salvar_documento_aprovacao_revisoes/",t,function(e){e&&r.refresh_timeline()})},t=function(a,i){parseInt(e.qtde_revisoes_pendentes)>0?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"<div><p>Deseja rejeitar as revisões anteriores do documento ?</p></div>","Sim",function(){o(!0,a,i)},!0,"Não",null,function(){o(!1,a,i)}):o(!1,a,i)};return i.find(".btn_aprovar").unbind("click").click(function(a){a.stopPropagation(),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Deseja realmente aprovar o Documento: "+e.nome+' ?<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="Considerações sobre o documento."></textarea></div>',"Sim",function(){var e=document.getElementById("consideracoes").value;t("S",e)},!0,"Não",null,function(){return!1})}),i.find(".btn_reprovar").unbind("click").click(function(a){a.stopPropagation(),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Por gentileza, informe o motivo pelo qual deseja reprovar o Documento: <br />"+e.nome+'<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="digite o motivo da reprova do documento."></textarea></div>',"Reprovar",function(){var e=document.getElementById("consideracoes").value;t("N",e)},!0,"Cancelar",null,function(){return!1})}),i.find(".btn_substituir").unbind("click").click(function(a){a.stopPropagation();var i=function(){alert_saved("Arquivo alterado com sucesso !"),r.refresh_timeline()};View.load("central_documentos/substituir_revisao",function(a,o){o.onsave=i,o.show(e.documento_aprovacao_alcada_id,e.codigo,e.nome,e.revisao_sequencia,e.revisao_nome,e.revisao_tamanho)})}),i}(n.data):function(e){var i="image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type||"application/pdf"==e.mime_type,o=null;o=e.tipo_copia==DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA?"Pendente de leitura":e.tipo_acao==DISTRIBUICAO_CONTROLADA_TIPO_ACAO.ADICIONAR?"Adicionar documento":e.tipo_acao==DISTRIBUICAO_CONTROLADA_TIPO_ACAO.REMOVER?"Remover documento":null;var t=$('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>:"+(e.codigo?" #"+e.codigo:"")+" "+o+(e.local_distribuicao?" localizado em: "+e.local_distribuicao:"")+'</h5><h6 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #959595;":"")+'">'+e.revisao_nome+"<i> "+filesize(parseInt(e.revisao_tamanho,10)||0)+"</i></h6><div>"+(r.supervisionado_id?"":'<button class="btn btn-primary btn_marcar_realizado"><span class="fas fa-check"></span></button>')+'</div></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+(e.data_prazo?"S"==e.atrasado?e.data_prazo.format_date_time():e.data_prazo.substr(11,5):"")+'</h6><div class="pull-right">'+(i?'<button style="margin-right: 5px;" class="btn btn-primary btn_visualizar"><span class="fas fa-eye"></span></button>':"")+'<button class="btn btn-primary btn_download"><span class="fas fa-file-download"></span></button></div></div></div>');return t.find(".btn_download").unbind("click").click(function(a){a.stopPropagation(),e.documento_revisao_id?App.obter_token_publico(function(a){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&token_publico="+a)}):alert_modal("Download","Nenhuma revisão do documento disponível para download")}),t.find(".btn_visualizar").unbind("click").click(function(a){a.stopPropagation(),"image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type?View.load("central_documentos/visualizar_documento",function(a,i){i.show(e.documento_revisao_id)}):"application/pdf"==e.mime_type&&View.load("central_documentos/visualizar_pdf",function(a,i){i.show(e.documento_revisao_id)})}),t.find(".btn_marcar_realizado").unbind("click").click(function(i){i.stopPropagation(),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Esta ação irá marcar essa atividade como </strong>concluído,<strong> deseja continuar ?</strong></span></div><div id="file-uploader"></div>','<i class="fa fa-check" aria-hidden="true"></i> Confirmar',function(){WS.post("documento_distribuicao_controlada/marcar_realizado/",{id:e.id,documento_id:e.documento_id,documento_revisao_id:e.documento_revisao_id,documento_confirmacao_distribuicao:r.documento_confirmacao_distribuicao.props.arquivoSelecionado},function(e){var a=!0===e?"success":"error",i=!0===e?"Atividade concluída com sucesso":"Falha ao concluir a atividade";DevExpress.ui.notify.default({message:i,type:a,displayTime:3e3,width:300}),!0===e&&r.refresh_timeline()},null,null,!0)},!0),a.render(r.documento_confirmacao_distribuicao,$("#file-uploader")[0]),r.documento_confirmacao_distribuicao.props.setDesabilitado(!1)}),t}(n.data);break;case MODULOS.PROCESSO:d=function(e){var a="S"==o?e.numero:e.solicitacao_id,i=e.usuario_solicitante_foto_id?window.WS_URI+"documento/midia/?&tamanho=20&usuario_id="+e.usuario_solicitacao_atividade_id+"&token_midia="+App.sessao.token_midia:"assets/img/imagem_usuario_padrao.svg";return $('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>Solicitação</b>: #'+a+" "+e.atividade_descricao+"</h5>"+(e.cliente_id?'<h6><span class="label label-info">C</span> '+e.cliente_nome+"</h6>":"")+'<h6><span data-toggle="tooltip" title="Solicitante"><img style="height: 20px; width: 20px; border-radius: 50%; object-fit: cover class="imagem_responsavel" src="'+i+'">&nbsp;'+e.usuario_solicitacao_nome+'</span>&nbsp;&nbsp;&nbsp;<span data-toggle="tooltip" title="Responsável"><img style="height: 20px; width: 20px; border-radius: 50%; object-fit: cover class="imagem_responsavel" src="assets/img/imagem_usuario_padrao.svg">&nbsp;'+e.usuario_grupos_responsavel_atividade+'</span></h6><h6 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #959595;":"")+'">'+e.processo_nome+"</h6>"+(e.descricao?'<h6 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #959595;":"")+'">'+e.descricao+"</h6>":"")+'</div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+(e.prazo_execucao?"S"==e.atrasado?e.prazo_execucao.format_date_time():e.prazo_execucao.substr(11,5):"")+"</h6></div></div>")}(n.data);break;case MODULOS.RELACIONAMENTO:d=function(e){return $('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>: "+e.descricao+"</h5><h6"+("S"==e.atrasado?' style="color: #959595;"':"")+">"+(e.projeto_nome?e.projeto_nome:"")+" "+(e.atividade_projeto_nome?e.atividade_projeto_nome:"")+'</h6><h6><span class="label '+cor_label_entidade(e.entidade_tipo)+'">'+e.entidade_tipo+"</span> "+e.entidade_nome+'</h6><div><span class="label label-default" style="margin-right: 5px;">'+e.tipo_agenda_oportunidade_descricao+'</span></div></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+("S"==e.atrasado?e.dia.format_date():"")+" <br />"+e.hora_inicio.substr(0,5)+"~"+e.duracao.substr(0,5)+"</h6></div></div>")}(n.data);break;case MODULOS.PROJETO:d=function(e){var a=$('<div class="'+("S"==e.atrasado?"bg-danger":"")+'" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #F33F66;":"")+'"><b>'+nome_modulo(e.timeline_modulo_original)+"</b>:"+(e.codigo?" "+e.codigo:"")+" "+e.atividade_simplificada+"</h5>"+(e.cliente_id?'<h6><span class="label label-info">C</span> '+e.cliente_nome+"</h6>":"")+'<h6 style="overflow: hidden; text-overflow: ellipsis;'+("S"==e.atrasado?" color: #959595;":"")+'">'+e.projeto_nome+'</h6></div><div style="margin: 5px;"><h6'+("S"==e.atrasado?' style="color: #959595;"':"")+' class="data">'+(e.prazo_execucao?"S"==e.atrasado?e.prazo_execucao.format_date_time():e.prazo_execucao.substr(11,5):"")+"</h6>"+(r.supervisionado_id?"":'<div class="pull-right"><button style="margin-right: 5px;" class="btn btn-primary btn_atividade_projeto"><span class="fas fa-tasks"></span></button><button class="btn btn-primary btn_apontamento"><span class="far fa-clock"></span></button></div>')+"</div></div>");return a.find(".btn_apontamento").unbind("click").click(function(a){a.stopPropagation();var i=null;e.apontamento_id>0&&e.dia==e.apontamento_dia&&App.sessao.usuario_id==e.usuario_id&&(i=e.apontamento_id),View.load("apontamento_projeto/detalhes",function(a,o){o.onclose=r.refresh_timeline,null!=i?o.show(i,FORMULARIO.EDITAR,e.dia,e.projeto_id,e.cliente_id,e.id,e.projeto_nome):o.show(null,FORMULARIO.NOVO,e.dia,e.projeto_id,e.cliente_id,e.cliente_nome,e.id,e.projeto_nome)},View.ABA.MULTIPLAS)}),a.find(".btn_atividade_projeto").unbind("click").click(function(a){a.stopPropagation(),View.load("atividade_projeto/detalhes",function(a,i){const o={projeto_id:e.projeto_id,projeto_atividade_id:e.id,tipo:FORMULARIO.EDITAR,template:e.projeto_template,nome:e.atividade_simplificada.substr(0,10),projeto_apontamento_por:e.projeto_apontamento_por};i.show(o)},View.ABA.MULTIPLAS,null,null,{projetoAtividadeId:e.id})}),a}(n.data);break;case"Feriado":d=function(e){return $('<div class="bg-danger" style="border-radius: 8px; display: flex; flex-flow: nowrap; justify-content: space-between; align-items: start; box-shadow: 0px 0px 10px rgb(0 0 0 / 25%);"><div style="margin: 5px; overflow: hidden;"><h5 style="overflow: hidden; text-overflow: ellipsis; color: #F33F66;"><b>Feriado</b>: '+e.nome+'</h5><h6 style="overflow: hidden; text-overflow: ellipsis; color: #F33F66;">'+(e.descricao?e.descricao:"")+'</h6></div><div style="margin: 5px;"><h6 style="color: #F33F66;">'+e.hora_inicio.substr(0,5)+"~"+e.hora_fim.substr(0,5)+"</h6></div></div>")}(n.data);break;default:d=$('<div class="text-muted" style="text-align: center">Sem registros para este dia</div>')}d.appendTo(t)}}],onInitialized:function(e){setTimeout(function(){e.component.repaint(),e.element.find(".dx-datagrid-header-panel").parent().css("border-radius","10px 10px 0px 0px"),e.element.find(".dx-datagrid-header-panel").css("border-radius","10px 10px 0px 0px")})},onRowClick:function(e){switch(e.data.timeline_modulo_original){case MODULOS.CHAMADO:View.loadReact(window.views.chamado.Detalhes.default,{chamadoId:e.data.id,onClose:r.refresh_timeline},function(e,a){},View.ABA.MULTIPLAS);break;case MODULOS.AGENDA:View.load("agenda/agenda_evento",function(a,i){i.onclose=r.refresh_timeline;var o={evento_id:e.data.agenda_evento_id,usuario_id:e.data.usuario_id,usuario_nome:e.data.nome_ativo_reservado,agenda_ativo_id:e.data.agenda_ativo_id,criado_por:e.data.insert_usuario_id};i.show(o)});break;case MODULOS.TAREFAS:View.load("tarefa/detalhes_cartao",function(a,i){i.onclose=r.refresh_timeline,i.show(e.data.id)},View.ABA.MULTIPLAS,null,null,{cartaoId:e.data.id});break;case MODULOS.PDCA:View.load("pdca/atividades",function(a,i){var o={pdca_id:e.data.pdca_id,numero:e.data.pdca_numero,objetivo:e.data.pdca_objetivo,data_inicio:e.data.pdca_data_inicio,data_fim:e.data.pdca_data_fim,progresso:e.data.pdca_progresso,situacao:e.data.pdca_situacao,situacao_id:e.data.pdca_situacao_id,dados_atividade:{pdca_atividade_id:e.data.pdca_atividade_id}};i.show(o,!0)},View.ABA.MULTIPLAS,null,null,{pdcaId:e.data.pdca_id});break;case MODULOS.DOCUMENTO:View.load("central_documentos/documento",function(a,i){i.onclose=r.refresh_timeline,i.show(e.data.documento_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS);break;case MODULOS.PROCESSO:View.load("solicitacao/detalhes",function(a,i){i.onclose=r.refresh_timeline,i.show(e.data.solicitacao_atividade_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS,null,null,{solicitacaoAtividadeId:e.data.solicitacao_atividade_id});break;case MODULOS.RELACIONAMENTO:View.load("oportunidade/atividade",function(a,i){var o=e.data.representante_usuario_id!=App.sessao.dados.usuario_id;i.onclose=r.refresh_timeline,i.show(e.data.oportunidade_agenda_id,FORMULARIO.EDITAR,null,e.data.oportunidade_id,null,o)});break;case MODULOS.PROJETO:View.load("atividade_projeto/detalhes",function(a,i){const o={projeto_id:e.data.projeto_id,projeto_atividade_id:e.data.id,tipo:FORMULARIO.EDITAR,template:e.data.projeto_template,nome:e.data.atividade_simplificada.substr(0,10),projeto_apontamento_por:e.data.projeto_apontamento_por};i.onclose=r.refresh_timeline,i.show(o)},View.ABA.MULTIPLAS,null,null,{projetoAtividadeId:e.data.id})}},onRowPrepared:function(e){if("data"==e.rowType)if(e.data.timeline_modulo_original){e.rowElement.css("cursor","pointer");var a=e.rowElement.find("td").length;e.rowElement.find(".dx-datagrid-group-space").remove(),e.rowElement.find("td").last().attr("colspan",a)}else e.rowElement.addClass("bg-info");else if("group"==e.rowType){var i=App.get_parametro_usuario("listagem_timeline");void 0===i.collapsed&&(i.collapsed=[]);var o=i.collapsed.indexOf(JSON.stringify(e.key));if(r.listagem_inicial){var t=new Date;if(t.setDate(date.getDate()-1),t=formatDate(t,!0),i.collapsed){for(var n=!1,s=0;s<i.collapsed.length;s++){for(var d=i.collapsed[s],l=!1,_=0;_<d.length;_++){var m=d[_];void 0!==m&&m&&isValidDate(m.toString())&&m<t&&(l=!0)}l?(n=!0,i.collapsed.splice(o,1)):r.dx_listagem_timeline_instance.collapseRow(JSON.parse(d))}n&&App.set_parametro_usuario("listagem_timeline",i)}}else e.isExpanded&&-1!==o?(i.collapsed.splice(o,1),App.set_parametro_usuario("listagem_timeline",i)):e.isExpanded||-1!==o||(i.collapsed.push(JSON.stringify(e.key)),App.set_parametro_usuario("listagem_timeline",i))}},onContentReady:function(e){e.element.find("table").last().find("col").not(":last").css("width","30px"),$(window).resize(function(){e.element.find("table").last().find("col").not(":last").css("width","30px")}),r.listagem_inicial=!1},onContextMenuPreparing:function(e){if("content"==e.target){var a="S"==e.row.data.agenda_tipo_particular||1==e.row.data.agenda_tipo_particular;"data"===e.row.rowType&&e.row.data.timeline_modulo_original==MODULOS.AGENDA&&(!a||a&&e.row.data.usuario_id==App.sessao.dados.usuario_id)?e.items=[{text:"Marcar como realizado",onItemClick:function(){alert_modal("Evento Agenda",'Deseja realmente marcar "'+e.row.data.descricao+'" como realizado ?',"Sim",function(){WS.post("agenda_evento/alterar_agenda_realizado/",{agenda_evento_id:e.row.data.agenda_evento_id},function(a){alert_saved('O evento "'+e.row.data.descricao+'" foi realizado'),r.btn_refresh.trigger("click")})},!0,"Não",function(){})}}]:"data"===e.row.rowType&&e.row.data.timeline_modulo_original==MODULOS.RELACIONAMENTO&&(e.items=[{text:"Editar Oportunidade",onItemClick:function(){View.load("oportunidade/detalhes",function(a,i){i.onclose=r.refresh_timeline,i.show(e.row.data.oportunidade_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS,null,null,{oportunidadeId:e.row.data.oportunidade_id})}}])}},scrolling:{mode:"virtual",legacyMode:!0},summary:{groupItems:[{column:"timeline_modulo_original",summaryType:"custom",displayFormat:"{0} registros",name:"timeline_modulo_original"}],calculateCustomSummary:function(e){var a=[];"timeline_modulo_original"===e.name&&("start"===e.summaryProcess&&(a=[],e.totalValue=0),"calculate"===e.summaryProcess&&(-1==a.indexOf(e.value)&&e.totalValue++,a.push(e.value)))}}}).dxDataGrid("instance"),r.div_cockpit.show(),r.divMeio.show(),r.divLadoEsquerdo.removeClass("col-md-12"),r.divLadoEsquerdo.addClass("col-md-6")}else r.div_cockpit.hide(),r.divMeio.hide(),r.divLadoEsquerdo.removeClass("col-md-6"),r.divLadoEsquerdo.addClass("col-md-12");r.cockpit_calc_height()},this.cockpit_calc_height=function(){var e=r.cockpitComponent.innerHeight();e+=94,r.scrollview.css("height","calc(100vh - "+e+"px)")},this.cockpit_view_wrap=function(){r.cockpitComponent.css({display:""}),r.cockpitComponent.find("div:first").css({display:"",flexFlow:""}),r.cockpitComponent.find("div.templateCard").css({width:""}),r.cockpit_calc_height(),App.set_parametro_usuario("cockpitOpcoes",{viewType:COCKPIT_VIEW.WRAP})},this.cockpit_view_inline=function(){r.cockpitComponent.find("div:first").css({display:"flex",flexFlow:"row nowrap"}),r.cockpitComponent.find("div.templateCard").css({minWidth:170}),r.cockpit_calc_height(),App.set_parametro_usuario("cockpitOpcoes",{viewType:COCKPIT_VIEW.INLINE})},this.expandir_cockpit=function(){r.cockpitComponent.parent().css({height:"100%"}),r.cockpitComponent.parent().parent().removeClass("hidden"),r.btn_expandir_cockpit.prop("disabled",!0),r.btn_view_wrap.prop("disabled",!1),r.btn_view_inline.prop("disabled",!1),r.btn_retrair_cockpit.prop("disabled",!1),r.div_cockpit_header.css({background:"transparent"});var e=App.get_parametro_usuario("cockpitOpcoes"),a=r.cockpitComponent.innerHeight();a+=94,r.scrollview.css("height","calc(100vh - "+a+"px)"),e=Object.assign(e,{visible:!0}),App.set_parametro_usuario("cockpitOpcoes",e)},this.retrair_cockpit=function(){r.cockpitComponent.parent().css({height:0}),r.cockpitComponent.parent().parent().addClass("hidden"),r.btn_retrair_cockpit.prop("disabled",!0),r.btn_view_wrap.prop("disabled",!0),r.btn_view_inline.prop("disabled",!0),r.btn_expandir_cockpit.prop("disabled",!1),r.div_cockpit_header.css({background:"#CECECE"});var e=r.cockpitComponent.innerHeight();e+=94,r.scrollview.css("height","calc(100vh - "+e+"px)");var a=App.get_parametro_usuario("cockpitOpcoes");a=Object.assign(a,{visible:!1}),App.set_parametro_usuario("cockpitOpcoes",a)},this.expandir_dashboard=function(){r.graficos_dashboard_crm.css({display:""}),r.btn_expandir_dashboard.prop("disabled",!0),r.btn_retrair_dashboard.prop("disabled",!1),r.div_dashboard_header.css({background:"transparent"});var e=App.get_parametro_usuario("dashboardOpcoes");e=Object.assign(e,{visible:!0}),App.set_parametro_usuario("dashboardOpcoes",e)},this.retrair_dashboard=function(){r.graficos_dashboard_crm.css({display:"none"}),r.btn_retrair_dashboard.prop("disabled",!0),r.btn_expandir_dashboard.prop("disabled",!1),r.div_dashboard_header.css({background:"#CECECE"});var e=App.get_parametro_usuario("dashboardOpcoes");e=Object.assign(e,{visible:!1}),App.set_parametro_usuario("dashboardOpcoes",e)},this.render_aniversariantes=(()=>{var e=App.get_parametro_usuario("aniversariantesOpcoes");!0===e.visible||void 0===e.visible?r.expandir_aniversariantes():r.retrair_aniversariantes(),ReactDOM.render(React.createElement(window.components.Aniversariantes.default,{}),r.divComponenteAniversariantes[0])}),this.expandir_aniversariantes=function(){r.divComponenteAniversariantes.css({display:""}),r.btn_expandir_aniversariantes.prop("disabled",!0),r.btn_retrair_aniversariantes.prop("disabled",!1),r.div_aniversariantes_header.css({background:"transparent"});var e=App.get_parametro_usuario("aniversariantesOpcoes");e=Object.assign(e,{visible:!0}),App.set_parametro_usuario("aniversariantesOpcoes",e)},this.retrair_aniversariantes=function(){r.divComponenteAniversariantes.css({display:"none"}),r.btn_retrair_aniversariantes.prop("disabled",!0),r.btn_expandir_aniversariantes.prop("disabled",!1),r.div_aniversariantes_header.css({background:"#CECECE"});var e=App.get_parametro_usuario("aniversariantesOpcoes");e=Object.assign(e,{visible:!1}),App.set_parametro_usuario("aniversariantesOpcoes",e)},this.btn_retrair_timeline.unbind("click").click(function(){r.dx_listagem_timeline_instance.collapseAll(),detectmob()&&(r.dx_listagem_timeline.css({display:"none"}),r.btn_retrair_timeline.prop("disabled",!0),r.btn_expandir_timeline.prop("disabled",!1),r.dx_listagem_timeline.parent().css({background:"#CECECE"}))}),this.btn_expandir_timeline.unbind("click").click(function(){r.dx_listagem_timeline_instance.expandAll(),detectmob()&&(r.dx_listagem_timeline.css({display:""}),r.btn_retrair_timeline.prop("disabled",!1),r.btn_expandir_timeline.prop("disabled",!0),r.dx_listagem_timeline.parent().css({background:"transparent"})),setTimeout(()=>{console.log(r.dx_listagem_timeline_instance)},2e3)}),this.btn_retrair_dashboard.unbind("click").click(function(){r.retrair_dashboard()}),this.btn_expandir_dashboard.unbind("click").click(function(){r.expandir_dashboard()}),this.drawer_right_resize=(e=>{$(r.instanceDrawer._$element).find(".dx-drawer-panel-content").css("width",e?300:0)}),this.toggle_drawer_right=function(e){var a=r.get_home_drawer_right_opcoes(),i=null;i=a.componente!==e?""!==a.componente&&null!==a.componente&&a.componente!==HOME_DRAWER_RIGHT_COMPONENTES.BOTH?HOME_DRAWER_RIGHT_COMPONENTES.BOTH:e:null,r.home_drawer_right_alterar_opcoes(i),r.drawer_right_resize(i),App.set_parametro_usuario("home_drawer_right_opcoes",spread(a,{componente:i})),r.render_dashboard()},this.btn_toggle_notas.off("click").on("click",function(){r.toggle_drawer_right(HOME_DRAWER_RIGHT_COMPONENTES.NOTAS)}),this.btn_toggle_favoritos.off("click").on("click",function(){r.toggle_drawer_right(HOME_DRAWER_RIGHT_COMPONENTES.FAVORITOS)}),this.btn_config_timeline.unbind("click"),this.btn_config_timeline.click(function(){View.load("menu/config_time_line",function(e,a){a.onclose=function(e,a){r.qtd_dias=e,r.exibir_dias_sem_evento=a,r.refresh_timeline()},a.show(r.qtd_dias,r.exibir_dias_sem_evento)})}),this.edt_nome_supervisionado.unbind("click").click(function(e){e.stopPropagation()}),this.edt_nome_supervisionado.unbind("keyup").keyup(function(){r.filtro_nome_supervisionado=$(this).val(),r.edt_nome_supervisionado.val(r.filtro_nome_supervisionado),r.render_usuarios_supervisionados()}),this.btn_mural_nova_mensagem.unbind("click"),this.btn_mural_nova_mensagem.click(function(){View.load("mural_mensagem/nova",function(e,a){a.onsave=function(e){r.ultima_mensagem_mural_id=null,r.maior_id=null,r.listar_mural(null)},a.onclose=function(){r.nova_mensagem_mural=!1},a.show(null,FORMULARIO.NOVO,null)},View.ABA.MULTIPLAS)}),this.btn_mural_nova_votacao.unbind("click"),this.btn_mural_nova_votacao.click(function(){if(r.div_mural_nova_votacao.is(":visible"))return!1;r.div_mural_nova_votacao.show(),r.react_component_nova_votacao=React.createElement(window.components.NovaVotacao.default,{votacao_id:0,origem:"mural_mensagem",onClose:e=>{r.div_mural_nova_votacao.hide(),ReactDOM.unmountComponentAtNode(r.div_nova_votacao[0]),r.div_nova_votacao.empty(),r.btn_refresh.click()}}),ReactDOM.render(r.react_component_nova_votacao,r.div_nova_votacao[0])}),this.btn_gestao_mural.unbind("click"),this.btn_gestao_mural.click(function(){View.hide(r.html_id),View.load("mural_mensagem/listar",function(e,a){},View.ABA.SIM)}),this.btn_refresh.unbind("click"),this.btn_refresh.click(function(e){r.ultima_mensagem_mural_id=null,r.maior_id=null,r.nova_mensagem_mural=!1,r.listar_mural(null),App.count_notificacao(),r.refresh_timeline(),e.stopImmediatePropagation()}),this.btn_voltar_ao_topo.unbind("click"),this.btn_voltar_ao_topo.click(function(){$("html, body").animate({scrollTop:0},1e3,"linear")}),this.dropdown.on("shown.bs.dropdown",function(e){$(this).css({overflow:"initial",whiteSpace:"normal"})}),this.dropdown.on("hidden.bs.dropdown",function(e){$(this).css({overflow:"hidden",whiteSpace:"nowrap"})}),this.btn_retrair_aniversariantes.unbind("click").click(function(){r.retrair_aniversariantes()}),this.btn_expandir_aniversariantes.unbind("click").click(function(){r.expandir_aniversariantes()}),r.show()}});