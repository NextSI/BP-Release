define(["react","react-dom","./../componentes_react/CboUsuarios"],function(a,i,o){return function(s){"use strict";var r=this;this.html_id=s,this.dialog=$("#"+this.html_id),this.title="Grupo de Ativos - Detalhes",this.onclose=null,this.params={grupo_ativos_id:null,tipo:FORMULARIO.NOVO},this.arr_responsaveis=[],this.arr_ativos=[],this.edt_nome=this.dialog.find(".edt_nome"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.cboUsuarios=a.createElement(o,null,null),this.cbo_agenda_ativo=this.dialog.find(".cbo_agenda_ativo"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.tab_geral=this.dialog.find(".tab_geral"),this.tab_ativos=this.dialog.find(".tab_ativos"),this.tab_usuarios=this.dialog.find(".tab_usuarios"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_ativos=this.dialog.find(".menu_ativos"),this.menu_usuarios=this.dialog.find(".menu_usuarios"),this.aba_geral=this.dialog.find(".aba_geral"),this.aba_ativos=this.dialog.find(".aba_ativos"),this.aba_usuarios=this.dialog.find(".aba_usuarios"),this.tab_responsaveis=this.dialog.find(".tab_responsaveis"),this.tab_ativos=this.dialog.find(".tab_ativos"),this.show=function(a){switch(r.params=extender_parametros(r.params,a),r.inicializar_componentes(),r.params.tipo){case FORMULARIO.NOVO:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0),set_focus(r.edt_codigo);break;case FORMULARIO.EDITAR:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}null!=r.params.grupo_ativos_id&&r.preencher()},this.preencher=function(){WS.get({route:"grupo_ativos/objeto/",data:{grupo_ativos_id:r.params.grupo_ativos_id},func_response:function(a){a&&(r.edt_nome.val(a.nome),r.arr_responsaveis=a.arr_responsaveis,r.arr_ativos=a.arr_ativos,r.render_ativos(),r.render_responsaveis())}})},this.permite_alterar=function(a){r.edt_nome.prop("readonly",!a),r.cbo_agenda_ativo.SelectMultiColumn("disabled",!a),r.cboUsuarios.props.setCampoUsuarioLeitura(!a)},this.close=function(){void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){r.aba_geral.attr("id","aba_geral"+r.html_id),r.aba_ativos.attr("id","aba_ativos"+r.html_id),r.aba_usuarios.attr("id","aba_usuarios"+r.html_id),r.menu_geral.attr("href","#"+r.aba_geral.attr("id")),r.menu_ativos.attr("href","#"+r.aba_ativos.attr("id")),r.menu_usuarios.attr("href","#"+r.aba_usuarios.attr("id"));var a={route:"agenda_ativo/listar/",method:"GET",params:null,arr_cols:[App.lang.agenda_ativos.nome],arr_campos:["nome"],campo_value:"id",text_value:"nome",habilitar_limite:!0,OnKeyUp:function(a,i){var o={nome:r.cbo_agenda_ativo.SelectMultiColumn("EdtVal")};if(r.cbo_agenda_ativo.SelectMultiColumn("UpdateParams",o),a.which==KEYPRESS_PADRAO.ENTER){var s=r.cbo_agenda_ativo.SelectMultiColumn("dados_selecionado");console.log(s),null==s||$(r.arr_ativos).in_array(s.id.toString(),"id")||(r.arr_ativos.push(s),r.cbo_agenda_ativo.SelectMultiColumn("clean"),r.render_ativos())}},OnClickOverRow:function(a,i,o){null==o||$(r.arr_ativos).in_array(o.id.toString(),"id")||(r.arr_ativos.push(o),r.cbo_agenda_ativo.SelectMultiColumn("clean"),r.render_ativos())}};$(r.cbo_agenda_ativo).SelectMultiColumn(a),i.render(r.cboUsuarios,r.div_componente_usuario[0]),r.cboUsuarios.props.setObjParam({EquipeInterna:!0,EmpresaId:App.temp.empresa,ExibirGrupos:!0}),r.cboUsuarios.props.setFunctionSelect(r.ao_selecionar_responsavel)},this.ao_selecionar_responsavel=function(){var a={},i=!1;$(r.arr_responsaveis).each(function(a,o){o.usuario_id===r.cboUsuarios.props.UsuarioSelecionado.id&&"usuarios"==r.cboUsuarios.props.UsuarioSelecionado.tipo?i=!0:o.grupo_usuarios_id===r.cboUsuarios.props.UsuarioSelecionado.id&&"grupo_usuarios"==r.cboUsuarios.props.UsuarioSelecionado.tipo&&(i=!0)}),!i&&r.cboUsuarios.props.UsuarioSelecionado.id>0&&(a.tipo=r.cboUsuarios.props.UsuarioSelecionado.tipo,a.nome=r.cboUsuarios.props.UsuarioSelecionado.nome,a.manutencao="N","usuarios"==r.cboUsuarios.props.UsuarioSelecionado.tipo?a.usuario_id=r.cboUsuarios.props.UsuarioSelecionado.id:"grupo_usuarios"==r.cboUsuarios.props.UsuarioSelecionado.tipo&&(a.grupo_usuarios_id=r.cboUsuarios.props.UsuarioSelecionado.id),r.arr_responsaveis.push(a),r.render_responsaveis()),r.cboUsuarios.props.setUsuario({usuario_id:null,usuario_nome:""})},this.render_ativos=function(){var a=r.tab_ativos.find("tbody"),i=a.find("tr:first");r.tab_ativos.find("tr:gt(1)").remove(),$(r.arr_ativos).each(function(o,s){!function(o){o=extender_parametros({codigo:"-",nome:"-"},o);var s=i.clone();s.removeAttr("template_row"),s.css("display",""),$(s).find('[template-field="nome"]').text(o.nome),$(s).find('[template-field="codigo"]').text(o.codigo);var e=$(s).find(".btn_ativo_remover");r.params.tipo!=FORMULARIO.EXCLUIR&&r.params.tipo!=FORMULARIO.VISUALIZAR?e.unbind("click").click(function(a){alert_modal("Aviso","Deseja remover o Ativo?","Remover",function(){$(r.arr_ativos).in_array(o.id,"id",function(a,i){r.arr_ativos.splice(a,1),r.render_ativos()})},!0)}):e.addClass("disabled"),s.appendTo(a)}(s)})},this.render_responsaveis=function(){var a=r.tab_responsaveis.find("tbody"),i=a.find("tr:first");a.find("tr:not([template-row])").remove(),$(r.arr_responsaveis).each(function(o,s){!function(o){var s=i.clone();s.removeAttr("template-row"),s.css("display","");var e=$(s.find("[template-field='tipo']"));"usuarios"==o.tipo?(e.addClass("label-info"),e.attr("title","Usuário"),e.attr("data-original-title","Usuário"),e.text("U")):"grupo_usuarios"==o.tipo&&(e.addClass("label-warning"),e.attr("title","Grupo de Usuários"),e.attr("data-original-title","Grupo de Usuários"),e.text("GU")),e.tooltip(),$(s.find("[template-field='nome']")).text(o.nome);var t=$(s.find("[template-field='manutencao']"));t.val(o.manutencao),t.change(function(){$(r.arr_responsaveis).each(function(a,i){("usuarios"==i.tipo&&i.usuario_id==o.usuario_id||"grupo_usuarios"==i.tipo&&i.grupo_usuarios_id==o.grupo_usuarios_id)&&(r.arr_responsaveis[a].manutencao=t.val())})});var n=$(s).find(".chk_notificar_por_email");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",!0===o.notificar_por_email||"S"===o.notificar_por_email),n.change(function(){$(r.arr_responsaveis).each(function(a,i){("usuarios"==i.tipo&&i.usuario_id==o.usuario_id||"grupo_usuarios"==i.tipo&&i.grupo_usuarios_id==o.grupo_usuarios_id)&&(r.arr_responsaveis[a].notificar_por_email=n.prop("checked"))})});var u=$(s.find(".btn_usuario_remover"));r.params.tipo!=FORMULARIO.EXCLUIR&&r.params.tipo!=FORMULARIO.VISUALIZAR?(u.unbind("click"),u.click(function(){alert_modal("Aviso","Deseja remover o Responsável?","Remover",function(){$(r.arr_responsaveis).each(function(a,i){"usuarios"==i.tipo?i.usuario_id==o.usuario_id&&(s.remove(),r.arr_responsaveis.splice(a,1),r.render_responsaveis()):"grupo_usuarios"==i.tipo&&i.grupo_usuarios_id==o.grupo_usuarios_id&&(s.remove(),r.arr_responsaveis.splice(a,1),r.render_responsaveis())})},!0)})):u.addClass("disabled"),s.appendTo(a)}(s)}),App.aplicar_checkbox(a)},this.btn_salvar.unbind("click").click(function(a){var i={grupo_ativos_id:r.params.grupo_ativos_id,nome:r.edt_nome.val(),arr_responsaveis:JSON.stringify(r.arr_responsaveis),arr_ativos:JSON.stringify(r.arr_ativos)},o=extender_parametros({grupo_ativos_id:null,nome:null},i);WS.post({route:"grupo_ativos/salvar",data:o,type:"POST",func_response:function(a){a&&(alert_saved("Grupo Ativos "+o.nome+" salvo com sucesso"),r.unload())},disable_buttons:[r.btn_salvar,r.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(a){WS.post({route:"grupo_ativos/excluir",data:{grupo_ativos_id:r.params.grupo_ativos_id},type:"POST",func_response:function(a){a&&(alert_saved("Ativo "+r.edt_nome.val()+" excluido com sucesso"),r.unload())},disable_buttons:[r.btn_excluir,r.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(a){r.unload()})}});