define([],function(){return function(o){"use strict";var i=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.edt_nome=this.dialog.find(".edt_nome"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.grupo_id=null,this.arr_motivos=[],this.cbo_option_html="",this.show=function(o,t){switch(t){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}WS.get("chamado_motivo/listar/",null,function(a){i.cbo_option_html='<option value="0">Selecione</option>';for(var e=0;e<a.length;e++)i.cbo_option_html=i.cbo_option_html+"<option motivo-bloqueado="+a[e].bloqueado+' value="'+a[e].chamado_motivo_id+'">'+a[e].nome+"</option>";i.tipo=t,void 0!==o&&o&&(i.grupo_id=o,i.preencher()),show_modal(i.modal.attr("id")),set_focus(i.edt_nome)})},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.permite_alterar=function(o){i.edt_nome.prop("readonly",!o),i.btn_add_grupo.prop("disabled",!o)},this.preencher=function(){WS.get("grupo_motivo_chamado/objeto/",{grupo_id:i.grupo_id},function(o){i.edt_nome.val(o.nome),i.arr_motivos=o.motivos,i.render_motivos()})},this.render_motivos=function(){var o=i.tab_listagem.find("tbody"),t=o.find("tr:first");$(i.arr_motivos).each(function(o,t){void 0===i.arr_motivos[o].removido&&(i.arr_motivos[o].removido=!1)}),i.tab_listagem.find("tr:gt(1)").remove(),$(i.arr_motivos).each(function(a,e){e.removido||function(a,e){var n=t.clone();n.removeAttr("template-row"),n.css("display","");var d=$(n.find(".cbo_motivo"));d.append(i.cbo_option_html);var r=$(n.find('[template-field="motivo_bloqueado"]'));"S"!=e.motivo_bloqueado&&!0!==e.motivo_bloqueado||$(r).append('<i class="fa fa-lock info_motivo_bloqueado" aria-hidden="true" data-toggle="tooltip" title="Motivo de chamado bloqueado"></i>'),d.val(e.chamado_motivo_id),d.on("change",function(o){"S"==$(this).find("option[value="+$(this).val()+"]").attr("motivo-bloqueado")||!0===e.motivo_bloqueado?$(r).append('<i class="fa fa-lock info_motivo_bloqueado" aria-hidden="true" data-toggle="tooltip" title="Motivo de chamado bloqueado"></i>'):$(r).find("i.info_motivo_bloqueado").remove(),i.arr_motivos[a].chamado_motivo_id=d.val()});var l=$(n.find(".btn_del_grupo"));l.unbind("click"),l.click(function(){alert_modal("Atenção!","Deseja remover o Motivo selecionado?","Remover",function(){i.arr_motivos[a].removido=!0,i.render_motivos()},!0)}),i.tipo!=FORMULARIO.VISUALIZAR&&i.tipo!=FORMULARIO.EXCLUIR||(l.prop("disabled",!0),d.prop("disabled",!0)),n.appendTo(o)}(a,e)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){for(var o=i.arr_motivos,t=0;t<o.length;t++)for(var a=0,e=0;e<i.arr_motivos.length;e++)i.arr_motivos[e].chamado_motivo_id==o[t].chamado_motivo_id&&(a+=1),a>1&&(i.arr_motivos[e].removido=!0);var n;n=i.arr_motivos.filter(function(o){return"0"!=o.chamado_motivo_id&&1!=o.removido}),WS.post("grupo_motivo_chamado/salvar",{grupo_id:i.grupo_id,nome:i.edt_nome.val(),motivos:n},function(o){i.grupo_id=o.grupo_id,alert_saved(o.nome+" salvo com sucesso"),i.unload()})}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("grupo_motivo_chamado/excluir",{grupo_id:i.grupo_id},function(o){alert_saved(o.nome+" excluido com sucesso"),i.unload()},[i.btn_cancelar,i.btn_excluir,i.btn_salvar,i.btn_add_grupo,$(".btn_del_grupo")])}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){i.arr_motivos.push({chamado_motivo_id:"0",grupo_id:null}),i.render_motivos()})}});