define(["react","react-dom","./../componentes_react/InformativoPrazo"],function(a,o,t){return function(i){"use strict";var s=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Dashboard Chamados",this.div_situacao=this.dialog.find(".div_situacao"),this.div_grafico_situacao=this.dialog.find(".div_grafico_situacao"),this.ul_motivos=this.dialog.find(".ul_motivos"),this.div_motivos=this.dialog.find(".div_motivos"),this.div_grafico_motivos=this.dialog.find(".div_grafico_motivos"),this.ul_chamados=this.dialog.find(".ul_chamados"),this.template_row=this.dialog.find(".template_row"),this.template_motivo=this.dialog.find(".template_motivo"),this.template_situacao=this.dialog.find(".template_situacao"),this.div_chamados=this.dialog.find(".div_chamados"),this.btn_filtrar=this.dialog.find(".btn_filtrar"),this.btn_limpar_filtros=this.dialog.find(".btn_limpar_filtros"),this.data_inicio=this.dialog.find(".data_inicio"),this.data_fim=this.dialog.find(".data_fim"),this.cbo_op_chamado=this.dialog.find(".cbo_op_chamado"),this.dados=[],this.cor=[],this.dados_situacao=[],this.cor_situacao=[],this.divs_informativo_prazo=[],this.data_previsao_retorno=null,this.horas_previsao_retorno=null,this.tipo_gestao_tempo=null,this.qtd_chamados=10,this.show=function(){this.listar_dashboard()},this.listar_dashboard=function(a){void 0!==a&&(s.qtd_chamados=a),s.div_chamados.text(""),s.div_motivos.text(""),s.div_situacao.text(""),s.gera_graficos()},this.add_chamados_row=function(i){var e=s.template_row.clone();e.removeClass("hidden");var d=e.find(".div_informativo_prazo"),n=a.createElement(t,null,null);o.render(n,d[0]),n.props.setConfiguracoes({ViewParent:s.html_id,StyleWidth:"200px",Alinhamento:"right",TipoGestaoTempo:i.tipo_gestao_tempo,HorasEstimadas:i.horas_previsao_retorno,DataPrazo:i.data_previsao_retorno,CalendarioTrabalhoId:i.calendario_trabalho_id_param,TituloDataPrazo:"Previs√£o de Retorno",LabelExcedente:"atrasado",LabelRestante:"restante"}),s.divs_informativo_prazo.push(n);var r=$(e.find("[template-field='usuario_responsavel_nome']"));null==i.usuario_responsavel_nome?r.text(""):r.text(i.usuario_responsavel_nome),$(e.find("[template-field='chamado_id']")).text("#"+i.id),$(e.find("[template-field='assunto']")).text(i.assunto),e.click(function(){View.loadReact(window.views.chamado.Detalhes.default,{chamadoId:i.id},function(a,o){},View.ABA.MULTIPLAS)}),e.appendTo(s.div_chamados)},this.add_situacao_row=function(a){var o=null,t=null;a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_CLIENTE?App.sessao.dados.tipo!=USUARIO_TIPO.FORNECEDOR&&(o="#FF6666",t=ChamadoImgSituacao(parseInt(a.situacao_id,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_EMPRESA?App.sessao.dados.tipo!=USUARIO_TIPO.CLIENTE&&(o="#EEEE00",t=ChamadoImgSituacao(parseInt(a.situacao_id,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_ATENDIMENTO?(o="#99ff99",t=ChamadoImgSituacao(parseInt(a.situacao_id,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_RESPONSAVEL?(o="#ff99ff",t=ChamadoImgSituacao(parseInt(a.situacao_id,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_FORNECEDOR||a.situacao_id==CHAMADO_SITUACAO.AGUARDANDO_ORGANIZACAO?(o="#FF6666",t=ChamadoImgSituacao(parseInt(2,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):10==a.situacao_id?(o="#FF6666",t=ChamadoImgSituacao(parseInt(2,10),"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])):null==a.situacao_id&&(App.temp.filtro_solicitantes=a.situacao_id,o="#795548",t=ChamadoImgSituacao(9,"mini"),s.dados_situacao.push([a.situacao_nome,parseInt(a.qtd,10)])),null!=o&&s.cor_situacao.push(o);var i=s.template_situacao.clone();i.removeClass("hidden"),t?i.append('<img src="assets/img/legenda/'+t+'">'+a.situacao_nome):i.text(a.situacao_nome);var e=$("<span>");e.addClass("badge"),e.attr("style","background-color:"+o),e.text(a.qtd),e.appendTo(i);let d=8==a.situacao_id?4:a.situacao_id;i.on("click",function(){View.loadReact(views.chamado.Listagem.default,{filtro_tipo_listagem:d},function(a){},View.ABA.SIM)}),i.appendTo(s.div_situacao)},this.add_motivos_row=function(a){s.dados.push([a.nome,parseInt(a.qtd,10)]),s.cor.push(a.cor);var o=s.template_motivo.clone();o.removeClass("hidden"),o.text(a.nome);var t=$("<span>");t.addClass("badge"),t.attr("style","background-color:"+a.cor),t.text(a.qtd),o.append(t),o.append("&nbsp;"),o.appendTo(s.div_motivos);let i=8==a.situacao_id?4:a.situacao_id;o.on("click",function(){View.loadReact(views.chamado.Listagem.default,{filtro_tipo_listagem:i},function(a){},View.ABA.SIM)})},this.gera_graficos=function(){for(var a=0;a<s.divs_informativo_prazo.length;a++)s.divs_informativo_prazo[a].props.desativarRefreshAutomatico();s.div_situacao.empty(),s.div_chamados.empty(),s.div_motivos.empty(),WS.get("chamado/listar_dashboard/",{qtd_chamados:parseInt(s.qtd_chamados,10),data_inicio:get_datepicker(s.data_inicio),data_fim:get_datepicker(s.data_fim)},function(a){s.dados=[],s.cor=[],s.dados_situacao=[],s.cor_situacao=[],0==a.chamado?s.ul_chamados.removeClass("hidden"):$(a.chamado).each(function(a,o){s.add_chamados_row(o)}),0==a.motivo?s.ul_motivos.removeClass("hidden"):($(a.motivo).each(function(a,o){s.add_motivos_row(o)}),s.gera_grafico_motivo()),$.each(a.situacao,function(a,o){s.add_situacao_row(o)}),s.gera_grafico_situacao()})},this.btn_filtrar.unbind("click"),this.btn_filtrar.click(function(a){s.gera_graficos()}),this.btn_limpar_filtros.unbind("click"),this.btn_limpar_filtros.click(function(a){s.data_inicio.val(""),s.data_fim.val(""),s.gera_graficos()}),this.gera_grafico_motivo=function(){s.div_grafico_motivos.highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:s.cor,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Motivo dos Chamados",borderColor:"#DDD",data:s.dados}]})},this.gera_grafico_situacao=function(){s.div_grafico_situacao.highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:s.cor_situacao,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Motivo dos Chamados",borderColor:"#DDD",data:s.dados_situacao}]})},this.unload=function(){for(var a=0;a<s.divs_informativo_prazo.length;a++)s.divs_informativo_prazo[a].props.desativarRefreshAutomatico();View.unload(this.html_id)},this.cbo_op_chamado.change(function(){s.listar_dashboard(s.cbo_op_chamado.val())})}});