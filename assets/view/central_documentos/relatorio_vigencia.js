define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="VigÃªncias",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_listar=this.dialog.find(".btn_listar"),this.btn_parametros=this.dialog.find(".btn_parametros"),this.btn_excel=this.dialog.find(".btn_excel"),this.div_carregar_mais=this.dialog.find(".div_carregar_mais"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.detalhes_reprova=this.dialog.find(".detalhes_reprova"),this.limite=0,this.onselect=null,this.params=null,this.show=function(){i.btn_parametros.trigger("click")},this.listar=function(a){var e=i.tab_listagem.find("tbody"),r=e.find("tr:first");i.params.exibir_informacoes_reprova?i.detalhes_reprova.removeClass("hidden"):i.detalhes_reprova.addClass("hidden"),a&&i.tab_listagem.find("tr:gt(1)").remove(),WS.get("documento/listar_documentos_vigentes/",{vigencia_inicio:i.params.vigencia_inicio,vigencia_fim:i.params.vigencia_fim,vigencia:i.params.vigencia,reprova_inicio:i.params.reprova_inicio,reprova_fim:i.params.reprova_fim,situacao_aprovacao:i.params.situacao_aprovacao,limite:i.limite},function(a){i.div_carregar_mais.removeClass("hidden"),i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),0===a.length&&(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),setTimeout(function(){i.btn_carregar_mais.css("pointer-events","none")})),$(a).each(function(a,t){!function(a){var t=r.clone();t.removeAttr("template-row"),t.css("display",""),$(t.find("[template-field='codigo']")).text(a.codigo),$(t.find("[template-field='nome']")).text(a.nome),$(t.find("[template-field='data_vigencia']")).text(null!=a.data_vigencia?a.data_vigencia.format_date_time():"-");var n=$(t.find("[template-field='vigencia']"));a.data_vigencia?"N"==a.expirado?n.html('<span class="fa fa-check text-success"></span>'):"S"==a.expirado&&n.html('<span class="fa fa-times text-danger"></span>'):n.html(""),i.params.exibir_informacoes_reprova&&($(t.find("[template-field='data_reprova']")).text("N"==a.aprovacao?a.data_aprovacao.format_date_time():""),$(t.find("[template-field='motivo_reprova']")).text("N"==a.aprovacao?a.motivo_reprovacao:""),$(t.find("[template-field='usuario_reprova']")).text("N"==a.aprovacao?a.nome_usuario_aprovacao:"")),$(t.find("[template-field='autor_revisao']")).text(a.nome_usuario_autor);var o=$(t.find("[template-field='situacao']"));"S"==a.aprovacao?o.html('<span class="label label-success">Aprovado</span>'):"N"==a.aprovacao?o.html('<span class="label label-danger">Reprovado</span>'):o.html('<span class="label label-warning">Pendente</span>');var s=$(t.find("[template-field='pasta']"));s.html('<i class="fa fa-folder caminho_pasta" aria-hidden="true"></i>'),s.find(".caminho_pasta").tooltip({title:a.caminho_pasta}).on("click",function(){copyToClipboard(a.caminho_pasta)}),s.find(".caminho_pasta").hover(function(){$(this).css("cursor","pointer")}),t.dblclick(function(){View.load("central_documentos/documento",function(e,r){r.onclose=function(a){void 0===a&&(a=!1),i.dialog.find(".active").hasClass("btn_pendente")?a&&i.listar_pendencias(null,!0):a&&(i.listar_pendencias(null,!1),i.limpar_listar())},r.show(a.documento_id,FORMULARIO.VISUALIZAR,a.documento_pasta_id)},View.ABA.MULTIPLAS)}),t.appendTo(e)}(t)})})},this.btn_parametros.click(function(a){View.load("central_documentos/parametros_vigencia",function(a,e){var r=function(a){var e={vigencia_inicio:a.vigencia_inicio,vigencia_fim:a.vigencia_fim,reprova_inicio:a.reprova_inicio,reprova_fim:a.reprova_fim,vigencia:a.vigencia,situacao_aprovacao:a.situacao_aprovacao,exibir_informacoes_reprova:a.exibir_informacoes_reprova};i.params=e,i.limite=0,i.listar(!0)};e.onselect=r,e.show(r)})}),this.btn_excel.unbind("click"),this.btn_excel.click(function(a){App.obter_token_publico(function(a){App.download(WS_URI+"documento/gera_excel_vigencia/?vigencia_inicio="+i.params.vigencia_inicio+"&vigencia_fim="+i.params.vigencia_fim+"&reprova_inicio="+i.params.reprova_inicio+"&reprova_fim="+i.params.reprova_fim+"&vigencia="+i.params.vigencia+"&situacao_aprovacao="+i.params.situacao_aprovacao+"&exibir_informacoes_reprova="+i.params.exibir_informacoes_reprova+"&token_publico="+a)})}),this.btn_carregar_mais.unbind("click").click(function(){i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin"></span>'),i.limite=i.limite+50,i.listar(!1)}),this.unload=function(){View.unload(this.html_id)}}});