define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.atuacao_efetiva_id=null,this.indicador_id=0,this.usuario_id=0,this.edt_nome=this.dialog.find(".edt_nome"),this.cbo_novo_indicador=this.dialog.find(".cbo_novo_indicador"),this.radio_indicador=this.dialog.find(".radio_indicador"),this.edt_indicador=this.dialog.find(".edt_indicador"),this.div_selecao_indicador=this.dialog.find(".div_selecao_indicador"),this.btn_avaliar=this.dialog.find(".btn_avaliar"),this.optradio_sete_dias=this.dialog.find("[name=optradio_sete_dias]"),this.radio_informativa_sete_dias=this.dialog.find(".radio_informativa_sete_dias"),this.radio_percentual_sete_dias=this.dialog.find(".radio_percentual_sete_dias"),this.radio_valor_sete_dias=this.dialog.find(".radio_valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.percentual_sete_dias=this.dialog.find(".percentual_sete_dias"),this.valor_sete_dias=this.dialog.find(".valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.edt_percentual_sete_dias=this.dialog.find(".edt_percentual_sete_dias"),this.edt_valor_sete_dias=this.dialog.find(".edt_valor_sete_dias"),this.edt_acao_sete_dias=this.dialog.find(".edt_acao_sete_dias"),this.data_sete_dias=this.dialog.find(".data_sete_dias"),this.btn_salvar_enviar=this.dialog.find(".btn_salvar_enviar"),this.responsabilidade_escolhida=this.dialog.find(".responsabilidade_escolhida"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.atuacao_efetiva_id=0,this.indicador_id=0,this.possibilidade_acao_id=0,this.dataAtual=new Date,this.selected_cbo_atuacao_efetiva_id=null,this.atuacao_efetiva_avaliacao_id=0,this.competencias_essenciais_avaliacao_status=0,this.indicador_principal="N",this.show=function(a,e,d,t,_,s,o){this.btn_avaliar.addClass("hidden"),"S"==App.sessao.dados.supervisor_empenho&&this.btn_avaliar.removeClass("hidden"),i.usuario_id=_,i.indicador_principal=o,i.atuacao_efetiva_id=e,i.indicador_id=d,i.carrega_acoes_metas(),show_modal(i.modal.attr("id")),set_focus(i.edt_nome);var n=(new Date).setDate(i.dataAtual.getDate()+7);i.data_sete_dias.text(new Date(n).toISOString().slice(0,10)),i.data_sete_dias.text(new Date(n).today()),i.edt_percentual_sete_dias.maskMoney({thousands:"",decimal:"",allowZero:!0,suffix:"",precision:0}),i.edt_valor_sete_dias.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}),$('[name="optradio_sete_dias"]').change(function(a){var e=+$(this).filter('[name="optradio_sete_dias"]:checked').val();+e==TIPO_RESULTADO.INFORMATIVO?(i.percentual_sete_dias.hide(),i.valor_sete_dias.hide()):+e==TIPO_RESULTADO.PERCENTUAL?(i.percentual_sete_dias.show(),i.valor_sete_dias.hide()):+e==TIPO_RESULTADO.VALOR?(i.percentual_sete_dias.hide(),i.valor_sete_dias.show()):e==TIPO_RESULTADO.SEM_ACAO&&$('[name="optradio_sete_dias"]:last').prop("checked","checked")})},this.carrega_acoes_metas=function(){WS.get("atuacao_efetiva_resultado_esperado/listar/",{possibilidade_acao_id:i.possibilidade_acao_id,atuacao_efetiva_id:i.atuacao_efetiva_id,indicador_id:i.indicador_id,indicador_principal:i.indicador_principal},function(a){var e=a;if(void 0!==e){var d=e.length>0?e[0].status:1;d!=STATUS_INDICADORES.NAO_INICIADO&&null!=d||i.btn_avaliar.prop("disabled",!0),d!=STATUS_INDICADORES.EM_ANDAMENTO&&"S"!=App.sessao.dados.supervisor_empenho&&i.btn_avaliar.prop("disabled",!1),"S"!=App.sessao.dados.supervisor_empenho?(i.btn_avaliar.prop("disabled",!0),d==STATUS_INDICADORES.NAO_INICIADO||d==STATUS_INDICADORES.NAO_APROVADO?(i.btn_salvar.removeClass("hidden"),i.btn_salvar_enviar.removeClass("hidden")):d!=STATUS_INDICADORES.EM_ANDAMENTO&&d!=STATUS_INDICADORES.EM_APROVACAO||(i.btn_salvar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"),i.permite_alterar(!1))):(d==STATUS_INDICADORES.EM_ANDAMENTO||d==STATUS_INDICADORES.NAO_APROVADO?i.btn_avaliar.prop("disabled",!0):d==STATUS_INDICADORES.EM_APROVACAO&&i.btn_avaliar.prop("disabled",!1),App.sessao.dados.usuario_id==i.usuario_id?(i.btn_avaliar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden")):(i.btn_salvar.addClass("hidden"),i.btn_salvar_enviar.addClass("hidden"))),i.competencias_essenciais_avaliacao_status=d,0!=i.atuacao_efetiva_avaliacao_id&&null!=i.atuacao_efetiva_avaliacao_id||void 0!==e[0]&&(i.atuacao_efetiva_avaliacao_id=e[0].atuacao_efetiva_avaliacao_id),$.each(e,function(a,e){e.dias_periodo==RESULTADO_ESPERADO.SETE_DIAS&&(i.edt_acao_sete_dias.val(e.descricao_acao).attr("atuacao_efetiva_resultado_esperado_id",e.atuacao_efetiva_resultado_esperado_id),i.cbo_informativa_sete_dias.val(e.informativa),i.edt_percentual_sete_dias.val(e.percentual),i.edt_valor_sete_dias.val(e.valor),$('[name="optradio_sete_dias"]').val([e.tipo]).change())})}})},this.salva_dados_acaoes_metas=function(a){var e=[{id:i.edt_acao_sete_dias.attr("atuacao_efetiva_resultado_esperado_id"),descricao_acao:i.edt_acao_sete_dias.val(),tipo:i.optradio_sete_dias.filter(":checked").val(),informativa:"0"==i.optradio_sete_dias.filter(":checked").val()?"S":"N",percentual:i.edt_percentual_sete_dias.val(),valor:i.edt_valor_sete_dias.maskMoney("unmasked")[0],dias_periodo:RESULTADO_ESPERADO.SETE_DIAS,indicador_principal:"S"}];WS.post("atuacao_efetiva_resultado_esperado/salvar/",{acoes:JSON.stringify(e),status:a,avaliacao_id:i.atuacao_efetiva_avaliacao_id,atuacao_efetiva_id:i.atuacao_efetiva_id,indicador_id:i.indicador_id,possibilidade_acao_id:i.possibilidade_acao_id,atuacao_efetiva_resultado_esperado_id:i.atuacao_efetiva_resultado_esperado_id},function(a){alert_saved("Salvo com sucesso"),i.unload(a.id)})},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},i.cbo_novo_indicador.change(function(a){i.selected_cbo_atuacao_efetiva_id=$(this).find("option:selected").attr("data-id-atuacao")}),this.permite_alterar=function(a){$("[name='optradio_sete_dias']").prop("disabled",!a),$("[name='optradio_catorze_dias']").prop("disabled",!a),$("[name='optradio_vinte_um_dias']").prop("disabled",!a),$("[name='optradio_vinte_oito_dias']").prop("disabled",!a),$("[name='optradio_trinta_dias']").prop("disabled",!a),i.edt_percentual_sete_dias.prop("readonly",!a),i.edt_percentual_catorze_dias.prop("readonly",!a),i.edt_percentual_vinte_um_dias.prop("readonly",!a),i.edt_percentual_vinte_oito_dias.prop("readonly",!a),i.edt_percentual_trinta_dias.prop("readonly",!a),i.edt_acao_sete_dias.prop("readonly",!a),i.edt_acao_catorze_dias.prop("readonly",!a),i.edt_acao_vinte_um_dias.prop("readonly",!a),i.edt_acao_vinte_oito_dias.prop("readonly",!a),i.edt_acao_trinta_dias.prop("readonly",!a)},this.radio_indicador.unbind("click"),this.radio_indicador.click(function(){1==parseInt($(this).val())?(i.cbo_novo_indicador.prop("disabled",!1),i.edt_indicador.prop("disabled",!0),i.cbo_novo_indicador.val(""),i.edt_indicador.val("")):2==parseInt($(this).val())&&(i.cbo_novo_indicador.prop("disabled",!0),i.edt_indicador.prop("disabled",!1),i.cbo_novo_indicador.val(""),i.edt_indicador.val(""))}),this.unload=function(a){i.close(a),View.unload(this.html_id)},this.preencher=function(){WS.get("atuacao_efetiva/objeto/",{atuacao_efetiva_id:i.atuacao_efetiva_id},function(a){i.edt_indicador.val(a.indicador)})},this.close=function(a){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose(a)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){i.usuario_id==App.sessao.dados.supervisor_empenho=="S"?i.salva_dados_acaoes_metas(STATUS_INDICADORES.EM_ANDAMENTO):i.salva_dados_acaoes_metas()}),this.btn_salvar_enviar.unbind("click"),this.btn_salvar_enviar.click(function(){i.salva_dados_acaoes_metas(STATUS_INDICADORES.EM_APROVACAO)}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("atuacao_efetiva/excluir",{atuacao_efetiva_id:i.atuacao_efetiva_id},function(a){alert_saved(a.nome+" excluido com sucesso"),i.unload()})})}});