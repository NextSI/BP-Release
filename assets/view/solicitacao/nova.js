define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.popup=null,this.onselect=null,this.onclose=null,this.onsave=null,this.list_processos=this.dialog.find(".list_processos"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.edt_pesquisa=this.dialog.find(".edt_pesquisa"),this.nova_solicitacao_atividade=null,this.arr_versao_processo=null,this.projeto_atividade_id=null,this.projeto_id=null,this.arr_categoria_processo=[],this.solicitacao_vinculada=null,this.oportunidade_id=null,this.pdca_atividade_id=null,this.pdca_id=null,this.modo_teste=null,this.modo_teste_responsavel_id=null,this.nome_usuario_teste=null,this.modo_teste=!1,this.lista_apenas_favoritas=!1,this.tarefa_quadro_lista_cartao_id=null,this.referencia_tabela=null,this.referencia_id=null,this.show=function(i,o,t,e,s,d,c,_,l,r,n,p,u,v){a.modo_teste=l,a.modo_teste_responsavel_id=r,a.nome_usuario_teste=p,a.lista_apenas_favoritas=n,"function"!=typeof i&&null!=i&&(o=i.projeto_atividade_id||null,t=i.projeto_id||null,s=i.solicitacao_id||null,e=i.solicitacao_atividade_id||null,v=i.processo_id||null,i=i.onselect||null),void 0!==d&&d&&(a.pdca_atividade_id=d.pdca_atividade_id),void 0!==c&&c&&(a.pdca_id=c),void 0!==u&&u&&(a.tarefa_quadro_lista_cartao_id=u),a.onselect=i,a.projeto_atividade_id=o,a.projeto_id=t,a.solicitacao_id=s,a.solicitacao_atividade_id=e,a.processo_id=v,a.oportunidade_id=_,alertaPopUp({titulo:"Nova Solicitação",conteudo:(i,o)=>{a.popup=o,i.replaceWith(a.dialog)},botaoConfirmarTexto:"Cancelar",largura:"calc(100% - 20px)",larguraMinima:"400px",larguraMaxima:"800px"}),set_focus(a.edt_pesquisa),a.listar()},this.close=function(){a.popup.hide(),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.listar=function(){a.arr_versao_processo=[],WS.get("solicitacao/listar_disponiveis/",{modo_teste:a.modo_teste,modo_teste_responsavel_id:a.modo_teste_responsavel_id,lista_apenas_favoritas:a.lista_apenas_favoritas,processo_id:a.processo_id},function(i){a.arr_versao_processo=i,a.render_lista()})},this.pesqSolicitacaoKeyPress=function(i){13==i.keyCode&&a.render_lista()},this.render_lista=function(){var i=a.dialog.find("[template-item]"),o=null,t=function(t){var e=i.clone();if(e.removeAttr("template-item"),e.css("display",""),e.addClass("atividade_solicitacao"),o!=t.categoria_processos_nome){o=t.categoria_processos_nome;var s=$('<div class="list-group-item list-group-item-info campo_nome_categoria">'),d=$('<h3 class="list-group-item-heading" style="margin-bottom: 0px">');s.append(d),d.text(o),a.list_processos.append(s)}var c=$(e.find("[template-field='nome']"));c.text(t.nome);var _=$(e.find("[template-field='instrucao_trabalho']"));_.html(t.instrucao_trabalho).find("img").css("max-width","100%"),_.hide();var l=$(e.find("[template-field='versao_processo_atividade_descricao']"));l.text(t.versao_processo_atividade_descricao);var r=$(e.find("[template-field='versao_processo_atividade_instrucao_trabalho']"));r.html(t.versao_processo_atividade_instrucao_trabalho).find("img").css("max-width","100%"),r.hide(),c.click(function(){_.toggle()}),l.click(function(){r.toggle()});var n=e.find(".btn_favoritar_item");verifica_favorito("solicitacoes",t.processo_id)&&n.find("span").addClass("glyphicon-star").removeClass("glyphicon-star-empty"),n.unbind("click"),n.click(function(i){var a=!1;i.stopPropagation();var o=$(this).find("span");o.hasClass("glyphicon-star")?(o.removeClass("glyphicon-star").addClass("glyphicon-star-empty"),a=!1):(o.addClass("glyphicon-star").removeClass("glyphicon-star-empty"),a=!0),favoritar_item("solicitacoes",t.processo_id,a)});var p=$(e.find(".btn_selecionar"));p.unbind("click"),p.click(function(){var i=function(){var i={versao_processo_id:t.versao_processo_id,versao_processo_atividade_id:t.versao_processo_atividade_id,data_referencia:o,projeto_atividade_id:a.projeto_atividade_id,projeto_id:a.projeto_id,solicitacao_atividade_id:a.solicitacao_atividade_id,solicitacao_id:a.solicitacao_id,oportunidade_id:a.oportunidade_id,modo_teste:a.modo_teste,modo_teste_responsavel_id:a.modo_teste_responsavel_id,referencia_tabela:a.referencia_tabela,referencia_id:a.referencia_id};WS.post("solicitacao/nova/",i,function(i){a.nova_solicitacao_atividade=i,a.vincular_solicitacao_pdca(i.solicitacao_id),a.vincular_tarefa_quadro_lista_cartao_solicitacao(i.solicitacao_id),a.unload(),void 0!==a.onsave&&a.onsave&&a.onsave(i.solicitacao_id),View.load("solicitacao/detalhes",function(i,o){o.onclose=a.onclose,o.show(a.nova_solicitacao_atividade,FORMULARIO.NOVO,a.nome_usuario_teste)},View.ABA.MULTIPLAS,null,null,{solicitacaoAtividadeId:i.id})},[p])},o=null;"S"==t.dias_corridos_data_referencia?View.load("solicitacao/data_referencia",function(a,t){t.onselect=function(a){o=a,i()},t.show()}):i()}),e.appendTo(a.list_processos)};a.list_processos.find(".atividade_solicitacao").remove(),function(){a.list_processos.find(".campo_nome_categoria").remove();var i=a.arr_versao_processo;null!=a.edt_pesquisa.val()&&null!=a.edt_pesquisa.val()&&(i=a.arr_versao_processo.filter(function(i){return i.versao_processo_atividade_descricao.toUpperCase().indexOf(a.edt_pesquisa.val().toUpperCase())>=0}),i=a.arr_versao_processo.filter(function(i){return i.nome.toUpperCase().indexOf(a.edt_pesquisa.val().toUpperCase())>=0})),$(i).each(function(i,a){t(a)})}()},this.vincular_solicitacao_pdca=function(i){if(void 0!==a.pdca_atividade_id&&null!=a.pdca_atividade_id){var o={solicitacao_id:i,pdca_id:a.pdca_id,pdca_atividade_id:a.pdca_atividade_id};WS.post("solicitacao/vincular_pdca_atividade_solicitacao/",o,function(i){},[])}},this.vincular_tarefa_quadro_lista_cartao_solicitacao=function(i){if(void 0!==a.tarefa_quadro_lista_cartao_id&&null!=a.tarefa_quadro_lista_cartao_id){var o={solicitacao_id:i,cartao_id:a.tarefa_quadro_lista_cartao_id};WS.post("solicitacao/vincular_tarefa_quadro_lista_cartao_solicitacao/",o,function(i){},[])}},this.edt_pesquisa.unbind("keyup"),this.edt_pesquisa.keyup($.debounce(500,a.render_lista)),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()})}});