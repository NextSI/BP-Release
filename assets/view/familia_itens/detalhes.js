define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title=App.lang.familia_itens.aba_detalhes,this.onclose=null,this.params={familia_itens_id:null,tipo:FORMULARIO.NOVO,tipo_arvore:TIPO_ARVORE.ANALITICO,pai_id:null},this.codigo_automatico=!1,this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.cbo_familia_item_pai=this.dialog.find(".cbo_familia_item_pai"),this.show=function(i){switch(a.params=extender_parametros(a.params,i),a.inicializar_componentes(),a.params.tipo){case FORMULARIO.NOVO:a.btn_salvar.show(),a.btn_excluir.hide(),a.permite_alterar(!0),set_focus(a.edt_codigo);break;case FORMULARIO.EDITAR:a.btn_salvar.show(),a.btn_excluir.hide(),a.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:a.btn_salvar.hide(),a.btn_excluir.hide(),a.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:a.btn_salvar.hide(),a.btn_excluir.show(),a.permite_alterar(!1)}null!=a.params.familia_itens_id&&a.preencher()},this.preencher=function(){WS.get({route:"familia_itens/objeto/",data:{familia_itens_id:a.params.familia_itens_id},func_response:function(i){if(i){var t=extender_parametros({codigo:"",descricao:"",bloqueado:!1,tipo:TIPO_ARVORE.ANALITICO},i);a.edt_codigo.val(t.codigo),a.edt_descricao.val(t.descricao),a.chk_bloqueado.prop("checked",t.bloqueado).trigger("change"),a.listar_sinteticas(t.pai_id)}}})},this.permite_alterar=function(i){a.edt_descricao.prop("readonly",!i),a.edt_codigo.prop("readonly",!i),a.chk_bloqueado.prop("disabled",!i),a.cbo_familia_item_pai.prop("disabled",!i)},this.close=function(){void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){a.listar_sinteticas(a.params.pai_id),null==a.params.familia_itens_id&&a.carregar_configuracoes(function(){a.codigo_automatico&&a.get_next_codigo()})},this.get_next_codigo=function(){WS.get("familia_itens/gerar_codigo/",null,function(i){i&&a.edt_codigo.val(i)})},this.carregar_configuracoes=function(i){WS.get("familia_itens/get_parametro/",null,function(t){t&&(a.codigo_automatico="S"==t.familia_itens_codigo_automatico,void 0!==i&&i())})},this.listar_sinteticas=function(i){a.cbo_familia_item_pai.find("option").remove(),add_option(a.cbo_familia_item_pai,"","Nenhuma"),WS.get("familia_itens/listar/",{arvore:!1},function(t){if(t){a.cbo_familia_item_pai.find("option").remove(),add_option(a.cbo_familia_item_pai,"","Nenhuma");for(var e=function(i,o,n){add_option(a.cbo_familia_item_pai,i.familia_itens_id,o.repeat(n)+i.codigo+" - "+i.descricao);for(var _=[],l=0;l<t.length;l++)(c=t[l]).pai_id==i.familia_itens_id&&c.tipo==TIPO_ARVORE.SINTETICO&&_.push(c);for(l=0;l<_.length;l++){var c=_[l];e(c,o,n+1)}},o=0;o<t.length;o++){var n=t[o];n.pai_id||n.tipo!=TIPO_ARVORE.SINTETICO||e(n,"&mdash;",0)}a.cbo_familia_item_pai.selectpicker("refresh"),i&&a.cbo_familia_item_pai.val(i).trigger("change")}})},this.btn_salvar.unbind("click").click(function(i){var t={familia_itens_id:a.params.familia_itens_id,descricao:a.edt_descricao.val(),codigo:a.edt_codigo.val(),bloqueado:a.chk_bloqueado.prop("checked"),pai_id:a.cbo_familia_item_pai.val()},e=extender_parametros({familia_itens_id:null,descricao:null,codigo:null,bloqueado:!1,tipo:a.params.tipo_arvore,pai_id:null},t);WS.post({route:"familia_itens/salvar",data:e,type:"POST",func_response:function(i){i&&(alert_saved(App.lang.familia_itens.alerta+e.descricao+App.lang.familia_itens.alerta_salvo),a.unload())},disable_buttons:[a.btn_salvar,a.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(i){WS.post({route:"familia_itens/excluir",data:{familia_itens_id:a.params.familia_itens_id},type:"POST",func_response:function(i){i&&(alert_saved(App.lang.familia_itens.alerta+a.edt_descricao.val()+App.lang.familia_itens.alerta_exclusao),a.unload())},disable_buttons:[a.btn_excluir,a.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(i){a.unload()})}});