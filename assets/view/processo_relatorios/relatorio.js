define([],function(){return function(t){"use strict";var i=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.title="Relatório de Processos",this.cores=ColorsGrafico(),this.div_filtros=this.dialog.find(".div_filtros"),this.div_tabelas_relatorio=this.dialog.find(".div_tabelas_relatorio"),this.tbl_solicitacoes_por_processo=this.dialog.find(".tbl_solicitacoes_por_processo"),this.div_grafico_solicitacoes_por_processo=this.dialog.find(".div_grafico_solicitacoes_por_processo"),this.div_solicitacoes_por_solicitante=this.dialog.find(".div_solicitacoes_por_solicitante"),this.tbl_solicitacoes_por_solicitante=this.dialog.find(".tbl_solicitacoes_por_solicitante"),this.div_grafico_solicitacoes_por_solicitante=this.dialog.find(".div_grafico_solicitacoes_por_solicitante"),this.div_solicitacoes_entregues_por_usuario=this.dialog.find(".div_solicitacoes_entregues_por_usuario"),this.tbl_solicitacoes_entregues_por_usuario=this.dialog.find(".tbl_solicitacoes_entregues_por_usuario"),this.div_grafico_solicitacoes_entregues_por_usuario=this.dialog.find(".div_grafico_solicitacoes_entregues_por_usuario"),this.div_grafico_solicitacoes_horas_previstas_x_realizadas=this.dialog.find(".div_grafico_solicitacoes_horas_previstas_x_realizadas"),this.div_grafico_solicitacoes_dias_previstos_x_gasto=this.dialog.find(".div_grafico_solicitacoes_dias_previstos_x_gasto"),this.div_atividades_entregues_por_processo=this.dialog.find(".div_atividades_entregues_por_processo"),this.tbl_atividades_entregues_por_processo=this.dialog.find(".tbl_atividades_entregues_por_processo"),this.div_grafico_atividades_entregues_por_processo=this.dialog.find(".div_grafico_atividades_entregues_por_processo"),this.div_agrupado_tabelas=this.dialog.find(".div_agrupado_tabelas"),this.dx_grafico_solicitacoes_por_status=this.dialog.find(".dx_grafico_solicitacoes_por_status"),this.qtde_abertas=this.dialog.find(".qtde_abertas"),this.qtde_andamento=this.dialog.find(".qtde_andamento"),this.qtde_canceladas=this.dialog.find(".qtde_canceladas"),this.qtde_finalizadas=this.dialog.find(".qtde_finalizadas"),this.qtde_remanescentes=this.dialog.find(".qtde_remanescentes"),this.btn_search=this.dialog.find(".btn_search"),this.btn_exportacao=this.dialog.find(".btn_exportacao"),this.btn_exportacao_excel=this.dialog.find(".btn_exportacao_excel"),this.cbo_processos=this.dialog.find(".cbo_processos"),this.chk_considerar_atividade_tipo_inicio=this.dialog.find(".chk_considerar_atividade_tipo_inicio"),this.chk_considerar_atividade_tipo_fim=this.dialog.find(".chk_considerar_atividade_tipo_fim"),this.chk_considerar_atividade_retornada=this.dialog.find(".chk_considerar_atividade_retornada"),this.div_dt_ini=this.dialog.find(".div_dt_ini"),this.div_dt_fim=this.dialog.find(".div_dt_fim"),this.div_filtro_processos=this.dialog.find(".div_filtro_processos"),this.dt_ini=null,this.dt_fim=null,this.filtro_processos=null,this.dxChart=null,this.show=function(){var t=new Date,e=t.getFullYear(),a=("0"+(t.getMonth()+1)).slice(-2),o=new Date(e,a,1),s=new Date(e,a,0);i.dt_ini=e+"-"+a+"-"+("0"+o.getDate()).slice(-2),i.dt_fim=e+"-"+a+"-"+("0"+s.getDate()).slice(-2);var r=i.div_dt_ini.dxDateBox({type:"date",displayFormat:"dd/MM/yyyy",value:i.dt_ini,width:"100%",onValueChanged:function(t){d.option("min",t.value),i.dt_ini=formatDate(t.value,!0)}}).dxDateBox("instance"),d=i.div_dt_fim.dxDateBox({type:"date",displayFormat:"dd/MM/yyyy",value:i.dt_fim,width:"100%",onValueChanged:function(t){r.option("max",t.value),i.dt_fim=formatDate(t.value,!0)}}).dxDateBox("instance");i.div_filtro_processos.dxDropDownBox({placeholder:"Selecione filtros",width:"100%"}).dxDropDownBox("instance"),setTimeout(function(){r.option("max",i.dt_fim),d.option("min",i.dt_ini)}),WS.get("processo/listar/",null,function(t){for(var e=0;e<t.length;e++){var a=t[e];add_option(i.cbo_processos,a.processo_id,a.nome)}i.cbo_processos.selectpicker({countSelectedText:function(t,i){return t+" processos selecionados"}}),i.cbo_processos.selectpicker("refresh")})},this.carrega_relatorio_processo=function(t,e,a,o,s,r){WS.get("processo/listar_relatorio/",{dia_inicio:t,dia_fim:e,filtros:a.val(),considerar_atividade_tipo_inicio:o,considerar_atividade_tipo_fim:s,considerar_atividade_retornada:r},function(t){var e,d,n,c,l;i.limpar(),i.div_tabelas_relatorio.removeClass("hidden"),e=t.solicitacoes_por_processo,d=[],n=0,c=[],l=[],$.each(e,function(t,e){$.each(i.cores,function(t,i){l.push(i.nome_hex),c.push(i.hex)}),i.tbl_solicitacoes_por_processo.append("<tr><td>"+e.nome+'</td><td><span class="badge" style="padding-right: 10px; background:'+c[t]+'"><font color="'+l[t]+'">'+e.total_solicitacoes+"</font></td></tr>"),n=parseInt(e.total_solicitacoes,10)+n,d.push([e.nome,parseInt(e.total_solicitacoes,10)])}),i.tbl_solicitacoes_por_processo.append('<tr><td><span class="badge" style="padding-right: 100px; background: #3333FF">Total</td><td>'+n+"</td></tr>"),i.div_grafico_solicitacoes_por_processo.highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:c,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Solicitações por Processo",borderColor:"#DDD",data:d}]}),function(t){var e=[],a=0,o=[],s=[];$.each(t,function(t,r){$.each(i.cores,function(t,i){s.push(i.nome_hex),o.push(i.hex)}),i.tbl_solicitacoes_por_solicitante.append("<tr><td>"+r.nome+'</td><td><span class="badge" style="padding-right: 10px; background:'+o[t]+'"><font color="'+s[t]+'">'+r.total_solicitacoes+"</font></td></tr>"),a=parseInt(r.total_solicitacoes,10)+a,e.push([r.nome,parseInt(r.total_solicitacoes,10)])}),i.tbl_solicitacoes_por_solicitante.append('<tr><td><span class="badge" style="padding-right: 100px; background: #3333FF">Total</td><td>'+a+"</td></tr>"),i.div_grafico_solicitacoes_por_solicitante.highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:o,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Solicitações por Solicitante",borderColor:"#DDD",data:e}]})}(t.solicitacoes_por_solicitante),function(t){var e=[],a=0,o=[],s=[];$.each(t,function(t,r){$.each(i.cores,function(t,i){s.push(i.nome_hex),o.push(i.hex)}),i.tbl_solicitacoes_entregues_por_usuario.append("<tr><td>"+r.nome+'</td><td><span class="badge" style="padding-right: 10px; background:'+o[t]+'"><font color="'+s[t]+'">'+r.total_solicitacoes+"</font></td></tr>"),a=parseInt(r.total_solicitacoes,10)+a,e.push([r.nome,parseInt(r.total_solicitacoes,10)])}),i.tbl_solicitacoes_entregues_por_usuario.append('<tr><td><span class="badge" style="padding-right: 100px; background: #3333FF">Total</td><td>'+a+"</td></tr>"),i.div_grafico_solicitacoes_entregues_por_usuario.highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:o,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Número de entregas de atividades por responsável",borderColor:"#DDD",data:e}]})}(t.solicitacoes_entregues_por_usuario),function(t){var e=[],a={name:"Horas Previstas",data:[parseInt(t[0].total_segundos_previstos,10)],stack:"Horas Previstas"},o={name:"Horas Realizadas",data:[parseInt(t[0].total_segundos_gastos,10)],stack:"Horas Realizadas"};e.push(a),e.push(o),i.div_grafico_solicitacoes_horas_previstas_x_realizadas.highcharts({chart:{type:"column"},title:{text:"Horas Previstas x Horas Realizadas"},xAxis:{categories:["Horas Previstas x Horas Realizadas"]},yAxis:{allowDecimals:!1,min:0,title:{text:"Segundos"}},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{formatter:function(){var t=this,i="000:00";return $(e).each(function(e,a){a.name==t.series.name&&(i=t.y,i=format_time(i.toString().toHHMMSS()))}),"<b>"+t.x+"</b><br/>"+t.series.name+": "+i+" horas<br/>Total: "+i+" horas"}},plotOptions:{column:{stacking:"normal"}},series:e})}(t.solicitacoes_horas_previstas_x_realizadas),function(t){var e=[],a={name:"Dias Previstos",data:[parseInt(t[0].dias_previstos,10)],stack:"Dias Previstos"},o={name:"Dias Realizados",data:[parseInt(t[0].dias_gastos,10)],stack:"Dias Realizados"};e.push(a),e.push(o),i.div_grafico_solicitacoes_dias_previstos_x_gasto.highcharts({chart:{type:"column"},title:{text:"Dias Previstos x Dias Realizados"},xAxis:{categories:["Dias Previstos x Dias Realizados"]},yAxis:{allowDecimals:!1,min:0,title:{text:"Dias"}},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+" dias <br/>Total: "+this.y+" dias"}},plotOptions:{column:{stacking:"normal"}},series:e})}(t.solicitacoes_dias_previstos_x_gasto),function(t){for(var e={abertas:0,canceladas:0,finalizadas:0,remanescentes:0},a=0;a<t.length;a++){var o=t[a];e.abertas+=o.abertas,e.canceladas+=o.canceladas,e.finalizadas+=o.finalizadas,e.remanescentes+=o.remanescentes}e.andamento=e.abertas+e.remanescentes,i.qtde_abertas.html(e.abertas),i.qtde_andamento.html(e.andamento),i.qtde_canceladas.html(e.canceladas),i.qtde_finalizadas.html(e.finalizadas),i.qtde_remanescentes.html(e.remanescentes),i.dxChart=i.dx_grafico_solicitacoes_por_status.dxChart({dataSource:t,commonSeriesSettings:{argumentField:"processo_nome",type:"stackedBar"},argumentAxis:{label:{overlappingBehavior:"rotate"}},series:[{valueField:"abertas",name:"Abertas"},{valueField:"canceladas",name:"Canceladas"},{valueField:"finalizadas",name:"Finalizadas"},{valueField:"remanescentes",name:"Remanescentes"}],legend:{verticalAlignment:"bottom",horizontalAlignment:"center",itemTextPosition:"top"},title:"Solicitacoes por status",export:{enabled:!0},tooltip:{enabled:!0,location:"edge",customizeTooltip:function(t){return{text:t.seriesName+": "+t.valueText}}}}).dxChart("instance")}(t.solicitacoes_por_status),function(t){i.div_agrupado_tabelas.html("");var e=[];$.each(t,function(t,i){e.includes(i.processo)||e.push(i.processo)});var d=0,n="",c="";i.div_agrupado_tabelas.append('<div class="row"><div class="col-md-8 default-col-md-8"><label>Atividades entregues por processo</label></<label></div>'),$.each(e,function(e,l){c="",n=(n=(n='<div class="row"><div class="col-md-8 default-col-md-8"><div class=""><label style="color:#999">#LABEL#</label><table class="table table-striped #nomeTabela#"><thead><tr><th width="50% ">Atividade</th><th width="50% ">&nbsp;</th></tr></thead><tbody>#conteudoTabela#</tbody></table></div></div><div class="col-md-4 default_col-md-4"><div class="#nomeGrafico#"></div></div></div>'.replace("#nomeGrafico#","divGrafico"+ ++d)).replace("#nomeTabela#","divTabela"+d)).replace("#LABEL#",l);var _=[],p=0,h=[],u=[];$.each(t,function(t,e){e.processo==l&&($.each(i.cores,function(t,i){u.push(i.nome_hex),h.push(i.hex)}),c+='<tr><td class="linkInterno" style="cursor:pointer" data-atividade="'+e.processo_atividade_id+'">'+e.atividade+'</td><td><span class="badge" style="padding-right: 10px; background:'+h[t]+'"><font color="'+u[t]+'">'+e.quantidade+"</font></td></tr>",p=parseInt(e.quantidade,10)+p,_.push([e.atividade,parseInt(e.quantidade,10)]))}),c+='<tr><td><span class="badge" style="padding-right: 100px; background: #3333FF">Total</td><td>'+p+"</td></tr>",n=n.replace("#conteudoTabela#",c),i.div_agrupado_tabelas.append(n),i.dialog.find(".linkInterno").unbind("click").click(function(){var t=$(this).data("atividade"),e=i.dt_ini,d=i.dt_fim,n=a.val();View.load("executor/executores",function(i,a){a.atividade=t,a.dataInicial=e,a.dataFinal=d,a.filtros=n,a.show(e,d,n,t,o,s,r)},View.ABA.MULTIPLAS)}),i.dialog.find(".divGrafico"+d).highcharts({chart:{backgroundColor:"#DDD",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:h,title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:l,borderColor:"#DDD",data:_}]})})}(t.atividades_entregues_por_processos)})},this.limpar=function(){i.tbl_solicitacoes_por_processo.find("tr:gt(0)").remove(),i.tbl_solicitacoes_por_solicitante.find("tr:gt(0)").remove(),i.tbl_solicitacoes_entregues_por_usuario.find("tr:gt(0)").remove(),i.tbl_atividades_entregues_por_processo.find("tr:gt(0)").remove()},this.btn_exportacao.unbind("click"),this.btn_exportacao.click(function(){exportar_div(i.div_tabelas_relatorio,"Relatorio_de_Processos.png")}),this.btn_exportacao_excel.unbind("click"),this.btn_exportacao_excel.click(function(){App.obter_token_publico(function(t){App.download(WS_URI+"processo/gera_excel/?dia_inicio="+i.dt_ini+"&dia_fim="+i.dt_fim+"&filtros="+i.cbo_processos.val()+"&considerar_atividade_tipo_inicio="+i.chk_considerar_atividade_tipo_inicio.prop("checked")+"&considerar_atividade_tipo_fim="+i.chk_considerar_atividade_tipo_fim.prop("checked")+"&considerar_atividade_retornada="+i.chk_considerar_atividade_retornada.prop("checked")+"&token_publico="+t)})}),this.unload=function(){View.unload(this.html_id)},this.btn_search.unbind("click"),this.btn_search.click(function(t){i.carrega_relatorio_processo(i.dt_ini,i.dt_fim,i.cbo_processos,i.chk_considerar_atividade_tipo_inicio.prop("checked"),i.chk_considerar_atividade_tipo_fim.prop("checked"),i.chk_considerar_atividade_retornada.prop("checked"))})}});