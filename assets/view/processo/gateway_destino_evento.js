define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.edt_enviar=this.dialog.find(".edt_enviar"),this.div_elementos=this.dialog.find(".div_elementos"),this.template_elemento=this.dialog.find('[template-field="elemento"]'),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_fullscreen=this.dialog.find(".btn_fullscreen"),this.lbl_tab_editor=this.dialog.find(".lbl_tab_editor"),this.filterBuilder=this.dialog.find(".filterBuilder"),this.div_javascript=this.dialog.find(".div_javascript"),this.div_filterBuilder=this.dialog.find(".div_filterBuilder"),this.SelectBox_tipo_automacao=this.dialog.find(".SelectBox_tipo_automacao"),this.script_salvo=null,this.filtro_script_salvo=null,this.formulario=null,this.tipo_automacao=null,this.editor=null,this.filterBuilderInstance=null,this.SelectBox_tipo_automacao_instance=null,this.show=function(i,e,l,o){t.script_salvo=null==i?"":i,t.filtro_script_salvo=l?JSON.parse(l):[],t.formulario=e,t.tipo_automacao=o?parseInt(o):GATEWAY_DESTINO_EVENTO_TIPO_AUTOMACAO.CONSTRUTOR_FILTROS,t.editor=monta_editor(t.edt_enviar,"javascript"),t.preencher(),t.tipo_automacao==GATEWAY_DESTINO_EVENTO_TIPO_AUTOMACAO.JAVASCRIPT?t.div_filterBuilder.hide():t.div_javascript.hide(),show_modal(t.modal.attr("id"))},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.listar_elementos=function(){t.div_elementos.find("br").remove(),t.div_elementos.find("span").remove();var i=function(i){if(!i.id_elemento)return!1;var e=t.template_elemento.clone();e.css("display",""),e.text(i.id_elemento),e.appendTo(t.div_elementos),$("<br>").appendTo(t.div_elementos)};i({id_elemento:"obj_solicitacao"}),$(t.formulario.grupos).each(function(t,e){$(e.elementos).each(function(t,e){e.tipo==ELEMENTO_TIPO.TABELA?$(e.campos).each(function(t,e){null!=e.id_elemento&&i(e)}):null!=e.id_elemento&&i(e)})});var e=[{ID:1,Nome:App.lang.gateway_destino_evento.javascript},{ID:2,Nome:App.lang.gateway_destino_evento.construtor_filtros}];t.SelectBox_tipo_automacao_instance=t.SelectBox_tipo_automacao.dxSelectBox({items:e,value:t.tipo_automacao,valueExpr:"ID",displayExpr:"Nome",onValueChanged:function(i){1==i.value?(t.div_javascript.fadeIn(),t.div_filterBuilder.fadeOut()):(t.div_filterBuilder.fadeIn(),t.div_javascript.fadeOut())}}).dxSelectBox("instance")},this.unload=function(){t.close(),View.unload(this.html_id)},this.permite_alterar=function(i){t.edt_enviar.prop("readonly",!i)},this.preencher=function(){t.editor.getDoc().setValue(t.script_salvo),t.listar_elementos(),t.filterBuilderInstance=dx_Filter_Builder({div_html:t.filterBuilder,fields:t.formulario,valor:t.filtro_script_salvo?t.filtro_script_salvo:null})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){void 0!==t.onsave&&t.onsave&&t.onsave(t.editor.getValue(),JSON.stringify(t.filterBuilderInstance.option("value")),t.SelectBox_tipo_automacao_instance.option("value")),t.unload()}),this.btn_fullscreen.off("click").on("click",()=>{alert_warning('Para sair do modo "Tela Cheia" pressione a tecla "ESC"'),t.edt_enviar.closest(".modal").children().toggleClass("modal-dialog"),t.editor.setOption("fullScreen",!t.editor.getOption("fullScreen")),t.editor.focus()})}});