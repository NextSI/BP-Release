"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var a=0;a<o.length;a++){var i=o[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,o,a){return o&&_defineProperties(e.prototype,o),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,o){return!o||"object"!==_typeof(o)&&"function"!=typeof o?_assertThisInitialized(e):o}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),o&&_setPrototypeOf(e,o)}function _setPrototypeOf(e,o){return(_setPrototypeOf=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e})(e,o)}define(["react","react-dom"],function(e,o){return function(o){function a(e){var o;return _classCallCheck(this,a),(o=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={},o.props.documentoRevisaoID=null,o.props.documentoRevisaoIDBackup=null,o.props.documentoRevisaoMimeType=null,o.props.documentoRevisaoMimeTypeBackup=null,o.props.arquivoSelecionado=null,o.props.arquivoPrevisao=null,o.props.arquivoNome="",o.props.arquivoNomeBackup=o.props.arquivoNome,o.props.arquivoTamanho=0,o.props.arquivoTamanhoBackup=o.props.arquivoTamanho,o.props.desabilitado=!0,o.props.exibirPrevisao=!0,o.props.obrigatorio=!1,o.props.clicksignAtivo=!1,o.props.certsignAtivo=!1,o.props.d4signAtivo=!1,o.props.elemKey=null,o.props.solicitacaoID=null,o.props.solicitacaoNumero=null,o.props.linhaTabela=null,o.props.objCampoTabela=null,o.props.setClicksignAtivo=function(e){o.props.clicksignAtivo=e},o.props.setCertsignAtivo=function(e){o.props.certsignAtivo=e},o.props.setD4SignAtivo=function(e){o.props.d4signAtivo=e},o.props.setDocumentoRevisaoID=function(e,a,i,t){o.props.documentoRevisaoID=e,o.props.documentoRevisaoIDBackup=e,o.props.documentoRevisaoMimeType=a,o.props.documentoRevisaoMimeTypeBackup=a,o.props.arquivoNome=i,o.props.arquivoNomeBackup=i,o.props.arquivoTamanho=t,o.props.arquivoTamanhoBackup=t,o.setState({})},o.props.setDesabilitado=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o.props.desabilitado=e,o.setState({})},o.props.setExibirPrevisao=function(e){o.props.exibirPrevisao=e,o.setState({})},o.props.setObrigatorio=function(e){o.props.obrigatorio=e},o.props.setElemKey=function(e){o.props.elemKey=e},o.props.setSolicitacaoID=function(e){o.props.solicitacaoID=e},o.props.setSolicitacaoNumero=function(e){o.props.solicitacaoNumero=e},o.props.setLinhaTabela=function(e){o.props.linhaTabela=e},o.handleLimparClick=o.handleLimparClick.bind(_assertThisInitialized(o)),o.handleSelecionarClick=o.handleSelecionarClick.bind(_assertThisInitialized(o)),o.handleDesfazerClick=o.handleDesfazerClick.bind(_assertThisInitialized(o)),o.handleVisualizarClick=o.handleVisualizarClick.bind(_assertThisInitialized(o)),o.handleDownloadClick=o.handleDownloadClick.bind(_assertThisInitialized(o)),o.handleClicksignSignatariosClick=o.handleClicksignSignatariosClick.bind(_assertThisInitialized(o)),o.handleCertsignSignatariosClick=o.handleCertsignSignatariosClick.bind(_assertThisInitialized(o)),o.handleD4SignSignatariosClick=o.handleD4SignSignatariosClick.bind(_assertThisInitialized(o)),o.handleInputDrop=o.handleInputDrop.bind(_assertThisInitialized(o)),o}return _inherits(a,e.Component),_createClass(a,[{key:"handleLimparClick",value:function(e){this.props.desabilitado||(this.props.documentoRevisaoID=null,this.props.arquivoSelecionado=null,this.props.arquivoNome="",this.props.arquivoTamanho=0,this.props.handleAlterado&&this.props.handleAlterado(this,this.props.objCampoTabela),this.setState({}))}},{key:"handleSelecionarClick",value:function(e){var o=this;if(!this.props.desabilitado){var a=$('<input type="file" class="input_arquivo hidden">');a.on("change",function(e){o.props.arquivoPrevisao=null;var a=e.target.files[0];void 0!==a&&a&&(o.props.documentoPastaID=null,o.props.arquivoSelecionado=a,o.props.arquivoNome=a.name,o.props.arquivoTamanho=a.size,o.props.documentoRevisaoMimeType=a.type),o.props.handleAlterado&&o.props.handleAlterado(o,o.props.objCampoTabela),o.setState({})});var i=$(e.target).closest(".input-group");i.find(".input_arquivo").remove(),a.appendTo(i),this.setState({}),$(document).ready(function(){a.click()})}}},{key:"handleDesfazerClick",value:function(e){this.props.arquivoSelecionado=null,this.props.arquivoPrevisao=null,this.props.documentoRevisaoID=this.props.documentoRevisaoIDBackup,this.props.documentoRevisaoMimeType=this.props.documentoRevisaoMimeTypeBackup,this.props.arquivoNome=this.props.arquivoNomeBackup,this.props.arquivoTamanho=this.props.arquivoTamanhoBackup,this.setState({})}},{key:"handleVisualizarClick",value:function(e){var o=this;"application/pdf"==this.props.documentoRevisaoMimeType?this.props.documentoRevisaoID>0&&View.load("central_documentos/visualizar_pdf",function(e,a){a.show(o.props.documentoRevisaoID)}):"image/png"!=this.props.documentoRevisaoMimeType&&"image/bmp"!=this.props.documentoRevisaoMimeType&&"image/jpeg"!=this.props.documentoRevisaoMimeType&&"image/jpg"!=this.props.documentoRevisaoMimeType&&"image/gif"!=this.props.documentoRevisaoMimeType||View.load("central_documentos/visualizar_documento",function(e,a){o.props.documentoRevisaoID>0?a.show(o.props.documentoRevisaoID):o.props.arquivoPrevisao&&a.show(null,null,null,null,null,null,null,o.props.arquivoPrevisao)})}},{key:"handleDownloadClick",value:function(e){var o=this;App.obter_token_publico(function(e){o.props.documentoRevisaoID>0&&App.download(WS_URI+"documento/download/?documento_revisao_id="+o.props.documentoRevisaoID+"&solicitacao=true&token_publico="+e)},this.props.documentoRevisaoID)}},{key:"handleClicksignSignatariosClick",value:function(e){var o=this;this.props.documentoRevisaoID>0?View.load("clicksign/detalhes",function(e,a){a.show(o.props.documentoRevisaoID)},View.ABA.SIM):View.load("clicksign/configurar_signatarios",function(e,a){a.show(null,!1,o.props.elemKey,o.props.linhaTabela,o.props.solicitacaoID)},View.ABA.SIM)}},{key:"handleCertsignSignatariosClick",value:function(e){var o=this;this.props.documentoRevisaoID>0?View.load("certsign/detalhes",function(e,a){a.show(o.props.documentoRevisaoID)},View.ABA.SIM):View.load("certsign/configurar_signatarios",function(e,a){a.show(null,!1,o.props.elemKey,o.props.linhaTabela,o.props.solicitacaoID)},View.ABA.SIM)}},{key:"handleD4SignSignatariosClick",value:function(e){var o=this;WS.get("processo/get_parametros/",null,function(e){var a=e.processo_padrao_mensagem_d4sign,i=o.props.solicitacaoID;"S"==App.sessao.dados.parametro_processo.numero_solicitacao_por_processo&&(i=o.props.solicitacaoNumero),o.props.documentoRevisaoID>0?View.load("d4sign/detalhes",function(e,t){t.show(o.props.documentoRevisaoID,null,a,i)},View.ABA.MULTIPLAS):View.load("d4sign/configurar_signatarios",function(e,t){t.show(null,!1,o.props.elemKey,o.props.linhaTabela,i,a)},View.ABA.MULTIPLAS)})}},{key:"handleInputDragStart",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"handleInputDragOver",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"handleInputDragLeave",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"handleInputDrop",value:function(e){e.preventDefault(),e.stopPropagation();var o=!1,a=!1;if(e.dataTransfer&&e.dataTransfer.items&&(e.dataTransfer.items.length>1&&(a=!0),$(e.dataTransfer.items).each(function(e,a){a.webkitGetAsEntry().isDirectory&&(o=!0)})),o)alert_modal("Aviso","<strong>Ocorreu uma falha na operação!</strong> <br /><br /> <strong>Não</strong> é possível realizar o <strong>upload de pastas</strong> através deste campo. Por favor, selecione apenas um arquivo e tente novamente."),this.setState({});else if(a)alert_modal("Aviso","<strong>Ocorreu uma falha na operação!</strong> <br /><br /> <strong>Não</strong> é possível realizar o <strong>upload de vários arquivos</strong> através deste campo. Por favor, selecione apenas um arquivo e tente novamente."),this.setState({});else if(e&&e.dataTransfer&&e.dataTransfer.files){if(this.props.desabilitado)return;this.props.arquivoPrevisao=null;var i=e.dataTransfer.files[0];void 0!==i&&i&&(this.props.documentoPastaID=null,this.props.arquivoSelecionado=i,this.props.arquivoNome=i.name,this.props.arquivoTamanho=i.size),this.props.handleAlterado&&this.props.handleAlterado(this,this.props.objCampoTabela),this.setState({})}}},{key:"render",value:function(){var o=this,a=null,i=null,t=null,s=null,r=null,n=null,p=null,l=null,u=null,c=null,d=null,m=null;if(!this.props.desabilitado&&this.props.documentoRevisaoIDBackup>0&&(this.props.arquivoSelecionado||!this.props.documentoRevisaoID)&&(m=e.createElement("li",null,e.createElement("a",{onClick:this.handleDesfazerClick,disabled:this.props.desabilitado,href:"javascript:;"},e.createElement("span",{className:"fa fa-undo"})," Desfazer"))),null!=this.props.arquivoSelecionado||this.props.documentoRevisaoID>0){if(void 0!==this.props.arquivoTamanho&&(i=e.createElement("button",{type:"button",className:"btn btn-default",disabled:"true",style:{paddingLeft:"3px",paddingRight:" 3px"}},e.createElement("span",{style:{fontSize:"x-small"}},filesize(parseInt(this.props.arquivoTamanho,10)||0)))),this.props.desabilitado||(s=e.createElement("li",{role:"separator",class:"divider"}),r=e.createElement("li",null,e.createElement("a",{onClick:this.handleLimparClick,href:"javascript:;"},e.createElement("span",{className:"fa fa-trash-alt"})," Limpar"))),this.props.clicksignAtivo){var h=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),v=h?null:"disabled";p=e.createElement("li",{className:v},e.createElement("a",{onClick:h?this.handleClicksignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (Clicksign)"))}if(this.props.certsignAtivo){var f=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),g=f?null:"disabled";l=e.createElement("li",{className:g},e.createElement("a",{onClick:f?this.handleCertsignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (Certsign)"))}if(this.props.d4signAtivo){var b=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),y=b?null:"disabled";u=e.createElement("li",{className:y},e.createElement("a",{onClick:b?this.handleD4SignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (D4Sign)"))}if(this.props.arquivoSelecionado){if(null==this.props.arquivoPrevisao){var k=new FileReader;k.onload=function(e){for(var i=!1,t=[".jpg",".jpeg",".bmp",".gif",".png"],s=0;s<t.length;s++){var r=t[s];if(o.props.arquivoNome.substr(o.props.arquivoNome.length-r.length,r.length).toLowerCase()==r.toLowerCase()){i=!0;break}}i?o.props.arquivoPrevisao=e.target.result:(a=null,o.props.arquivoPrevisao=!1),o.setState({})},k.readAsDataURL(this.props.arquivoSelecionado)}}else if(this.props.documentoRevisaoID>0&&null==this.props.arquivoPrevisao&&("image/png"==this.props.documentoRevisaoMimeType||"image/bmp"==this.props.documentoRevisaoMimeType||"image/jpeg"==this.props.documentoRevisaoMimeType||"image/jpg"==this.props.documentoRevisaoMimeType||"image/gif"==this.props.documentoRevisaoMimeType)){var D=WS_URI+"documento/midia/?documento_revisao_id="+this.props.documentoRevisaoID+"&tipo=v&tamanho=200&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime();this.props.arquivoPrevisao=D}if(this.props.exibirPrevisao&&this.props.arquivoPrevisao){a=e.createElement("div",{style:{"border-left":"1px solid #ccc","border-right":"1px solid #ccc","border-bottom":"1px solid #ccc"}},e.createElement("img",{src:this.props.arquivoPrevisao,style:{"max-height":"200px","max-width":"100%"}}))}}else n=e.createElement("button",{title:"Selecionar",type:"button",className:"btn btn-default",onClick:this.handleSelecionarClick,disabled:this.props.desabilitado},e.createElement("span",{className:"fa fa-upload"}));(this.props.arquivoSelecionado||this.props.documentoRevisaoID>0)&&(("image/png"==this.props.documentoRevisaoMimeType||"image/bmp"==this.props.documentoRevisaoMimeType||"image/jpeg"==this.props.documentoRevisaoMimeType||"image/jpg"==this.props.documentoRevisaoMimeType||"image/gif"==this.props.documentoRevisaoMimeType||"application/pdf"==this.props.documentoRevisaoMimeType&&this.props.documentoRevisaoID>0)&&(c=e.createElement("button",{title:"Visualizar",type:"button",className:"btn btn-default",onClick:this.handleVisualizarClick},e.createElement("span",{className:"fa fa-window-maximize"}))),this.props.documentoRevisaoID>0&&(d=e.createElement("li",null,e.createElement("a",{onClick:this.handleDownloadClick,href:"javascript:;"},e.createElement("span",{className:"fa fa-download"})," Download"))));var _={onDragStart:this.handleInputDragStart,onDrag:this.handleInputDragStart,onDragOver:this.handleInputDragOver,onDragEnter:this.handleInputDragOver,onDragLeave:this.handleInputDragLeave,onDragEnd:this.handleInputDragLeave,onDrop:this.handleInputDrop};return(m||d||p||l||u||r)&&(t=e.createElement("button",{title:"Mais opções",type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},e.createElement("span",{className:"caret"}),e.createElement("span",{className:"sr-only"},"Mais opções"))),e.createElement("div",_,e.createElement("div",{className:"input-group"},e.createElement("input",{type:"text",className:"form-control",value:this.props.arquivoNome,readOnly:!0,placeholder:"Arraste um arquivo aqui ou clique no botão para pesquisar",style:{paddingLeft:"3px",paddingRight:" 3px"},onClick:null!=this.props.arquivoSelecionado||this.props.documentoRevisaoID>0?null:this.handleSelecionarClick,required:this.props.obrigatorio}),e.createElement("div",{className:"input-group-btn"},i,n,c,t,e.createElement("ul",{className:"dropdown-menu pull-right"},m,d,p,l,u,s,r))),a)}}]),a}()});