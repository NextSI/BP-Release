define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Gest√£o Mural",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_novo=this.dialog.find(".btn_novo"),this.btn_config=this.dialog.find(".btn_config"),this.btn_listar=this.dialog.find(".btn_listar"),this.div_carregar_mais=this.dialog.find(".div_carregar_mais"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.limite=0,this.existe_mais=!1,this.stripHTML=function(i){var a=document.createElement("div");return a.innerHTML=i,a.textContent||a.innerText},this.listar=function(){var i=a.tab_listagem.find("tbody"),t=i.find("tr:first");WS.get("mural_mensagem/listar_mural/",{limite:a.limite},function(n){a.div_carregar_mais.removeClass("hidden"),a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),0===a.limite&&a.tab_listagem.find("tr:gt(1)").remove(),0===n.length?(a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),a.existe_mais=!1):a.existe_mais=!0,a.existe_mais&&$(n).each(function(n,s){!function(n){var s=t.clone();s.removeAttr("template-row"),s.css("display",""),$(s.find("[template-field='usuario']")).text(n.autor_nome),$(s.find("[template-field='mensagem']")).append(n.mensagem),$(s.find("[template-field='data']")).text(n.data_publicacao.format_date_time());var e=$(s.find("[template-buttons='actions']>div"));(App.sessao.dados.admin||n.autor_id==App.sessao.usuario_id)&&e.show(),$(s.find("[template-field='tipo_descricao']")).text(n.tipo_descricao);var r=$(s.find(".btn_visualizar"));r.unbind("click"),r.click(function(){View.load("mural_mensagem/nova",function(i,t){t.onclose=function(){a.limpar_listar()},t.show(n.mural_mensagem_id,FORMULARIO.VISUALIZAR)},View.ABA.MULTIPLAS)});var c=$(s.find(".btn_editar")),_=function(){View.load("mural_mensagem/nova",function(i,t){t.onclose=function(){a.limpar_listar()},t.show(n.mural_mensagem_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS)};c.unbind("click"),c.click(_),s.dblclick(_);var l=$(s.find(".btn_excluir"));l.unbind("click"),l.click(function(){View.load("mural_mensagem/nova",function(i,t){t.onclose=function(){a.limpar_listar()},t.show(n.mural_mensagem_id,FORMULARIO.EXCLUIR,!0)},View.ABA.MULTIPLAS)}),s.appendTo(i);var o=i.find("img");o.css("width","auto"),o.css("height","100px")}(s)})})},this.btn_config.unbind("click"),this.btn_config.click(function(){View.load("mural_mensagem/config_mural",function(i,t){t.onclose=function(){a.limpar_listar()},t.show()})}),this.btn_novo.unbind("click"),this.btn_novo.click(function(){View.load("mural_mensagem/nova",function(i,t){t.onclose=function(){a.limpar_listar()},t.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.btn_listar.unbind("click"),this.btn_listar.click(function(){a.limpar_listar()}),this.limpar_listar=function(){a.limpa_limite(),setTimeout(function(){a.listar()},150)},this.limpa_limite=function(){a.limite=0,a.existe_mais=!0},this.btn_carregar_mais.unbind("click").click(function(){a.existe_mais&&(a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),a.limite=a.limite+50,a.listar())}),this.unload=function(){View.unload(this.html_id)},!0===App.sessao.dados.admin&&a.btn_config.removeClass("hidden"),this.listar()}});