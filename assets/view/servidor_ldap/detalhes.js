define([],function(){return function(o){"use strict";var i=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.title="Servidor LDAP - Detalhes",this.onclose=null,this.params={servidor_ldap_id:null,tipo:FORMULARIO.NOVO},this.cbo_motivo=this.dialog.find(".cbo_motivo"),this.cbo_local=this.dialog.find(".cbo_local"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_testar_conexao=this.dialog.find(".btn_testar_conexao"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_endereco=this.dialog.find(".edt_endereco"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_filtro=this.dialog.find(".edt_filtro"),this.edt_porta=this.dialog.find(".edt_porta"),this.chk_utilizar_ssl=this.dialog.find(".chk_utilizar_ssl"),this.edt_base=this.dialog.find(".edt_base"),this.edt_login_ldap=this.dialog.find(".edt_login_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.div_dominio=this.dialog.find(".div_dominio"),this.edt_dominio=this.dialog.find(".edt_dominio"),this.chk_padrao=this.dialog.find(".chk_padrao"),this.show=function(o){switch(i.params=o,i.inicializar_componentes(),i.params.tipo){case FORMULARIO.NOVO:i.edt_login_ldap.val(""),i.edt_senha_ldap.val(""),i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0),i.retornar_proximo_codigo();break;case FORMULARIO.EDITAR:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}null!=i.params.servidor_ldap_id&&i.preencher()},this.preencher=function(){WS.get({route:"servidor_ldap/objeto/",data:{servidor_ldap_id:i.params.servidor_ldap_id},func_response:function(o){o&&(i.edt_codigo.val(o.id),i.edt_nome.val(o.nome),i.cbo_tipo.val(o.tipo),i.edt_endereco.val(o.endereco),i.edt_porta.val(o.porta),i.chk_utilizar_ssl.prop("checked",o.utilizar_ssl).trigger("change"),i.edt_dominio.val(o.dominio),i.edt_login_ldap.val(o.usuario_ldap),i.chk_padrao.prop("checked",o.padrao).trigger("change"),o.padrao&&i.chk_padrao.prop("disabled")&&i.chk_padrao.parent().removeClass("off").addClass("on"),i.edt_base.val(o.base_dn),i.edt_filtro.val(o.filtro_conexao))}})},this.permite_alterar=function(o){i.edt_nome.prop("readonly",!o),i.edt_codigo.prop("readonly",!o),i.edt_endereco.prop("readonly",!o),i.edt_porta.prop("readonly",!o),i.chk_utilizar_ssl.prop("disabled",!o),i.edt_base.prop("readonly",!o),i.edt_filtro.prop("readonly",!o),i.cbo_tipo.prop("disabled",!o),i.edt_dominio.prop("disabled",!o),i.chk_padrao.prop("disabled",!o)},this.close=function(){void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){i.edt_filtro.val("(&(objectClass=user)(objectCategory=person)(!userAccountControl:1.2.840.113556.1.4.803:=2))"),i.edt_codigo.prop("disabled",!0)},this.btn_salvar.unbind("click").click(function(o){var t={nome:i.edt_nome.val(),tipo:i.cbo_tipo.val(),codigo:i.edt_codigo.val(),endereco:i.edt_endereco.val(),porta:i.edt_porta.val(),utilizar_ssl:i.chk_utilizar_ssl.prop("checked"),filtro_conexao:i.edt_filtro.val(),base_dn:i.edt_base.val(),dominio:i.edt_dominio.val(),usuario_ldap:i.edt_login_ldap.val(),senha_ldap:i.edt_senha_ldap.val(),padrao:i.chk_padrao.prop("checked")};WS.post({route:"servidor_ldap/salvar",data:t,type:"POST",func_response:function(o){o&&(alert_saved("Servidor "+o.nome+" salvo com sucesso"),i.unload())},disable_buttons:[i.btn_salvar,i.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(o){WS.post({route:"servidor_ldap/excluir",data:{servidor_ldap_id:i.params.servidor_ldap_id},type:"POST",func_response:function(o){o&&(alert_saved("Servidor "+i.edt_nome.val()+" excluido com sucesso"),i.unload())},disable_buttons:[i.btn_excluir,i.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(o){i.unload()}),this.btn_testar_conexao.unbind("click").click(function(o){WS.get("servidor_ldap/validar_servidor/",{ldap_tipo:i.cbo_tipo.val(),ldap_server:i.edt_endereco.val(),ldap_porta:i.edt_porta.val(),ldap_utilizar_ssl:i.chk_utilizar_ssl.prop("checked"),ldap_usuario:i.edt_login_ldap.val(),ldap_senha:i.edt_senha_ldap.val(),ldap_dn:i.edt_base.val(),ldap_filtro:i.edt_filtro.val(),ldap_dominio:i.edt_dominio.val()},function(o){alert_modal("Atenção",o[0].mensagem)})}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){"1"==i.cbo_tipo.val()?""!=i.edt_filtro.val()&&i.edt_filtro.val("(&(objectClass=user)(objectCategory=person)(!userAccountControl:1.2.840.113556.1.4.803:=2))"):""!=i.edt_filtro.val()&&i.edt_filtro.val("(|(objectClass=user)(objectClass=organizationalUnit))")}),this.retornar_proximo_codigo=function(){WS.get("servidor_ldap/retornar_proximo_codigo/",null,function(o){i.edt_codigo.val(o[0].prox_cod)})}}});