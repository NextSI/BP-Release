define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.chk_visualiza_apontamentos=this.dialog.find(".chk_visualiza_apontamentos"),this.chk_visualiza_despezas=this.dialog.find(".chk_visualiza_despezas"),this.chk_reembolso_refeicao=this.dialog.find(".chk_reembolso_refeicao"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.edt_quilometragem=this.dialog.find(".edt_quilometragem"),this.edt_valor_refeicao=this.dialog.find(".edt_valor_refeicao"),this.cbo_usuario=this.dialog.find(".cbo_usuario"),this.edt_valor_projeto=this.dialog.find(".edt_valor_projeto"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.tecnico_id=null,this.show=function(i,e,a){switch(o.edt_quilometragem.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),o.edt_valor_refeicao.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),o.edt_valor_projeto.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),e){case FORMULARIO.NOVO:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0),o.listar_usuarios();break;case FORMULARIO.EDITAR:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:o.btn_salvar.hide(),o.btn_excluir.hide(),o.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:o.btn_salvar.hide(),o.btn_excluir.show(),o.permite_alterar(!1)}o.tipo=e,void 0!==i&&i&&(o.tecnico_id=i,o.preencher()),"S"==a||1==a?(o.edt_codigo.prop("disabled",!0),o.sugerir_codigo()):o.edt_codigo.prop("disabled",!1),show_modal(o.modal.attr("id")),set_focus(o.cbo_usuario)},this.listar_usuarios=function(i){o.cbo_usuario.find("option").remove(),WS.get("usuario/listar/",{tipo_usuario:[USUARIO_TIPO.COLABORADOR,USUARIO_TIPO.FORNECEDOR]},function(e){for(var a=0;a<e.length;a++){var t=e[a];add_option(o.cbo_usuario,t.usuario_id,t.nome,'data-subtext="'+t.tipo_descricao+'"')}i&&o.cbo_usuario.val(i).trigger("change"),o.cbo_usuario.selectpicker("refresh")})},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.permite_alterar=function(i){o.chk_visualiza_apontamentos.prop("disabled",!i),o.chk_visualiza_despezas.prop("disabled",!i),o.chk_reembolso_refeicao.prop("disabled",!i),o.cbo_tipo.prop("disabled",!i),o.edt_quilometragem.prop("readonly",!i),o.cbo_usuario.prop("disabled",!i),o.edt_valor_refeicao.prop("disabled",!i),o.edt_valor_projeto.prop("disabled",!i)},this.preencher=function(){WS.get("tecnico/objeto/",{tecnico_id:o.tecnico_id},function(i){o.listar_usuarios(i.usuario_id),o.edt_quilometragem.maskMoney("mask",parseFloat(i.valor_km)),o.edt_valor_refeicao.maskMoney("mask",parseFloat(i.valor_refeicao)),o.edt_valor_projeto.maskMoney("mask",parseFloat(i.valor_projeto)),o.edt_codigo.val(i.codigo),o.cbo_tipo.val(i.tipo).trigger("change"),"S"==i.reembolso_refeicao&&o.chk_reembolso_refeicao.bootstrapSwitch("state",!0),"S"==i.visualizar_despesas&&o.chk_visualiza_despezas.bootstrapSwitch("state",!0),"S"==i.visualizar_apontamentos&&o.chk_visualiza_apontamentos.bootstrapSwitch("state",!0)})},this.sugerir_codigo=function(){WS.get("tecnico/get_next_codigo/",null,function(i){o.edt_codigo.val(i)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){o.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("tecnico/salvar",{tecnico_id:o.tecnico_id,valor_km:o.edt_quilometragem.maskMoney("unmasked")[0],valor_refeicao:o.edt_valor_refeicao.maskMoney("unmasked")[0],tipo:o.cbo_tipo.val(),usuario_id:o.cbo_usuario.val(),visualizar_apontamentos:o.chk_visualiza_apontamentos.prop("checked"),visualizar_despesas:o.chk_visualiza_despezas.prop("checked"),reembolso_refeicao:o.chk_reembolso_refeicao.prop("checked"),valor_projeto:o.edt_valor_projeto.maskMoney("unmasked")[0],codigo:o.edt_codigo.val()},function(i){o.tecnico_id=i.id,alert_saved("Técnico salvo com sucesso"),o.unload()})}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("tecnico/excluir",{tecnico_id:o.tecnico_id},function(i){alert_saved("Técnico excluido com sucesso"),o.unload()})})}});