define([],function(){return function(e){"use strict";var i=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_add=this.dialog.find(".btn_add"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.arr_webservice=[],this.webservice_selecionado=null,this.webservice_valido=!1,this.show=function(e){if("undefined"==typeof Storage)return alert_modal("Aviso de Compatibilidade",'Sem suporte a "Local Storage"'),void i.unload();localStorage.getItem("bp_ws_lista")&&"undefined"!=localStorage.getItem("bp_ws_lista")&&(i.arr_webservice=JSON.parse(localStorage.getItem("bp_ws_lista"))),void 0!==e&&e&&(i.webservice_selecionado=e),i.render_webservices(),show_modal(i.modal.attr("id")),set_focus(i.edt_nome)},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.permite_alterar=function(e){i.edt_nome.prop("readonly",!e)},this.render_webservices=function(){var e=i.tab_listagem.find("tbody"),t=e.find("tr:first");$(i.arr_webservice).each(function(e,t){void 0===i.arr_webservice[e].removido&&(i.arr_webservice[e].removido=!1)});var r=i.arr_webservice.filter(function(e){var i=!0;return!0===e.removido&&(i=!1),i});r=r.sort(function(e,i){return e.nome.toUpperCase()>i.nome.toUpperCase()}),i.tab_listagem.find("tr:gt(1)").remove(),$(r).each(function(r,o){!function(r){var o=t.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome']")).text(r.nome),$(o.find("[template-field='endereco']")).text(r.endereco);var a=$(o.find(".btn_remover"));a.unbind("click"),a.click(function(){alert_modal("Remover","Deseja remover o webservice "+r.nome+"?","Remover",function(){$(i.arr_webservice).each(function(e,t){t.nome==r.nome&&(i.arr_webservice[e].removido=!0,alert_saved(r.nome+" removido"),i.render_webservices())})},!0)});var n=$(o.find(".btn_editar"));n.unbind("click"),n.click(function(){i.exibir_modal_webservice_detalhes(r,!0)}),o.appendTo(e)}(o)}),setTimeout(function(){i.ajusta_endereco()},800)},this.ajusta_endereco=function(){i.tab_listagem.find('[template-field="endereco"]').css("max-width",i.tab_listagem.width()-50)},this.salvar_webservice=function(e,t){for(var r=-1,o=0;o<i.arr_webservice.length;o++)i.arr_webservice[o].nome.trim()==e.nome.trim()&&(void 0!==i.arr_webservice[o].removido&&0!=i.arr_webservice[o].removido||(r=o));if(!t&&r>=0)return i.webservice_valido=!1,void alert_modal("Atenção","O  Nome de Webservice "+e.nome+" já existe, favor alterar","OK",function(){i.exibir_modal_webservice_detalhes(e,!1)});i.webservice_valido=!0,r>=0?i.arr_webservice[r]=e:i.arr_webservice.push(e)},this.exibir_modal_webservice_detalhes=function(e,t){View.load("login/webservice_detalhes",function(r,o){o.onsave=function(e){i.salvar_webservice(e,t),i.webservice_valido&&alert_saved(e.nome+" alterado"),i.render_webservices()},o.show(e,FORMULARIO.EDITAR)})},this.btn_add.unbind("click"),this.btn_add.click(function(){View.load("login/webservice_detalhes",function(e,t){t.onsave=function(e){i.salvar_webservice(e,!1),i.webservice_valido&&alert_saved(e.nome+" adicionado"),i.render_webservices()},t.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){$(i.arr_webservice).each(function(e,t){void 0===i.arr_webservice[e].removido&&(i.arr_webservice[e].removido=!1)});var e=i.arr_webservice.filter(function(e){var i=!0;return!0===e.removido&&(i=!1),i});e=e.sort(function(e,i){return e.nome.toUpperCase()>i.nome.toUpperCase()}),localStorage.setItem("bp_ws_lista",JSON.stringify(e)),alert_saved("Webservices Salvos"),i.unload()}),$(window).resize(function(){i.ajusta_endereco()})}});