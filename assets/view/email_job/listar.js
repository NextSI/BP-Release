define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Saída de E-mails",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_enviar=this.dialog.find(".btn_enviar"),this.btn_limpar_semaforo=this.dialog.find(".btn_limpar_semaforo"),this.btn_listar=this.dialog.find(".btn_listar"),this.btn_selecionar_todos=this.dialog.find(".btn_selecionar_todos"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.div_carregar_mais=this.dialog.find(".div_carregar_mais"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.scrollview=this.dialog.find(".scrollview"),this.limite=0,this.pode_buscar=!0;var t=[];this.show=function(){a.scrollview.dxScrollView().dxScrollView("instance"),a.scrollview.css("height","calc(100vh - 75px)"),a.listar()},this.listar=function(){a.btn_limpar_semaforo.hide();var i=a.tab_listagem.find("tbody"),r=i.find("tr:first");t=[],a.btn_excluir_refresh(),WS.get("email_job/listar_caixa_saida/",{limite:a.limite},function(e){a.div_carregar_mais.removeClass("hidden"),a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),0===e.lista.length&&(a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),a.pode_buscar=!1),0===a.limite&&a.tab_listagem.find("tr:gt(1)").remove(),a.pode_buscar&&($(e.lista).each(function(e,s){!function(e){var s=r.clone();s.removeAttr("template-row"),s.css("display",""),s.data("email_job_id",e.email_job_id),$(s.find("[template-field='data_solicitacao_envio']")).text(e.data_solicitacao_envio.format_date_time()),$(s.find("[template-field='de_nome']")).text(e.de_nome),$(s.find("[template-field='para']")).text(e.para),$(s.find("[template-field='assunto']")).text(e.assunto);var n=$(s.find("[template-field='status']"));e.data_envio?(n.addClass("label-success"),n.text("Enviado")):parseInt(e.erro_quantidade,10)>0?(n.addClass("label-warning"),n.text("Falhou  ("+e.erro_quantidade+")"),n.tooltip({title:e.erro_mensagem,placement:"left",trigger:"hover"})):(n.addClass("label-default"),n.text("Aguardando"),n.tooltip("hide"));var l=$(s.find(".btn_visualizar_corpo_email"));l.unbind("click"),l.click(function(){View.load("email_job/detalhes",function(i,a){a.show(e.email_job_id)})}),s.click(function(){if("true"!=s.attr("selecionado"))s.addClass("bg-primary"),s.find("td").addClass("bg-primary"),s.attr("selecionado",!0),t.push(e.email_job_id);else{s.removeClass("bg-primary"),s.find("td").removeClass("bg-primary"),s.attr("selecionado",!1);var i=t.indexOf(e.email_job_id);t.splice(i,1)}a.btn_excluir_refresh()}),s.appendTo(i)}(s)}),e.semaforo&&""!=e.semaforo.trim()?a.btn_limpar_semaforo.show():a.btn_limpar_semaforo.hide())},[a.btn_enviar,a.btn_limpar_semaforo,a.btn_listar,a.btn_excluir])},this.btn_listar.unbind("click"),this.btn_listar.click(function(){a.limpar_listar()}),this.btn_enviar.unbind("click"),this.btn_enviar.click(function(){WS.post("email_job/processar_envios_pendentes/",null,function(i){i.log_ultima_execucao&&alert_modal("Validação",nl2br(i.log_ultima_execucao)),a.limpar_listar()},[a.btn_enviar,a.btn_listar,a.btn_excluir])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("email_job/excluir/",{email_job_ids:JSON.stringify(t)},function(i){a.limpar_listar()},[a.btn_enviar,a.btn_listar,a.btn_excluir])}),this.btn_excluir_refresh=function(){t.length>0?a.btn_excluir.show():a.btn_excluir.hide()},this.btn_limpar_semaforo.unbind("click"),this.btn_limpar_semaforo.click(function(){WS.post("email_job/limpar_semaforo/",null,function(i){a.limpar_listar()},[a.btn_limpar_semaforo])}),this.btn_selecionar_todos.unbind("click"),this.btn_selecionar_todos.click(()=>{a.tab_listagem.find("tr:gt(1)").each((i,a)=>{"true"!=$(a).attr("selecionado")&&($(a).addClass("bg-primary"),$(a).find("td").addClass("bg-primary"),$(a).attr("selecionado",!0),t.push($(a).data("email_job_id")))}),a.btn_excluir_refresh()}),this.btn_carregar_mais.unbind("click").click(function(){a.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),a.btn_carregar_mais.find("span.icn_carregar_mais").remove(),a.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),a.pode_buscar&&(a.limite=a.limite+100),a.listar()}),this.limpar_listar=function(){a.limpar_limite(),a.listar()},this.limpar_limite=function(){a.limite=0,a.pode_buscar=!0},this.unload=function(){View.unload(this.html_id)},this.show()}});