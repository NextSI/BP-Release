define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.edt_nome=this.dialog.find(".edt_nome"),this.edt_missao=this.dialog.find(".edt_missao"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_incluir_responsabilidade=this.dialog.find(".btn_incluir_responsabilidade"),this.tab_listagem_responsabilidades=this.dialog.find(".tab_listagem_responsabilidades"),this.btn_incluir_indicador=this.dialog.find(".btn_incluir_indicador"),this.tab_indicadores=this.dialog.find(".tab_indicadores"),this.funcao_hpe_id=null,this.arr_responsabilidades=[],this.arr_indicadores=[],this.show=function(i,d,e){switch(e&&a.edt_nome.val(e),d){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:a.btn_salvar.show(),a.btn_excluir.hide(),a.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:a.btn_salvar.hide(),a.btn_excluir.hide(),a.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:a.btn_salvar.hide(),a.btn_excluir.show(),a.permite_alterar(!1)}a.tipo=d,a.funcao_hpe_id=i,void 0!==i&&i&&a.preencher(),show_modal(a.modal.attr("id")),set_focus(a.edt_nome)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},a.btn_incluir_responsabilidade.unbind("click").click(function(i){a.new_row()}),a.btn_incluir_indicador.unbind("click").click(function(i){a.novo_indicador()}),this.new_row=function(i){var d=a.tab_listagem_responsabilidades.find("tbody"),e=d.find("tr:first").clone();e.removeAttr("template-row"),e.css("display","");var n=$(e.find('[template-field="descricao"] input')),o=$(e.find('[template-field="desejado"] input'));null!=i&&""!=i&&(n.val(i.descricao),o.val(i.desejado),e.attr("data-id-responsabilidade",i.id));var t=$(e.find(".btn_deletar_responsabilidade"));t.unbind("click"),t.click(function(){$(this).closest("tr").attr("data-id-responsabilidade"),void 0!==i?alert_modal("Função","Deseja remover esta responsabilidade?","Remover",function(){WS.post("funcao_hpe_responsabilidades/excluir/",{funcao_hpe_responsabilidade_id:i.id},function(i){alert_saved("Responsabilidade excluída com sucesso"),$(e).remove()})},!0):$(e).remove()}),e.appendTo(d),n.focus()},this.novo_indicador=function(i){var d=a.tab_indicadores.find("tbody"),e=d.find("tr:first").clone();e.removeAttr("template-row"),e.css("display","");var n=$(e.find('[template-field="nome"] input'));null!=i&&""!=i&&(n.val(i.nome),e.attr("data-id-indicador",i.id));var o=$(e.find(".btn_deletar_indicador"));o.unbind("click"),o.click(function(){void 0!==i?alert_modal("Função","Deseja remover este indicador?","Remover",function(){WS.post("funcao_hpe_indicadores/excluir/",{funcao_hpe_indicadores_id:i.id},function(i){alert_saved("Indicador excluído com sucesso"),$(e).remove()})},!0):$(e).remove()}),e.appendTo(d),n.focus()},this.incluir_responsabilidades=function(){var i=a.tab_listagem_responsabilidades.find("tbody tr").not("[template-row]");a.arr_responsabilidades=[],$.each(i,function(i,d){var e=void 0===$(d).attr("data-id-responsabilidade")?"":$(d).attr("data-id-responsabilidade"),n=$(d).find("[template-field='descricao'] input").val(),o=$(d).find("[template-field='desejado'] input").val();a.arr_responsabilidades.push({responsabilidade_id:e,descricao:n,desejado:o})})},this.permite_alterar=function(i){a.edt_nome.prop("readonly",!i),a.edt_missao.prop("readonly",!i)},this.preencher=function(){WS.get("funcao_hpe/objeto/",{funcao_hpe_id:a.funcao_hpe_id},function(i){a.edt_nome.val(i.funcao.nome),a.edt_missao.val(i.funcao.missao),a.arr_responsabilidades=i.responsabilidades,a.arr_indicadores=i.indicadores;for(var d=0;d<$(a.arr_responsabilidades).length;d++)void 0!==a.arr_responsabilidades[d]&&null!=a.arr_responsabilidades[d].id&&a.new_row(a.arr_responsabilidades[d]);for(d=0;d<$(a.arr_indicadores).length;d++)void 0!==a.arr_indicadores[d]&&null!=a.arr_indicadores[d].id&&a.novo_indicador(a.arr_indicadores[d]);if(a.tipo==FORMULARIO.VISUALIZAR||a.tipo==FORMULARIO.EXCLUIR){var e=a.tab_listagem_responsabilidades.find("tbody tr").not("[template-row]");e.find("input").prop("readonly",!0),e.find(".btn_deletar_responsabilidade").addClass("hidden"),a.tab_listagem_responsabilidades.find(".btn_incluir_responsabilidade").addClass("hidden")}})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){a.incluir_responsabilidades(),a.arr_indicadores=[],$.each(a.tab_indicadores.find("tbody tr").not("[template-row]"),function(i,d){""!=$(d).find("td:nth-child(1) input").val().trim()?a.arr_indicadores.push({nome:$(d).find("td:nth-child(1) input").val(),id:$(d).attr("data-id-indicador")}):""!=$(d).attr("data-id-indicador")&&void 0!==$(d).attr("data-id-indicador")&&WS.post("atuacao_efetiva_indicador/excluir/",{atuacao_efetiva_indicador_id:$(d).attr("data-id-indicador")},function(i){})}),WS.post("funcao_hpe/salvar",{funcao_hpe_id:a.funcao_hpe_id,responsabilidades:JSON.stringify(a.arr_responsabilidades),indicadores:JSON.stringify(a.arr_indicadores),nome:a.edt_nome.val(),missao:a.edt_missao.val()},function(i){a.funcao_hpe_id=i.id,alert_saved(i.nome+" salvo com sucesso"),void 0!==a.onsave&&a.onsave&&a.onsave(i),a.unload()})}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("funcao_hpe/excluir",{funcao_hpe_id:a.funcao_hpe_id},function(i){alert_saved(i.nome+" excluido com sucesso"),a.unload()})})}});