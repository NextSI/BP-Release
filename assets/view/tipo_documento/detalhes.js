define([],function(){return function(o){"use strict";var a=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.painel_detalhes=this.dialog.find(".painel_detalhes"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.chk_controle_acessos=this.dialog.find(".chk_controle_acessos"),this.div_permissoes=this.dialog.find(".div_permissoes"),this.tab_permissoes=this.dialog.find(".tab_permissoes"),this.tab_permissoes_grupo=this.dialog.find(".tab_permissoes_grupo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_add_usuario=this.dialog.find(".btn_add_usuario"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.grupos=new Object,this.grupos_array=new Array,this.usuarios=new Object,this.usuarios_array=new Array,this.tipo_documento_id=null,this.permite_alterar_seguranca=!1,this.valor=null,this.houve_alteracao=!1,this.show=function(o,s){a.tipo=s,void 0!==o&&o?(a.tipo_documento_id=o,a.preencher()):a.permite_alterar(),show_modal(a.modal.attr("id"))},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.permite_alterar=function(){var o=!1;switch(a.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:a.btn_salvar.show(),a.btn_excluir.hide(),o=!0,a.valor=!0,a.permite_alterar_seguranca=!0;break;case FORMULARIO.VISUALIZAR:a.btn_salvar.hide(),a.btn_excluir.hide(),o=!1,a.valor=!1,a.permite_alterar_seguranca=!1;break;case FORMULARIO.EXCLUIR:a.btn_salvar.hide(),a.btn_excluir.show(),o=!1,a.valor=!1,a.permite_alterar_seguranca=!1}a.btn_add_grupo.prop("disabled",!o),a.btn_add_usuario.prop("disabled",!o),a.chk_controle_acessos.prop("disabled",!o)},this.preencher=function(){WS.get("tipo_documento/objeto/",{tipo_documento_id:a.tipo_documento_id},function(o){a.permite_alterar(),a.usuarios_array=o.usuarios_permissoes,a.render_usuarios(),a.grupos_array=o.grupos_permissoes,a.render_grupos(),a.chk_controle_acessos.prop("checked",!0===o.controle_acessos).change()})},this.render_usuarios=function(){var o=a.tab_permissoes.find("tbody"),s=o.find("tr:first"),r=function(o,s,r){$(a.usuarios_array).each(function(e,i){i.usuario_id==r.usuario_id&&(a.usuarios=i,"visualizacao"==s?a.usuarios.visualizacao=o.prop("checked"):"download"==s?a.usuarios.download=o.prop("checked"):"exclusao"==s?a.usuarios.exclusao=o.prop("checked"):"escrita"==s?a.usuarios.escrita=o.prop("checked"):"revisao"==s?a.usuarios.revisao=o.prop("checked"):"seguranca"==s&&(a.usuarios.seguranca=o.prop("checked")),a.usuarios_array[e]=a.usuarios)})};a.tab_permissoes.find("tr:gt(1)").remove(),$(a.usuarios_array).each(function(e,i){!function(e){var i=s.clone();i.removeAttr("template-row"),i.css("display","");var c=$(i.find(".btn_usuario_remover"));i.find(".img_usuario"),i.find(".lbl_nome").text(e.nome);var t=i.find(".chk_visualizacao");t.attr("type","checkbox"),t.addClass("checkbox_bootstrap_toggle"),t.prop("checked",1==e.visualizacao);var u=i.find(".chk_download");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.download);var n=i.find(".chk_escrita");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.escrita);var d=i.find(".chk_exclusao");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.exclusao);var l=i.find(".chk_revisao");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.revisao);var p=i.find(".chk_seguranca");p.attr("type","checkbox"),p.addClass("checkbox_bootstrap_toggle"),p.prop("checked",1==e.seguranca),$(t).prop("disabled",!a.valor),$(u).prop("disabled",!a.valor),$(n).prop("disabled",!a.valor),$(d).prop("disabled",!a.valor),$(l).prop("disabled",!a.valor),$(p).prop("disabled",!a.valor),$(c).prop("disabled",!a.valor),t.change(function(){r(t,"visualizacao",e)}),u.change(function(){r(u,"download",e)}),n.change(function(){r(n,"escrita",e)}),d.change(function(){r(d,"exclusao",e)}),l.change(function(){r(l,"revisao",e)}),p.change(function(){r(p,"seguranca",e)}),c.unbind("click"),c.click(function(){alert_modal(a.title.text(),"Deseja remover o usu√°rio?","Remover",function(){$(a.usuarios_array).each(function(o,s){s.usuario_id==e.usuario_id&&(i.remove(),a.usuarios_array.splice(o,1),a.render_usuarios())})},!0)}),i.appendTo(o)}(i)}),App.aplicar_checkbox(o)},this.render_grupos=function(){var o=a.tab_permissoes_grupo.find("tbody"),s=o.find("tr:first"),r=function(o,s,r){$(a.grupos_array).each(function(e,i){i.grupo_usuarios_id==r.grupo_usuarios_id&&(a.grupos=i,"visualizacao"==s?a.grupos.visualizacao=o.prop("checked"):"download"==s?a.grupos.download=o.prop("checked"):"exclusao"==s?a.grupos.exclusao=o.prop("checked"):"escrita"==s?a.grupos.escrita=o.prop("checked"):"revisao"==s?a.grupos.revisao=o.prop("checked"):"seguranca"==s&&(a.grupos.seguranca=o.prop("checked")),a.grupos_array[e]=a.grupos)})};a.tab_permissoes_grupo.find("tr:gt(1)").remove(),$(a.grupos_array).each(function(e,i){!function(e){var i=s.clone();i.removeAttr("template-row"),i.css("display",""),i.find(".lbl_nome").text(e.nome);var c=i.find(".chk_visualizacao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.visualizacao);var t=i.find(".chk_download");t.attr("type","checkbox"),t.addClass("checkbox_bootstrap_toggle"),t.prop("checked",1==e.download);var u=i.find(".chk_escrita");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.escrita);var n=i.find(".chk_exclusao");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.exclusao);var d=i.find(".chk_revisao");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.revisao);var l=i.find(".chk_seguranca");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.seguranca),$(c).prop("disabled",!a.valor),$(t).prop("disabled",!a.valor),$(u).prop("disabled",!a.valor),$(n).prop("disabled",!a.valor),$(d).prop("disabled",!a.valor),$(l).prop("disabled",!a.valor),$(p).prop("disabled",!a.valor),c.change(function(){r(c,"visualizacao",e)}),t.change(function(){r(t,"download",e)}),u.change(function(){r(u,"escrita",e)}),n.change(function(){r(n,"exclusao",e)}),d.change(function(){r(d,"revisao",e)}),l.change(function(){r(l,"seguranca",e)});var p=$(i.find(".btn_grupo_remover"));p.unbind("click"),p.click(function(){alert_modal(a.title.text(),"Deseja remover o grupo?","Remover",function(){$(a.grupos_array).each(function(o,s){s.grupo_usuarios_id==e.grupo_usuarios_id&&(i.remove(),a.grupos_array.splice(o,1),a.render_grupos())})},!0)}),i.appendTo(o)}(i)}),App.aplicar_checkbox(o)},this.chk_controle_acessos.change(function(){$(this).prop("checked")?a.div_permissoes.fadeIn():(a.div_permissoes.fadeOut(),a.usuarios_array=[],a.grupos_array=[],a.tab_permissoes.find("tr:gt(1)").remove(),a.tab_permissoes_grupo.find("tr:gt(1)").remove())}),this.btn_add_usuario.unbind("click"),this.btn_add_usuario.click(function(){View.load("usuario/selecionar",function(o,s){s.show(function(o){var s=!1;$(a.usuarios_array).each(function(a,r){r.usuario_id==o.usuario_id&&(s=!0)}),s||(a.usuarios=o,a.usuarios.visualizacao=!1,a.usuarios.download=!1,a.usuarios.escrita=!1,a.usuarios.exclusao=!1,a.usuarios.revisao=!1,a.usuarios.seguranca=!1,a.usuarios_array.push(a.usuarios)),a.render_usuarios(a.usuarios_array)})})}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){View.load("grupo_usuarios/selecionar",function(o,s){s.show(function(o){var s=!1;$(a.grupos_array).each(function(a,r){r.grupo_usuarios_id==o.grupo_usuarios_id&&(s=!0)}),s||(a.grupos=o,a.grupos.visualizacao=!1,a.grupos.download=!1,a.grupos.escrita=!1,a.grupos.exclusao=!1,a.grupos.revisao=!1,a.grupos.seguranca=!1,a.grupos_array.push(a.grupos)),a.render_grupos(a.grupos_array)},MODULOS.DOCUMENTO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("tipo_documento/salvar_permissoes",{tipo_documento_id:a.tipo_documento_id,usuarios_permissoes:JSON.stringify(a.usuarios_array),grupos_permissoes:JSON.stringify(a.grupos_array),controle_acessos:a.chk_controle_acessos.prop("checked")},function(o){a.tipo_documento_id=o.id,alert_saved(o.nome+" salvo com sucesso"),a.houve_alteracao=!0,a.unload()},[a.btn_excluir,a.btn_salvar,a.btn_cancelar])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("tipo_documento/excluir",{tipo_documento_id:a.tipo_documento_id},function(o){alert_saved(o.nome+" excluido com sucesso"),a.houve_alteracao=!0,a.unload()},[a.btn_excluir,a.btn_salvar,a.btn_cancelar])})}});