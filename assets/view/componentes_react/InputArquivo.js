"use strict";define(["react","react-dom"],function(e,i){return class extends e.Component{constructor(e){var i;super(e),i=this,this.state={},this.props.documentoRevisaoID=null,this.props.documentoRevisaoIDBackup=null,this.props.documentoRevisaoMimeType=null,this.props.documentoRevisaoMimeTypeBackup=null,this.props.arquivoSelecionado=null,this.props.arquivoPrevisao=null,this.props.arquivoNome="",this.props.arquivoNomeBackup=this.props.arquivoNome,this.props.arquivoTamanho=0,this.props.arquivoTamanhoBackup=this.props.arquivoTamanho,this.props.desabilitado=!0,this.props.exibirPrevisao=!0,this.props.obrigatorio=!1,this.props.clicksignAtivo=!1,this.props.certsignAtivo=!1,this.props.d4signAtivo=!1,this.props.elemKey=null,this.props.solicitacaoID=null,this.props.solicitacaoNumero=null,this.props.linhaTabela=null,this.props.objCampoTabela=null,this.props.setClicksignAtivo=(e=>{this.props.clicksignAtivo=e}),this.props.setCertsignAtivo=(e=>{this.props.certsignAtivo=e}),this.props.setD4SignAtivo=(e=>{this.props.d4signAtivo=e}),this.props.setDocumentoRevisaoID=((e,i,s,o)=>{this.props.documentoRevisaoID=e,this.props.documentoRevisaoIDBackup=e,this.props.documentoRevisaoMimeType=i,this.props.documentoRevisaoMimeTypeBackup=i,this.props.arquivoNome=s,this.props.arquivoNomeBackup=s,this.props.arquivoTamanho=o,this.props.arquivoTamanhoBackup=o,this.setState({})}),this.props.setDesabilitado=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i.props.desabilitado=e,i.setState({})},this.props.setExibirPrevisao=(e=>{this.props.exibirPrevisao=e,this.setState({})}),this.props.setObrigatorio=(e=>{this.props.obrigatorio=e}),this.props.setElemKey=(e=>{this.props.elemKey=e}),this.props.setSolicitacaoID=(e=>{this.props.solicitacaoID=e}),this.props.setSolicitacaoNumero=(e=>{this.props.solicitacaoNumero=e}),this.props.setLinhaTabela=(e=>{this.props.linhaTabela=e}),this.handleLimparClick=this.handleLimparClick.bind(this),this.handleSelecionarClick=this.handleSelecionarClick.bind(this),this.handleDesfazerClick=this.handleDesfazerClick.bind(this),this.handleVisualizarClick=this.handleVisualizarClick.bind(this),this.handleDownloadClick=this.handleDownloadClick.bind(this),this.handleClicksignSignatariosClick=this.handleClicksignSignatariosClick.bind(this),this.handleCertsignSignatariosClick=this.handleCertsignSignatariosClick.bind(this),this.handleD4SignSignatariosClick=this.handleD4SignSignatariosClick.bind(this),this.handleInputDrop=this.handleInputDrop.bind(this)}handleLimparClick(e){this.props.desabilitado||(this.props.documentoRevisaoID=null,this.props.arquivoSelecionado=null,this.props.arquivoNome="",this.props.arquivoTamanho=0,this.props.handleAlterado&&this.props.handleAlterado(this,this.props.objCampoTabela),this.setState({}))}handleSelecionarClick(e){if(this.props.desabilitado)return;let i=$('<input type="file" class="input_arquivo hidden">');i.on("change",e=>{this.props.arquivoPrevisao=null;const i=e.target.files[0];void 0!==i&&i&&(this.props.documentoPastaID=null,this.props.arquivoSelecionado=i,this.props.arquivoNome=i.name,this.props.arquivoTamanho=i.size,this.props.documentoRevisaoMimeType=i.type),this.props.handleAlterado&&this.props.handleAlterado(this,this.props.objCampoTabela),this.setState({})});let s=$(e.target).closest(".input-group");s.find(".input_arquivo").remove(),i.appendTo(s),this.setState({}),$(document).ready(function(){i.click()})}handleDesfazerClick(e){this.props.arquivoSelecionado=null,this.props.arquivoPrevisao=null,this.props.documentoRevisaoID=this.props.documentoRevisaoIDBackup,this.props.documentoRevisaoMimeType=this.props.documentoRevisaoMimeTypeBackup,this.props.arquivoNome=this.props.arquivoNomeBackup,this.props.arquivoTamanho=this.props.arquivoTamanhoBackup,this.setState({})}handleVisualizarClick(e){"application/pdf"==this.props.documentoRevisaoMimeType?this.props.documentoRevisaoID>0&&View.load("central_documentos/visualizar_pdf",(e,i)=>{i.show(this.props.documentoRevisaoID)}):"image/png"!=this.props.documentoRevisaoMimeType&&"image/bmp"!=this.props.documentoRevisaoMimeType&&"image/jpeg"!=this.props.documentoRevisaoMimeType&&"image/jpg"!=this.props.documentoRevisaoMimeType&&"image/gif"!=this.props.documentoRevisaoMimeType||View.load("central_documentos/visualizar_documento",(e,i)=>{this.props.documentoRevisaoID>0?i.show(this.props.documentoRevisaoID):this.props.arquivoPrevisao&&i.show(null,null,null,null,null,null,null,this.props.arquivoPrevisao)})}handleDownloadClick(e){App.obter_token_publico(e=>{this.props.documentoRevisaoID>0&&App.download(WS_URI+"documento/download/?documento_revisao_id="+this.props.documentoRevisaoID+"&solicitacao=true&token_publico="+e)},this.props.documentoRevisaoID)}handleClicksignSignatariosClick(e){this.props.documentoRevisaoID>0?View.load("clicksign/detalhes",(e,i)=>{i.show(this.props.documentoRevisaoID)},View.ABA.SIM):View.load("clicksign/configurar_signatarios",(e,i)=>{i.show(null,!1,this.props.elemKey,this.props.linhaTabela,this.props.solicitacaoID)},View.ABA.SIM)}handleCertsignSignatariosClick(e){this.props.documentoRevisaoID>0?View.load("certsign/detalhes",(e,i)=>{i.show(this.props.documentoRevisaoID)},View.ABA.SIM):View.load("certsign/configurar_signatarios",(e,i)=>{i.show(null,!1,this.props.elemKey,this.props.linhaTabela,this.props.solicitacaoID)},View.ABA.SIM)}handleD4SignSignatariosClick(e){WS.get("processo/get_parametros/",null,e=>{const i=e.processo_padrao_mensagem_d4sign;let s=this.props.solicitacaoID;"S"==App.sessao.dados.parametro_processo.numero_solicitacao_por_processo&&(s=this.props.solicitacaoNumero),this.props.documentoRevisaoID>0?View.load("d4sign/detalhes",(e,o)=>{o.show(this.props.documentoRevisaoID,null,i,s)},View.ABA.MULTIPLAS):View.load("d4sign/configurar_signatarios",(e,o)=>{o.show(null,!1,this.props.elemKey,this.props.linhaTabela,s,i)},View.ABA.MULTIPLAS)})}handleInputDragStart(e){e.preventDefault(),e.stopPropagation()}handleInputDragOver(e){e.preventDefault(),e.stopPropagation()}handleInputDragLeave(e){e.preventDefault(),e.stopPropagation()}handleInputDrop(e){e.preventDefault(),e.stopPropagation();let i=!1,s=!1;if(e.dataTransfer&&e.dataTransfer.items&&(e.dataTransfer.items.length>1&&(s=!0),$(e.dataTransfer.items).each(function(e,s){s.webkitGetAsEntry().isDirectory&&(i=!0)})),i)alert_modal("Aviso","<strong>Ocorreu uma falha na operação!</strong> <br /><br /> <strong>Não</strong> é possível realizar o <strong>upload de pastas</strong> através deste campo. Por favor, selecione apenas um arquivo e tente novamente."),this.setState({});else if(s)alert_modal("Aviso","<strong>Ocorreu uma falha na operação!</strong> <br /><br /> <strong>Não</strong> é possível realizar o <strong>upload de vários arquivos</strong> através deste campo. Por favor, selecione apenas um arquivo e tente novamente."),this.setState({});else if(e&&e.dataTransfer&&e.dataTransfer.files){if(this.props.desabilitado)return;this.props.arquivoPrevisao=null;let i=e.dataTransfer.files[0];void 0!==i&&i&&(this.props.documentoPastaID=null,this.props.arquivoSelecionado=i,this.props.arquivoNome=i.name,this.props.arquivoTamanho=i.size),this.props.handleAlterado&&this.props.handleAlterado(this,this.props.objCampoTabela),this.setState({})}}render(){let i=null,s=null,o=null,a=null,t=null,r=null,p=null,n=null,l=null,h=null,c=null,d=null;if(!this.props.desabilitado&&this.props.documentoRevisaoIDBackup>0&&(this.props.arquivoSelecionado||!this.props.documentoRevisaoID)&&(d=e.createElement("li",null,e.createElement("a",{onClick:this.handleDesfazerClick,disabled:this.props.desabilitado,href:"javascript:;"},e.createElement("span",{className:"fa fa-undo"})," Desfazer"))),null!=this.props.arquivoSelecionado||this.props.documentoRevisaoID>0){if(void 0!==this.props.arquivoTamanho&&(s=e.createElement("button",{type:"button",className:"btn btn-default",disabled:"true",style:{paddingLeft:"3px",paddingRight:" 3px"}},e.createElement("span",{style:{fontSize:"x-small"}},filesize(parseInt(this.props.arquivoTamanho,10)||0)))),this.props.desabilitado||(a=e.createElement("li",{role:"separator",class:"divider"}),t=e.createElement("li",null,e.createElement("a",{onClick:this.handleLimparClick,href:"javascript:;"},e.createElement("span",{className:"fa fa-trash-alt"})," Limpar"))),this.props.clicksignAtivo){let i=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),s=i?null:"disabled";p=e.createElement("li",{className:s},e.createElement("a",{onClick:i?this.handleClicksignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (Clicksign)"))}if(this.props.certsignAtivo){let i=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),s=i?null:"disabled";n=e.createElement("li",{className:s},e.createElement("a",{onClick:i?this.handleCertsignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (Certsign)"))}if(this.props.d4signAtivo){let i=extensao_valida(this.props.arquivoNome,extensoes_validas_assinatura),s=i?null:"disabled";l=e.createElement("li",{className:s},e.createElement("a",{onClick:i?this.handleD4SignSignatariosClick:null,href:"javascript:;"},e.createElement("span",{className:"fa fa-edit"})," Assinaturas (D4Sign)"))}if(this.props.arquivoSelecionado){if(null==this.props.arquivoPrevisao){let e=new FileReader;e.onload=(e=>{let s=!1,o=[".jpg",".jpeg",".bmp",".gif",".png"];for(let e=0;e<o.length;e++){let i=o[e];if(this.props.arquivoNome.substr(this.props.arquivoNome.length-i.length,i.length).toLowerCase()==i.toLowerCase()){s=!0;break}}s?this.props.arquivoPrevisao=e.target.result:(i=null,this.props.arquivoPrevisao=!1),this.setState({})}),e.readAsDataURL(this.props.arquivoSelecionado)}}else if(this.props.documentoRevisaoID>0&&null==this.props.arquivoPrevisao&&("image/png"==this.props.documentoRevisaoMimeType||"image/bmp"==this.props.documentoRevisaoMimeType||"image/jpeg"==this.props.documentoRevisaoMimeType||"image/jpg"==this.props.documentoRevisaoMimeType||"image/gif"==this.props.documentoRevisaoMimeType)){let e=WS_URI+"documento/midia/?documento_revisao_id="+this.props.documentoRevisaoID+"&tipo=v&tamanho=200&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime();this.props.arquivoPrevisao=e}if(this.props.exibirPrevisao&&this.props.arquivoPrevisao){const s={"border-left":"1px solid #ccc","border-right":"1px solid #ccc","border-bottom":"1px solid #ccc"},o={"max-height":"200px","max-width":"100%"};i=e.createElement("div",{style:s},e.createElement("img",{src:this.props.arquivoPrevisao,style:o}))}}else r=e.createElement("button",{title:"Selecionar",type:"button",className:"btn btn-default",onClick:this.handleSelecionarClick,disabled:this.props.desabilitado},e.createElement("span",{className:"fa fa-upload"}));(this.props.arquivoSelecionado||this.props.documentoRevisaoID>0)&&(("image/png"==this.props.documentoRevisaoMimeType||"image/bmp"==this.props.documentoRevisaoMimeType||"image/jpeg"==this.props.documentoRevisaoMimeType||"image/jpg"==this.props.documentoRevisaoMimeType||"image/gif"==this.props.documentoRevisaoMimeType||"application/pdf"==this.props.documentoRevisaoMimeType&&this.props.documentoRevisaoID>0)&&(h=e.createElement("button",{title:"Visualizar",type:"button",className:"btn btn-default",onClick:this.handleVisualizarClick},e.createElement("span",{className:"fa fa-window-maximize"}))),this.props.documentoRevisaoID>0&&(c=e.createElement("li",null,e.createElement("a",{onClick:this.handleDownloadClick,href:"javascript:;"},e.createElement("span",{className:"fa fa-download"})," Download"))));let u={onDragStart:this.handleInputDragStart,onDrag:this.handleInputDragStart,onDragOver:this.handleInputDragOver,onDragEnter:this.handleInputDragOver,onDragLeave:this.handleInputDragLeave,onDragEnd:this.handleInputDragLeave,onDrop:this.handleInputDrop};return(d||c||p||n||l||t)&&(o=e.createElement("button",{title:"Mais opções",type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},e.createElement("span",{className:"caret"}),e.createElement("span",{className:"sr-only"},"Mais opções"))),e.createElement("div",u,e.createElement("div",{className:"input-group"},e.createElement("input",{type:"text",className:"form-control",value:this.props.arquivoNome,readOnly:!0,placeholder:"Arraste um arquivo aqui ou clique no botão para pesquisar",style:{paddingLeft:"3px",paddingRight:" 3px"},onClick:null!=this.props.arquivoSelecionado||this.props.documentoRevisaoID>0?null:this.handleSelecionarClick,required:this.props.obrigatorio}),e.createElement("div",{className:"input-group-btn"},s,r,h,o,e.createElement("ul",{className:"dropdown-menu pull-right"},d,c,p,n,l,a,t))),i)}}});