define([],function(){return function(i){"use strict";var a,t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.edt_mensagem_count=this.dialog.find(".edt_mensagem_count"),this.edt_mensagem=this.dialog.find(".edt_mensagem"),this.emails_adicionais=this.dialog.find(".emails_adicionais"),this.ul_usuarios=this.dialog.find(".ul_usuarios"),this.edt_emails=this.dialog.find(".edt_emails"),this.div_btn_drop=this.dialog.find(".div_btn_drop"),this.li_edt_emails=this.dialog.find(".li_edt_emails"),this.btn_drop=this.dialog.find(".btn_drop"),this.show=function(){t.preencher(),t.edt_emails.unbind("keyup"),t.edt_emails.keyup($.debounce(500,t.pesquisar_email_adicionais)),show_modal(t.modal.attr("id")),set_focus(t.edt_mensagem)},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.preencher=function(){WS.get("projeto/get_parametros/",null,function(i){t.emails_adicionais.val(i.email_resposta),t.edt_mensagem.val(i.agenda_email_cliente_mensagem),t.count_msg()})},this.drop_click=function(){t.ul_usuarios.find("li:gt()").remove(),t.edt_emails.val(""),t.edt_emails.click(function(i){i.stopPropagation()}),t.li_edt_emails.click(function(){t.div_btn_drop.find("dropdown").remove().appendTo(t.btn_drop.find("dropdown").text($(this).text()))})},this.pesquisar_email_adicionais=function(){var i=t.edt_emails.val(),e=function(i){t.ul_usuarios.append($('<li class="li_click"><a href="#">'+i.nome+" [ "+i.email+" ]</a></li>").click(function(){""==t.emails_adicionais.val()?(a=i.email,t.emails_adicionais.val(a)):-1==t.emails_adicionais.val().indexOf(i.email)&&(a=i.email+";"+t.emails_adicionais.val(),t.emails_adicionais.val(a))}))};WS.get("usuario/listar/",{nome:i},function(i){t.ul_usuarios.find("li:gt()").remove();for(var a=0;a<i.length;a++){var n=i[a];e(n)}})},this.count_msg=function(){msg_count(t.edt_mensagem,t.edt_mensagem_count,3e3)},this.edt_mensagem.keyup(function(){t.count_msg()}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_drop.click(function(){t.drop_click()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("projeto/salvar_mensagem_agenda",{agenda_email_cliente_mensagem:t.edt_mensagem.val(),email_resposta:t.emails_adicionais.val()},function(i){alert_saved(App.lang.alert_saved.mensagem+App.lang.alert_saved.salvo),t.unload()},[t.btn_salvar,t.btn_cancelar])})}});