define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.carrega_img=this.dialog.find(".carrega_img"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.titulo=this.dialog.find(".titulo"),this.modal_carregar_curtida=this.dialog.find(".modal_carregar_curtida"),this.div_load=this.dialog.find(".div_load"),this.modal_teste=this.dialog.find(".modal_teste"),this.usuario_id_param=null,this.arr_curtidas_usuario=null,this.arr_curtidas=[],this.usuario_seguindo=null,this.limite=0,this.quantidade=0,this.usuario_nome=null,this.flag=null,this.show=function(i,s,u){a.usuario_id_param=i,a.usuario_seguindo=u,a.usuario_nome=s,show_modal(a.modal.attr("id")),a.listar()},this.listar=function(){1==a.usuario_seguindo?(a.usuario_id_param==App.sessao.usuario_id?a.titulo.text("Quem estou seguindo"):a.titulo.text("Quem "+a.usuario_nome+" segue"),WS.get({route:"mural_mensagem/listar_seguindo/",data:{id_usuario_seguidor:a.usuario_id_param,limite:a.limite},func_response:function(i){i&&(a.arr_curtidas=i,a.render_usuarios(),a.flag=!0)}})):(a.usuario_id_param==App.sessao.usuario_id?a.titulo.text("Quem me segue"):a.titulo.text("Quem segue "+a.usuario_nome),WS.get({route:"mural_mensagem/listar_seguidores/",data:{id_usuario_seguindo:a.usuario_id_param,limite:a.limite},func_response:function(i){i&&(a.arr_curtidas=i,a.render_usuarios(),a.flag=!0)}}))},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.render_usuarios=function(){var i=a.tab_listagem.find("tbody"),s=i.find("tr:first");a.tab_listagem.find("tr:gt(-1)").remove(),$(a.arr_curtidas).each(function(u,o){null==o.usuario_seguindo_nome&&""==o.usuario_seguindo_nome||(null!=o.foto_id?a.carrega_img.attr("src",WS_URI+"documento/midia/?documento_id="+o.foto_id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):a.carrega_img.attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg")),function(u){var o=s.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='img_usuario_curtida']"));var d=$(o.find("[template-field='nome_usuario_curtida']")),e=$(o.find(".link_perfil")),t=$(o.find(".btn_seguir")),r=$(o.find(".btn_deixar_seguir"));1==u.count_usuario_logado?(r.hasClass("hidden")&&r.removeClass("hidden"),t.hasClass("hidden")||t.addClass("hidden")):(t.hasClass("hidden")&&t.removeClass("hidden"),r.hasClass("hidden")||r.addClass("hidden")),App.sessao.usuario_id!=a.usuario_id_param&&(App.sessao.usuario_id!=u.id_usuario_seguindo&&App.sessao.usuario_id!=u.id_usuario_seguidor||(r.addClass("hidden"),t.addClass("hidden"))),1==a.usuario_seguindo?(d.text(u.usuario_seguindo_nome),a.quantidade=u.contador_seguindo,e.unbind("click"),e.click(function(){View.load("perfil/listar",function(i,a){a.show(u.id_usuario_seguindo,!1)},View.ABA.MULTIPLAS),a.unload()}),t.unbind("click"),t.click(function(){WS.post("mural_mensagem/seguir",{id_usuario_seguindo:u.id_usuario_seguindo,id_usuario_seguidor:App.sessao.usuario_id},function(i){alert_saved("Seguindo usuario"),i&&(t.addClass("hidden"),r.removeClass("hidden"))},[t],null,!0)}),r.unbind("click"),r.click(function(){alert_modal("Validação","Deixar de seguir "+u.usuario_seguindo_nome+" ?","Ok",function(){WS.post("mural_mensagem/deixar_seguir",{id_usuario_seguindo:u.id_usuario_seguindo,id_usuario_seguidor:App.sessao.usuario_id},function(i){t.removeClass("hidden"),r.addClass("hidden")},[r],null,!0)},!0)})):(d.text(u.usuario_seguidor_nome),a.quantidade=u.contador_seguidor,e.unbind("click"),e.click(function(){View.load("perfil/listar",function(i,a){a.show(u.id_usuario_seguidor,!1)},View.ABA.MULTIPLAS),a.unload()}),t.unbind("click"),t.click(function(){WS.post("mural_mensagem/seguir",{id_usuario_seguindo:u.id_usuario_seguidor,id_usuario_seguidor:App.sessao.usuario_id},function(i){alert_saved("Seguindo usuario"),i&&(t.addClass("hidden"),r.removeClass("hidden"))},[t],null,!0)}),r.unbind("click"),r.click(function(){alert_modal("Validação","Deixar de seguir "+u.usuario_seguidor_nome+" ?","Ok",function(){WS.post("mural_mensagem/deixar_seguir",{id_usuario_seguindo:u.id_usuario_seguidor,id_usuario_seguidor:App.sessao.usuario_id},function(i){t.removeClass("hidden"),r.addClass("hidden")},[r],null,!0)},!0)})),o.appendTo(i)}(o)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),a.flag=!0,this.modal_carregar_curtida.unbind("scroll"),this.modal_carregar_curtida.scroll(function(){a.modal_carregar_curtida.scrollTop()+a.modal_carregar_curtida.height()>a.tab_listagem.get(0).scrollHeight&&(a.div_load.removeClass("hidden"),1==a.flag&&(a.flag=!1,a.limite=a.limite+5,a.listar()))})}});