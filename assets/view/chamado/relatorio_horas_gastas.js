define([],function(){return function(e){"use strict";var i=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.title="Relatorio de Horas Gastas",this.edt_day_start=this.dialog.find(".edt_day_start"),this.edt_day_end=this.dialog.find(".edt_day_end"),this.btn_search=this.dialog.find(".btn_search"),this.btn_refresh=this.dialog.find(".btn_refresh"),this.btn_show_filtros=this.dialog.find(".btn_show_filtros"),this.div_alert=this.dialog.find(".div_alert"),this.div_template=this.dialog.find(".div_template"),this.div_lista_geral_cliente=this.dialog.find(".div_lista_geral_cliente"),this.div_lista_geral_usuario=this.dialog.find(".div_lista_geral_usuario"),this.div_template_usuario=this.dialog.find(".div_template_usuario"),this.div_filtros=this.dialog.find(".div_filtros"),this.div_filtro_cliente=this.dialog.find(".div_filtro_cliente"),this.div_filtro_prospect=this.dialog.find(".div_filtro_prospect"),this.div_filtro_fornecedor=this.dialog.find(".div_filtro_fornecedor"),this.div_filtro_empresa=this.dialog.find(".div_filtro_empresa"),this.filtro_cliente_id=this.dialog.find(".filtro_cliente_id"),this.filtro_prospect_id=this.dialog.find(".filtro_prospect_id"),this.filtro_fornecedor_id=this.dialog.find(".filtro_fornecedor_id"),this.filtro_empresa_id=this.dialog.find(".filtro_empresa_id"),this.array_chamados=[],this.array_cliente_horas_grafico=[],this.array_usuarios_horas_grafico=[],this.cores=ColorsGrafico(),this.exibir_grafico_cliente_x_colaborador="S",this.exibir_grafico_colaborador_x_cliente_usuario_cliente="S",this.exibir_grafico_colaborador_x_cliente_usuario_prospect="S",this.exibir_grafico_colaborador_x_cliente_usuario_fornecedor="S",this.exibir_grafico_colaborador_x_cliente_usuario_empresa_filial="S",this.cliente_id=-1,this.auxiliar=!1,this.cores=ColorsGrafico(),this.show=function(){set_datepicker(i.edt_day_start),set_datepicker(i.edt_day_end);var e=new Date,a=e.getFullYear(),r=("0"+(e.getMonth()+1)).slice(-2),o=new Date(a,r,1),t=new Date(a,r,0),s=a+"-"+r+"-"+("0"+o.getDate()).slice(-2),_=a+"-"+r+"-"+("0"+t.getDate()).slice(-2);setTimeout(function(){set_datepicker(i.edt_day_start,s),set_datepicker(i.edt_day_end,_),i.carregar_dados()},150),create_combobox(i.filtro_cliente_id,i.listar_filtro_clientes),i.criar_events_cliente(i.filtro_cliente_id),i.listar_filtro_prospect(),i.listar_filtro_fornecedor(),i.listar_filtro_empresa()},this.verifica_config=function(){WS.get("chamado/get_parametros_relatorio_horas_gastas/",null,function(e){i.exibir_grafico_cliente_x_colaborador=e.exibir_grafico_cliente_x_colaborador,i.exibir_grafico_colaborador_x_cliente_usuario_cliente=e.exibir_grafico_colaborador_x_cliente_usuario_cliente,i.exibir_grafico_colaborador_x_cliente_usuario_prospect=e.exibir_grafico_colaborador_x_cliente_usuario_prospect,i.exibir_grafico_colaborador_x_cliente_usuario_fornecedor=e.exibir_grafico_colaborador_x_cliente_usuario_fornecedor,i.exibir_grafico_colaborador_x_cliente_usuario_empresa_filial=e.exibir_grafico_colaborador_x_cliente_usuario_empresa_filial})},this.carregar_dados=function(){WS.get("chamado/relatorio_horas_gastas/",{cliente_id:[i.cliente_id],prospect_id:i.filtro_prospect_id.val(),fornecedor_id:i.filtro_fornecedor_id.val(),empresa_filial_id:i.filtro_empresa_id.val(),data_inicio:get_datepicker(i.edt_day_start),data_fim:get_datepicker(i.edt_day_end)},function(e){i.array_chamados=e,(!i.array_chamados.cliente_horas||i.array_chamados.cliente_horas.length<1)&&(!i.array_chamados.usuario_horas||i.array_chamados.usuario_horas.length<1)&&(!i.array_chamados.prospect_horas||i.array_chamados.prospect_horas.length<1)&&(!i.array_chamados.fornecedor_horas||i.array_chamados.fornecedor_horas.length<1)&&(!i.array_chamados.empresa_filial_horas||i.array_chamados.empresa_filial_horas.length<1)?(i.div_lista_geral_usuario.find("div").remove(),i.div_lista_geral_cliente.find("div").remove(),i.div_alert.removeClass("hidden")):(i.div_alert.addClass("hidden"),i.listar())})},this.listar_filtro_clientes=function(e,a){var r=a.parent(),o=r.find(".edt_combobox");WS.get("cliente/listar/",{nome_fantasia:o.val(),limite:0},function(o){limpar_combobox(a),$(o).each(function(e,i){var r=[];r.Nome=i.nome_fantasia,add_option_combobox(a,e,i.cliente_id>0?i.cliente_id:null,r)}),e(!0),r.find(".ul_row").click(function(){var e=$(this).parent().attr("id_registro");i.cliente_id=e,i.filtro_change()})})},this.criar_events_cliente=function(e){var a=e.parent().find(".edt_combobox");a.keypress(function(r){13==r.keyCode?setTimeout(function(){var r=e.parent().find(".ncbo_scroll").find(".row_selected");if(""==a.val().trim())i.cliente_id=-1;else{var o=r.attr("id_registro");i.cliente_id=o,i.filtro_change()}set_focus(a)},150):13==r.tecla_value&&(i.cliente_id=$(this).attr("selected-value"),i.filtro_change())})},this.filtro_change=function(e){var a=!0;i.edt_day_start.val().length<10&&(a=!1),i.edt_day_end.val().length<10&&(a=!1),i.filtro_cliente_id.prop("disabled",!1),i.filtro_prospect_id.prop("disabled",!1),i.filtro_fornecedor_id.prop("disabled",!1),i.filtro_empresa_id.prop("disabled",!1),i.cliente_id>0?(i.filtro_prospect_id.prop("disabled",!0),i.filtro_fornecedor_id.prop("disabled",!0),i.filtro_empresa_id.prop("disabled",!0)):i.filtro_prospect_id.val()&&i.filtro_prospect_id.val().length>0?(i.filtro_cliente_id.prop("disabled",!0),i.filtro_fornecedor_id.prop("disabled",!0),i.filtro_empresa_id.prop("disabled",!0)):i.filtro_fornecedor_id.val()&&i.filtro_fornecedor_id.val().length>0?(i.filtro_prospect_id.prop("disabled",!0),i.filtro_cliente_id.prop("disabled",!0),i.filtro_empresa_id.prop("disabled",!0)):i.filtro_empresa_id.val()&&i.filtro_empresa_id.val().length>0&&(i.filtro_prospect_id.prop("disabled",!0),i.filtro_fornecedor_id.prop("disabled",!0),i.filtro_cliente_id.prop("disabled",!0)),i.filtro_prospect_id.selectpicker("refresh"),i.filtro_fornecedor_id.selectpicker("refresh"),i.filtro_empresa_id.selectpicker("refresh"),a||alert_modal("Relatório","Digite um período válido")},this.listar_filtro_prospect=function(e){i.filtro_prospect_id.find("option").remove(),WS.get("prospect/listar/",null,function(a){for(var r=0;r<a.length;r++){var o=a[r];add_option(i.filtro_prospect_id,o.prospect_id,o.nome_fantasia)}e&&i.filtro_prospect_id.val(e).trigger("change"),i.filtro_prospect_id.change(i.filtro_change),i.filtro_prospect_id.selectpicker("refresh")})},this.listar_filtro_fornecedor=function(e){i.filtro_fornecedor_id.find("option").remove(),WS.get("fornecedor/listar/",null,function(a){for(var r=0;r<a.length;r++){var o=a[r];add_option(i.filtro_fornecedor_id,o.fornecedor_id,o.nome_fantasia)}e&&i.filtro_fornecedor_id.val(e).trigger("change"),i.filtro_fornecedor_id.change(i.filtro_change),i.filtro_fornecedor_id.selectpicker("refresh")})},this.listar_filtro_empresa=function(e){i.filtro_empresa_id.find("option").remove(),WS.get("empresa/listar/",null,function(a){for(var r=0;r<a.length;r++){var o=a[r];add_option(i.filtro_empresa_id,o.empresa_id,o.nome_fantasia)}e&&i.filtro_empresa_id.val(e).trigger("change"),i.filtro_empresa_id.change(i.filtro_change),i.filtro_empresa_id.selectpicker("refresh")})},this.listar=function(){var e=function(e){var a=i.div_template.clone();a.css("display","");var r=[],o=!1,t=[];$.each(i.cores,function(e,i){t.push(i.hex)});var s=$(a.find(".tab_listagem_cliente"));$(s.find('[template-field="nome_fantasia"]')).text(e.nome_fantasia),$(s.find('[template-field="total_horas"]')).text(null!=e.horas?format_time(e.horas.toString().toHHMMSS()):"000:00");var _=$(s.find(".tbody")),l=$(_.find("[template-row]"));$(e.usuario_horas).each(function(e,i){r.push([i.nome_usuario,1e3*parseInt(i.soma_seconds,10)]),parseInt(i.soma_seconds,10)>0&&(o=!0),function(e){var i=l.clone();i.removeAttr("template-cliente"),i.css("display",""),$(i.find("[template-field='nome_usuario']")).text(e.nome_usuario),$(i.find("[template-field='horas']")).text(null!=e.horas?format_time(e.horas.toString().toHHMMSS()):"000:00"),i.appendTo(_)}(i)}),a.appendTo(i.div_lista_geral_cliente),1==o?(a.find(".div_grafico_cliente_x_colaborador").removeClass("hidden"),a.find(".div_grafico_cliente_x_colaborador").highcharts({chart:{type:"column"},exporting:{enabled:!1},colors:t,title:{text:e.nome_fantasia},xAxis:{type:"category",labels:{rotation:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Horas Gastas"},labels:{enabled:!1}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){var e=this,i="000:00";return $(r).each(function(a,r){r[0]==e.key&&(i=e.y/1e3,i=format_time(i.toString().toHHMMSS()))}),"<b>"+i+"</b>"}}}},series:[{name:"Cliente X Colaborador",data:r}]})):a.find(".div_grafico_cliente_x_colaborador").addClass("hidden")};i.div_lista_geral_usuario.find("div").remove(),i.div_lista_geral_cliente.find("div").remove(),$(i.array_chamados.cliente_horas).each(function(i,a){e(a)}),$(i.array_chamados.prospect_horas).each(function(i,a){e(a)}),$(i.array_chamados.fornecedor_horas).each(function(i,a){e(a)}),$(i.array_chamados.empresa_filial_horas).each(function(i,a){e(a)}),$(i.array_chamados.usuario_horas).each(function(e,a){!function(e){var a=i.div_template_usuario.clone();a.css("display","");var r=[],o=[],t=[],s=[],_=!1,l=!1,n=!1,d=!1,c=[];$.each(i.cores,function(e,i){c.push(i.hex)});var f=$(a.find(".tab_listagem_usuario"));$(f.find('[template-field="nome_usuario"]')).text(e.nome_usuario),$(f.find('[template-field="total_horas"]')).text(null!=e.horas?format_time(e.horas.toString().toHHMMSS()):"000:00");var h=$(f.find(".tbody")),p=$(h.find("[template-row]")),u=function(e){var i=p.clone();i.removeAttr("template-cliente"),i.css("display","");var a=$(i.find("[template-field='nome_fantasia']"));void 0!==e.nome_fantasia&&a.text(e.nome_fantasia);var r=$(i.find("[template-field='horas']"));void 0!==e.horas&&r.text(null!=e.horas?format_time(e.horas.toString().toHHMMSS()):"000:00"),i.appendTo(h)};void 0!==e.cliente_horas&&$(e.cliente_horas).each(function(e,i){r.push([i.nome_fantasia,1e3*parseInt(i.soma_seconds,10)]),parseInt(i.soma_seconds,10)>0&&(_=!0),u(i)}),void 0!==e.prospect_horas&&$(e.prospect_horas).each(function(e,i){o.push([i.nome_fantasia,1e3*parseInt(i.soma_seconds,10)]),parseInt(i.soma_seconds,10)>0&&(l=!0),u(i)}),void 0!==e.fornecedor_horas&&$(e.fornecedor_horas).each(function(e,i){t.push([i.nome_fantasia,1e3*parseInt(i.soma_seconds,10)]),parseInt(i.soma_seconds,10)>0&&(n=!0),u(i)}),void 0!==e.empresa_filial_horas&&$(e.empresa_filial_horas).each(function(e,i){s.push([i.nome_fantasia,1e3*parseInt(i.soma_seconds,10)]),parseInt(i.soma_seconds,10)>0&&(d=!0),u(i)}),a.appendTo(i.div_lista_geral_usuario),1==_?(a.find(".div_grafico_colaborador_x_cliente_usuario_cliente").removeClass("hidden"),a.find(".div_grafico_colaborador_x_cliente_usuario_cliente").highcharts({chart:{type:"column"},exporting:{enabled:!1},colors:c,title:{text:e.nome_usuario},xAxis:{type:"category",labels:{rotation:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Horas Gastas"},labels:{enabled:!1}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){var e=this,i="000:00";return $(r).each(function(a,r){r[0]==e.key&&(i=e.y/1e3,i=format_time(i.toString().toHHMMSS()))}),"<b>"+i+"</b>"}}}},series:[{name:"Colaborador X Cliente",data:r}]})):a.find(".div_grafico_colaborador_x_cliente_usuario_cliente").addClass("hidden"),1==l?(a.find(".div_grafico_colaborador_x_cliente_usuario_prospect").removeClass("hidden"),a.find(".div_grafico_colaborador_x_cliente_usuario_prospect").highcharts({chart:{backgroundColor:"#DDD",type:"column"},exporting:{enabled:!1},colors:c,title:{text:e.nome_usuario},xAxis:{type:"category",labels:{rotation:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Horas Gastas"},labels:{enabled:!1}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){var e=this,i=null;return $(o).each(function(a,r){r[0]==e.key&&(i=e.y/1e3,i=format_time(i.toString().toHHMMSS()))}),"<b>"+i+"</b>"}}}},series:[{name:"Colaborador X Cliente",data:o}]})):a.find(".div_grafico_colaborador_x_cliente_usuario_prospect").addClass("hidden"),1==n?(a.find(".div_grafico_colaborador_x_cliente_usuario_fornecedor").removeClass("hidden"),a.find(".div_grafico_colaborador_x_cliente_usuario_fornecedor").highcharts({chart:{type:"column"},exporting:{enabled:!1},colors:c,title:{text:e.nome_usuario},xAxis:{type:"category",labels:{rotation:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Horas Gastas"},labels:{enabled:!1}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){var e=this;return $(t).each(function(i,a){a[0]==e.key&&(valor_usuario_fornecedor=e.y/1e3,valor_usuario_fornecedor=format_time(valor_usuario_fornecedor.toString().toHHMMSS()))}),"<b>"+valor_usuario_fornecedor+"</b>"}}}},series:[{name:"Colaborador X Cliente",data:t}]})):a.find(".div_grafico_colaborador_x_cliente_usuario_fornecedor").addClass("hidden"),1==d?(a.find(".div_grafico_colaborador_x_cliente_usuario_empresa_filial").removeClass("hidden"),a.find(".div_grafico_colaborador_x_cliente_usuario_empresa_filial").highcharts({chart:{type:"column"},exporting:{enabled:!1},colors:c,title:{text:e.nome_usuario},xAxis:{type:"category",labels:{rotation:0,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}}},yAxis:{title:{text:"Horas Gastas"},labels:{enabled:!1}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){var e=this,i="000:00";return $(s).each(function(a,r){r[0]==e.key&&(i=e.y/1e3,i=format_time(i.toString().toHHMMSS()))}),"<b>"+i+"</b>"}}}},series:[{name:"Colaborador X Cliente",data:s}]})):a.find(".div_grafico_colaborador_x_cliente_usuario_empresa_filial").addClass("hidden")}(a)})},this.btn_show_filtros.unbind("click"),this.btn_show_filtros.click(function(){0==i.auxiliar?(i.div_filtros.fadeIn(500),i.auxiliar=!0):(i.div_filtros.fadeOut(300),i.auxiliar=!1)}),this.btn_refresh.unbind("click"),this.btn_refresh.click(function(){i.carregar_dados()}),this.btn_search.unbind("click"),this.btn_search.click(function(){i.carregar_dados()}),this.unload=function(){View.unload(this.html_id)}}});