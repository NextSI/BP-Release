define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.quadro_id=null,this.old_imagem_id=null,this.files=this.dialog.find(".files"),this.carrega_img=this.dialog.find(".carrega_img"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.show=function(i,t,l){a.tipo=i,a.quadro_id=t,a.old_imagem_id=l,a.permite_alterar();var e=cripto(WS.token);a.old_imagem_id&&a.carrega_img.attr("src",WS_URI+"documento/download/?documento_id="+a.old_imagem_id+"&token_publico="+e+"&tipo=S&acao=abrir"),show_modal(a.modal.attr("id")),set_focus(a.edt_senha_atual)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.preview_imagem=function(i){var t=i.target.files[0],l=new FileReader;l.onload=function(i){a.carrega_img.attr("src",i.target.result)},l.readAsDataURL(t)},this.permite_alterar=function(){switch(a.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:a.btn_salvar.show();break;case FORMULARIO.VISUALIZAR:a.btn_salvar.hide()}},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){var i=null;$.each(a.files,function(a,t){t.files.length>0&&(i=t.files[0])}),WS.post("tarefa_quadro/alterar_imagem",{tarefa_quadro_id:a.quadro_id,imagem_id:i},function(i){alert_saved("Imagem alterada com sucesso"),a.unload()},[a.files,a.btn_cancelar,a.btn_salvar],null,!0)}),a.files[0].addEventListener("change",a.preview_imagem,!1)}});