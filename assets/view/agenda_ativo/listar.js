define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title=App.lang.agenda_ativos.agenda_ativos,this.onclose=null,this.params={limite:0},this.params_template={limite:0,considerar_bloqueado:!1},this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_limite=!1,this.cbo_filtro_local=this.dialog.find(".cbo_filtro_local"),this.cbo_filtro_motivo=this.dialog.find(".cbo_filtro_motivo"),this.btn_novo=this.dialog.find(".btn_novo"),this.btn_atualizar=this.dialog.find(".btn_atualizar"),this.btn_limpar_filtros=this.dialog.find(".btn_limpar_filtros"),this.btn_ordenacao=this.dialog.find(".orderbypointer"),this.btn_filtro=this.dialog.find(".btn_filtro"),this.btn_config=this.dialog.find(".btn_config"),this.container_config=this.dialog.find("[config]"),this.chk_mostrar_bloqueados=this.dialog.find(".chk_mostrar_bloqueados"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.show=function(){i.inicializar_componentes(),i.listar(!0)},this.listar=function(a){if(void 0!==a&&"boolean"==typeof a||(a=!1),!i.bloqueia_limite){i.params.limite=i.limite,i.params.considerar_bloqueado=i.chk_mostrar_bloqueados.prop("checked");var t=function(a,t){t=extender_parametros({codigo:"-",nome:"-",agenda_local:"-",agenda_motivo:"-"},t);var o=$.Tabela_Padrao_Next.create_row(i.tab_listagem),n=($.Tabela_Padrao_Next.getColumn(o,"codigo").text(t.codigo),$.Tabela_Padrao_Next.getColumn(o,"nome").text(t.nome),$.Tabela_Padrao_Next.getColumn(o,"local").text(t.agenda_local),$.Tabela_Padrao_Next.getColumn(o,"motivo").text(t.agenda_motivo),$.Tabela_Padrao_Next.getColumn(o,"acao")),e=$.Tabela_Padrao_Next.getColumn(n,"btn_visualizar"),r=$.Tabela_Padrao_Next.getColumn(n,"btn_editar"),_=$.Tabela_Padrao_Next.getColumn(n,"btn_excluir");e.unbind("click").click(function(a){i.evento_visualizar($(this),t)}),r.unbind("click").click(function(a){i.evento_editar($(this),t)}),_.unbind("click").click(function(a){i.evento_excluir($(this),t)}),$.Tabela_Padrao_Next.RenderRow(i.tab_listagem,o)};WS.post({route:"agenda_ativo/listar/",type:"GET",data:i.params,func_response:function(o){if(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),o){a&&(i.limite=i.limite+i.limite_a_cada);for(var n=0;n<o.length;n++){var e=o[n];t(0,e)}0==o.length&&(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),i.bloqueia_limite=!0)}},html_id:i.html_id,disable_buttons:[i.btn_atualizar,i.btn_limpar_filtros]})}},this.limpar_tabela=function(){$.Tabela_Padrao_Next.clear(i.tab_listagem),i.params.limite=0,i.limite=0,i.bloqueia_limite=!1},this.unload=function(){View.unload(this.html_id)},this.listar_tipo_agenda=function(a){i.cbo_filtro_motivo.find(".opt_motivo").find("option").remove(),WS.get("tipo_agenda/listar/",null,function(t){for(var o=0;o<t.length;o++){var n=t[o];$(i.cbo_filtro_motivo).add_opt_to_group("opt_motivo",n.tipo_agenda_id,n.nome)}a&&i.cbo_filtro_motivo.val(a).trigger("change"),i.cbo_filtro_motivo.selectpicker("refresh")})},this.listar_local_agenda=function(a){i.cbo_filtro_local.find(".opt_local").find("option").remove(),WS.get("local_agenda/listar/",null,function(t){for(var o=0;o<t.data.length;o++){var n=t.data[o];$(i.cbo_filtro_local).add_opt_to_group("opt_local",n.id,n.nome)}a&&i.cbo_filtro_local.val(a).trigger("change"),i.cbo_filtro_local.selectpicker("refresh")})},this.inicializar_componentes=function(){i.listar_local_agenda(),i.listar_tipo_agenda(),i.container_config.toggle(!1);var a={local:{tipo:TABELA_PADRAO_BP_FILTRO.SELECT,todos_extension:!0},motivo:{tipo:TABELA_PADRAO_BP_FILTRO.SELECT,todos_extension:!0}};$.Tabela_Padrao_Next.Filtros.Start(i.tab_listagem,a,function(a,t,o){for(var n in a[o]=t,a)a[n]instanceof Array&&(a[n]=JSON.stringify(a[n]));i.params=extender_parametros(i.params_template,a),setTimeout(function(){i.evento_atualizar()},300)})},this.evento_atualizar=function(){i.limpar_tabela(),i.listar_tipo_agenda(void 0!==i.params.motivo?JSON.parse(i.params.motivo):[]),i.listar_local_agenda(void 0!==i.params.local?JSON.parse(i.params.local):[]),i.listar(!0)},this.evento_visualizar=function(a,t){View.load("agenda_ativo/detalhes",function(a,o){var n={tipo:FORMULARIO.VISUALIZAR,agenda_ativo_id:t.id};o.onclose=function(){i.evento_atualizar()},o.show(n)},View.ABA.SIM)},this.evento_editar=function(a,t){View.load("agenda_ativo/detalhes",function(a,o){var n={tipo:FORMULARIO.EDITAR,agenda_ativo_id:t.id};o.onclose=function(){i.evento_atualizar()},o.show(n)},View.ABA.SIM)},this.evento_excluir=function(a,t){View.load("agenda_ativo/detalhes",function(a,o){var n={tipo:FORMULARIO.EXCLUIR,agenda_ativo_id:t.id};o.onclose=function(){i.evento_atualizar()},o.show(n)},View.ABA.SIM)},this.func_organizacao=function(a,t){i.limpar_tabela(),i.params=i.params_template,i.params.orderby=a,i.params.asc=t,setTimeout(function(){i.listar(!0)},300)},this.btn_atualizar.unbind("click").click(function(a){i.evento_atualizar()}),this.btn_limpar_filtros.unbind("click").click(function(a){$.tabela_padrao_bp_filtro("clean",i.html_id,i.tab_listagem),i.chk_mostrar_bloqueados.prop("checked",!1).trigger("change"),i.params=i.params_template,i.listar_tipo_agenda(),i.listar_local_agenda(),i.limpar_tabela(),i.listar(!0)}),this.btn_novo.unbind("click").click(function(a){View.load("agenda_ativo/detalhes",function(a,t){t.onclose=function(){i.evento_atualizar()},t.show()},View.ABA.SIM)}),this.btn_ordenacao.unbind("click").click(function(a){var t=$(this),o=$(t).attr("data-ordername"),n=$(t).attr("data-asc");if(0===n.length){for(var e=0;e<i.btn_ordenacao.length;e++)if($(i.btn_ordenacao[e])!==$(t)){try{$(i.btn_ordenacao[e]).find(".icon_orderby").removeClass("fa-sort-up fa-sort-down").addClass("hidden fa-sort-down")}catch(a){}$(i.btn_ordenacao[e]).attr("data-asc","")}n=!0,$(t).attr("data-asc",n),$(t).find(".icon_orderby").removeClass("hidden")}else n=!(n="true"==n),$(t).attr("data-asc",n),$(t).find(".icon_orderby").toggleClass("fa-sort-down fa-sort-up");i.func_organizacao(o,n)}),this.btn_filtro.unbind("click").click(function(a){var t=$(this).prop("data-active");t=!t,$(this).prop("data-active",t),i.container_config.toggle(t)}),this.btn_config.unbind("click").click(function(a){View.load("agenda_ativo/configuracoes",function(a,i){i.show()},View.ABA.NAO)}),this.btn_carregar_mais.unbind("click").click(function(){i.bloqueia_limite||(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),i.listar(!0))})}});