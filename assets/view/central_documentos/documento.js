define(["react","react-dom","./ListarAprovadores","./../componentes_react/InputArquivo"],function(a,o,i,e){return function(t){"use strict";var r=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.title="Documento",this.tipo=null,this.tipo_anexo=null,this.onclose=null,this.onsave=null,this.ondelete=null,this.houve_alteracao=!1,this.lbl_tab_geral=this.dialog.find(".lbl_tab_geral"),this.menu_geral=this.dialog.find(".menu_geral"),this.painel_geral=this.dialog.find(".painel_geral"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.menu_seguranca=this.dialog.find(".menu_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.lbl_tab_observacoes=this.dialog.find(".lbl_tab_observacoes"),this.menu_observacoes=this.dialog.find(".menu_observacoes"),this.painel_observacoes=this.dialog.find(".painel_observacoes"),this.lbl_tab_aprovacoes=this.dialog.find(".lbl_tab_aprovacoes"),this.menu_aprovacoes=this.dialog.find(".menu_aprovacoes"),this.painel_aprovacoes=this.dialog.find(".painel_aprovacoes"),this.lbl_tab_distribuicoes=this.dialog.find(".lbl_tab_distribuicoes"),this.menu_distribuicoes=this.dialog.find(".menu_distribuicoes"),this.painel_distribuicoes=this.dialog.find(".painel_distribuicoes"),this.lbl_tab_revisoes=this.dialog.find(".lbl_tab_revisoes"),this.menu_revisoes=this.dialog.find(".menu_revisoes"),this.painel_revisoes=this.dialog.find(".painel_revisoes"),this.lbl_tab_historico=this.dialog.find(".lbl_tab_historico"),this.menu_log=this.dialog.find(".menu_log"),this.painel_historico=this.dialog.find(".painel_historico"),this.lbl_tab_notificacao=this.dialog.find(".lbl_tab_notificacao"),this.menu_notificacao=this.dialog.find(".menu_notificacao"),this.painel_notificacao=this.dialog.find(".painel_notificacao"),this.lbl_tab_referencias=this.dialog.find(".lbl_tab_referencias"),this.menu_referencias=this.dialog.find(".menu_referencias"),this.painel_referencias=this.dialog.find(".painel_referencias"),this.div_componente_referencias=this.dialog.find(".div_componente_referencias"),this.painel_novo_arquivo=this.dialog.find(".painel_novo_arquivo"),this.painel_nova_revisao=this.dialog.find(".painel_nova_revisao"),this.dx_listagem_documento_copia_controlada=this.dialog.find(".dx_listagem_documento_copia_controlada"),this.dx_listagem_documento_distribuicoes=this.dialog.find(".dx_listagem_documento_distribuicoes"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_observacao_revisao=this.dialog.find(".edt_observacao_revisao"),this.edt_observacao_novo=this.dialog.find(".edt_observacao_novo"),this.edt_observacoes_historico=this.dialog.find(".edt_observacoes_historico"),this.edt_tag=this.dialog.find(".edt_tag"),this.div_assunto=this.dialog.find(".div_assunto"),this.cbo_assunto=this.dialog.find(".cbo_assunto"),this.btn_assunto_visualizar=this.dialog.find(".btn_assunto_visualizar"),this.btn_assunto_novo=this.dialog.find(".btn_assunto_novo"),this.div_tipo_documento=this.dialog.find(".div_tipo_documento"),this.div_tipo_aprovacao=this.dialog.find(".div_tipo_aprovacao"),this.cbo_tipo_documento=this.dialog.find(".cbo_tipo_documento"),this.btn_tipo_documento_visualizar=this.dialog.find(".btn_tipo_documento_visualizar"),this.btn_tipo_documento_novo=this.dialog.find(".btn_tipo_documento_novo"),this.div_local_armazenamento=this.dialog.find(".div_local_armazenamento"),this.cbo_local_armazenamento=this.dialog.find(".cbo_local_armazenamento"),this.btn_local_armazenamento_visualizar=this.dialog.find(".btn_local_armazenamento_visualizar"),this.btn_local_armazenamento_novo=this.dialog.find(".btn_local_armazenamento_novo"),this.btn_favoritar_item=this.dialog.find(".btn_favoritar_item"),this.dx_selecao_pasta=this.dialog.find(".dx_selecao_pasta"),this.div_novo_arquivo=this.dialog.find(".div_novo_arquivo"),this.inputArquivoNovo=a.createElement(e,null,null),this.lbl_tab_revisoes=this.dialog.find(".lbl_tab_revisoes"),this.painel_revisoes=this.dialog.find(".painel_revisoes"),this.tab_revisoes=this.dialog.find(".tab_revisoes"),this.th_aprovacao=this.dialog.find(".th_aprovacao"),this.lbl_tab_nova_revisao=this.dialog.find(".lbl_tab_nova_revisao"),this.div_nova_revisao=this.dialog.find(".div_nova_revisao"),this.inputNovaRevisao=a.createElement(e,null,null),this.painel_historico=this.dialog.find(".painel_historico"),this.painel_aprovacoes=this.dialog.find(".painel_aprovacoes"),this.tab_historico=this.dialog.find(".tab_historico"),this.tab_aprovacoes=this.dialog.find(".tab_aprovacoes"),this.cbo_usuario=this.dialog.find(".cbo_usuario"),this.cbo_acao=this.dialog.find(".cbo_acao"),this.btn_limpar_filtros=this.dialog.find(".btn_limpar_filtros"),this.lbl_tab_seguranca=this.dialog.find(".lbl_tab_seguranca"),this.painel_seguranca=this.dialog.find(".painel_seguranca"),this.chk_controle_acessos=this.dialog.find(".chk_controle_acessos"),this.chk_notificacoes=this.dialog.find(".chk_notificacoes"),this.chk_notificar_email_antes=this.dialog.find(".chk_notificar_email_antes"),this.chk_notificacao_outros_usuarios=this.dialog.find(".chk_notificacao_outros_usuarios"),this.chk_notificacao_seguranca=this.dialog.find(".chk_notificacao_seguranca"),this.chk_notificacao_aprovador=this.dialog.find(".chk_notificacao_aprovador"),this.chk_copia_controlada=this.dialog.find(".chk_copia_controlada"),this.div_permissoes=this.dialog.find(".div_permissoes"),this.div_emails_adicionais=this.dialog.find(".div_emails_adicionais"),this.div_notificacao_vigencia=this.dialog.find(".div_notificacao_vigencia"),this.tab_permissoes=this.dialog.find(".tab_permissoes"),this.tab_permissoes_grupo=this.dialog.find(".tab_permissoes_grupo"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_add_usuario=this.dialog.find(".btn_add_usuario"),this.btn_add_grupo=this.dialog.find(".btn_add_grupo"),this.btn_download_revisao_atual=this.dialog.find(".btn_download_revisao_atual"),this.btn_historico_assinatura=this.dialog.find(".btn_historico_assinatura"),this.btn_group_visualizar_revisao_atual=this.dialog.find(".btn_group_visualizar_revisao_atual"),this.btn_visualizar_revisao_atual=this.dialog.find(".btn_visualizar_revisao_atual"),this.btn_download_revisao_atual_2=this.dialog.find(".btn_download_revisao_atual_2"),this.menu_visualizar_revisao_atual_google_docs=this.dialog.find(".menu_visualizar_revisao_atual_google_docs"),this.btn_visualizar_revisao_atual_google_docs=this.dialog.find(".btn_visualizar_revisao_atual_google_docs"),this.menu_visualizar_revisao_atual_office_365=this.dialog.find(".menu_visualizar_revisao_atual_office_365"),this.btn_visualizar_revisao_atual_office_365=this.dialog.find(".btn_visualizar_revisao_atual_office_365"),this.btn_assinaturas_clicksign=this.dialog.find(".btn_assinaturas_clicksign"),this.btn_assinaturas_certsign=this.dialog.find(".btn_assinaturas_certsign"),this.btn_assinaturas_d4sign=this.dialog.find(".btn_assinaturas_d4sign"),this.div_codigo=this.dialog.find(".div_codigo"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_validade=this.dialog.find(".edt_validade"),this.edt_dias_notitificacao=this.dialog.find(".edt_dias_notitificacao"),this.cbo_validade_periodo=this.dialog.find(".cbo_validade_periodo"),this.edt_data_vigencia=this.dialog.find(".edt_data_vigencia"),this.div_edt_prazo_dias=this.dialog.find(".div_edt_prazo_dias"),this.edt_prazo_dias=this.dialog.find(".edt_prazo_dias"),this.div_ListarAprovadores=this.dialog.find(".listarAprovadores"),this.ListarAprovadores=a.createElement(i,null,null),this.cbo_tipo_aprovacao=this.dialog.find(".cbo_tipo_aprovacao"),this.cbo_selecionar_alcada=this.dialog.find(".cbo_selecionar_alcada"),this.div_cbo_selecionar_alcada=this.dialog.find(".div_cbo_selecionar_alcada"),this.div_cbo_aprovador=this.dialog.find(".div_cbo_aprovador"),this.cbo_aprovador=this.dialog.find(".cbo_aprovador"),this.panel_central_documentos=this.dialog.find(".panel_central_documentos"),this.content_central_documentos=this.dialog.find(".content_central_documentos"),this.doc_rev_reprovado=this.dialog.find(".doc_rev_reprovado"),this.doc_rev_pendente=this.dialog.find(".doc_rev_pendente"),this.doc_bloqueado=this.dialog.find(".doc_bloqueado"),this.div_carregar_mais_historico=this.dialog.find(".div_carregar_mais_historico"),this.btn_carregar_mais_historico=this.dialog.find(".btn_carregar_mais_historico"),this.div_carregar_mais_aprovacoes=this.dialog.find(".div_carregar_mais_aprovacoes"),this.btn_carregar_mais_aprovacoes=this.dialog.find(".btn_carregar_mais_aprovacoes"),this.cbo_usuario_historico_aprovacoes=this.dialog.find(".cbo_usuario_historico_aprovacoes"),this.cbo_situacao_historico_aprovacoes=this.dialog.find(".cbo_situacao_historico_aprovacoes"),this.cbo_origem_historico_aprovacoes=this.dialog.find(".cbo_origem_historico_aprovacoes"),this.ipt_revisao_historico_aprovacoes=this.dialog.find(".ipt_revisao_historico_aprovacoes"),this.ipt_nivel_historico_aprovacoes=this.dialog.find(".ipt_nivel_historico_aprovacoes"),this.ipt_consideracoes_historico_aprovacoes=this.dialog.find(".ipt_consideracoes_historico_aprovacoes"),this.ipt_recebimento_data=this.dialog.find(".ipt_recebimento_data"),this.ipt_acao_data=this.dialog.find(".ipt_acao_data"),this.ipt_prazo_data=this.dialog.find(".ipt_prazo_data"),this.aprovacoes_historico=this.dialog.find(".aprovacoes_historico"),this.aprovacoes_configuracoes=this.dialog.find(".aprovacoes_configuracoes"),this.distribuicoes_historico=this.dialog.find(".distribuicoes_historico"),this.distribuicoes_configuracoes=this.dialog.find(".distribuicoes_configuracoes"),this.btn_aprovacoes_historico=this.dialog.find(".btn_aprovacoes_historico"),this.btn_aprovacoes_configuracoes=this.dialog.find(".btn_aprovacoes_configuracoes"),this.btn_distribuicoes_historico=this.dialog.find(".btn_distribuicoes_historico"),this.btn_distribuicoes_configuracoes=this.dialog.find(".btn_distribuicoes_configuracoes"),this.documento=null,this.grupos=new Object,this.grupos_array=new Array,this.usuarios={automatic:!1,add_self:!1},this.usuarios_array=new Array,this.dataGrid_distribuicao_controlada=null,this.dados_distribuicao_controlada={},this.dataGrid_distribuicoes=null,this.valor=null,this.documento_id=null,this.documento_pasta_id=null,this.nova_revisao=!1,this.permite_alterar_seguranca=!1,this.atividade_id=null,this.projeto_id=null,this.solicitacao_atividade_id=null,this.solicitacao_id=null,this.oportunidade_id=null,this.observacoes=!1,this.arr_historico=null,this.pasta_notificacao=null,this.usuario_historico=null,this.acao_historico=null,this.solicitacao_numero="",this.nome_processo="",this.nome_campo="",this.nome_padrao="",this.versoes=[],this.permitir_exclusao=!0,this.codigo_documento=!1,this.informar_codigo_documento_pasta=!1,this.codigo_pasta="",this.usuario_permissao_escrita=null,this.documento_parametros=null,this.documento_bloqueado=null,this.limite=0,this.limite_quantidade=50,this.todos_carregados=!1,this.param_inicial_aprovacoes=0,this.param_qtde_aprovacoes=50,this.param_todos_carregados_aprovacoes=!1,this.referencia_tabela=null,this.referencia_id=null,this.filtro_historico_aprovacoes_usuario_id,this.filtro_historico_aprovacoes_situacao,this.filtro_historico_aprovacoes_revisao,this.filtro_historico_aprovacoes_nivel,this.filtro_historico_aprovacoes_consideracoes,this.filtro_historico_aprovacoes_origem,this.filtro_historico_aprovacoes_recebimento_data,this.filtro_historico_aprovacoes_acao_data,this.documento_confirmacao_distribuicao=a.createElement(e,null,null),this.visualizar_versoes_documento=!0,this.tab_email_usuarios={tabela:this.dialog.find(".tab_email_usuarios"),header:this.dialog.find(".tab_email_usuarios_header"),input:this.dialog.find(".tab_email_usuarios_header thead .edt_emails"),btn_add:this.dialog.find(".tab_email_usuarios_header thead .btn_add_email"),bp_drop:this.dialog.find(".tab_email_usuarios_header thead .bp_div_drop > ul"),create_row:function(a){var o=$(this.tabela).find("[template-row]").clone();return o.removeAttr("template-row").removeClass("hidden"),o.find(".lbl_email").text(a),o.appendTo(this.tabela.find("tbody")),o},getColumn:function(a,o){return $(a).find("."+o)},elem_key:0,arr_dados:[],add_email:function(a,o){var i,e,t=this.arr_dados;if(i=a.email,e=!1,t.filter(function(a){a.email==i&&(e=!0)}),!(!e&&a.email.trim().length>0&&validateEmail(a.email)))return validateEmail(a.email)?void(void 0!==o&&null!=o&&o(!1)):void alert_modal("Alerta","O e-mail inserido está inválido.");t.push({elem_key:a.elem_key,email:a.email}),void 0!==o&&null!=o&&o(!0)},remove_email:function(a,o){var i=this.arr_dados;i.filter(function(o,e){o.elem_key==a&&i.splice(e,1)})},reset:function(){$(this.tabela).find("tbody").find("tr:not([template-row])").remove(),this.elem_key=0,this.arr_dados=[]}},this.anexos=[],this.pdca_id=null,this.pdca_atividade_id=null,this.tarefa_quadro_lista_cartao_id=null,this.download_url_dialog=null,this.show=function(a,i,e,t,s,n,d,c,_,l,u,p,v,m,h,f){verifica_favorito("documentos",a)&&r.btn_favoritar_item.find("span").addClass("glyphicon-star").removeClass("glyphicon-star-empty"),r.painel_geral.attr("id","painel_geral"+r.html_id),r.painel_seguranca.attr("id","painel_seguranca"+r.html_id),r.painel_observacoes.attr("id","painel_observacoes"+r.html_id),r.painel_aprovacoes.attr("id","painel_aprovacoes"+r.html_id),r.painel_distribuicoes.attr("id","painel_distribuicoes"+r.html_id),r.painel_revisoes.attr("id","painel_revisoes"+r.html_id),r.painel_historico.attr("id","painel_historico"+r.html_id),r.painel_notificacao.attr("id","painel_notificacao"+r.html_id),r.painel_referencias.attr("id","painel_referencias"+r.html_id),r.menu_geral.attr("href","#"+r.painel_geral.attr("id")),r.menu_seguranca.attr("href","#"+r.painel_seguranca.attr("id")),r.menu_observacoes.attr("href","#"+r.painel_observacoes.attr("id")),r.menu_aprovacoes.attr("href","#"+r.painel_aprovacoes.attr("id")),r.menu_distribuicoes.attr("href","#"+r.painel_distribuicoes.attr("id")),r.menu_revisoes.attr("href","#"+r.painel_revisoes.attr("id")),r.menu_log.attr("href","#"+r.painel_historico.attr("id")),r.menu_notificacao.attr("href","#"+r.painel_notificacao.attr("id")),r.menu_referencias.attr("href","#"+r.painel_referencias.attr("id")),r.tipo=i,r.tipo_anexo=p,r.codigo_pasta=v,o.render(r.inputArquivoNovo,r.div_novo_arquivo[0]),o.render(r.inputNovaRevisao,r.div_nova_revisao[0]),r.inputArquivoNovo.props.handleAlterado=this.inputArquivoNovoHandleAlterado,r.inputNovaRevisao.props.handleAlterado=this.inputNovaRevisaoHandleAlterado,WS.get("documento/get_parametros/",null,function(o){r.documento_parametros=o,r.informar_codigo_documento_pasta="N"!=o.documentos_informar_codigo_documento_pasta,r.permitir_exclusao="N"!=o.documentos_permitir_exclusao,1==r.informar_codigo_documento_pasta?(r.div_codigo.removeClass("hidden"),r.edt_codigo.attr("required",!0)):r.edt_nome.parent().parent().toggleClass("col-md-8 col-md-12"),r.carregamento_inicial(a,i,e,t,s,n,d,c,_,l,u,p,v,h,m,f)})},this.carregamento_inicial=function(a,o,i,e,t,s,n,d,c,_,l,u,p,v,m,h){r.solicitacao_numero=n,r.nome_processo=l,void 0!==h&&h&&(r.tarefa_quadro_lista_cartao_id=h),void 0!==m&&m&&(r.pdca_atividade_id=m.pdca_atividade_id),void 0!==v&&v&&(r.pdca_id=v),void 0!==i&&i&&(r.documento_pasta_id=i),void 0!==e&&e&&(r.nova_revisao=e),void 0!==n&&n&&(r.solicitacao_id=n),void 0!==d&&d&&(r.solicitacao_atividade_id=d),void 0!==c&&c&&(r.oportunidade_id=c),void 0!==t&&t&&(r.projeto_id=t),void 0!==s&&s&&(r.atividade_id=s),create_combobox(r.cbo_aprovador,r.listar_grupos_usuarios),r.RenderAprovadores(),void 0!==a&&a?(r.documento_id=a,r.lbl_tab_seguranca.addClass("hidden"),r.preencher()):(App.titulo_aba(r.html_id,"Novo documento"),void 0!==i&&i?(r.preencher_padroes(),r.renderizar_dx_selecao_pasta(i)):(r.listar_assunto(),r.listar_tipo_documento()),r.chk_notificacoes.prop("checked",r.pasta_notificacao||!1).change(),App.sessao.dados.admin||(r.usuarios=App.sessao.dados,r.usuarios.visualizacao=!0,r.usuarios.download=!0,r.usuarios.escrita=!0,r.usuarios.exclusao=!0,r.usuarios.revisao=!0,r.usuarios.seguranca=!0,r.usuarios.automatic=!0,r.usuarios_array.push(r.usuarios)),r.listar_local_armazenamento(),r.permite_alterar(),r.preencher_distribuicoes([])),r.listar_copia_controlada(),void 0!==_&&_&&(r.observacoes=_),r.ajusto_componentes(),r.listar_filtro_historico_aprovacoes()},this.close=function(){void 0!==r.onclose&&r.onclose&&r.onclose(r.houve_alteracao)},this.unload=function(){r.close(),View.unload(this.html_id)},this.permite_alterar=function(){var a=!1;switch(r.tipo){case FORMULARIO.NOVO:r.btn_salvar.show(),a=!0,r.valor=!0,WS.get("documento/ultimo_codigo/",{documento_pasta_id:r.documento_pasta_id},function(a){r.edt_codigo.val(a)}),r.permite_alterar_seguranca=!0,r.btn_favoritar_item.hide();break;case FORMULARIO.EDITAR:r.btn_salvar.show(),a=!0,r.valor=!0,r.permite_alterar_seguranca=!0;break;case FORMULARIO.VISUALIZAR:r.btn_salvar.hide(),a=!1,r.valor=!1,r.permite_alterar_seguranca=!1}r.edt_nome.prop("readonly",!a),r.edt_observacao_revisao.prop("readonly",!a),r.edt_observacao_novo.prop("readonly",!a),r.edt_tag.prop("readonly",!a),r.cbo_assunto.prop("disabled",!a),r.btn_add_grupo.prop("disabled",!a),r.btn_add_usuario.prop("disabled",!a),r.btn_assunto_novo.prop("disabled",!a),r.cbo_tipo_documento.prop("disabled",!a),r.btn_tipo_documento_novo.prop("disabled",!a),r.chk_controle_acessos.prop("disabled",!a),r.chk_notificacao_seguranca.prop("disabled",!a),r.exibicao_validade_vigencia(),r.usuario_permissao_escrita||r.tipo==FORMULARIO.NOVO?(r.panel_central_documentos.css("opacity","1").css("cursor","auto"),r.content_central_documentos.css("pointer-events","auto")):r.lbl_tab_revisoes.parent().click(function(){setTimeout(function(){r.lbl_tab_revisoes.hasClass("active")||r.lbl_tab_historico.hasClass("active")||r.lbl_tab_aprovacoes.hasClass("active")?(r.panel_central_documentos.css("opacity","1").css("cursor","auto"),r.content_central_documentos.css("pointer-events","auto")):(r.panel_central_documentos.css("opacity","0.7").css("cursor","not-allowed"),r.content_central_documentos.css("pointer-events","none"))})})},this.ajusto_componentes=function(){switch(r.tipo){case FORMULARIO.NOVO:r.painel_novo_arquivo.show(),r.inputArquivoNovo.props.setDesabilitado(!1),r.painel_nova_revisao.hide(),r.lbl_tab_revisoes.hide(),r.lbl_tab_historico.hide(),r.lbl_tab_nova_revisao.hide(),r.lbl_tab_seguranca.hide(),r.lbl_tab_geral.find("a").tab("show");break;case FORMULARIO.EDITAR:r.painel_novo_arquivo.hide(),r.painel_nova_revisao.show(),r.lbl_tab_revisoes.show(),r.lbl_tab_historico.show(),r.lbl_tab_nova_revisao.show(),r.inputNovaRevisao.props.setDesabilitado(!1),r.lbl_tab_seguranca.show(),r.nova_revisao?r.lbl_tab_nova_revisao.find("a").tab("show"):r.observacoes?r.lbl_tab_observacoes.find("a").tab("show"):r.lbl_tab_geral.find("a").tab("show")}App.verifica_permissao(App.temp.empresa,"assunto")||(r.btn_assunto_novo.hide(),r.btn_assunto_visualizar.hide(),r.div_assunto.removeClass("input-group")),App.verifica_permissao(App.temp.empresa,"tipo_documento")||(r.btn_tipo_documento_novo.hide(),r.btn_tipo_documento_visualizar.hide(),r.div_tipo_documento.removeClass("input-group")),App.verifica_permissao(App.temp.empresa,"local_armazenamento")||(r.btn_local_armazenamento_novo.hide(),r.btn_local_armazenamento_visualizar.hide(),r.div_local_armazenamento.removeClass("input-group"))},this.consultar_ultima_revisao=function(a){if(r.btn_group_visualizar_revisao_atual.hide(),r.btn_download_revisao_atual.hide(),r.menu_visualizar_revisao_atual_google_docs.hide(),r.menu_visualizar_revisao_atual_office_365.hide(),a.documento_revisao_id>0)if("application/pdf"==a.revisao_mime_type&&!detectmob()||"image/png"==a.revisao_mime_type||"image/bmp"==a.revisao_mime_type||"image/jpeg"==a.revisao_mime_type||"image/jpg"==a.revisao_mime_type||"image/gif"==a.revisao_mime_type){if(r.btn_group_visualizar_revisao_atual.show(),r.usuario_permissao_download?(r.btn_download_revisao_atual_2.unbind("click"),r.btn_download_revisao_atual_2.click(function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&r.unload()})};"S"==r.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()})):r.btn_group_visualizar_revisao_atual.find(".dropdown-toggle").addClass("hidden"),"application/pdf"==a.revisao_mime_type)var o=function(){View.load("central_documentos/visualizar_pdf",function(o,i){i.show(a.documento_revisao_id,null,null,"S",a.aprovacao_ultima_rev,r.documento_bloqueado,null,r.usuario_permissao_download)})};else o=function(){View.load("central_documentos/visualizar_documento",function(o,i){i.show(a.documento_revisao_id,a.id,"S","S",r.documento_bloqueado,a.controle_distribuicao,r.usuario_permissao_download)})};r.btn_visualizar_revisao_atual.unbind("click"),r.btn_visualizar_revisao_atual.click(o)}else if(MIME_TYPE_OFFICE.indexOf(a.revisao_mime_type)>=0){var i=function(){App.obter_token_publico(function(o){var i=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname,e=i.indexOf("index.html");e>0&&(i=i.substring(0,e)),i+="/webservice/index.php/documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o+"&acao=abrir";var t="https://docs.google.com/viewer?embedded=true&url="+encodeURIComponent(i);window.open(t,"_blank")})};if(r.usuario_permissao_download){r.btn_group_visualizar_revisao_atual.show(),r.btn_download_revisao_atual.show(),r.btn_visualizar_revisao_atual.hide(),r.btn_download_revisao_atual_2.hide(),r.menu_visualizar_revisao_atual_google_docs.show(),r.menu_visualizar_revisao_atual_office_365.show(),r.btn_visualizar_revisao_atual_google_docs.click(i),r.btn_visualizar_revisao_atual_office_365.click(function(){App.obter_token_publico(function(o){var i=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname,e=i.indexOf("index.html");e>0&&(i=i.substring(0,e)),i+="/webservice/index.php/documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o+"&acao=abrir";var t="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(i);window.open(t,"_blank")})});var e=function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&r.unload()})};"S"==r.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()};r.btn_download_revisao_atual.unbind("click"),r.btn_download_revisao_atual.click(e),extensao_valida(a.revisao_nome,extensoes_validas_assinatura)&&(void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.certsign_ativo&&(r.btn_assinaturas_certsign.show(),r.btn_assinaturas_certsign.unbind("click"),r.btn_assinaturas_certsign.bind("click",function(){View.load("certsign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.SIM)})),void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.clicksign_ativo&&(r.btn_assinaturas_clicksign.show(),r.btn_assinaturas_clicksign.unbind("click"),r.btn_assinaturas_clicksign.bind("click",function(){View.load("clicksign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.SIM)})),void 0!==App.sessao.dados.parametro_documento&&"S"==App.sessao.dados.parametro_documento.d4sign_ativo&&(r.btn_assinaturas_d4sign.show(),r.btn_assinaturas_d4sign.unbind("click"),r.btn_assinaturas_d4sign.bind("click",function(){View.load("d4sign/detalhes",function(o,i){i.show(a.documento_revisao_id)},View.ABA.MULTIPLAS)})))}else r.btn_group_visualizar_revisao_atual.show(),r.btn_group_visualizar_revisao_atual.find(".dropdown-toggle").addClass("hidden"),r.btn_visualizar_revisao_atual.unbind("click"),r.btn_visualizar_revisao_atual.click(i)}else a.documento_revisao_id&&r.usuario_permissao_download&&(r.btn_download_revisao_atual.show(),r.btn_historico_assinatura.show(),e=function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o),"safari"!=getBrowser()&&r.unload()})};"S"==r.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()},r.btn_download_revisao_atual.unbind("click"),r.btn_download_revisao_atual.click(e),r.btn_historico_assinatura.unbind("click"),r.btn_historico_assinatura.click(function(){View.load("clicksign/detalhes",function(o,i){i.show(a.documento_revisao_id,a),i.onclose=null},View.ABA.SIM)}))},this.preencher_padroes=function(a){void 0===a&&(a=null),r.documento_pasta_id&&WS.get("documento_pasta/objeto/",{documento_pasta_id:r.documento_pasta_id},function(o){r.tipo==FORMULARIO.NOVO&&o.usuario_permissao_seguranca?r.lbl_tab_seguranca.show():a&&(o.usuario_permissao_seguranca?r.lbl_tab_seguranca.show():r.lbl_tab_seguranca.hide()),null==o.tags_padrao&&""==o.tags_padrao||r.edt_tag.val(o.tags_padrao),null==o.assunto_id&&""==o.assunto_id||r.listar_assunto(o.assunto_id),null==o.tipo_documento_id&&""==o.tipo_documento_id||r.listar_tipo_documento(o.tipo_documento_id)})},this.preencher=function(){WS.get("documento/objeto/",{documento_id:r.documento_id},function(a){if(r.documento=a,App.titulo_aba(r.html_id,"Documento "+a.nome),r.documento_bloqueado=a.bloqueado,"S"==r.documento_bloqueado&&(r.div_nova_revisao.css("pointer-events","none"),r.div_nova_revisao.parent().css("opacity","0.7").css("cursor","not-allowed"),r.doc_bloqueado.show(),r.doc_bloqueado.append("<br /> Motivo do bloqueio: "+a.motivo_bloqueio)),r.usuario_permissao_visualizacao=a.usuario_permissao_visualizacao,r.usuario_permissao_download=a.usuario_permissao_download,r.usuario_permissao_escrita=a.usuario_permissao_escrita,r.usuario_permissao_revisao=a.usuario_permissao_revisao,r.usuario_permissao_exclusao=a.usuario_permissao_exclusao,r.usuario_permissao_seguranca=a.usuario_permissao_seguranca,r.permite_alterar(),App.sessao.dados.admin||r.usuario_permissao_escrita||r.usuario_permissao_seguranca||r.btn_salvar.hide(),r.cbo_usuario.SelectMultiColumn({route:"usuario/listar/",params:null,arr_cols:["Nome"],arr_campos:["nome"],campo_value:"nome",habilitar_novo:!1,OnKeyUp:function(a,o){var i={nome:r.cbo_usuario.SelectMultiColumn("EdtVal")};r.cbo_usuario.SelectMultiColumn("UpdateParams",i),13==a.which&&(""==a.currentTarget.value&&r.cbo_usuario.SelectMultiColumn("original"),r.usuario_historico=a.currentTarget.value,r.render_historico(r.arr_historico,!0),r.limite=0,r.todos_carregados=!1)},OnClickOverRow:function(a,o){r.usuario_historico=o,r.render_historico(r.arr_historico,!0),r.limite=0,r.todos_carregados=!1}}),App.sessao.dados.admin||"N"!=a.controle_acessos&&!1!==a.controle_acessos?r.usuarios_array=a.usuarios_permissoes:(r.usuarios=App.sessao.dados,r.usuarios.visualizacao=!0,r.usuarios.download=!0,r.usuarios.escrita=!0,r.usuarios.exclusao=!0,r.usuarios.revisao=!0,r.usuarios.seguranca=!0,r.usuarios.automatic=!0,r.usuarios_array.push(r.usuarios)),r.render_usuarios(),r.grupos_array=a.grupos_permissoes,r.render_grupos(),r.documento_pasta_id=a.documento_pasta_id,r.edt_nome.val(a.nome),1==r.informar_codigo_documento_pasta&&(r.tipo,FORMULARIO.NOVO),r.edt_codigo.val(a.codigo),r.edt_validade.val(a.validade),r.cbo_validade_periodo.val(a.validade_periodo),set_datepicker(r.edt_data_vigencia,a.data_vigencia),r.exibicao_validade_vigencia(!1),r.edt_observacao_revisao.val(null),r.edt_observacoes_historico.html(a.observacao_documento.replace(/\n\r?/g,"<br />")),r.edt_tag.val(a.tag),r.listar_assunto(a.assunto_id),r.listar_tipo_documento(a.tipo_documento_id),r.listar_local_armazenamento(a.local_armazenamento_id),r.render_revisoes(a),r.render_aprovacoes(a.historico_aprovacoes),r.preencher_distribuicoes(a.distribuicao_controlada_responsaveis),r.arr_historico=a.historico,r.render_historico(r.arr_historico,!0),r.limite=0,r.todos_carregados=!1,r.atividade_id=a.projeto_atividade_id,r.projeto_id=a.projeto_id,r.solicitacao_atividade_id=a.solicitacao_atividade_id,r.solicitacao_id=a.solicitacao_id,r.oportunidade_id=a.oportunidade_id,r.consultar_ultima_revisao(a),r.cbo_tipo_aprovacao.val(a.tipo_aprovacao).trigger("change"),r.cbo_tipo_aprovacao.selectpicker("refresh"),null!=a.alcada_generica_id&&a.alcada_generica_id>0?r.alcada_generica_id=a.alcada_generica_id:r.alcada_generica_id=null,r.chk_controle_acessos.prop("checked",a.controle_acessos).change(),a.usuarios_permissoes&&a.grupos_permissoes&&r.lbl_tab_seguranca.removeClass("hidden"),r.chk_copia_controlada.prop("checked",a.utilizar_controle_distribuicao).change(),r.chk_notificacoes.prop("checked",a.notificar_por_email||!1).change(),r.chk_notificar_email_antes.prop("checked",a.notificar_por_email_antes||!1).change(),r.edt_dias_notitificacao.val(a.dias_notificacao_email),r.chk_notificacao_seguranca.prop("checked",a.notificar_por_controle_acesso).change(),r.chk_notificacao_aprovador.prop("checked",a.notificar_por_controle_aprovacao).change(),a.notificar_por_email&&a.notificar_emails.length>0){r.chk_notificacao_outros_usuarios.prop("checked",!0).trigger("click");for(var o=0;o<a.notificar_emails.length;o++){var i=a.notificar_emails[o];r.tab_email_usuarios.input.val(i),r.tab_email_usuarios.btn_add.trigger("click")}}r.edt_prazo_dias.val(a.prazo_dias),r.renderizar_dx_selecao_pasta(a.documento_pasta_id)})},this.render_historico=function(a,o){r.div_carregar_mais_historico.removeClass("hidden"),a.length+1<r.limite_quantidade?(r.btn_carregar_mais_historico.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),r.btn_carregar_mais_historico.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_historico.append('<span class="icn_carregar_mais fa fa-check"></span>'),r.todos_carregados=!0):(r.btn_carregar_mais_historico.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),r.btn_carregar_mais_historico.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_historico.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'));var i=r.tab_historico.find("tbody"),e=i.find("tr:first");o&&$(i).find("tr:not([template-row])").remove(),$(a).each(function(a,o){!function(a){if(!(void 0!==r.acao_historico&&null!=r.acao_historico&&a.acao!=r.acao_historico&&r.acao_historico>-1||void 0!==r.usuario_historico&&null!=r.usuario_historico&&a.usuario_nome!=r.usuario_historico&&""!=r.usuario_historico)){var o=e.clone();o.removeAttr("template-row"),o.css("display",""),o.find(".lbl_acao").text(AcaoDocumentoNome(a.acao)),o.find(".lbl_detalhes").text(a.detalhes),o.find(".lbl_usuario").text(a.usuario_nome),o.find(".lbl_data").text(a.quando.format_date_time()),o.appendTo(i)}}(o)})},this.render_aprovacoes=function(a){var o=r.tab_aprovacoes.find("tbody"),i=o.find("tr:first");WS.get("documento/listar_historico_aprovacoes/",{documento_id:r.documento_id,usuario_id:r.filtro_historico_aprovacoes_usuario_id,situacao:r.filtro_historico_aprovacoes_situacao,revisao:r.filtro_historico_aprovacoes_revisao,nivel:r.filtro_historico_aprovacoes_nivel,consideracoes:r.filtro_historico_aprovacoes_consideracoes,origem:r.filtro_historico_aprovacoes_origem,recebimento_data:r.filtro_historico_aprovacoes_recebimento_data,acao_data:r.filtro_historico_aprovacoes_acao_data,prazo_data:r.filtro_historico_aprovacoes_prazo_data,limite:r.param_inicial_aprovacoes,limite_quantidade:r.param_qtde_aprovacoes},function(e){e&&(a&&r.tab_aprovacoes.find("tbody > tr:not([template-row])").remove(),r.div_carregar_mais_aprovacoes.removeClass("hidden"),e.length<r.param_qtde_aprovacoes?(r.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),r.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-check"></span>'),r.param_todos_carregados_aprovacoes=!0):(r.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),r.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>')),$.each(e,function(a,e){!function(a){var e=i.clone();e.removeAttr("template-row"),e.css("display","");var t=e.find(".lbl_usuario");null!=a.nome?(t.html('<img style="height: 20px; width: 20px; margin-right:5px;" class="imagem_usuario pull-left"/>'),null!=a.foto_id?t.find("img").attr("src",WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id+"&token_midia="+App.sessao.token_midia):t.find("img").attr("src","assets/img/imagem_usuario_padrao.svg"),a.nome!==a.nome_responsavel&&(t.attr("data-container","body"),null!=a.foto_id_responsavel?t.tooltip({title:'<img style="height: 18px;width: 18px;background: white;margin-right:5px;" class="imagem_usuario pull-left" src='+WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id_responsavel+"&token_midia="+App.sessao.token_midia+"> Responsável: "+a.nome_responsavel,placement:"bottom",html:!0}):t.tooltip({title:'<img style="height: 18px;width: 18px;background: white;margin-right:5px;" class="imagem_usuario pull-left" src="assets/img/imagem_usuario_padrao.svg"> Responsável: '+a.nome_responsavel,placement:"bottom",html:!0})),t.append(a.nome)):(t.html('<img style="height: 20px; width: 20px; margin-right:5px;" class="imagem_usuario pull-left"/>'),null!=a.foto_id_responsavel?t.find("img").attr("src",WS_URI+"documento/midia/?&tamanho=20&documento_id="+a.foto_id_responsavel+"&token_midia="+App.sessao.token_midia):t.find("img").attr("src","assets/img/imagem_usuario_padrao.svg"),t.append(a.nome_responsavel));var r=e.find(".lbl_situacao");"S"==a.excluido?r.html('<span class="label label-default">Excluido</span>'):a.situacao==GED_APROVACAO_SITUACAO.AGUARDANDO?r.html('<span class="label label-warning">Aguardando</span>'):a.situacao==GED_APROVACAO_SITUACAO.APROVADO?r.html('<span class="label label-success">Aprovado</span>'):a.situacao==GED_APROVACAO_SITUACAO.REPROVADO?r.html('<span class="label label-danger">Reprovado</span>'):a.situacao==GED_APROVACAO_SITUACAO.APROVADO_POR_TERCEIRO?r.html('<span class="label label-success">Aprovado por Terceiro</span>'):a.situacao==GED_APROVACAO_SITUACAO.REPROVADO_POR_TERCEIRO?r.html('<span class="label label-danger">Reprovado por Terceiro</span>'):a.situacao==GED_APROVACAO_SITUACAO.AGUARDANDO_NIVEL&&r.html('<span class="label label-warning">Aguardando Alçada</span>'),e.find(".lbl_dt_inicio_aprovacao").html("<span>"+(a.recebimento_data?a.recebimento_data.format_date_time():"")+"</span>"),e.find(".lbl_dt_prazo_aprovacao").html("<span>"+(a.prazo_data?a.prazo_data.format_date_time():"")+"</span>"),e.find(".lbl_dt_fim_aprovacao").html("<span>"+(a.acao_data?a.acao_data.format_date_time():"")+"</span>"),e.find(".lbl_nivel_alcada").html("<span>"+a.nivel+"</span>"),e.find(".lbl_revisao").html("<span>"+a.revisao+"</span>");var s=e.find(".lbl_tipo_origem");a.tipo_origem==GED_TIPO_ORIGEM.PASTA?(s.html('<i class="fa fa-folder tipo_origem" aria-hidden="true"></i>'),s.find(".tipo_origem").tooltip({title:"Aprovação foi originada da pasta.",placement:"auto"})):a.tipo_origem==GED_TIPO_ORIGEM.DOCUMENTO&&(s.html('<i class="fa fa-file tipo_origem" aria-hidden="true"></i>'),s.find(".tipo_origem").tooltip({title:"Aprovação foi originada do documento.",placement:"auto"}));var n=e.find(".lbl_consideracoes");null!=a.consideracoes&&""!=a.consideracoes?(n.html('<i class="fa fa-comments consideracoes" aria-hidden="true"></i>'),n.find(".consideracoes").tooltip({title:a.consideracoes.length>100?a.consideracoes.substr(0,100)+"...":a.consideracoes,placement:"auto"}).on("click",function(){alert_modal('<i class="fa fa-comments pull-left" aria-hidden="true"></i>'+a.nome,nl2br(a.consideracoes))}),n.find(".consideracoes").hover(function(){$(this).css("cursor","pointer")})):n.html(""),parseInt(a.aprovacao_atrasada)&&e.addClass("bg-danger"),e.appendTo(o)}(e)}))})},this.render_revisoes=function(a){r.versoes=[];var o=r.tab_revisoes.find("tbody"),i=o.find("tr:first"),e=a.revisoes;r.tab_revisoes.find("tr:gt(1)").remove(),$(e).each(function(e,t){!function(e,t){var s=i.clone();if(s.removeAttr("template-row"),s.css("display",""),0==t)if("N"==e.aprovacao){r.doc_rev_pendente.hide(),r.doc_rev_reprovado.show();var n="Reprovado por "+e.usuario_alteracao_nome+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():"")+" <br /> Motivo da reprova: "+e.motivo_reprovacao;r.doc_rev_reprovado.find("span").html('<span href="#" class="alert-link"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i><strong> Atenção! A ultima revisão deste documento está </strong> Reprovada</span><br /><small>'+n+"</small>")}else null==e.aprovacao||"N"==e.controle_distribuicao?(r.doc_rev_reprovado.hide(),r.doc_rev_pendente.show()):(r.doc_rev_reprovado.hide(),r.doc_rev_pendente.hide());var d=s.find(".lbl_sequencia"),c=s.find(".td_aprovacao"),_=s.find(".div_aprovacao"),l=s.find(".lbl_data_envio"),u=s.find(".lbl_tamanho"),p=s.find(".lbl_autor"),v=(s.find(".lbl_observacoes"),s.find(".lbl_versao")),m=s.find(".sep_avaliacao"),h=s.find(".btn_aprovar"),f=s.find(".btn_reprovar"),b=s.find(".btn_estornar_avaliacao");s.find(".btn_gerar_url_download").on("click",function(){var a=function(){WS.post("documento/gerar_url_download/",{documento_revisao_id:e.documento_revisao_id},function(a){alert_saved("URL de download do arquivo gerada com sucesso!"),o(a)})},o=function(o){r.download_url_dialog=DevExpress.ui.dialog.custom({title:"Link de download",messageHtml:"Abaixo, o link de download para o documento: <br><br> <a href="+o+" target='_blank'>"+o+"</a> <br><br> <small>* Com esse link, qualquer usuário poderá realizar o download do documento, mesmo que ele não tenha cadastro no Next BP.</small> <br> <small>* Gerar um novo link irá impossibilitar o download do documento pelo link atual.</small>",buttons:[{text:"OK",onClick:function(){return!1}},{text:"Gerar novo link",onClick:function(o){r.download_url_dialog&&r.download_url_dialog.hide(),a()}},{text:"Copiar link",onClick:function(a){copyToClipboard(o)}}]}),r.download_url_dialog.show()};WS.get("documento/verificar_url_download/",{documento_revisao_id:e.documento_revisao_id},function(i){i?o(i):(r.download_url_dialog&&r.download_url_dialog.hide(),a())})});var g=function(a,o,i){var t={documento_id:e.documento_id,documento_revisao_id:e.documento_revisao_id,aprovacao:o,documento_aprovacao_alcada_id:e.documento_aprovacao_alcada_id};null!=a&&(t.rejeitar=a,t.documento_revisao_reprovar_id=e.documento_revisao_reprovar_id,t.revisoes_reprovadas=e.revisoes_reprovadas),null!=i&&(t.consideracoes=i),WS.post("documento/salvar_documento_aprovacao_revisoes/",t,function(a){if(a){var i=!0===a?"success":"error",e="N"==o?"Revisão reprovada com sucesso":"Revisão aprovada com sucesso";DevExpress.ui.notify.default({message:e,type:i,displayTime:3e3,width:300}),r.preencher()}})},A=function(a,o){parseInt(e.qtde_revisoes_pendentes)>0?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"<div><p>Deseja rejeitar as revisões anteriores do documento ?</p></div>","Sim",function(){g(!0,a,o)},!0,"Não",null,function(){g(!1,a,o)}):g(!1,a,o)};if(h.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Deseja realmente aprovar o Documento: "+e.nome_arquivo+' ?<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="Considerações sobre o documento."></textarea></div>',"Sim",function(){var a=document.getElementById("consideracoes").value;A("S",a)},!0,"Não",null,function(){return!1})}),f.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Aviso!',"Por gentileza, informe o motivo pelo qual deseja reprovar o Documento: <br />"+e.nome_arquivo+'<div class="form-group"><br /><textarea class="form-control" rows="5" id="consideracoes" style="min-width: 100%; max-width: 100%" placeholder="digite o motivo da reprova do documento."></textarea></div>',"Reprovar",function(){var a=document.getElementById("consideracoes").value;A("N",a),r.render_aprovacoes(!0)},!0,"Cancelar",null,function(){return!1})}),b.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja estornar a aprovação/reprovação desta revisão?","Estornar Aprova/Reprova",function(){WS.post("documento/salvar_documento_aprovacao_revisoes/",{documento_revisao_id:e.documento_revisao_id,aprovacao:"E"},function(a){if(a){var o=!0===a?"success":"error",i=!0===a?"Estorno realizado com sucesso":"Falha ao estornar a atividade";DevExpress.ui.notify.default({message:i,type:o,displayTime:3e3,width:300}),!0===a&&r.preencher()}else alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Não é possivel estornar após o nivel estar aprovado<br /> Deseja gerar uma nova revisão ?","Gerar Nova Revisão",function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Está Ação irá duplicar a revisão do documento<br /> Deseja continuar ?","Gerar Nova Revisão",function(){WS.post("documento/gerar_nova_revisao",{documento_revisao_id:e.documento_revisao_id},function(a){DevExpress.ui.notify.default({message:"Revisão salva com sucesso",type:"success",displayTime:3e3,width:300}),r.preencher()})},!0)},!0)})},!0)}),a.historico_aprovacoes)if(c.removeClass("hidden"),r.th_aprovacao.show(),e.aprovacao&&""!=e.aprovacao){var k=s.find(".lbl_aprovado"),w=s.find(".lbl_reprovado");if(e.aprovacao&&"S"==e.aprovacao)_.tooltip({title:"Aprovado"+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():""),placement:"right"}),_.tooltip(),k.show();else if(e.aprovacao&&("N"==e.aprovacao||"A"==e.aprovacao)){if("A"==e.aprovacao)var x="<br /> Reprova Automatica";else"N"==e.aprovacao&&(x="<br /> Justificativa da Reprova: "+(null!=e.motivo_reprovacao?e.motivo_reprovacao:""));_.tooltip({title:"Reprovado por "+e.usuario_alteracao_nome+(e.data_aprovacao?" em "+e.data_aprovacao.format_date_time():"")+x,placement:"right"}),w.show()}}else s.find(".lbl_aprovacao_pendente").show(),(App.sessao.dados.admin||a.usuario_permissao_aprovacao)&&(e.documento_aprovacao_alcada_id?(h.parent().show(),f.parent().show(),m.show()):void 0!==r.documento_parametros.documentos_permitir_estorno_aprovacao&&"N"!=r.documento_parametros.documentos_permitir_estorno_aprovacao&&(b.parent().show(),m.show()));else c.addClass("hidden"),r.th_aprovacao.hide();var O=$(s.find("[template-field='observacao_revisao']"));null==e.observacao_revisao||""==e.observacao_revisao?O.hide():(O.tooltip({title:e.observacao_revisao.replace(/\n\r?/g,"<br />"),placement:"auto",html:!0}),O.tooltip()),null!=e.versao?(v.find("span").keypress(function(a){if(!new RegExp("[0-9]").test(a.key))return a.preventDefault(),!1}).keyup(function(a){var o=$(this);if(a.which==KEYPRESS_PADRAO.ENTER){var i=o.text().replace("&nbsp;"),e=o.attr("data-original");if(o.attr("contenteditable",!1),o.parent().css({"user-select":"all"}),r.versoes.filter(function(a){if(parseInt(a.versao,10)==parseInt(i,10))return a}).length>0||0==i.trim().length)o.text(e+" ");else{var t=null;r.versoes.filter(function(a,o){parseInt(a.versao,10)==e&&(t=r.versoes[o].revisao,r.versoes.splice(o,1))}),setTimeout(function(){o.attr("data-original",i),r.versoes.push({revisao:t,versao:parseInt(i.trim(),10)}),clearTimeout(this)},100),o.text(i)}}}).dblclick(function(a){var o=$(this),i="true"==o.attr("contenteditable");if(o.text().replace("&nbsp;",""),i=!i,o.attr("contenteditable",i).attr("data-editor","true"),i){o.parent().css({"user-select":"none"});var e=o.get(0).childNodes[0],t=document.createRange();t.setStart(e,e.length-1),t.setEnd(e,e.length-1);var r=window.getSelection();r.removeAllRanges(),r.addRange(t)}}).blur(function(a){var o=$(this),i=o.text().replace("&nbsp;");o.attr("contenteditable","false");var e=o.attr("data-original");if(r.versoes.filter(function(a){if(parseInt(a,10)==parseInt(i,10))return a}).length>0||0==i.trim().length)o.text(e+" ");else{var t=null;r.versoes.filter(function(a,o){parseInt(a.versao,10)==e&&(t=r.versoes[o].revisao,r.versoes.splice(o,1))}),setTimeout(function(){o.attr("data-original",i),r.versoes.push({revisao:t,versao:parseInt(i.trim(),10)}),clearTimeout(this)},100),o.text(i)}}).html(e.versao+"&nbsp;").attr("data-original",e.versao),r.versoes.push({revisao:e.documento_revisao_id,versao:e.versao})):v.find("span").text(""),d.text(e.sequencia),l.text(e.data_envio?e.data_envio.format_date_time():""),u.text(filesize(parseInt(e.tamanho,10)||0)),p.text(e.usuario_envio_nome?e.usuario_envio_nome:"");var C=$(s.find(".btn_download"));C.addClass("hidden");var R=$(s.find(".btn_submenu")),y=$(s.find(".btn_visualizar"));if("application/pdf"==e.mime_type){var S=function(){View.load("central_documentos/visualizar_pdf",function(a,o){o.show(e.documento_revisao_id,null,null,e.ativa,e.aprovacao,r.documento_bloqueado,null,r.usuario_permissao_download)})};y.unbind("click").click(S)}else"image/png"==e.mime_type||"image/bmp"==e.mime_type||"image/jpeg"==e.mime_type||"image/jpg"==e.mime_type||"image/gif"==e.mime_type?(S=function(){View.load("central_documentos/visualizar_documento",function(a,o){o.show(e.documento_revisao_id,null,e.ativa,e.aprovacao,r.documento_bloqueado,e.controle_distribuicao,r.usuario_permissao_download)})},y.click(S)):y.hide();r.usuario_permissao_visualizacao&&r.usuario_permissao_download&&(C.removeClass("hidden"),C.click(function(){var o=function(){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+e.documento_revisao_id+"&documento_id="+a.id+"&token_publico="+o)},e.documento_revisao_id)};"S"!=e.ativa||"S"!=e.aprovacao?"N"==e.aprovacao?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>reprovada,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):null==e.aprovacao?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>pendente,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):"N"==e.ativa&&alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-warning" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar uma revisão </strong>obsoleta,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):"S"==r.documento_bloqueado?alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-danger" style="text-align: center"> <span href="#" class="alert-link"><strong>Você está tentando baixar um documento </strong>bloqueado,<strong> deseja continuar ?  </strong></span></div>','<i class="fa fa-download" aria-hidden="true"></i> Download',function(){o()},!0):o()}));var I=$(s.find(".btn_ativar_revisao"));if(I.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja ativar esta revisão?","Ativar Revisão",function(){WS.post("documento/ativar_revisao",{documento_revisao_id:e.documento_revisao_id,versoes:JSON.stringify(r.versoes)},function(a){DevExpress.ui.notify.default({message:"Revisão ativada com sucesso",type:"success",displayTime:3e3,width:300}),r.preencher()})},!0)}),r.usuario_permissao_escrita&&"S"!=r.documento_bloqueado){var z=$(s.find(".btn_reenviar_revisao"));z.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Está Ação irá duplicar a revisão do documento<br /> Deseja continuar ?","Gerar Nova Revisão",function(){r.salvar_documento(r.btn_salvar,!0,e.documento_revisao_id)},!0)}),z.removeClass("hidden")}if(App.verifica_permissao(App.temp.empresa,"substituir_revisao")&&r.usuario_permissao_revisao||App.sessao.dados.admin){var E=$(s.find(".btn_substituir"));E.click(function(){var a=function(a){DevExpress.ui.notify.default({message:"Documento atualizado com sucesso",type:"success",displayTime:3e3,width:300}),r.preencher()};View.load("central_documentos/corrigir_revisao",function(o,i){i.onsave=a,i.show(e.documento_revisao_id,e.nome_arquivo,e.sequencia,e.tamanho)})}),E.removeClass("hidden")}if(("S"==r.documento_parametros.documentos_permitir_exclusao||App.sessao.dados.admin)&&r.usuario_permissao_exclusao&&r.usuario_permissao_revisao){var D=$(s.find(".btn_excluir_revisao"));D.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja excluir esta revisão?","Excluir Revisão",function(a){WS.post("documento/excluir_revisao",{documento_revisao_id:e.documento_revisao_id,versoes:JSON.stringify(r.versoes)},function(a){DevExpress.ui.notify.default({message:"Revisão excluida com sucesso",type:"success",displayTime:3e3,width:300}),r.preencher()},[])},!0)}),D.removeClass("hidden")}if((r.usuario_permissao_revisao||r.usuario_permissao_escrita)&&"S"==r.documento_parametros.documentos_permitir_ativar_revisao&&null!=e.aprovacao||I.parent().hide(),"S"==e.ativa){var N=$(s.find(".lbl_ativa"));I.parent().hide(),("S"==r.documento_parametros.documentos_permitir_exclusao||App.sessao.dados.admin)&&r.usuario_permissao_exclusao&&r.usuario_permissao_revisao&&D.addClass("hidden"),R.removeClass("btn-default"),R.addClass("btn-primary")}else if("N"==e.ativa&&"S"==e.aprovacao&&"S"==e.controle_distribuicao)N=$(s.find(".lbl_obsoleta")),I.parent().hide();else if("N"!=e.ativa||"N"!=e.aprovacao&&"A"!=e.aprovacao)N=$(s.find(".lbl_pendente")),!a.documento_pasta_aprovacao||e.aprovacao&&"S"==e.aprovacao||I.parent().hide();else{var N=$(s.find(".lbl_reprovada"));I.parent().hide()}N.show(),$(s.find(".lbl_nome_arquivo")).text(e.nome_arquivo),s.appendTo(o)}(t,e)})},this.render_usuarios=function(){var a=r.tab_permissoes.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(r.usuarios_array).each(function(e,t){t.usuario_id==i.usuario_id&&(r.usuarios=t,"visualizacao"==o?r.usuarios.visualizacao=a.prop("checked"):"download"==o?r.usuarios.download=a.prop("checked"):"exclusao"==o?r.usuarios.exclusao=a.prop("checked"):"escrita"==o?r.usuarios.escrita=a.prop("checked"):"revisao"==o?r.usuarios.revisao=a.prop("checked"):"seguranca"==o&&(r.usuarios.seguranca=a.prop("checked")),r.usuarios_array[e]=r.usuarios)})};r.tab_permissoes.find("tr:gt(1)").remove(),$(r.usuarios_array).each(function(e,t){!function(e){var t=o.clone();t.removeAttr("template-row"),t.css("display","");var s=$(t.find(".btn_usuario_remover"));t.find(".img_usuario"),t.find(".lbl_nome").text(e.nome);var n=t.find(".chk_visualizacao");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.visualizacao).change();var d=t.find(".chk_download");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.download).change();var c=t.find(".chk_escrita");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.escrita).change();var _=t.find(".chk_exclusao");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==e.exclusao).change();var l=t.find(".chk_revisao");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.revisao).change();var u=t.find(".chk_seguranca");u.attr("type","checkbox"),u.addClass("checkbox_bootstrap_toggle"),u.prop("checked",1==e.seguranca).change(),$(n).prop("disabled",!r.valor),$(d).prop("disabled",!r.valor),$(c).prop("disabled",!r.valor),$(_).prop("disabled",!r.valor),$(l).prop("disabled",!r.valor),$(u).prop("disabled",!r.valor),$(s).attr("disabled",!r.valor),!App.sessao.dados.admin&&(void 0!==e.automatic&&!0===e.automatic||void 0!==e.add_self&&!0===e.add_self||App.sessao.dados.usuario_id==e.usuario_id)&&(n.prop("disabled",!0),d.prop("disabled",!0),c.prop("disabled",!0),_.prop("disabled",!0),l.prop("disabled",!0),u.prop("disabled",!0),s.attr("disabled",!0),void 0!==e.add_self&&!0===e.add_self&&s.attr("disabled",!1)),n.change(function(){i(n,"visualizacao",e)}),d.change(function(){i(d,"download",e)}),c.change(function(){i(c,"escrita",e)}),_.change(function(){i(_,"exclusao",e)}),l.change(function(){i(l,"revisao",e)}),u.change(function(){i(u,"seguranca",e)}),s.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o usuário?","Remover",function(){$(r.usuarios_array).each(function(a,o){o.usuario_id==e.usuario_id&&(t.remove(),r.usuarios_array.splice(a,1),r.render_usuarios())})},!0)}),t.appendTo(a)}(t)}),App.aplicar_checkbox(a)},this.render_grupos=function(){var a=r.tab_permissoes_grupo.find("tbody"),o=a.find("tr:first"),i=function(a,o,i){$(r.grupos_array).each(function(e,t){t.grupo_usuarios_id==i.grupo_usuarios_id&&(r.grupos=t,"visualizacao"==o?r.grupos.visualizacao=a.prop("checked"):"download"==o?r.grupos.download=a.prop("checked"):"exclusao"==o?r.grupos.exclusao=a.prop("checked"):"escrita"==o?r.grupos.escrita=a.prop("checked"):"revisao"==o?r.grupos.revisao=a.prop("checked"):"seguranca"==o&&(r.grupos.seguranca=a.prop("checked")),r.grupos_array[e]=r.grupos)})};r.tab_permissoes_grupo.find("tr:gt(1)").remove(),$(r.grupos_array).each(function(e,t){!function(e){var t=o.clone();t.removeAttr("template-row"),t.css("display",""),t.find(".lbl_nome").text(e.nome);var s=t.find(".chk_visualizacao");s.attr("type","checkbox"),s.addClass("checkbox_bootstrap_toggle"),s.prop("checked",1==e.visualizacao);var n=t.find(".chk_download");n.attr("type","checkbox"),n.addClass("checkbox_bootstrap_toggle"),n.prop("checked",1==e.download);var d=t.find(".chk_escrita");d.attr("type","checkbox"),d.addClass("checkbox_bootstrap_toggle"),d.prop("checked",1==e.escrita);var c=t.find(".chk_exclusao");c.attr("type","checkbox"),c.addClass("checkbox_bootstrap_toggle"),c.prop("checked",1==e.exclusao);var _=t.find(".chk_revisao");_.attr("type","checkbox"),_.addClass("checkbox_bootstrap_toggle"),_.prop("checked",1==e.revisao);var l=t.find(".chk_seguranca");l.attr("type","checkbox"),l.addClass("checkbox_bootstrap_toggle"),l.prop("checked",1==e.seguranca),$(s).prop("disabled",!r.valor),$(n).prop("disabled",!r.valor),$(d).prop("disabled",!r.valor),$(c).prop("disabled",!r.valor),$(_).prop("disabled",!r.valor),$(l).prop("disabled",!r.valor),$(u).prop("disabled",!r.valor),s.change(function(){i(s,"visualizacao",e)}),n.change(function(){i(n,"download",e)}),d.change(function(){i(d,"escrita",e)}),c.change(function(){i(c,"exclusao",e)}),_.change(function(){i(_,"revisao",e)}),l.change(function(){i(l,"seguranca",e)});var u=$(t.find(".btn_grupo_remover"));u.unbind("click"),u.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Deseja remover o grupo?","Remover",function(){$(r.grupos_array).each(function(a,o){o.grupo_usuarios_id==e.grupo_usuarios_id&&(t.remove(),r.grupos_array.splice(a,1),r.render_grupos())})},!0)}),t.appendTo(a)}(t)}),App.aplicar_checkbox(a)},this.listar_assunto=function(a){r.cbo_assunto.find("option").remove(),add_option(r.cbo_assunto,"","Nenhum"),WS.get("assunto/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];r.projeto_id>0?"S"==e.padrao_projeto?add_option(r.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(r.cbo_assunto,e.assunto_id,e.descricao):r.solicitacao_id>0?"S"==e.padrao_processos?add_option(r.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(r.cbo_assunto,e.assunto_id,e.descricao):r.oportunidade_id>0?"S"==e.padrao_atendimento_relacionamento?add_option(r.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(r.cbo_assunto,e.assunto_id,e.descricao):"S"==e.padrao_documentos?add_option(r.cbo_assunto,e.assunto_id,e.descricao,"selected"):add_option(r.cbo_assunto,e.assunto_id,e.descricao)}a&&r.cbo_assunto.val(a).trigger("change")})},this.listar_tipo_documento=function(a){r.cbo_tipo_documento.find("option").remove(),add_option(r.cbo_tipo_documento,"","Nenhum"),WS.get("tipo_documento/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];r.projeto_id>0?"S"==e.padrao_projeto?add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome):r.solicitacao_id>0?"S"==e.padrao_processos?add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome):r.oportunidade_id>0?"S"==e.padrao_atendimento_relacionamento?add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome):"S"==e.padrao_documentos?add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome,"selected"):add_option(r.cbo_tipo_documento,e.tipo_documento_id,e.nome)}a&&r.cbo_tipo_documento.val(a).trigger("change")})},this.listar_local_armazenamento=function(a){r.cbo_local_armazenamento.find("option").remove(),add_option(r.cbo_local_armazenamento,"","Nenhum"),WS.get("local_armazenamento/listar/",null,function(o){for(var i=0;i<o.length;i++){var e=o[i];r.projeto_id>0?1==e.padrao_projeto?add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):r.solicitacao_id>0?1==e.padrao_processos?add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):r.oportunidade_id>0?1==e.padrao_atendimento_relacionamento?add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome):"true"===e.padrao_documentos.toString()?add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome,"selected"):add_option(r.cbo_local_armazenamento,e.local_armazenamento_id,e.nome)}a&&r.cbo_local_armazenamento.val(a).trigger("change")})},this.RenderAprovadores=function(){o.render(r.ListarAprovadores,r.div_ListarAprovadores[0])},this.listar_alcada=function(){WS.get("alcada_aprovadores/listar/",null,function(a){a.length>0&&(r.cbo_selecionar_alcada.find("option").remove(),$(a).each(function(a,o){add_option(r.cbo_selecionar_alcada,o.alcada_generica_id,o.nome)}),r.cbo_selecionar_alcada.selectpicker("refresh"),r.alcada_generica_id&&(r.cbo_selecionar_alcada.val(r.alcada_generica_id).trigger("change"),r.cbo_selecionar_alcada.selectpicker("refresh")))})},this.listar_grupos_usuarios=function(a){var o=r.cbo_aprovador.parent().find(".edt_combobox"),i=new Object;i.nome=o.val(),WS.get("alcada_aprovadores/listar_todos_aprovadores/",i,function(o){limpar_combobox(r.cbo_aprovador),$(o).each(function(a,o){var i=[];i.Nome=o.nome;var e=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(e.addClass("label-info"),e.text("U"),e.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo?(e.addClass("label-warning"),e.text("GU"),e.attr("tipo","grupo_usuarios")):"alcada_generica"==o.tipo&&(e.addClass("label-danger"),e.text("AP"),e.attr("tipo","alcada_generica")),e.tooltip(),add_option_combobox(r.cbo_aprovador,a,o.id>0?o.id:null,i,e,JSON.stringify(o))}),o.length>0&&a(!0),$(r.cbo_aprovador.parent()).find(".ul_row").click(function(){var a=$(this).parent().attr("dados-adicionais")?JSON.parse($(this).parent().attr("dados-adicionais")):null;r.ListarAprovadores.props.setAprovadoresManual(a),setTimeout(function(){var a=r.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected");r.cbo_aprovador.parent().find(".edt_combobox").val(""),a.removeClass("row_selected")})})})},this.exibicao_validade_vigencia=function(a){void 0===a&&(a=!0);var o=!1;switch(r.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:o=!0;break;case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:o=!1}var i=parseInt(r.edt_validade.val(),10);!isNaN(i)&&i>0?(r.cbo_validade_periodo.show(),r.edt_data_vigencia.prop("readonly",!0),r.cbo_validade_periodo.val()&&""!=r.cbo_validade_periodo.val()||r.cbo_validade_periodo.val(0),r.documento&&r.documento.revisao_data_aprovacao&&a&&WS.get("documento/sugestao_vigencia/",{data_revisao:r.documento.revisao_data_aprovacao,validade:i,validade_periodo:r.cbo_validade_periodo.val()},function(a){set_datepicker(r.edt_data_vigencia,a.data_vigencia)},null,null,null,null,r.html_id)):(r.cbo_validade_periodo.hide(),r.edt_data_vigencia.prop("readonly",!o)),r.edt_validade.prop("readonly",!o),r.cbo_validade_periodo.prop("disabled",!o)},this.listar_filtro_historico_aprovacoes=function(){r.cbo_usuario_historico_aprovacoes.children().remove(),r.cbo_situacao_historico_aprovacoes.children().remove(),r.cbo_origem_historico_aprovacoes.children().remove(),WS.get("documento/listar_aprovadores/",{documento_id:r.documento_id},function(a){for(var o=0;o<a.length;o++){var i=a[o];add_option(r.cbo_usuario_historico_aprovacoes,i.id,i.nome)}r.cbo_usuario_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" usuarios selecionados"}}),r.cbo_usuario_historico_aprovacoes.selectpicker("refresh")}),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.AGUARDANDO,"Aguardando"),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.APROVADO,"Aprovado"),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.REPROVADO,"Reprovado"),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.APROVADO_POR_TERCEIRO,"Aprovado por Terceiro"),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.REPROVADO,"Reprovado por Terceiro"),add_option(r.cbo_situacao_historico_aprovacoes,GED_APROVACAO_SITUACAO.AGUARDANDO_NIVEL,"Aguardando Alçada"),r.cbo_situacao_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" situação selecionadas"}}),r.cbo_situacao_historico_aprovacoes.selectpicker("refresh"),add_option(r.cbo_origem_historico_aprovacoes,GED_TIPO_ORIGEM.PASTA,"Pasta"),add_option(r.cbo_origem_historico_aprovacoes,GED_TIPO_ORIGEM.DOCUMENTO,"Documento"),r.cbo_origem_historico_aprovacoes.selectpicker({countSelectedText:function(a,o){return a+" origem selecionadas"}}),r.cbo_origem_historico_aprovacoes.selectpicker("refresh")},this.listar_copia_controlada=function(){WS.get("documento_copia_controlada/listar/",{documento_id:r.documento_id,empresa_id:App.sessao.dados.empresa_filial_id},function(a){r.preencher_copia_controlada(a)})},this.preencher_copia_controlada=function(a){var o=document.createElement("div");o.className="div_listagem_documento_copia_controlada",o.style="min-width: 100%;",r.dx_listagem_documento_copia_controlada.find(".div_listagem_documento_copia_controlada").remove(),r.dx_listagem_documento_copia_controlada[0].appendChild(o);var i=detectmob()?"select":"dragAndDrop",e=[{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.FISICA,descricao:"Cópia física"},{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA,descricao:"Cópia eletrônica"}];r.dataGrid_distribuicao_controlada=r.dx_listagem_documento_copia_controlada.find(".div_listagem_documento_copia_controlada").dxDataGrid({dataSource:a.dados,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,rowAlternationEnabled:!1,searchPanel:{visible:!0,width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:i},stateStoring:{enabled:!0,type:"custom",customLoad:function(a){var o=App.get_parametro_usuario("documento_copia_controlada");return r.template=o.template?o.template:"N",o},customSave:function(a){App.set_parametro_usuario("documento_copia_controlada",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de distribuicao controlada"+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},onToolbarPreparing:function(a){var o=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem de distribuicao controlada",text:"Recarregar listagem de distribuicao controlada",onClick:function(){r.listar_copia_controlada()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(o,a.toolbarOptions.items);for(var i=0;i<a.toolbarOptions.items.length;i++){var e=a.toolbarOptions.items[i];"saveButton"==e.name&&(e.visible=!1)}},onContentReady:function(a){add_filtro_cor_tema(a)},onInitNewRow:function(a){a.data.obrigatorio_comprovacao=!1},onEditorPrepared:function(a){"dataRow"==a.parentType&&("responsavel_id"==a.dataField?a.editorElement.dxSelectBox("instance").option("itemTemplate",function(a){var o=null;return"usuarios"==a.tipo?o='<span class="label lb_tipo label-info" style="margin: 5px;" tipo="usuarios" data-original-title="" title="">U</span> ':"grupo_usuarios"==a.tipo&&(o='<span class="label lb_tipo label-warning" style="margin: 5px;" tipo="grupo_usuarios" data-original-title="" title="">GU</span> '),o+a.nome}):"tipo_copia"==a.dataField&&$(a.editorElement).dxSelectBox("instance").on("valueChanged",function(o){o.value==DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA&&r.dataGrid_distribuicao_controlada.cellValue(a.row.rowIndex,"local_distribuicao_id",null)}))},onEditorPreparing:function(a){"dataRow"==a.parentType&&a.row.data.tipo_copia==DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA&&"local_distribuicao_id"==a.dataField&&(a.editorOptions.disabled=!0)},focusedRowEnabled:!1,editing:{mode:"batch",allowAdding:!0,allowDeleting:!0,allowUpdating:!0,useIcons:!0},columns:[{dataField:"tipo_copia",caption:"Tipo da Cópia",lookup:{dataSource:e,displayExpr:"descricao",valueExpr:"id"}},{dataField:"responsavel_id",caption:"Responsável",lookup:{dataSource:{store:{type:"array",data:a.usuarios,key:function(a){if(a)return a.tipo+";"+a.id+";"+a.nome}},pageSize:10,paginate:!0},valueExpr:function(a){if(a)return a.tipo+";"+a.id+";"+a.nome},displayExpr:"nome"}},{dataField:"local_distribuicao_id",caption:"Local de distribuição",lookup:{dataSource:a.locais_distribuicao,displayExpr:"nome",valueExpr:"id"}},{dataField:"obrigatorio_comprovacao",caption:"Obrigatório comprovação",dataType:"boolean"},{dataField:"dias_prazo",caption:"Prazo em dias",dataType:"number"},{type:"buttons",buttons:[{hint:"Apagar registro",icon:"fa fa-trash",visible:function(a){return!a.row.removed},cssClass:"icon_black",onClick:function(a){r.dataGrid_distribuicao_controlada.deleteRow(a.row.rowIndex)}},{hint:"Recuperar registro",icon:"fa fa-undo",visible:function(a){return a.row.removed},cssClass:"icon_black",onClick:function(a){r.dataGrid_distribuicao_controlada.undeleteRow(a.row.rowIndex)}}]}]}).dxDataGrid("instance")},this.listar_distribuicoes=function(){WS.get("documento_copia_controlada/listar/",{empresa_id:App.sessao.dados.empresa_filial_id},function(a){r.preencher_distribuicoes(a)})},this.preencher_distribuicoes=function(a){var i=document.createElement("div");i.className="div_listagem_documento_distribuicoes",i.style="min-width: 100%;",r.dx_listagem_documento_distribuicoes.find(".div_listagem_documento_distribuicoes").remove(),r.dx_listagem_documento_distribuicoes[0].appendChild(i);var e=detectmob()?"select":"dragAndDrop",t=[{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.FISICA,descricao:"Cópia física"},{id:DISTRIBUICAO_CONTROLADA_TIPO_COPIA.ELETRONICA,descricao:"Cópia eletrônica"}],s=[{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.ADICIONAR,descricao:"Adicionar documento"},{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.REMOVER,descricao:"Remover documento"},{id:DISTRIBUICAO_CONTROLADA_TIPO_ACAO.CIENCIA,descricao:"Ciência"}];r.dataGrid_distribuicoes=r.dx_listagem_documento_distribuicoes.find(".div_listagem_documento_distribuicoes").dxDataGrid({dataSource:a,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,rowAlternationEnabled:!1,searchPanel:{visible:!0,width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:e},stateStoring:{enabled:!0,type:"custom",customLoad:function(a){var o=App.get_parametro_usuario("documento_distribuicoes");return r.template=o.template?o.template:"N",o},customSave:function(a){App.set_parametro_usuario("documento_distribuicoes",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de distribuicao de documento"+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},onToolbarPreparing:function(a){var o=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem de distribuicao de documento",text:"Recarregar listagem de distribuicao de documento",onClick:function(){r.listar_copia_controlada()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(o,a.toolbarOptions.items);for(var i=0;i<a.toolbarOptions.items.length;i++){var e=a.toolbarOptions.items[i];"saveButton"!=e.name&&"revertButton"!=e.name||(e.visible=!1)}},onContentReady:function(a){add_filtro_cor_tema(a)},editing:{useIcons:!0},columns:[{dataField:"sequencia",caption:"Revisão do documento",dataType:"number"},{dataField:"tipo_copia",caption:"Tipo da Cópia",lookup:{dataSource:t,displayExpr:"descricao",valueExpr:"id"}},{dataField:"usuario_responsavel",caption:"Usuário responsável"},{dataField:"local_distribuicao",caption:"Local de distribuição"},{dataField:"tipo_acao",caption:"Tipo da ação",lookup:{dataSource:s,displayExpr:"descricao",valueExpr:"id"}},{dataField:"confirmado",caption:"Realizado",dataType:"boolean",calculateCellValue:function(a){return"S"==a.confirmado}},{dataField:"data_prazo",caption:"Prazo",dataType:"datetime",format:"dd/MM/yyyy HH:mm"},{dataField:"data_confirmacao",caption:"Confirmação",dataType:"datetime",format:"dd/MM/yyyy HH:mm"},{type:"buttons",buttons:[{hint:"Marcar como realizado",icon:"fa fa-check",cssClass:"icon_black",visible:function(a){return"N"==a.row.data.confirmado&&a.row.data.usuario_id==App.sessao.dados.usuario_id},onClick:function(a){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Esta ação irá marcar essa atividade como </strong>concluído,<strong> deseja continuar ?</strong></span></div><div id="file-uploader"></div>','<i class="fa fa-check" aria-hidden="true"></i> Confirmar',function(){WS.post("documento_distribuicao_controlada/marcar_realizado/",{id:a.row.data.id,documento_id:a.row.data.documento_id,documento_revisao_id:a.row.data.documento_revisao_id,documento_confirmacao_distribuicao:r.documento_confirmacao_distribuicao.props.arquivoSelecionado},function(a){var o=!0===a?"success":"error",i=!0===a?"Atividade concluída com sucesso":"Falha ao concluir a atividade";DevExpress.ui.notify.default({message:i,type:o,displayTime:3e3,width:300}),!0===a&&r.preencher()},null,null,!0)},!0),o.render(r.documento_confirmacao_distribuicao,$("#file-uploader")[0]),r.documento_confirmacao_distribuicao.props.setDesabilitado(!1)}},{hint:"Download do documento de comprovação",icon:"fa fa-download",cssClass:"icon_black",visible:function(a){return a.row.data.confirmacao_documento_revisao_id},onClick:function(a){App.obter_token_publico(function(o){App.download(WS_URI+"documento/download/?documento_revisao_id="+a.row.data.confirmacao_documento_revisao_id+"&token_publico="+o),"safari"!=getBrowser()&&r.unload()})}}]}],onRowPrepared:function(a){"data"==a.rowType&&a.data.atrasado&&"S"==a.data.atrasado&&a.rowElement.addClass("bg-danger")}}).dxDataGrid("instance")},r.cbo_usuario_historico_aprovacoes.change(function(a){var o=$(this);r.filtro_historico_aprovacoes_usuario_id=o.val(),r.render_aprovacoes(!0)}),r.cbo_situacao_historico_aprovacoes.change(function(a){var o=$(this);r.filtro_historico_aprovacoes_situacao=o.val(),r.render_aprovacoes(!0)}),r.cbo_origem_historico_aprovacoes.change(function(a){var o=$(this);r.filtro_historico_aprovacoes_origem=o.val(),r.render_aprovacoes(!0)}),r.ipt_consideracoes_historico_aprovacoes.keyup(function(a){var o=$(this);r.filtro_historico_aprovacoes_consideracoes=o.val(),r.render_aprovacoes(!0)}),r.ipt_recebimento_data.unbind("change").change(function(a){var o=$(this);r.filtro_historico_aprovacoes_recebimento_data=o.val(),r.render_aprovacoes(!0)}),r.ipt_prazo_data.unbind("change").change(function(a){var o=$(this);r.filtro_historico_aprovacoes_prazo_data=o.val(),r.render_aprovacoes(!0)}),r.ipt_acao_data.unbind("change").change(function(a){var o=$(this);r.filtro_historico_aprovacoes_acao_data=o.val(),r.render_aprovacoes(!0)}),r.ipt_nivel_historico_aprovacoes.keyup(function(a){var o=$(this);r.filtro_historico_aprovacoes_nivel=o.val(),r.render_aprovacoes(!0)}),r.ipt_revisao_historico_aprovacoes.keyup(function(a){var o=$(this);r.filtro_historico_aprovacoes_revisao=o.val(),r.render_aprovacoes(!0)}),r.chk_notificar_email_antes.change(function(a){$(this).prop("checked")?r.div_notificacao_vigencia.removeClass("hidden"):r.div_notificacao_vigencia.addClass("hidden"),1==$(this).prop("checked")||1==r.chk_notificacoes.prop("checked")?(r.chk_notificacao_seguranca.parents(".row").removeClass("hidden"),r.chk_notificacao_outros_usuarios.parents(".row").removeClass("hidden"),r.chk_notificacao_aprovador.parents(".row").removeClass("hidden")):(r.chk_notificacao_seguranca.prop("checked",!1).change().parents(".row").addClass("hidden"),r.chk_notificacao_outros_usuarios.prop("checked",!1).change().parents(".row").addClass("hidden"),r.chk_notificacao_aprovador.prop("checked",!1).change().parents(".row").addClass("hidden"))}),this.edt_validade.unbind("keyup").unbind("change"),this.edt_validade.keyup($.debounce(500,r.exibicao_validade_vigencia)),this.edt_validade.change(r.exibicao_validade_vigencia),this.cbo_validade_periodo.unbind("change"),this.cbo_validade_periodo.change(r.exibicao_validade_vigencia),this.btn_assunto_visualizar.unbind("click"),this.btn_assunto_visualizar.click(function(){""!=r.cbo_assunto.val()&&View.load("assunto/detalhes",function(a,o){o.show(r.cbo_assunto.val(),FORMULARIO.VISUALIZAR)})}),this.btn_assunto_novo.unbind("click"),this.btn_assunto_novo.click(function(){View.load("assunto/detalhes",function(a,o){o.onclose=function(){o.assunto_id&&r.listar_assunto(o.assunto_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_tipo_documento_visualizar.unbind("click"),this.btn_tipo_documento_visualizar.click(function(){""!=r.cbo_tipo_documento.val()&&View.load("tipo_documento/detalhes",function(a,o){o.show(r.cbo_tipo_documento.val(),FORMULARIO.VISUALIZAR)})}),this.btn_tipo_documento_novo.unbind("click"),this.btn_tipo_documento_novo.click(function(){View.load("tipo_documento/detalhes",function(a,o){o.onclose=function(){o.tipo_documento_id&&r.listar_tipo_documento(o.tipo_documento_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_local_armazenamento_visualizar.unbind("click"),this.btn_local_armazenamento_visualizar.click(function(){""!=r.cbo_local_armazenamento.val()&&View.load("local_armazenamento/detalhes",function(a,o){o.show(r.cbo_local_armazenamento.val(),FORMULARIO.VISUALIZAR)})}),this.btn_favoritar_item.click(function(){var a=!1,o=$(this).find("span");o.hasClass("glyphicon-star")?(o.removeClass("glyphicon-star").addClass("glyphicon-star-empty"),a=!1):(o.addClass("glyphicon-star").removeClass("glyphicon-star-empty"),a=!0),favoritar_item("documentos",r.documento_id,a)}),this.btn_local_armazenamento_novo.unbind("click"),this.btn_local_armazenamento_novo.click(function(){View.load("local_armazenamento/detalhes",function(a,o){o.onclose=function(){o.local_armazenamento_id&&r.listar_local_armazenamento(o.local_armazenamento_id)},o.show(null,FORMULARIO.NOVO)})}),this.chk_controle_acessos.unbind("change"),this.chk_controle_acessos.change(function(){$(this).prop("checked")?(r.render_usuarios(r.usuarios_array),r.div_permissoes.fadeIn()):(r.div_permissoes.fadeOut(),r.usuarios_array=r.usuarios_array?r.usuarios_array:[],r.usuarios_array=r.usuarios_array.filter(function(a){return a.usuario_id==App.sessao.usuario_id}),r.grupos_array=[],r.tab_permissoes.find("tr:gt(1)").remove(),r.tab_permissoes_grupo.find("tr:gt(1)").remove())}),this.chk_copia_controlada.unbind("change").change(function(){$(this).prop("checked")?r.dx_listagem_documento_copia_controlada.fadeIn():r.dx_listagem_documento_copia_controlada.fadeOut()}),this.btn_add_usuario.unbind("click"),this.btn_add_usuario.click(function(){View.load("usuario/selecionar",function(a,o){o.show(function(a){var o=!1;if($(r.usuarios_array).each(function(i,e){e.usuario_id==a.usuario_id&&(o=!0)}),!o){var i=!App.sessao.dados.admin&&a.usuario_id==App.sessao.dados.usuario_id;r.usuarios=a,r.usuarios.visualizacao=!!i,r.usuarios.download=!!i,r.usuarios.escrita=!!i,r.usuarios.exclusao=!!i,r.usuarios.revisao=!!i,r.usuarios.seguranca=!!i,r.usuarios.add_self=!!i,r.usuarios_array.push(r.usuarios)}r.render_usuarios(r.usuarios_array)})})}),this.btn_add_grupo.unbind("click"),this.btn_add_grupo.click(function(){View.load("grupo_usuarios/selecionar",function(a,o){o.show(function(a){var o=!1;$(r.grupos_array).each(function(i,e){e.grupo_usuarios_id==a.grupo_usuarios_id&&(o=!0)}),o||(r.grupos=a,r.grupos.visualizacao=!1,r.grupos.download=!1,r.grupos.escrita=!1,r.grupos.exclusao=!1,r.grupos.revisao=!1,r.grupos.seguranca=!1,r.grupos_array.push(r.grupos)),r.render_grupos(r.grupos_array)},MODULOS.DOCUMENTO)})}),this.inputArquivoNovoHandleAlterado=function(a){var o=r.inputArquivoNovo.props.arquivoSelecionado||null;if(o){var i=App.sessao.dados.parametro_processo.processo_padrao_nome_documento;i=i.replace("{nome_processo}",void 0===r.nome_processo?"":r.nome_processo).replace("{nome_documento}",o.name).replace("{nome_campo}",""),""==r.edt_nome.val().trim()?r.atividade_id>0?r.edt_nome.val("Atividade do Projeto #"+r.atividade_id+" - "+o.name):r.solicitacao_atividade_id>0?"S"==App.sessao.dados.parametro_processo.processo_usar_nome_padrao&&null==r.projeto_id?(i=i.replace("{solicitacao_numero}",r.solicitacao_id.toString()),r.edt_nome.val(i)):r.edt_nome.val("Solicitação #"+r.solicitacao_id+" - "+o.name):r.oportunidade_id>0?r.edt_nome.val("Oportunidade #"+r.oportunidade_id+" - "+o.name):r.edt_nome.val(o.name):alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"O nome do documento já está definido, deseja atualiza-lo com o nome do arquivo selecionado?","Sim. Atualizar nome do documento",function(){r.atividade_id>0?r.edt_nome.val("Atividade do Projeto #"+r.atividade_id+" - "+o.name):r.solicitacao_atividade_id>0?"S"==App.sessao.dados.parametro_processo.processo_usar_nome_padrao&&null==r.projeto_id?(i=i.replace("{solicitacao_numero}",r.solicitacao_id.toString()),r.edt_nome.val(i)):r.edt_nome.val("Solicitação #"+r.solicitacao_id+" - "+o.name):r.oportunidade_id>0?r.edt_nome.val("Oportunidade #"+r.oportunidade_id+" - "+o.name):r.edt_nome.val(o.name)},!0)}},this.inputNovaRevisaoHandleAlterado=function(a){var o=r.inputNovaRevisao.props.arquivoSelecionado||null;o?r.edt_observacao_revisao.show():r.edt_observacao_revisao.hide();var i=r.edt_nome.val();o&&"N"!=r.documento_parametros.documentos_sugerir_alteracao_nome&&o.name!==i&&alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','Deseja alterar o nome do documento de <b>"'+i+'"</b> para <b>"'+o.name+'"</b> ?',"Sim, alterar nome do documento",function(){r.edt_nome.val(o.name)},!0,"Não")},this.cbo_acao.unbind("change"),this.cbo_acao.change(function(){r.acao_historico=r.cbo_acao.val(),r.render_historico(r.arr_historico,!0),r.limite=0,r.todos_carregados=!1}),this.btn_limpar_filtros.unbind("click"),this.btn_limpar_filtros.click(function(){r.usuario_historico=null,r.acao_historico=null,r.cbo_usuario.SelectMultiColumn("clean"),r.cbo_acao.val(-1).trigger("change"),r.render_historico(r.arr_historico,!0),r.limite=0,r.todos_carregados=!1}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if(n=validateForm())alert_fail("Preencha os campos obrigatórios");else{if(r.cbo_tipo_aprovacao.val()==TIPO_APROVACAO.MANUAL){for(var a=!1,o=!1,i=[],e=r.ListarAprovadores.props.arrAprovadoresManual.length,t=0;t<e;t++){for(var s=t;s<e;s++)1==r.ListarAprovadores.props.arrAprovadoresManual[s].tipo_aprovador?t!=s&&r.ListarAprovadores.props.arrAprovadoresManual[t].usuario_id==r.ListarAprovadores.props.arrAprovadoresManual[s].usuario_id&&r.ListarAprovadores.props.arrAprovadoresManual[t].nivel==r.ListarAprovadores.props.arrAprovadoresManual[s].nivel&&(a=!0,i.push(r.ListarAprovadores.props.arrAprovadoresManual[t].aprovador_usuario_nome)):2==r.ListarAprovadores.props.arrAprovadoresManual[s].tipo_aprovador&&t!=s&&r.ListarAprovadores.props.arrAprovadoresManual[t].grupo_usuarios_id==r.ListarAprovadores.props.arrAprovadoresManual[s].grupo_usuarios_id&&r.ListarAprovadores.props.arrAprovadoresManual[t].nivel==r.ListarAprovadores.props.arrAprovadoresManual[s].nivel&&(a=!0,i.push(r.ListarAprovadores.props.arrAprovadoresManual[t].aprovador_grupo_nome));t>0&&parseInt(r.ListarAprovadores.props.arrAprovadoresManual[t].nivel)-parseInt(r.ListarAprovadores.props.arrAprovadoresManual[t-1].nivel)>1&&(o=!0)}if(1==a)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Os itens abaixo estão duplicados: <br /><br />"+i)),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1==o)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, verifique a ordem dos niveis")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(0==r.ListarAprovadores.props.arrAprovadoresManual.length)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, informe ao menos um usuário para salvar uma alçada.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1;if(1!=r.ListarAprovadores.props.arrAprovadoresManual[0].nivel)return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,'A alçada sempre deverá iniciar com o nivel "1" ')),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}else if(r.cbo_tipo_aprovacao.val()==TIPO_APROVACAO.PREDEFINIDA){var n;if(""==r.cbo_selecionar_alcada.val()||null==r.cbo_selecionar_alcada.val())return(n=new Validation).add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Por gentileza, escolha ao menos uma alçada para continuar.")),alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',n),!1}var d=(new Date).toISOString().substr(0,10);""!=get_datepicker(r.edt_data_vigencia)&&get_datepicker(r.edt_data_vigencia)<d?alert_modal("Documento","A Data de Vigência deste documento está expirada. Deseja continuar?","Sim",function(){r.salvar_documento(r.btn_salvar,!1,null)},!0,"Não",null,function(){}):r.salvar_documento(r.btn_salvar,!1,null)}}),this.salvar_documento=function(a,o,i){if(!r.validar_campos_obrigatorios())return!1;var e=function(a){WS.post("documento/gerar_nova_revisao",{documento_revisao_id:a},function(a){DevExpress.ui.notify.default({message:"Revisão salva com sucesso",type:"success",displayTime:3e3,width:300}),r.preencher()})};App.is_nativo()?App.obter_token_publico(function(t){r.anexos.length>0?(r.cbo_tipo_documento.val()>0&&r.cbo_local_armazenamento.val()>0&&r.cbo_assunto.val()>0&&r.edt_nome.val()&&(r.edt_observacao_revisao.val()||r.edt_observacao_novo.val())&&a.text("Aguarde, enviando o arquivo."),r.anexos):WS.post("documento/salvar",{documento_id:r.documento_id,nome:r.edt_nome.val(),codigo:r.edt_codigo.val(),validade:r.edt_validade.val(),validade_periodo:r.cbo_validade_periodo.val(),data_vigencia:get_datepicker(r.edt_data_vigencia),observacao_documento:r.edt_observacao_novo.val(),observacao_historico_documento:r.edt_observacoes_historico.html(),observacao_revisao:r.edt_observacao_revisao.val(),assunto_id:r.cbo_assunto.val(),tipo_documento_id:r.cbo_tipo_documento.val(),local_armazenamento_id:r.cbo_local_armazenamento.val(),documento_pasta_id:r.documento_pasta_id,usuarios_permissoes:JSON.stringify(r.usuarios_array),grupos_permissoes:JSON.stringify(r.grupos_array),controle_acessos:r.chk_controle_acessos.prop("checked"),atividade_id:r.atividade_id,projeto_id:r.projeto_id,solicitacao_id:r.solicitacao_id,solicitacao_atividade_id:r.solicitacao_atividade_id,oportunidade_id:r.oportunidade_id,tag:r.edt_tag.val(),notificar_por_email:r.chk_notificacoes.prop("checked"),notificar_por_email_antes:r.chk_notificar_email_antes.prop("checked"),dias_notificacao_email:r.edt_dias_notitificacao.val(),notificar_por_usuario_seguranca:r.chk_notificacao_seguranca.prop("checked"),notificar_por_usuario_aprovador:r.chk_notificacao_aprovador.prop("checked"),emails_adicionais:JSON.stringify(r.tab_email_usuarios.arr_dados)||JSON.stringify([]),tipo_anexo:r.tipo_anexo,arrAprovadoresManual:JSON.stringify(r.ListarAprovadores.props.arrAprovadoresManual),tipo_aprovacao:r.cbo_tipo_aprovacao.val(),alcada_generica_id:r.cbo_selecionar_alcada.val(),prazo_dias:r.edt_prazo_dias.val(),utilizar_controle_distribuicao:r.chk_copia_controlada.prop("checked"),distribuicao_controlada:r.dataGrid_distribuicao_controlada.getController("editing").getChanges().length?CircularJSON.stringify(r.dataGrid_distribuicao_controlada.getController("editing").getChanges()):null,referencia_tabela:r.referencia_tabela,referencia_id:r.referencia_id},function(a){r.documento_pasta_id=a.id,DevExpress.ui.notify.default({message:a.nome+" salvo com sucesso",type:"success",displayTime:3e3,width:300}),void 0!==r.onsave&&r.onsave&&r.onsave(),r.houve_alteracao=!0,r.vincular_documento_pdca(r.documento_id),r.vincular_documento_tarefa_quadro_lista_cartao(r.documento_id),o?e(i):r.unload()},[r.btn_salvar],null,!0)}):((r.inputArquivoNovo.props.arquivoSelecionado||r.inputNovaRevisao.props.arquivoSelecionado)&&r.cbo_tipo_documento.val()>0&&r.cbo_local_armazenamento.val()>0&&r.cbo_assunto.val()>0&&r.edt_nome.val()&&(r.edt_observacao_revisao.val()||r.edt_observacao_novo.val())&&r.btn_salvar.text("Aguarde, enviando o arquivo."),WS.post("documento/salvar",{documento_id:r.documento_id,nome:r.edt_nome.val(),codigo:r.edt_codigo.val(),validade:r.edt_validade.val(),validade_periodo:r.cbo_validade_periodo.val(),data_vigencia:get_datepicker(r.edt_data_vigencia),observacao_documento:r.edt_observacao_novo.val(),observacao_historico_documento:r.edt_observacoes_historico.html(),observacao_revisao:r.edt_observacao_revisao.val(),assunto_id:r.cbo_assunto.val(),tipo_documento_id:r.cbo_tipo_documento.val(),local_armazenamento_id:r.cbo_local_armazenamento.val(),documento_pasta_id:r.documento_pasta_id,arquivo:o?null:r.inputArquivoNovo.props.arquivoSelecionado||r.inputNovaRevisao.props.arquivoSelecionado||null,usuarios_permissoes:JSON.stringify(r.usuarios_array),grupos_permissoes:JSON.stringify(r.grupos_array),controle_acessos:r.chk_controle_acessos.prop("checked"),atividade_id:r.atividade_id,projeto_id:r.projeto_id,solicitacao_id:r.solicitacao_id,solicitacao_atividade_id:r.solicitacao_atividade_id,oportunidade_id:r.oportunidade_id,tag:r.edt_tag.val(),notificar_por_email:r.chk_notificacoes.prop("checked"),notificar_por_email_antes:r.chk_notificar_email_antes.prop("checked"),dias_notificacao_email:r.edt_dias_notitificacao.val(),notificar_por_usuario_seguranca:r.chk_notificacao_seguranca.prop("checked"),notificar_por_usuario_aprovador:r.chk_notificacao_aprovador.prop("checked"),emails_adicionais:JSON.stringify(r.tab_email_usuarios.arr_dados)||JSON.stringify([]),versoes:JSON.stringify(r.versoes),tipo_anexo:r.tipo_anexo,arrAprovadoresManual:JSON.stringify(r.ListarAprovadores.props.arrAprovadoresManual),tipo_aprovacao:r.cbo_tipo_aprovacao.val(),alcada_generica_id:r.cbo_selecionar_alcada.val(),prazo_dias:r.edt_prazo_dias.val(),utilizar_controle_distribuicao:r.chk_copia_controlada.prop("checked"),distribuicao_controlada:r.dataGrid_distribuicao_controlada.getController("editing").getChanges().length?CircularJSON.stringify(r.dataGrid_distribuicao_controlada.getController("editing").getChanges()):null,referencia_tabela:r.referencia_tabela,referencia_id:r.referencia_id},function(a){r.documento_pasta_id=a.id,DevExpress.ui.notify.default({message:a.nome+" salvo com sucesso",type:"success",displayTime:3e3,width:300}),void 0!==r.onsave&&r.onsave&&r.onsave(),r.houve_alteracao=!0,r.vincular_documento_pdca(a.id),r.vincular_documento_tarefa_quadro_lista_cartao(a.id),o?e(i):r.unload()},[r.btn_salvar],null,!0))},this.pesquisar_email=function(a){var o=r.tab_email_usuarios.input.val(),i=0,e=function(a){r.tab_email_usuarios.bp_drop.parent().attr("data-visible","true");var o=function(){var a=$(this).attr("data-email");r.tab_email_usuarios.input.val(a),r.tab_email_usuarios.btn_add.trigger("click"),r.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")};r.tab_email_usuarios.bp_drop.append($('<li class="li_click '+(0==i?"active":"")+'" data-email="'+a.email+'" data-selecionado="'+(0==i)+'">'+a.nome+" [ "+a.email+" ]</li>").click(o).mousedown(o)),i++};a.which!=KEYPRESS_PADRAO.KEYUP&&a.which!=KEYPRESS_PADRAO.KEYDOWN&&a.which!=KEYPRESS_PADRAO.ENTER&&WS.get("usuario/listar/",{nome:o},function(a){r.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove();for(var o=0;o<a.length;o++){var i=a[o];e(i)}})},this.vincular_documento_pdca=function(a){if(void 0!==r.pdca_atividade_id&&r.pdca_atividade_id>0){var o={documento_id:a,pdca_id:r.pdca_id,pdca_atividade_id:r.pdca_atividade_id};WS.post("documento/vincular_pdca_atividade_documento/",o,function(a){},[])}},this.vincular_documento_tarefa_quadro_lista_cartao=function(a){if(r.tarefa_quadro_lista_cartao_id){var o={documento_id:a,tarefa_quadro_lista_cartao_id:r.tarefa_quadro_lista_cartao_id};WS.post("documento/vincular_tarefa_quadro_lista_cartao_documento/",o,function(a){})}},this.evento_hover_li=function(a,o){var i=$(o).find(".active");a==KEYPRESS_PADRAO.KEYUP?$(i).prev().length>0&&($(o).find(".active").removeClass("active").removeAttr("data-selecionado",!1),$(i).prev().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.KEYDOWN?$(i).next().length>0&&($(o).find(".active").removeClass("active").attr("data-selecionado",!1),$(i).next().addClass("active").attr("data-selecionado",!0)):a==KEYPRESS_PADRAO.ENTER&&($(o).find(".active").length>0?($(o).find(".active").trigger("click"),r.tab_email_usuarios.bp_drop.find("li:not([template-row])").remove()):r.tab_email_usuarios.btn_add.trigger("click"),r.tab_email_usuarios.bp_drop.parent().attr("data-visible","false"))},this.renderizar_dx_selecao_pasta=function(a){a&&(a=a.toString()),ReactDOM.render(React.createElement(window.components.SelecaoPasta.default,{selecionado:a,aoAlterar(a){r.documento_pasta_id=a},readOnly:r.tipo==FORMULARIO.VISUALIZAR}),r.dx_selecao_pasta[0])},this.validar_campos_obrigatorios=function(){let a=[];return null!==r.edt_nome.val()&&""!==r.edt_nome.val().trim()||a.push("- Informe o nome do documento."),null!==r.cbo_assunto.val()&&""!==r.cbo_assunto.val().trim()||a.push("- Informe o assunto do documento."),null!==r.cbo_tipo_documento.val()&&""!==r.cbo_tipo_documento.val().trim()||a.push("- Informe o tipo do documento."),null!==r.cbo_local_armazenamento.val()&&""!==r.cbo_local_armazenamento.val().trim()||a.push("- Informe o local de armazenamento do documento."),!a.length||(alertaPopUp("Validação",`Preencha os campos obrigatórios antes de continuar:<br><br>${a.join("<br>")}`),!1)},this.chk_notificacoes.unbind("change").change(function(){1==$(this).prop("checked")||1==r.chk_notificar_email_antes.prop("checked")?(r.chk_notificacao_seguranca.parents(".row").removeClass("hidden"),r.chk_notificacao_outros_usuarios.parents(".row").removeClass("hidden"),r.chk_notificacao_aprovador.parents(".row").removeClass("hidden")):(r.chk_notificacao_seguranca.prop("checked",!1).change().parents(".row").addClass("hidden"),r.chk_notificacao_outros_usuarios.prop("checked",!1).change().parents(".row").addClass("hidden"),r.chk_notificacao_aprovador.prop("checked",!1).change().parents(".row").addClass("hidden"))}),this.chk_notificacao_outros_usuarios.unbind("change").change(function(){1==$(this).prop("checked")?r.div_emails_adicionais.removeClass("hidden"):r.div_emails_adicionais.addClass("hidden"),r.tab_email_usuarios.reset()}),this.tab_email_usuarios.btn_add.unbind("click").click(function(a){var o=parseInt(r.tab_email_usuarios.elem_key,10)+1;r.tab_email_usuarios.elem_key=o;var i=r.tab_email_usuarios.input.val(),e={elem_key:o,email:i};r.tab_email_usuarios.add_email(e,function(a){if(a){var t=r.tab_email_usuarios.create_row(i);t.attr("data-id",o),r.tab_email_usuarios.getColumn(t,"btn_remover_email").unbind("click").click(function(a){var o=$(this),i=$(o).parents("tr");$(i).remove(),r.tab_email_usuarios.remove_email(e.elem_key)}),r.tab_email_usuarios.input.val("")}})}),this.tab_email_usuarios.input.unbind("focusout").focusout(function(){r.tab_email_usuarios.bp_drop.parent().attr("data-visible","false")}),this.tab_email_usuarios.input.unbind("keyup").keyup($.debounce(200,r.pesquisar_email)),this.tab_email_usuarios.input.keyup(function(a){r.evento_hover_li(a.which,r.tab_email_usuarios.bp_drop)}),this.cbo_tipo_aprovacao.unbind("change"),this.cbo_tipo_aprovacao.change(function(){if(2==r.cbo_tipo_aprovacao.val())r.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),r.div_edt_prazo_dias.removeClass("hidden"),r.div_cbo_selecionar_alcada.removeClass("hidden"),r.div_cbo_aprovador.addClass("hidden"),r.listar_alcada(),r.ListarAprovadores.props.setAprovadoresManual(null);else if(1==r.cbo_tipo_aprovacao.val()){r.div_tipo_aprovacao.removeClass("col-sm-12 col-md-6").addClass("col-sm-8 col-md-4"),r.div_edt_prazo_dias.removeClass("hidden"),r.div_cbo_selecionar_alcada.addClass("hidden"),r.div_cbo_aprovador.removeClass("hidden"),r.ListarAprovadores.props.setAlcadaSelecionada(null),r.ListarAprovadores.props.setDocumentoSelecionado(parseInt(r.documento_id));var a=r.cbo_aprovador.parent();r.edt_aprovador=a.find(".edt_combobox"),r.edt_aprovador.keypress(function(a){if(13==a.keyCode){var o=r.cbo_aprovador.parent().find(".ncbo_scroll").find(".row_selected"),i=o.attr("dados-adicionais")?JSON.parse(o.attr("dados-adicionais")):null;r.ListarAprovadores.props.setAprovadoresManual(i),r.cbo_aprovador.parent().find(".edt_combobox").val(""),o.removeClass("row_selected")}})}else r.div_tipo_aprovacao.removeClass("col-sm-8 col-md-4").addClass("col-sm-12 col-md-6"),r.div_edt_prazo_dias.addClass("hidden"),r.div_cbo_selecionar_alcada.addClass("hidden"),r.div_cbo_aprovador.addClass("hidden"),r.ListarAprovadores.props.setAlcadaSelecionada(null),r.ListarAprovadores.props.setAprovadoresManual(null)}),this.cbo_selecionar_alcada.unbind("change"),this.cbo_selecionar_alcada.change(function(){r.ListarAprovadores.props.setAlcadaSelecionada(parseInt($(this).val()))}),this.btn_carregar_mais_historico.unbind("click").click(function(){if(r.todos_carregados)return!1;r.btn_carregar_mais_historico.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),r.btn_carregar_mais_historico.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_historico.append('<span class="icn_carregar_mais fa fa-spinner fa-spin"></span>'),r.limite=r.limite+r.limite_quantidade,WS.get("documento/listar_historico/",{documento_id:r.documento_id,limite:r.limite,limite_quantidade:r.limite_quantidade},function(a){r.render_historico(a,!1)})}),this.btn_carregar_mais_aprovacoes.unbind("click").click(function(){if(r.param_todos_carregados_aprovacoes)return!1;r.btn_carregar_mais_aprovacoes.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),r.btn_carregar_mais_aprovacoes.find("span.icn_carregar_mais").remove(),r.btn_carregar_mais_aprovacoes.append('<span class="icn_carregar_mais fa fa-spinner fa-spin"></span>'),r.param_inicial_aprovacoes=r.param_inicial_aprovacoes+r.param_qtde_aprovacoes,r.render_aprovacoes(!1)}),this.btn_aprovacoes_historico.unbind("click").click(function(){r.btn_aprovacoes_configuracoes.removeClass("active"),r.btn_aprovacoes_historico.addClass("active"),r.aprovacoes_configuracoes.hide(),r.aprovacoes_historico.fadeIn()}),this.btn_aprovacoes_configuracoes.unbind("click").click(function(){r.btn_aprovacoes_historico.removeClass("active"),r.btn_aprovacoes_configuracoes.addClass("active"),r.aprovacoes_historico.hide(),r.aprovacoes_configuracoes.fadeIn()}),this.btn_distribuicoes_historico.unbind("click").click(function(){r.btn_distribuicoes_configuracoes.removeClass("active"),r.btn_distribuicoes_historico.addClass("active"),r.distribuicoes_configuracoes.hide(),r.distribuicoes_historico.fadeIn()}),this.btn_distribuicoes_configuracoes.unbind("click").click(function(){r.btn_distribuicoes_historico.removeClass("active"),r.btn_distribuicoes_configuracoes.addClass("active"),r.distribuicoes_historico.hide(),r.distribuicoes_configuracoes.fadeIn()}),this.menu_referencias.unbind("click").click(function(){r.menu_referencias.parent().hasClass("active")||(ReactDOM.unmountComponentAtNode(r.div_componente_referencias[0]),ReactDOM.render(React.createElement(window.components.Referencias.default,{tabela:"documento",id:r.documento_id}),r.div_componente_referencias[0]))})}});