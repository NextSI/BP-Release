# Referências entre módulos
03/08/2021
## Melhoria
## Referência: BPM4222
## Módulo: Geral
***

## Novo componente "Referências"

Adicionado nas telas "Atividades/Solicitações de Processo", "Atividades de projeto", "Cartões de tarefas", "Pós-ação do PDCA", "Oportunidades do CRM" e "Documento" a nova aba "Referências". 

Retiradas as abas "Chamados", "Processos", "Documentos", que realizavam a antiga referência entre módulos.

Com o novo componente  as referências estão centralizadas sendo possível acessar rapidamente registros relacionados.

![]([PATH_IMG]/BPM4222-1.png)


## Dados em tabelas

É possível visualizar os dados do módulo em uma tabela, clicando sobre a linha do módulo, posteriormente será exibida a listagem de registros em uma tabela. Com possibilidade de criação de filtros, ordenações de colunas e exportação dos dados.

![]([PATH_IMG]/BPM4222-2.png)


## Inclusão de referência

Para incluir referências, clique em "Adicionar referência interna" e selecione o módulo desejado. De acordo com cada módulo poderão aparecer opções para pesquisar um registro já existente ou criar um registro (exemplo: chamado, documento, solicitação de processo).

![]([PATH_IMG]/BPM4222-3.png)

A remoção de referências só é permitida para referências internas, ou seja, através do registro de origem da referência.

## Considerações Técnicas

### API
Para realizar integrações com outros softwares, utilize a [Documentação da API Webservice]([PATH_SWAGGER]#/Referencias)

### Alteração na estrutura da base de dados

Quinze (15) tabelas foram retiradas do Next BP:

* tarefa_quadro_lista_cartao_documento
* tarefa_quadro_lista_cartao_chamado
* tarefa_quadro_lista_cartao_solicitacao
* solicitacao_documento
* solicitacao_atividade_chamado
* solicitacao_atividade_vinculada
* projeto_documento
* projeto_atividade_chamado
* projeto_atividade_solicitacao
* pdca_atividade_documento
* pdca_atividade_chamado
* pdca_atividade_solicitacao
* oportunidade_documento
* oportunidade_chamado
* oportunidade_solicitacao

Estas tabelas eram responsáveis por registrar a referência entre os registros, de forma descentralizada. Os dados foram migrados e centralizados na tabela `referencia`.

Se as tabelas retiradas estão sendo utilizadas em seus scripts específicos do Next BP ou em outros softwares, então deverá ser necessário ajustar seu código.

Com a implantação do novo modelo de referências, todos os dados serão salvos na tabela `referencia`. Onde as colunas `tabela_a` e `id_a` representam o registro de origem da referência, e as colunas `tabela_b` e `id_b` representam o registro referenciado.

Exemplo:

| tabela_a | id_a | tabela_b | id_b |
| ------------------------------------ |
| oportunidade| 3091 | chamado | 46387 |
| tarefa_quadro_lista_cartao | 157 | chamado | 46387 |
| projeto_atividade | 18115 | chamado | 46387 |
| chamado | 46387 | chamado | 46463 |
| pdca_atividade | 138 | chamado | 46387 |
| chamado | 46458 | chamado | 46387 |

Na primeira linha, temos o exemplo da oportunidade 3091, que possui o chamado 46387 como uma referência interna. Sendo assim, o chamado 46387 possuí a oportunidade 3091 como uma referência externa.