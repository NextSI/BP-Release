define(["react","react-dom"],function(i,a){return function(e){"use strict";var o,r=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.title="Usuário",this.tipo=null,this.onclose=null,this.scrollview=this.dialog.find(".scrollview"),this.edt_id=this.dialog.find(".edt_id"),this.div_nome_usuario=this.dialog.find(".div_nome_usuario"),this.div_id_usuario=this.dialog.find(".div_id_usuario"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_email=this.dialog.find(".edt_email"),this.edt_username=this.dialog.find(".edt_username"),this.edt_senha=this.dialog.find(".edt_senha"),this.files=this.dialog.find(".files"),this.carrega_img=this.dialog.find(".carrega_img"),this.btn_exibir_senha=this.dialog.find(".btn_exibir_senha"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.div_chk_admin=this.dialog.find(".div_chk_admin"),this.chk_admin=this.dialog.find(".chk_admin"),this.chk_alterar_senha_proximo_login=this.dialog.find(".chk_alterar_senha_proximo_login"),this.cbo_area=this.dialog.find(".cbo_area"),this.btn_area_novo=this.dialog.find(".btn_area_novo"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.edt_codigo_externo=this.dialog.find(".edt_codigo_externo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_incluir_cliente=this.dialog.find(".btn_incluir_cliente"),this.tab_listagem_cliente=this.dialog.find(".tab_listagem_cliente"),this.div_cliente=this.dialog.find(".div_cliente"),this.modal_usuario_cbo_area=this.dialog.find(".modal_usuario_cbo_area"),this.modal_usuario_cbo_calendario_trabalho=this.dialog.find(".modal_usuario_cbo_calendario_trabalho"),this.lbl_tipo=this.dialog.find(".lbl_tipo"),this.edt_nivel=this.dialog.find(".edt_nivel"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.btn_incluir_empresa=this.dialog.find(".btn_incluir_empresa"),this.btn_incluir_fornecedor=this.dialog.find(".btn_incluir_fornecedor"),this.btn_incluir_prospect=this.dialog.find(".btn_incluir_prospect"),this.tab_listagem_fornecedor=this.dialog.find(".tab_listagem_fornecedor"),this.div_fornecedor=this.dialog.find(".div_fornecedor"),this.div_prospect=this.dialog.find(".div_prospect"),this.tab_listagem_prospect=this.dialog.find(".tab_listagem_prospect"),this.btn_incluir_grupo_motivo=this.dialog.find(".btn_incluir_grupo_motivo"),this.tab_listagem_grupo_motivo=this.dialog.find(".tab_listagem_grupo_motivo"),this.div_grupo_motivo=this.dialog.find(".div_grupo_motivo"),this.div_grupo_usuarios=this.dialog.find(".div_grupo_usuarios"),this.div_user_comum=this.dialog.find(".div_user_comum"),this.tab_listagem_empresa=this.dialog.find(".tab_listagem_empresa"),this.div_empresa=this.dialog.find(".div_empresa"),this.tab_dados_gerais=this.dialog.find(".tab_dados_gerais"),this.edt_telefone1=this.dialog.find(".edt_telefone1"),this.edt_telefone2=this.dialog.find(".edt_telefone2"),this.edt_telefone3=this.dialog.find(".edt_telefone3"),this.edt_telefone4=this.dialog.find(".edt_telefone4"),this.edt_cpf=this.dialog.find(".edt_cpf"),this.edt_data_nascimento=this.dialog.find(".edt_data_nascimento"),this.edt_data_admissao=this.dialog.find(".edt_data_admissao"),this.cbo_idiomas=this.dialog.find(".cbo_idiomas"),this.edt_assinatura=this.dialog.find(".edt_assinatura"),this.cbo_usuario_ldap=this.dialog.find(".cbo_usuario_ldap"),this.btn_listar_usuarios_ldap=this.dialog.find(".btn_listar_usuarios_ldap"),this.btn_limpar=this.dialog.find(".btn_limpar"),this.edt_usuario_ldap=this.dialog.find(".edt_usuario_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.edt_servidor_ldap=this.dialog.find(".edt_servidor_ldap"),this.btn_autenticar_ldap=this.dialog.find(".btn_autenticar_ldap"),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.btn_fechar_modal=this.dialog.find(".btn_fechar_modal"),this.btn_validar_autenticacao=this.dialog.find(".btn_validar_autenticacao"),this.chk_ldap_entrar_entrar_automaticamente=this.dialog.find(".chk_ldap_entrar_entrar_automaticamente"),this.servidor_ldap_id=null,this.usuario_id=null,this.foto_id=null,this.arr_clientes=[],this.arr_clientes_filtrados=[],this.arr_prospects=[],this.arr_prospects_filtrados=[],this.arr_fornecedores=[],this.arr_fornecedores_filtrados=[],this.arr_grupo_motivo=[],this.arr_grupo_motivo_filtrados=[],this.arr_empresa=[],this.arr_empresa_filtrados=[],this.senha="",this.perfis_padrao=null,this.tipo_usuario_inicial=null,this.arr_grupos=[],this.show=function(i,a){switch(r.scrollview.dxScrollView().dxScrollView("instance"),r.scrollview.css("height","calc(100vh - 77px)"),r.edt_assinatura.attr("id","edt_assinatura"+r.html_id),r.edt_cpf.mask("999.999.999-99"),r.listar_perfis_padrao(),a){case FORMULARIO.NOVO:r.edt_email.val(""),r.edt_senha.val(""),r.div_id_usuario.remove(),r.div_nome_usuario.addClass("col-md-12").removeClass("col-md-10"),r.btn_salvar.show(),r.btn_excluir.hide(),r.edt_nivel.attr("max",parseInt(App.sessao.dados.nivel,10)),r.edt_nivel.val(10).trigger("change"),r.permite_alterar(!0);break;case FORMULARIO.EDITAR:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}r.tipo=a,void 0!==i&&i?(r.usuario_id=i,r.preencher(),1==i&&(r.edt_nome.prop("disabled",!0),r.div_user_comum.addClass("hidden"))):(App.titulo_aba(r.html_id,"Usuário - Novo"),r.listar_areas(),r.listar_calendario_trabalho(),r.cbo_tipo.change(),set_tinymce(r.edt_assinatura,""),r.render_selecao_grupo_usuarios()),App.verifica_permissao(App.temp.empresa,"gestao_chamados")?r.div_grupo_motivo.show():r.div_grupo_motivo.hide(),App.verifica_permissao(App.temp.empresa,"grupo_usuarios")?r.div_grupo_usuarios.show():r.div_grupo_usuarios.hide(),1==App.sessao.dados.admin&&r.div_chk_admin.removeClass("hidden"),set_focus(r.edt_nome)},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.permite_alterar=function(i){r.edt_id.prop("readonly",!0),r.edt_nome.prop("readonly",!i),r.edt_email.prop("readonly",!i),r.edt_username.prop("readonly",!i),r.edt_senha.prop("readonly",!i),r.chk_bloqueado.prop("checked",!i).change(),r.chk_alterar_senha_proximo_login.prop("checked",!i).change(),r.edt_telefone1.prop("readonly",!i),r.edt_telefone2.prop("readonly",!i),r.edt_telefone3.prop("readonly",!i),r.edt_telefone4.prop("readonly",!i),r.edt_cpf.prop("readonly",!i),r.edt_codigo_externo.prop("disabled",!i),r.edt_data_nascimento.prop("disabled",!i),r.edt_data_admissao.prop("disabled",!i),!0===App.sessao.dados.admin?r.chk_admin.prop("disabled",!i):r.chk_admin.prop("disabled",!0),r.files.prop("disabled",!i),r.cbo_area.prop("disabled",!i),r.btn_area_novo.prop("disabled",!i),r.cbo_calendario_trabalho.prop("disabled",!i),r.btn_calendario_trabalho_novo.prop("disabled",!i),r.edt_nivel.prop("disabled",!i),r.cbo_tipo.prop("disabled",!i),r.cbo_usuario_ldap.prop("disabled",!i),r.btn_incluir_empresa.prop("disabled",!i),r.btn_incluir_prospect.prop("disabled",!i),r.btn_incluir_fornecedor.prop("disabled",!i),r.btn_incluir_cliente.prop("disabled",!i),r.btn_incluir_grupo_motivo.prop("disabled",!i),r.btn_limpar.prop("disabled",!i),r.btn_listar_usuarios_ldap.prop("disabled",!i)},this.preencher=function(){WS.get("usuario/objeto/",{usuario_id:r.usuario_id},function(i){null!=i.nome&&App.titulo_aba(r.html_id,"Usuário - "+i.nome.substring(0,15)),r.edt_id.val(i.id),r.edt_nome.val(i.nome),r.edt_username.val(i.username),r.edt_email.val(i.email),App.sessao.dados.senhas_ocultas||App.sessao.dados.senhas_md5?(r.edt_senha.attr("placeholder","Alterar senha"),App.sessao.dados.senhas_md5||(r.senha=i.senha)):r.edt_senha.val(i.senha),r.edt_telefone1.val(i.telefone1),r.edt_telefone2.val(i.telefone2),r.edt_telefone3.val(i.telefone3),r.edt_telefone4.val(i.telefone4),r.edt_cpf.val(i.cpf),r.edt_codigo_externo.val(i.codigo_externo),r.edt_data_nascimento.val(i.data_nascimento),r.edt_data_admissao.val(i.data_admissao),set_tinymce(r.edt_assinatura,i.assinatura_email,r.tipo==FORMULARIO.VISUALIZAR||r.tipo==FORMULARIO.EXCLUIR),i.tipo==USUARIO_TIPO.CLIENTE?(r.arr_clientes=i.usuario_cliente,r.render_clientes()):i.tipo==USUARIO_TIPO.ANALISTA?(r.arr_empresa=i.usuario_empresa,r.render_empresa()):i.tipo==USUARIO_TIPO.FORNECEDOR?(r.arr_fornecedores=i.usuario_fornecedor,r.render_fornecedores()):i.tipo==USUARIO_TIPO.PROSPECT&&(r.arr_prospects=i.usuario_prospect,r.render_prospects()),r.tipo_usuario_inicial=i.tipo,"none"!=r.div_grupo_motivo.css("display")&&(r.arr_grupo_motivo=i.arr_grupo_motivo,r.render_grupo_motivo()),r.arr_grupos=i.grupo_usuarios?i.grupo_usuarios.map(function(i){return i.grupo_usuarios_id}):null,r.render_selecao_grupo_usuarios({selecionado:r.arr_grupos}),r.chk_bloqueado.prop("checked",i.bloqueado).change(),""!=i.ldap_login&&null!=i.ldap_login&&(i.alterar_senha_proximo_login=!1),r.chk_alterar_senha_proximo_login.prop("checked",i.alterar_senha_proximo_login).change();var a=r.chk_bloqueado.prop("disabled");r.chk_bloqueado.prop("disabled",!1),r.chk_admin.prop("disabled",!1),!0===i.bloqueado&&r.chk_bloqueado.prop("checked",!0).change(),!0===i.admin&&(r.chk_admin.prop("checked",!0).change(),r.cbo_tipo.find('option[value="1"]').remove(),r.cbo_tipo.find('option[value="4"]').remove(),r.cbo_tipo.find('option[value="5"]').remove()),null!=i.foto_id?"S"==i.foto_id.midia&&r.carrega_img.attr("src",WS_URI+"documento/midia/?documento_id="+i.foto_id.id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):r.carrega_img.attr("src","assets/img/imagem_usuario_padrao.svg"),r.chk_bloqueado.prop("disabled",a),r.chk_admin.prop("disabled",a),r.edt_nivel.val(i.nivel).trigger("change"),r.cbo_tipo.val(i.tipo),r.listar_areas(i.area_id),r.listar_calendario_trabalho(i.calendario_trabalho_id),r.servidor_ldap_id=i.servidor_ldap_id,i.ldap_login&&(add_option(r.cbo_usuario_ldap,"0",i.ldap_login),r.cbo_usuario_ldap.selectpicker(),r.cbo_usuario_ldap.selectpicker("refresh"),r.cbo_usuario_ldap.val(0).trigger("change")),o=i.tipo,r.cbo_tipo.change()})},this.listar_areas=function(i){r.cbo_area.find("option").remove(),add_option(r.cbo_area,"","Nenhum"),WS.get("area/listar/",null,function(a){for(var e=0;e<a.data.length;e++){var o=a.data[e];add_option(r.cbo_area,o.id,o.nome)}i&&r.cbo_area.val(i).trigger("change")})},this.listar_calendario_trabalho=function(i){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(a){for(var e=0;e<a.length;e++){var o=a[e];add_option(r.cbo_calendario_trabalho,o.calendario_trabalho_id,o.nome)}i&&r.cbo_calendario_trabalho.val(i).trigger("change")})},this.preview_foto=function(i){if(0===$(this).get(0).files.length)r.carrega_img.attr("src","assets/img/imagem_usuario_padrao.svg"),$(this).parent().find(".anexo_base_button_text").text("Nenhum arquivo selecionado!");else{var a=i.target.files[0],e=new FileReader;e.onload=function(i){r.carrega_img.attr("src",i.target.result)},e.readAsDataURL(a),$(this).parent().find(".anexo_base_button_text").text($(this).val().split("fakepath\\").length>1?$(this).val().split("fakepath\\")[1].toString():$(this).val().split("fakepath\\")[0].toString())}},this.render_grupo_motivo=function(){var i=r.tab_listagem_grupo_motivo.find("tbody"),a=i.find("tr:first");$(r.arr_grupo_motivo).each(function(i,a){void 0===r.arr_grupo_motivo[i].removido&&(r.arr_grupo_motivo[i].removido=!1)}),r.arr_grupo_motivo_filtrados=r.arr_grupo_motivo.filter(function(i){var a=!0;return!0===i.removido&&(a=!1),a}),r.tab_listagem_grupo_motivo.find("tr:gt(1)").remove(),$(r.arr_grupo_motivo_filtrados).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_grupo_motivo']")).text(e.nome);var t=$(o.find(".btn_deletar_grupo_motivo"));switch(t.unbind("click"),t.click(function(){alert_modal("Grupo de Motivo do chamado","Deseja remover o grupo de motivo?","Remover",function(){$(r.arr_grupo_motivo).each(function(i,a){a.grupo_id==e.grupo_id&&(r.arr_grupo_motivo[i].removido=!0,r.render_grupo_motivo())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(i)}(o)}),App.aplicar_mascaras(i)},this.listar_perfis_padrao=function(){WS.get("perfil_padrao/listar/",null,function(i){r.perfis_padrao=i.lista_perfil_padrao})},this.render_clientes=function(){var i=r.tab_listagem_cliente.find("tbody"),a=i.find("tr:first");$(r.arr_clientes).each(function(i,a){void 0===r.arr_clientes[i].removido&&(r.arr_clientes[i].removido=!1)}),r.arr_clientes_filtrados=r.arr_clientes.filter(function(i){var a=!0;return!0===i.removido&&(a=!1),a}),r.tab_listagem_cliente.find("tr:gt(1)").remove(),$(r.arr_clientes_filtrados).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_cliente"));switch(t.unbind("click"),t.click(function(){alert_modal("Cliente","Deseja remover o cliente?","Remover",function(){$(r.arr_clientes).each(function(i,a){a.cliente_id==e.cliente_id&&(r.arr_clientes[i].removido=!0,r.render_clientes())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(i)}(o)}),App.aplicar_mascaras(i)},this.render_fornecedores=function(){var i=r.tab_listagem_fornecedor.find("tbody"),a=i.find("tr:first");$(r.arr_fornecedores).each(function(i,a){void 0===r.arr_fornecedores[i].removido&&(r.arr_fornecedores[i].removido=!1)}),r.arr_fornecedores_filtrados=r.arr_fornecedores.filter(function(i){var a=!0;return!0===i.removido&&(a=!1),a}),r.tab_listagem_fornecedor.find("tr:gt(1)").remove(),$(r.arr_fornecedores_filtrados).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_fornecedor"));switch(t.unbind("click"),t.click(function(){alert_modal("Fornecedor","Deseja remover o fornecedor?","Remover",function(){$(r.arr_fornecedores).each(function(i,a){a.fornecedor_id==e.fornecedor_id&&(r.arr_fornecedores[i].removido=!0,r.render_fornecedores())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(i)}(o)}),App.aplicar_mascaras(i)},this.render_empresa=function(){var i=r.tab_listagem_empresa.find("tbody"),a=i.find("tr:first");$(r.arr_empresa).each(function(i,a){void 0===r.arr_empresa[i].removido&&(r.arr_empresa[i].removido=!1)}),r.arr_empresa_filtrados=r.arr_empresa.filter(function(i){var a=!0;return!0===i.removido&&(a=!1),a}),r.tab_listagem_empresa.find("tr:gt(1)").remove(),$(r.arr_empresa_filtrados).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_empresa"));switch(t.unbind("click"),t.click(function(){alert_modal("Empresa","Deseja remover a empresa?","Remover",function(){$(r.arr_empresa).each(function(i,a){a.empresa_id==e.empresa_id&&(r.arr_empresa[i].removido=!0,r.render_empresa())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(i)}(o)}),App.aplicar_mascaras(i)},this.validar_campos_autenticacao=function(){var i=!0;""!=r.edt_usuario_ldap.val()&&""!=r.edt_senha_ldap.val()&&(i=!1),r.btn_validar_autenticacao.prop("disabled",i)},this.render_prospects=function(){var i=r.tab_listagem_prospect.find("tbody"),a=i.find("tr:first");$(r.arr_prospects).each(function(i,a){void 0===r.arr_prospects[i].removido&&(r.arr_prospects[i].removido=!1)}),r.arr_prospects_filtrados=r.arr_prospects.filter(function(i){var a=!0;return!0===i.removido&&(a=!1),a}),r.tab_listagem_prospect.find("tr:gt(1)").remove(),$(r.arr_prospects_filtrados).each(function(e,o){!function(e){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_prospect"));switch(t.unbind("click"),t.click(function(){alert_modal("prospect","Deseja remover o prospect?","Remover",function(){$(r.arr_prospects).each(function(i,a){a.prospect_id==e.prospect_id&&(r.arr_prospects[i].removido=!0,r.render_prospects())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(i)}(o)}),App.aplicar_mascaras(i)},this.render_selecao_grupo_usuarios=function(e){e||(e={});var o={aoAlterar:function(i){r.arr_grupos=i}};Object.assign(o,e),a.render(i.createElement(window.components.SelecaoGrupoUsuarios.default,o),r.div_grupo_usuarios[0])},this.btn_exibir_senha.unbind("click"),this.btn_exibir_senha.click(function(){var i=r.btn_exibir_senha.find(".ico_senha");"password"==r.edt_senha.attr("type")?(r.edt_senha.attr("type","text"),i.removeClass("glyphicon-eye-open"),i.addClass("glyphicon glyphicon-eye-close")):(r.edt_senha.attr("type","password"),i.removeClass("glyphicon-eye-close"),i.addClass("glyphicon glyphicon-eye-open"))}),this.edt_usuario_ldap.blur(function(){r.validar_campos_autenticacao()}),this.edt_senha_ldap.blur(function(){r.validar_campos_autenticacao()}),this.btn_area_novo.unbind("click"),this.btn_area_novo.click(function(){View.load("area/detalhes",function(i,a){a.onclose=function(){a.area_id&&r.listar_areas(a.area_id)},a.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(i,a){a.onclose=function(){a.calendario_trabalho_id&&r.listar_calendario_trabalho(a.calendario_trabalho_id)},a.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if($.each(r.files,function(i,a){a.files.length>0&&(r.foto_id=a.files[0])}),new RegExp(/^[A-Za-z0-9@._-]+$/).test(r.edt_username.val().trim())||""==r.edt_username.val().trim()||null==r.edt_username.val().trim())var i=setInterval(function(){var a=function(){WS.post("usuario/salvar",{usuario_id:r.usuario_id,nome:r.edt_nome.val(),email:r.edt_email.val(),username:r.edt_username.val().trim(),senha:""==r.edt_senha.val()?r.senha:r.edt_senha.val(),admin:1==r.chk_admin.prop("checked")?"S":"N",alterar_senha_proximo_login:1==r.chk_alterar_senha_proximo_login.prop("checked")?"S":"N",bloqueado:1==r.chk_bloqueado.prop("checked")?"S":"N",area_id:r.cbo_area.val(),calendario_trabalho_id:r.cbo_calendario_trabalho.val(),usuario_cliente:JSON.stringify(r.arr_clientes_filtrados),usuario_fornecedor:JSON.stringify(r.arr_fornecedores_filtrados),usuario_prospect:JSON.stringify(r.arr_prospects_filtrados),arr_grupo_motivo:JSON.stringify(r.arr_grupo_motivo_filtrados),usuario_empresa:JSON.stringify(r.arr_empresa_filtrados),nivel:r.edt_nivel.val(),tipo:r.cbo_tipo.val(),foto_id:r.foto_id,telefone1:r.edt_telefone1.val(),telefone2:r.edt_telefone2.val(),telefone3:r.edt_telefone3.val(),telefone4:r.edt_telefone4.val(),cpf:r.edt_cpf.val(),data_nascimento:r.edt_data_nascimento.val(),data_admissao:r.edt_data_admissao.val(),assinatura_email:get_tinymce(r.edt_assinatura),ldap_login:""!=r.cbo_usuario_ldap.val()?r.cbo_usuario_ldap.find("option:selected").text():"",servidor_ldap_id:r.servidor_ldap_id,codigo_externo:r.edt_codigo_externo.val(),grupo_usuarios:JSON.stringify(r.arr_grupos)},function(i){r.usuario_id=i.id,alert_saved(i.nome+" salvo com sucesso"),r.unload()},null,null,!0)};r.tipo==FORMULARIO.EDITAR?WS.post("perfil_padrao_permissao/existe",{tipo_usuario:r.cbo_tipo.val()},function(i){i&&r.cbo_tipo.val()!=r.tipo_usuario_inicial?function(){if(null!==r.perfis_padrao&&r.perfis_padrao.length>0){var i=null,e="",t="";if(o!=r.cbo_tipo.val()&&""!=(o=r.cbo_tipo.val())){for(var n=0;n<r.perfis_padrao.length;n++)if(r.perfis_padrao[n].codigo==o){i={calendario_trabalho:null==r.perfis_padrao[n].calendario_trabalho_id?0:r.perfis_padrao[n].calendario_trabalho_id,nivel:r.perfis_padrao[n].nivel,area:null==r.perfis_padrao[n].area_id?0:r.perfis_padrao[n].area_id};break}i&&(0!=i.calendario_trabalho&&(e=r.cbo_calendario_trabalho.find('option[value="'+i.calendario_trabalho+'"]').text()),0!=i.area&&(t=r.cbo_area.find('option[value="'+i.area+'"]').text()),alert_modal("Sugestão","Deseja alterar os seguintes dados: <br><br>"+(0!=i.calendario_trabalho&&r.cbo_calendario_trabalho.val()!=i.calendario_trabalho?"-<b> Calendário de Trabalho</b>: "+e+"<br>":"")+(0!=i.area&&r.cbo_area.val()!=i.area?"-<b> Área</b>: "+t+"<br>":"")+(r.edt_nivel.val()!=i.nivel?"-<b> Nível</b>: "+i.nivel+"<br><br>":"")+"Suas permissões de acordo com o padrão "+r.cbo_tipo.find('option[value="'+o+'"]').text()+" ? ","Alterar",function(){r.setar_permissoes(r.cbo_tipo.val()),a()},!0,"Não",null,function(){a()}))}}}():a()},null,null,!0):a(),clearInterval(i)},500);else alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Não é permitido caracteres especiais no nome de usuário !")}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("usuario/excluir",{usuario_id:r.usuario_id},function(i){alert_saved(i.nome+" excluido com sucesso"),r.unload()})}),this.btn_incluir_grupo_motivo.unbind("click"),this.btn_incluir_grupo_motivo.click(function(){View.load("grupo_motivo_chamado/selecionar",function(i,a){a.show(function(i){var a=!1;$(r.arr_grupo_motivo).each(function(e,o){o.grupo_id==i.grupo_id&&(a=!0,r.arr_grupo_motivo[e].removido=!1)}),a||r.arr_grupo_motivo.push(i),r.render_grupo_motivo()})})}),this.btn_incluir_cliente.unbind("click"),this.btn_incluir_cliente.click(function(){View.load("cliente/selecionar",function(i,a){a.show(function(i){var a=!1;$(r.arr_clientes).each(function(e,o){o.cliente_id==i.cliente_id&&(a=!0,r.arr_clientes[e].removido=!1)}),a||r.arr_clientes.push(i),r.render_clientes()})})}),this.edt_nivel.unbind("change"),this.edt_nivel.change(function(){"S"!=App.sessao.dados.admin&&1!=App.sessao.dados.admin&&parseInt(this.value,10)>parseInt(App.sessao.dados.nivel,10)&&r.edt_nivel.val(App.sessao.dados.nivel)}),this.btn_incluir_fornecedor.unbind("click"),this.btn_incluir_fornecedor.click(function(){View.load("fornecedor/selecionar",function(i,a){a.show(function(i){var a=!1;$(r.arr_fornecedores).each(function(e,o){o.fornecedor_id==i.fornecedor_id&&(a=!0,r.arr_fornecedores[e].removido=!1)}),a||r.arr_fornecedores.push(i),r.render_fornecedores()})})}),this.btn_incluir_prospect.unbind("click"),this.btn_incluir_prospect.click(function(){View.load("prospect/selecionar",function(i,a){a.show(function(i){var a=!1;$(r.arr_prospects).each(function(e,o){o.prospect_id==i.prospect_id&&(a=!0,r.arr_prospects[e].removido=!1)}),a||r.arr_prospects.push(i),r.render_prospects()})})}),this.btn_incluir_empresa.unbind("click"),this.btn_incluir_empresa.click(function(){View.load("empresa/selecionar",function(i,a){a.show(function(i){var a=!1;$(r.arr_empresa).each(function(e,o){o.empresa_id==i.empresa_id&&(a=!0,r.arr_empresa[e].removido=!1)}),a||r.arr_empresa.push(i),r.render_empresa()})})}),this.chk_admin.change(function(){if(r.chk_admin.prop("checked")){if(1!=App.sessao.dados.admin){var i=new Validation;return i.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Você não tem permissão para definir usuários administradores. Por favor, contate algum administrador do sistema")),alert_modal("Validação",i),$(this).prop("checked",!1),void $(this).prop("disabled",!0)}r.cbo_tipo.find('option[value="1"]').remove(),r.cbo_tipo.find('option[value="4"]').remove(),r.cbo_tipo.find('option[value="5"]').remove(),r.modal_usuario_cbo_area.find(".campo_obrigatorio").addClass("hidden"),r.modal_usuario_cbo_calendario_trabalho.find(".campo_obrigatorio").addClass("hidden"),r.lbl_tipo.find(".campo_obrigatorio").addClass("hidden")}else r.chk_admin.prop("checked")||1!=App.sessao.dados.admin||(add_option(r.cbo_tipo,1,"Cliente","selected"),add_option(r.cbo_tipo,4,"Fornecedor"),add_option(r.cbo_tipo,5,"Organização"),r.cbo_tipo.val(""),r.modal_usuario_cbo_area.find(".campo_obrigatorio").removeClass("hidden"),r.modal_usuario_cbo_calendario_trabalho.find(".campo_obrigatorio").removeClass("hidden"),r.lbl_tipo.find(".campo_obrigatorio").removeClass("hidden"));r.cbo_tipo.trigger("change")}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){r.div_cliente.hide(),r.div_fornecedor.hide(),r.div_prospect.hide(),r.div_empresa.hide(),r.edt_data_admissao.parent().hide(),"1"==r.cbo_tipo.val()?r.div_cliente.show():"4"==r.cbo_tipo.val()?r.div_fornecedor.show():"5"==r.cbo_tipo.val()?r.div_prospect.show():"2"==r.cbo_tipo.val()&&(r.div_empresa.show(),r.edt_data_admissao.parent().show())}),this.btn_listar_usuarios_ldap.unbind("click"),this.btn_listar_usuarios_ldap.click(function(){View.load("servidor_ldap/login",function(i,a){a.onclose=null,a.show(r,!0)})}),this.btn_limpar.unbind("click"),this.btn_limpar.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Deseja remover o usuário vinculado ao LDAP ?</strong></span></div>','<i class="fa fa-check-square" aria-hidden="true"></i> Sim',function(){r.cbo_usuario_ldap.find("option").remove(),r.cbo_usuario_ldap.selectpicker("refresh"),r.servidor_ldap_id=null},!0,'<i class="fa fa-undo" aria-hidden="true"></i> Não')}),this.btn_fechar_modal.unbind("click"),this.btn_fechar_modal.click(function(){r.close(),View.unload(r.usuario_id)}),this.setar_permissoes=function(i){if(void 0!==r.perfis_padrao&&r.perfis_padrao)for(var a=0;a<r.perfis_padrao.length;a++)if(r.perfis_padrao[a].codigo==i)return null!==r.perfis_padrao[a].calendario_trabalho_id&&r.cbo_calendario_trabalho.val(r.perfis_padrao[a].calendario_trabalho_id),r.perfis_padrao[a].nivel>0&&r.edt_nivel.val(r.perfis_padrao[a].nivel),void(null!==r.perfis_padrao[a].area_id&&r.cbo_area.val(r.perfis_padrao[a].area_id))},r.files[0].addEventListener("change",r.preview_foto,!1)}});