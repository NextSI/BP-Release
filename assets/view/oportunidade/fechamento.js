define([],function(){return function(a){"use strict";var e=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.onclose=null,this.onsave=null,this.edt_data_fechamento=this.dialog.find(".edt_data_fechamento"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.cbo_empresas=this.dialog.find(".cbo_empresas"),this.div_empresa=this.dialog.find(".div_empresa"),this.oportunidade_id=null,this.escolha_empresa_ganho_perda="",this.show=function(a,i){e.escolha_empresa_ganho_perda=i,"S"==i&&(e.div_empresa.removeClass("hidden"),e.lista_empresas()),e.oportunidade_id=a,set_datepicker(e.edt_data_fechamento);var s=new Date,t=s.getFullYear(),o=("0"+(s.getMonth()+1)).slice(-2),d=s.getDate();d<10&&(d="0"+d);var n=t+"-"+o+"-"+d;set_datepicker(e.edt_data_fechamento,n),show_modal(e.modal.attr("id"))},this.lista_empresas=function(){e.cbo_empresas.find("option").remove(),add_option(e.cbo_empresas,-1,"Selecione uma empresa"),$.each(App.sessao.dados.usuario_empresa,function(a,i){add_option(e.cbo_empresas,i.empresa_id,i.nome_fantasia)}),e.cbo_empresas.val(App.sessao.dados.empresa_filial_id).trigger("change"),e.cbo_empresas.selectpicker("refresh")},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){e.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){var a={oportunidade_id:e.oportunidade_id,situacao:"G",data_situacao:get_datepicker(e.edt_data_fechamento),empresa_filial_id:"S"!=e.escolha_empresa_ganho_perda?App.sessao.dados.empresa_filial_id:e.cbo_empresas.val()};WS.post("oportunidade/atualizar_situacao",a,function(a){alert_saved("Situação alterada com sucesso"),void 0!==e.onsave&&e.onsave&&e.onsave(),e.unload()},[e.btn_salvar,e.btn_cancelar])})}});