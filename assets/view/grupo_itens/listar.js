define([],function(){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title=App.lang.grupo_item.aba_listar,this.onclose=null,this.params={limite:0},this.params_template={limite:0,considerar_bloqueado:!1},this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_limite=!1,this.btn_novo_analitico=this.dialog.find(".btn_novo_analitico"),this.btn_novo_sintetico=this.dialog.find(".btn_novo_sintetico"),this.btn_atualizar=this.dialog.find(".btn_atualizar"),this.btn_limpar_filtros=this.dialog.find(".btn_limpar_filtros"),this.btn_ordenacao=this.dialog.find(".orderbypointer"),this.btn_config=this.dialog.find(".btn_config"),this.btn_filtro=this.dialog.find(".btn_filtro"),this.btn_selecionar=this.dialog.find(".btn_selecionar"),this.container_filtro=this.dialog.find("[filtro]"),this.chk_mostrar_bloqueados=this.dialog.find(".chk_mostrar_bloqueados"),this.chk_codigo_automatico=this.dialog.find(".chk_codigo_automatico"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.show=function(){t.inicializar_componentes(),t.listar(!0)},this.listar=function(a){if(void 0!==a&&"boolean"==typeof a||(a=!1),!t.bloqueia_limite){t.params.limite=t.limite,t.params.considerar_bloqueado=t.chk_mostrar_bloqueados.prop("checked");var i=function(a,i){var e=i.pai_id,o=i.id,r=i.raiz_id;i=extender_parametros({codigo:"-",descricao:"-"},i);var n=$.Tabela_Padrao_Next.create_row(t.tab_listagem);n.attr("elem-key",o),n.attr("parent-key",e),n.attr("nivel",i.nivel),n.attr("data-retraido","false"),n.attr("data-parent-retraido","false"),n.attr("data-tipo","simples"),n.attr("raiz-id",r),n.css({cursor:"pointer"}),$.Tabela_Padrao_Next.getColumn(n,"codigo").text(i.codigo);var s=$.Tabela_Padrao_Next.getColumn(n,"descricao .nome").text(i.descricao),c=$.Tabela_Padrao_Next.getColumn(n,"acao"),l=$.Tabela_Padrao_Next.getColumn(c,"btn_visualizar"),_=$.Tabela_Padrao_Next.getColumn(c,"btn_editar"),d=$.Tabela_Padrao_Next.getColumn(c,"btn_excluir"),u=$.Tabela_Padrao_Next.getColumn(c,"btn_novo_menu"),m=$.Tabela_Padrao_Next.getColumn(u,"btn_novo_sintetico"),p=$.Tabela_Padrao_Next.getColumn(u,"btn_novo_analitico"),g=function(a,i){var e=$(a);i&&(e=$(a).parents("tr"));var o="true"==e.attr("data-retraido");e.attr("data-retraido",!o),e.attr("data-parent-retraido",!o),t.retrair(e,!o)};if(l.unbind("click").click(function(a){t.evento_visualizar($(this),i)}),_.unbind("click").click(function(a){t.evento_editar($(this),i)}),d.unbind("click").click(function(a){t.evento_excluir($(this),i)}),$.Tabela_Padrao_Next.addEvent(n,{nome:"dblclick",func:function(a){g($(this),!0)}}),i.tipo==TIPO_ARVORE.ANALITICO)s.css("padding-left",15*i.nivel+"px"),u.remove();else if(i.tipo==TIPO_ARVORE.SINTETICO){var f=$.Tabela_Padrao_Next.getColumn(n,"descricao .glyphicon").removeClass("hidden").css({"padding-left":15*i.nivel+"px","font-weight":"bold"});m.unbind("click").click(function(a){View.load("grupo_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.SINTETICO,pai_id:o};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),p.unbind("click").click(function(a){View.load("grupo_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.ANALITICO,pai_id:o};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),$.Tabela_Padrao_Next.addEvent(f,{nome:"click",func:function(a){g($(this),!0)}})}0==e?$.Tabela_Padrao_Next.RenderAt(t.tab_listagem,n,0):$.Tabela_Padrao_Next.RenderRow(t.tab_listagem,n,e)};WS.get({route:"grupo_itens/listar/",data:t.params,func_response:function(e){if(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down">'),e){a&&(t.limite=t.limite+t.limite_a_cada);for(var o=0;o<e.length;o++){var r=e[o];i(0,r)}0==e.length&&(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check">'),t.bloqueia_limite=!0)}},html_id:t.html_id,disable_buttons:[t.btn_atualizar,t.btn_limpar_filtros]})}},this.limpar_tabela=function(){$.Tabela_Padrao_Next.clear(t.tab_listagem),t.params.limite=0,t.limite=0,t.bloqueia_limite=!1},this.unload=function(){View.unload(this.html_id)},this.inicializar_componentes=function(){t.container_filtro.toggle(!1),0==App.sessao.dados.admin?t.chk_codigo_automatico.parent().remove():WS.get("grupo_itens/get_parametro/",{},function(a){a&&(t.chk_codigo_automatico.prop("checked","S"==a.grupo_itens_codigo_automatico).change(),t.chk_codigo_automatico.unbind("change").change(function(a){WS.post("grupo_itens/set_parametro/",{codigo_automatico:t.chk_codigo_automatico.val()},function(a){a&&alert_saved("Configuração salva com sucesso!")})}))}),$.Tabela_Padrao_Next.Filtros.Start(t.tab_listagem,{},function(a,i,e){t.params=extender_parametros(t.params_template,a),setTimeout(function(){t.evento_atualizar()},600)})},this.evento_atualizar=function(){t.limpar_tabela(),t.listar(!0)},this.evento_visualizar=function(a,i){View.load("grupo_itens/detalhes",function(a,e){var o={tipo:FORMULARIO.VISUALIZAR,grupo_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(o)},View.ABA.SIM)},this.evento_editar=function(a,i){View.load("grupo_itens/detalhes",function(a,e){var o={tipo:FORMULARIO.EDITAR,grupo_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(o)},View.ABA.SIM)},this.evento_excluir=function(a,i){View.load("grupo_itens/detalhes",function(a,e){var o={tipo:FORMULARIO.EXCLUIR,grupo_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(o)},View.ABA.SIM)},this.func_organizacao=function(a,i){t.limpar_tabela(),t.params=t.params_template,t.params.orderby=a,t.params.asc=i,setTimeout(function(){t.listar(!0)},300)},this.retrair=function(a,t){void 0===t&&(t=!1);var i=parseInt($(a).attr("nivel"),10),e=parseInt($(a).attr("raiz-id"),10),o=$(a).find('[data-bp-column="descricao"] [template-button="btn_efect"]'),r=$(a).nextAll('[raiz-id="'+e+'"]');$(a).attr("data-parent-retraido",t);for(var n=0;n<r.length;n++){if(!(i<parseInt($(r[n]).attr("nivel"),10)))return;if(t)$(o).removeClass("glyphicon-triangle-bottom"),$(o).addClass("glyphicon-triangle-right"),$(r[n]).attr("data-retraido","true"),void 0!==$(r[n]).attr("data-retraido-by")&&null!=$(r[n]).attr("data-retraido-by")&&""!=$(r[n]).attr("data-retraido-by")||$(r[n]).attr("data-retraido-by",md5($(a).attr("elem-key"))),$(r[n]).animate({opacity:0},{duration:200,complete:function(){$(this).addClass("hidden")}});else{$(o).addClass("glyphicon-triangle-bottom"),$(o).removeClass("glyphicon-triangle-right");var s=md5($(a).attr("elem-key"));$(r[n]).attr("data-retraido-by")==s&&($(r[n]).attr("data-retraido-by",""),$(r[n]).removeClass("hidden").animate({opacity:1},200)),"A"==$(r[n]).attr("data-tipo")?$(r[n]).attr("data-retraido","false"):"S"==$(r[n]).attr("data-tipo")&&($(r[n]).attr("data-retraido","false"),$(r[n]).attr("data-parent-retraido","false"))}}},this.btn_atualizar.unbind("click").click(function(a){t.evento_atualizar()}),this.btn_limpar_filtros.unbind("click").click(function(a){$.tabela_padrao_bp_filtro("clean",t.html_id,t.tab_listagem),t.chk_mostrar_bloqueados.prop("checked",!1).trigger("change"),t.params=t.params_template,t.limpar_tabela(),t.listar(!0)}),this.btn_novo_sintetico.unbind("click").click(function(a){View.load("grupo_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.SINTETICO};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),this.btn_novo_analitico.unbind("click").click(function(a){View.load("grupo_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.ANALITICO};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),this.btn_ordenacao.unbind("click").click(function(a){var i=$(this),e=$(i).attr("data-ordername"),o=$(i).attr("data-asc");if(0===o.length){for(var r=0;r<t.btn_ordenacao.length;r++)if($(t.btn_ordenacao[r])!==$(i)){try{$(t.btn_ordenacao[r]).find(".icon_orderby").removeClass("fa-sort-up fa-sort-down").addClass("hidden fa-sort-down")}catch(a){}$(t.btn_ordenacao[r]).attr("data-asc","")}o=!0,$(i).attr("data-asc",o),$(i).find(".icon_orderby").removeClass("hidden")}else o=!(o="true"==o),$(i).attr("data-asc",o),$(i).find(".icon_orderby").toggleClass("fa-sort-down fa-sort-up");t.func_organizacao(e,o)}),this.btn_filtro.unbind("click").click(function(a){var i=$(this).prop("data-active");i=!i,$(this).prop("data-active",i),t.container_filtro.toggle(i)}),this.btn_config.unbind("click").click(function(a){View.load("grupo_itens/configuracao",function(a,t){t.show()})}),this.btn_carregar_mais.unbind("click").click(function(){t.bloqueia_limite||(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),t.listar(!0))}),t.show()}});