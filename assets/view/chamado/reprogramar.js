define([],function(){return function(a){"use strict";var o=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.edt_prazo=this.dialog.find(".edt_prazo"),this.div_prazo_horas=this.dialog.find(".div_prazo_horas"),this.edt_prazo_horas=this.dialog.find(".edt_prazo_horas"),this.edt_horas_trabalhadas=this.dialog.find(".edt_horas_trabalhadas"),this.cbo_responsavel=this.dialog.find(".cbo_responsavel"),this.txt_motivo=this.dialog.find(".txt_motivo"),this.lbl_total_chamados_selecionados=this.dialog.find(".lbl_total_chamados_selecionados"),this.lbl_id_chamados=this.dialog.find(".lbl_id_chamados"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.chamados=new Array,this.data_previsao_retorno=null,this.tipo_gestao_tempo=null,this.show=function(a,t){if(o.listar_responsavel(),o.txt_motivo.attr("id","txt_motivo"+o.html_id),"2"==t){if(set_datepicker(o.edt_prazo),o.chamados=a,o.chamados.length>0){var s=0,i="";o.lbl_total_chamados_selecionados.removeClass("hidden");for(var d=0;d<=o.chamados.length-1;d++)i+="#"+o.chamados[d].id+"  ",s++;o.lbl_total_chamados_selecionados.text("Chamados ("+s+")"),o.lbl_id_chamados.text(i)}}else if("1"==t&&(o.div_prazo_horas.removeClass("hidden"),o.edt_prazo_horas.removeClass("hidden"),o.chamados=a,o.chamados.length>0)){for(s=0,i="",o.lbl_total_chamados_selecionados.removeClass("hidden"),d=0;d<=o.chamados.length-1;d++)i+="#"+o.chamados[d].id+"  ",s++;o.lbl_total_chamados_selecionados.text("Chamados ("+s+")"),o.lbl_id_chamados.text(i)}set_tinymce(o.txt_motivo,"",!1,MODULOS.CHAMADO),formatarCampoHorasTrabalhadas(function(a){o.edt_horas_trabalhadas.mask(a),o.edt_horas_trabalhadas.attr("placeholder",a),show_modal(o.modal.attr("id"))})},this.listar_responsavel=function(a){o.cbo_responsavel.find("option").remove(),add_option(o.cbo_responsavel,"","- Selecione -"),add_option(o.cbo_responsavel,App.sessao.dados.usuario_id,App.sessao.dados.nome),WS.get("usuario/listar/",{tipo_usuario:2},function(t){for(var s=0;s<t.length;s++){var i=t[s];i.usuario_id!=App.sessao.dados.usuario_id&&add_option(o.cbo_responsavel,i.usuario_id,i.nome)}a&&o.cbo_responsavel.val(a).trigger("change"),o.cbo_responsavel.selectpicker("refresh")})},this.validar_hora_minuto=function(){var a=new window.Validation,t=o.edt_horas_trabalhadas.val().split(":"),s=t[1];if(t.length,s>59||o.edt_horas_trabalhadas.val().length>0&&6!=o.edt_horas_trabalhadas.val().length&&5!=o.edt_horas_trabalhadas.val().length)return a.add(new window.ValidationMessage(window.Validation.CODES.ERR_FIELD,'Campo "Horas Trabalhadas" inválido!')),window.alert_modal("Validação",a),!1;var i=o.edt_horas_trabalhadas.val();return 2==t.length&&(i="0"+i),!(i>"838:59"&&(a.add(new window.ValidationMessage(window.Validation.CODES.ERR_FIELD,'Campo "Horas Trabalhadas" deve ser menor que 838:59 horas!')),window.alert_modal("Validação",a),1))},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){o.unload()}),this.btn_confirmar.unbind("click"),this.btn_confirmar.click(function(){o.data_previsao_retorno=get_datepicker(o.edt_prazo_horas),o.data_previsao_retorno=get_datepicker(o.edt_prazo)+" "+o.edt_prazo_horas.val(),o.validar_hora_minuto(o.edt_horas_trabalhadas.val())&&WS.post("chamado/reprogramar/",{prazo:"2"==o.tipo_gestao_tempo?get_datepicker(o.edt_prazo):o.data_previsao_retorno,motivo:get_tinymce(o.txt_motivo),chamados:JSON.stringify(o.chamados),responsavel:o.cbo_responsavel.val(),horas_trabalhadas:o.edt_horas_trabalhadas.val()},function(a){alert_saved("Chamados reprogramados com sucesso"),o.unload()},[o.btn_confirmar,o.btn_cancelar])})}});