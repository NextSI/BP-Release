define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.div_ipi=this.dialog.find(".div_ipi"),this.cbo_impostos=this.dialog.find(".cbo_impostos"),this.edt_porcentagem=this.dialog.find(".edt_porcentagem"),this.cbo_cst_impostos=this.dialog.find(".cbo_cst_impostos"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.imposto_id=null,this.parametros_impostos=null,this.imposto={ipi_aliquota:0,codigo_imposto:null,excluido:"N",ipi_cst:null},this.show=function(i,t,s){WS.get("itens/get_parametros/",null,function(a){switch(o.parametros_impostos=a,s&&(o.imposto.ipi_aliquota=s),t){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:o.btn_salvar.hide(),o.btn_excluir.hide(),o.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:o.btn_salvar.hide(),o.btn_excluir.show(),o.permite_alterar(!1)}o.add_mascara(),o.tipo=t,"undefined"!=typeof area_id&&area_id?(o.imposto_id=i,o.preencher()):o.listar_impostos(),show_modal(o.modal.attr("id")),set_focus(o.edt_porcentagem)})},this.add_mascara=function(){o.edt_porcentagem.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2})},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.listar_impostos=function(i){for(var t in o.cbo_impostos.find("option").remove(),add_option(o.cbo_impostos,"0","Selecione"),IMPOSTOS)"clean"!=t&&"S"==o.parametros_impostos.imposto_ipi&&IMPOSTOS[t]==IMPOSTOS.IPI&&add_option(o.cbo_impostos,IMPOSTOS[t],get_imposto_nome(IMPOSTOS[t]),'prefixo="'+t+'" nome_imposto="'+get_imposto_nome(IMPOSTOS[t])+'"');i&&o.cbo_impostos.val(i).trigger("change"),o.cbo_impostos.selectpicker("refresh")},this.listar_cst_impostos=function(i,t){for(var s in o.cbo_cst_impostos.find("option").remove(),add_option(o.cbo_cst_impostos,"0","CST"),IMPOSTOS_CST)"clean"!=s&&(s.substring(0,s.indexOf("_")),s.toUpperCase().indexOf(t.toUpperCase())>-1&&add_option(o.cbo_cst_impostos,IMPOSTOS_CST[s],IMPOSTOS_CST[s]+" - "+get_cst_imposto_nome(IMPOSTOS_CST[s]),"nome_cst_imposto="+get_cst_imposto_nome(IMPOSTOS_CST[s])));i&&o.cbo_cst_impostos.val(i).trigger("change"),o.cbo_cst_impostos.selectpicker("refresh")},this.permite_alterar=function(i){o.edt_porcentagem.prop("disabled",!i)},this.preencher=function(){o.listar_impostos(o.imposto_id),o.edt_porcentagem.val(o.imposto.ipi_aliquota)},this.validar=function(){var i=!0,t=new Validation;return""==o.imposto.codigo_imposto||null==o.imposto.codigo_imposto||0==parseInt(o.imposto.codigo_imposto,10)?(t.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe o Imposto.")),i=!1):(""!=o.imposto.ipi_cst&&null!=o.imposto.ipi_cst&&0!=parseInt(o.imposto.ipi_cst,10)||(t.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe o Código de Situação Tributária (CST) do Imposto.")),i=!1),""!=o.imposto.ipi_aliquota&&null!=o.imposto.ipi_aliquota&&0!=o.imposto.ipi_aliquota||(t.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe a porcentagem do Imposto.")),i=!1)),i||alert_modal("Validação",t),i},this.cbo_impostos.unbind("change"),this.cbo_impostos.change(function(){switch(parseInt(this.value,10)){case IMPOSTOS.IPI:o.div_ipi.removeClass("hidden");break;case 0:o.div_ipi.addClass("hidden")}o.listar_cst_impostos(null,o.cbo_impostos.find('[value="'+this.value+'"]').attr("prefixo"))}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){o.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){o.imposto.ipi_aliquota=o.edt_porcentagem.maskMoney("unmasked")[0],o.imposto.codigo_imposto=o.cbo_impostos.val(),o.imposto.ipi_cst=o.cbo_cst_impostos.val(),o.validar()&&o.onsave&&void 0!==o.onsave&&(o.unload(),o.onsave(o.imposto))}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){})}});