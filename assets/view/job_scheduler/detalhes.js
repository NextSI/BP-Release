define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.cbo_script=this.dialog.find(".cbo_script"),this.chk_ativo=this.dialog.find(".chk_ativo"),this.edt_minuto=this.dialog.find(".edt_minuto"),this.edt_hora=this.dialog.find(".edt_hora"),this.edt_dia=this.dialog.find(".edt_dia"),this.edt_mes=this.dialog.find(".edt_mes"),this.edt_dia_semana=this.dialog.find(".edt_dia_semana"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.job_scheduler_id=null,this.cubo_id=null,this.show=function(i,o,a){t.tipo=o,a&&(t.cubo_id=a),void 0!==i&&i?(t.job_scheduler_id=i,t.preencher()):t.listar_scripts(),show_modal(t.modal.attr("id")),set_focus(t.cbo_script)},this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.permite_alterar=function(){var i=!0;switch(t.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:t.btn_salvar.show(),t.btn_excluir.hide(),i=!0;break;case FORMULARIO.VISUALIZAR:t.btn_salvar.hide(),t.btn_excluir.hide(),i=!1;break;case FORMULARIO.EXCLUIR:t.btn_salvar.hide(),t.btn_excluir.show(),i=!1}t.cbo_script.prop("disabled",t.cubo_id||!i),t.chk_ativo.bootstrapSwitch("disabled",!i),t.edt_minuto.prop("readonly",!i),t.edt_hora.prop("readonly",!i),t.edt_dia.prop("readonly",!i),t.edt_mes.prop("readonly",!i),t.edt_dia_semana.prop("readonly",!i)},this.preencher=function(){WS.get("job_scheduler/objeto/",{job_scheduler_id:t.job_scheduler_id},function(i){t.listar_scripts(i.script),t.chk_ativo.prop("checked",!0===i.ativo).change(),t.edt_minuto.val(i.minuto),t.edt_hora.val(i.hora),t.edt_dia.val(i.dia),t.edt_mes.val(i.mes),t.edt_dia_semana.val(i.dia_semana),t.permite_alterar()})},this.listar_scripts=function(i){t.cbo_script.find("option").remove(),add_option(t.cbo_script,"","Nenhum"),WS.get("job_scheduler/listar_scripts/",null,function(o){for(var a=!1,e=0;e<o.length;e++){var d=o[e];add_option(t.cbo_script,d,d),i==d&&(a=!0)}i&&0==a&&add_option(t.cbo_script,i,i+" (arquivo nÃ£o encontrado)"),i?t.cbo_script.val(i).trigger("change"):t.cubo_id&&t.cbo_script.val("Cubo.job.php").trigger("change"),t.permite_alterar()})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("job_scheduler/salvar",{job_scheduler_id:t.job_scheduler_id,script:t.cbo_script.val(),ativo:t.chk_ativo.prop("checked"),minuto:t.edt_minuto.val(),hora:t.edt_hora.val(),dia:t.edt_dia.val(),mes:t.edt_mes.val(),dia_semana:t.edt_dia_semana.val(),cubo_id:t.cubo_id},function(i){t.job_scheduler_id=i.id,alert_saved(i.script+" salvo com sucesso"),t.unload()})}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("job_scheduler/excluir",{job_scheduler_id:t.job_scheduler_id},function(i){alert_saved(i.script+" excluido com sucesso"),t.unload()})})}});