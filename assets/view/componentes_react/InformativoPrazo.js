"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}define(["react","react-dom"],function(e,t){return function(t){function r(e){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).state={DiferencaHorasUteis:"00:00",DiferencaDias:0,DiferencaHorasUteisSegundos:0,PrazoEstourado:!1,Percentual:0,DataPrazoSegundos:0,DataPrazoParaCalendarioDoUsuarioLogado:""},t.props.Configuracoes={ViewParent:null,Alinhamento:"left",TipoGestaoTempo:GESTAO_TEMPO.HORAS_UTEIS,HorasEstimadas:null,DiasEstimados:null,DataPrazo:"",CalendarioTrabalhoId:null,LabelExcedente:"Atrasado",LabelRestante:"Restante",TituloDataPrazo:"Prazo",StyleWidth:"200px",ExibirTituloDataPrazo:!1,ExibirDataPrazo:!0,ExibirBarraProgresso:!0,ExibirDiferencaHorasUteis:!0,IntervalId:0,chamadoEncerrado:!1},t.props.setConfiguracoes=function(e){t.props.Configuracoes=spread(t.props.Configuracoes,e),t.props.Configuracoes.ViewParent&&(t.props.IntervalId=View.setInterval(t.props.Configuracoes.ViewParent,function(){t.processarDados()},6e4)),t.processarDados()},t.props.desativarRefreshAutomatico=function(){View.removeInterval(t.props.IntervalId)},t}return _inherits(r,e.Component),_createClass(r,[{key:"processarDados",value:function(){if(!this.props.Configuracoes.DataPrazo)return null;var e=new Date,t=e.now(),r={DiferencaHorasUteis:"00:00",DiferencaDias:0,DiferencaHorasUteisSegundos:0,PrazoEstourado:!1,Percentual:0,DataPrazo:0,DataPrazoParaCalendarioDoUsuarioLogado:""};t>this.props.Configuracoes.DataPrazo&&(r.PrazoEstourado=!0);var o=0;if(o=r.PrazoEstourado?fn_segundos_uteis(this.props.Configuracoes.CalendarioTrabalhoId,this.props.Configuracoes.DataPrazo,t):fn_segundos_uteis(this.props.Configuracoes.CalendarioTrabalhoId,t,this.props.Configuracoes.DataPrazo),r.DiferencaHorasUteis=fn_converter_segundos_para_horas(o),r.DataPrazo=date_create(this.props.Configuracoes.DataPrazo),r.DataPrazo.setMilliseconds(0),r.DataPrazo.setSeconds(0),r.DataPrazo.setMinutes(0),r.DataPrazo.setHours(0),e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0),e.setHours(0),r.DiferencaDias=date_diff(r.DataPrazo,e.getTime()),r.PrazoEstourado)r.Percentual=100;else if(+this.props.Configuracoes.TipoGestaoTempo==GESTAO_TEMPO.HORAS_UTEIS&&this.props.Configuracoes.HorasEstimadas&&"00:00:00"!=this.props.Configuracoes.HorasEstimadas){var a=fn_converter_horas_para_segundos(this.props.Configuracoes.HorasEstimadas);r.Percentual=(a-o)/a*100}else+this.props.Configuracoes.TipoGestaoTempo==GESTAO_TEMPO.DIAS_CORRIDOS&&this.props.Configuracoes.DataPrazo&&this.props.Configuracoes.DiasEstimados&&(r.Percentual=(+this.props.Configuracoes.DiasEstimados-r.DiferencaDias)/+this.props.Configuracoes.DiasEstimados*100);r.Percentual>100&&(r.Percentual=100),r.Percentual<0&&(r.Percentual=0),this.setState(r)}},{key:"renderDataPrazo",value:function(){var t=null;this.props.Configuracoes.ExibirTituloDataPrazo&&(t=e.createElement("div",{style:{whiteSpace:"nowrap"},className:"right"==this.props.Configuracoes.Alinhamento?"text-right":""},this.props.Configuracoes.TituloDataPrazo));var r=null;return+this.props.Configuracoes.TipoGestaoTempo==GESTAO_TEMPO.DIAS_CORRIDOS?r=e.createElement("div",{style:{whiteSpace:"nowrap"},className:"right"==this.props.Configuracoes.Alinhamento?"text-right":"",title:this.props.Configuracoes.TituloDataPrazo},this.props.Configuracoes.DataPrazo?this.props.Configuracoes.DataPrazo.format_date():""):+this.props.Configuracoes.TipoGestaoTempo==GESTAO_TEMPO.HORAS_UTEIS&&(r=e.createElement("div",{style:{whiteSpace:"nowrap"},className:"right"==this.props.Configuracoes.Alinhamento?"text-right":"",title:this.props.Configuracoes.TituloDataPrazo},this.props.Configuracoes.DataPrazo?this.props.Configuracoes.DataPrazo.format_date_time():"")),e.createElement("div",null,t,r)}},{key:"renderDiferencaHorasUteis",value:function(){var t=null,r=this.state.PrazoEstourado||0===this.state.DiferencaDias?"text-danger":"text-default",o={font:"inherit",width:"100%",whiteSpace:"nowrap"},a={fontWeight:"bold",paddingLeft:"0px",paddingRight:"0px"};switch("left"==this.props.Configuracoes.Alinhamento&&(a.paddingRight="10px"),"right"==this.props.Configuracoes.Alinhamento&&(a.paddingLeft="10px"),+this.props.Configuracoes.TipoGestaoTempo){case GESTAO_TEMPO.DIAS_CORRIDOS:t=e.createElement("div",{style:o,className:"text "+r,title:this.props.Configuracoes.TituloDataPrazo},dia_contador_str(this.state.DiferencaDias,this.state.PrazoEstourado));break;case GESTAO_TEMPO.HORAS_UTEIS:t=e.createElement("div",{style:o,className:"text "+r,title:this.state.PrazoEstourado?this.props.Configuracoes.LabelExcedente:this.props.Configuracoes.LabelRestante},this.state.DiferencaHorasUteis)}return e.createElement("div",{style:a},t)}},{key:"renderBarraProgresso",value:function(){if(+this.props.Configuracoes.TipoGestaoTempo==GESTAO_TEMPO.DIAS_CORRIDOS&&this.props.Configuracoes.DataPrazo&&!this.props.Configuracoes.DiasEstimados)return null;var t=this.state.PrazoEstourado?"progress-bar-danger":"progress-bar-default";return e.createElement("div",{className:"progress div_progress",style:{marginBottom:"0px",height:"12px"}},e.createElement("div",{className:"progress-bar progress-bar-striped "+t,style:{width:this.state.Percentual+"%"}}))}},{key:"renderTooltip",value:function(){return e.createElement("div",null,this.renderDataPrazo())}},{key:"render",value:function(){if(this.props.Configuracoes.chamadoEncerrado||!this.props.Configuracoes.DataPrazo)return e.createElement(e.Fragment,null,e.createElement("span",null,"-"));var t=null;this.props.Configuracoes.ExibirDataPrazo&&(t=this.renderDataPrazo());var r=null;this.props.Configuracoes.ExibirBarraProgresso&&(r=this.renderBarraProgresso());var o=null;this.props.Configuracoes.ExibirDiferencaHorasUteis&&(o=this.renderDiferencaHorasUteis());var a=null,s=null;return"right"==this.props.Configuracoes.Alinhamento&&(a="row-reverse",s="end"),e.createElement("div",{style:{width:this.props.Configuracoes.StyleWidth}},e.createElement("div",{style:{display:"flex",flexWrap:"wrap",flexFlow:a,justifyContent:s}},o,t),e.createElement("div",{style:{}},r))}}]),r}()});