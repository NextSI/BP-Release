define([],function(){return function(a){"use strict";var e=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Relatório de Produtividade",this.dx_listagem_sintetico=this.dialog.find(".dx_listagem_sintetico"),this.dx_listagem_analitico=this.dialog.find(".dx_listagem_analitico"),this.params_processo_id=null,this.params_responsavel_id=null,this.params_solicitante_id=null,this.params_codigo=null,this.params_descricao=null,this.params_data_solicitacao_ini=null,this.params_data_solicitacao_fim=null,this.params_data_recebimento_ini=null,this.params_data_recebimento_fim=null,this.params_data_execucao_ini=null,this.params_data_execucao_fim=null,this.params_tipo=null,this.resizing_mode_sintetico=!0,this.resizing_mode_analitico=!0,this.clearState=!1,this.show=function(a){void 0!==a?a==RELATORIO_PROCESSO.SINTETICO?(e.dx_listagem_analitico.addClass("hidden"),e.dx_listagem_sintetico.removeClass("hidden"),e.listar_sintetico()):(e.dx_listagem_sintetico.addClass("hidden"),e.dx_listagem_analitico.removeClass("hidden"),e.listar_analitico()):(e.dx_listagem_analitico.addClass("hidden"),e.dx_listagem_sintetico.addClass("hidden"),e.configurar_parametros())},this.listar_sintetico=function(){WS.get({route:"solicitacao/relatorio_produtividade_sintetico/",data:{params_processo_id:e.params_processo_id,params_responsavel_id:e.params_responsavel_id,params_solicitante_id:e.params_solicitante_id,params_codigo:e.params_codigo,params_descricao:e.params_descricao,params_data_solicitacao_ini:e.params_data_solicitacao_ini,params_data_solicitacao_fim:e.params_data_solicitacao_fim},func_response:function(a){e.preencher_sintetico(a)},html_id:e.html_id})},this.preencher_sintetico=function(a){var i=document.createElement("div");i.className="div_relatorio_produtividade_sintetico",i.style="min-width: 100%;",e.dx_listagem_sintetico.find(".div_relatorio_produtividade_sintetico").remove(),e.dx_listagem_sintetico[0].appendChild(i);var t=detectmob()?"select":"dragAndDrop";e.dx_listagem_sintetico.find(".div_relatorio_produtividade_sintetico").css("height","calc(100vh - 42px)"),e.dataGrid=e.dx_listagem_sintetico.find(".div_relatorio_produtividade_sintetico").dxDataGrid({dataSource:a,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,columnResizingMode:"widget",rowAlternationEnabled:!1,searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:t},stateStoring:{enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("relatorio_produtividade_sintetico")},customSave:function(a){App.set_parametro_usuario("relatorio_produtividade_sintetico",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de produtividade sintético "+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},groupPanel:{visible:!0},columnFixing:{enabled:!0},onToolbarPreparing:function(a){var i=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem sintética",text:"Recarregar listagem sintética",onClick:function(){e.listar_sintetico()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"},{widget:"dxButton",options:{icon:"fa fa-cog",hint:"Configurar preferências",text:"Configurar preferências",onClick:function(){e.configurar_parametros()}},showText:"inMenu",location:"after",name:"BtnConfiguracoes",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(i,a.toolbarOptions.items)},onContentReady:function(a){add_filtro_cor_tema(a),e.clearState&&(e.dx_listagem_sintetico.find(".div_relatorio_produtividade_sintetico").dxDataGrid("instance").state({}),e.clearState=!1)},columns:[{dataField:"numero",caption:"N° Solicitação",width:80,dataType:"number",calculateSortValue:function(a){return parseInt(a.numero,10)}},{dataField:"processo_nome",caption:"Processo"},{dataField:"usuario_nome",caption:"Solicitante"},{dataField:"data_solicitacao",caption:"Data abertura",dataType:"datetime",format:"dd/MM/yyyy HH:mm",width:110},{dataField:"data_finalizacao",caption:"Data conclusão",dataType:"datetime",format:"dd/MM/yyyy HH:mm",width:110},{dataField:"dias_corridos",caption:"Dias Corridos",dataType:"number",width:80,calculateCellValue:function(a){return a.dias_corridos?a.dias_corridos:"-"},calculateSortValue:function(a){return a.dias_corridos?parseInt(a.dias_corridos,10):null}},{dataField:"horas_uteis",caption:"Horas Úteis",alignment:"right",width:80,calculateCellValue:function(a){return a.horas_uteis?a.horas_uteis:"-"},calculateSortValue:function(a){return a.horas_uteis?fn_converter_horas_para_segundos(a.horas_uteis):null}}],onSelectionChanged:function(a){a.component.refresh(!0)},summary:{totalItems:[{name:"dias_corridos",showInColumn:"dias_corridos",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"horas_uteis",showInColumn:"horas_uteis",displayFormat:"Soma: {0}",summaryType:"custom"}],calculateCustomSummary:function(a){"dias_corridos"===a.name?"start"===a.summaryProcess?a.totalValue=0:"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=a.totalValue+(a.value.dias_corridos?parseInt(a.value.dias_corridos):0)):"horas_uteis"===a.name&&("start"===a.summaryProcess?a.totalValue=0:"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=somar_horas(a.totalValue,a.value.horas_uteis)))}},onContextMenuPreparing:function(a){"header"==a.target&&Array.isArray(a.items)&&a.items.push({text:"Restaurar estado das colunas",visible:!0,beginGroup:!0,onItemClick:function(a){DevExpress.ui.dialog.confirm("Os filtros, ordenações, agrupamentos, posição, tamanho, e visibilidade das colunas desta listagem serão restauradas ao estado padrão. <b>Deseja continuar?</b>","Restaurar estado das colunas").done(function(a){a&&(e.clearState=!0,e.show(RELATORIO_PROCESSO.SINTETICO))})}})}}).dxDataGrid("instance")},this.listar_analitico=function(){WS.get({route:"solicitacao/relatorio_produtividade_analitica/",data:{params_processo_id:e.params_processo_id,params_responsavel_id:e.params_responsavel_id,params_solicitante_id:e.params_solicitante_id,params_codigo:e.params_codigo,params_descricao:e.params_descricao,params_data_solicitacao_ini:e.params_data_solicitacao_ini,params_data_solicitacao_fim:e.params_data_solicitacao_fim,params_data_recebimento_ini:e.params_data_recebimento_ini,params_data_recebimento_fim:e.params_data_recebimento_fim,params_data_execucao_ini:e.params_data_execucao_ini,params_data_execucao_fim:e.params_data_execucao_fim},func_response:function(a){e.preencher_analitico(a)},html_id:e.html_id})},this.preencher_analitico=function(a){var i=document.createElement("div");i.className="div_relatorio_produtividade_analitico",i.style="min-width: 100%;",e.dx_listagem_analitico.find(".div_relatorio_produtividade_analitico").remove(),e.dx_listagem_analitico[0].appendChild(i);var t=detectmob()?"select":"dragAndDrop";e.dx_listagem_analitico.find(".div_relatorio_produtividade_analitico").css("height","calc(100vh - 42px)"),e.dataGrid=e.dx_listagem_analitico.find(".div_relatorio_produtividade_analitico").dxDataGrid({dataSource:a,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,columnResizingMode:"widget",rowAlternationEnabled:!1,searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:t},stateStoring:{enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("relatorio_produtividade_analitico")},customSave:function(a){App.set_parametro_usuario("relatorio_produtividade_analitico",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de produtividade sintético "+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},groupPanel:{visible:!0},columnFixing:{enabled:!0},onToolbarPreparing:function(a){var i=[{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem analítica",text:"Recarregar listagem analítica",onClick:function(){e.listar_analitico()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"},{widget:"dxButton",options:{icon:"fa fa-cog",hint:"Configurar preferências",text:"Configurar preferências",onClick:function(){e.configurar_parametros()}},showText:"inMenu",location:"after",name:"BtnConfiguracoes",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(i,a.toolbarOptions.items)},onContentReady:function(a){add_filtro_cor_tema(a),e.clearState&&(e.dx_listagem_analitico.find(".div_relatorio_produtividade_analitico").dxDataGrid("instance").state({}),e.clearState=!1)},columns:[{dataField:"numero",caption:"N° Solicitação",width:80,dataType:"number",calculateSortValue:function(a){return parseInt(a.numero,10)}},{dataField:"processo_nome",caption:"Processo"},{dataField:"usuario_nome",caption:"Solicitante"},{dataField:"descricao",caption:"Etapa"},{caption:"Executor",calculateCellValue:function(a){return a.usuario_nome?a.usuario_nome:""}},{dataField:"data",caption:"Data início atv",dataType:"datetime",format:"dd/MM/yyyy HH:mm",width:110},{dataField:"entrega",caption:"Data conclusão atv",dataType:"datetime",format:"dd/MM/yyyy HH:mm",width:110},{dataField:"dias_previsto",caption:"Dias previstos",dataType:"number",width:80,calculateCellValue:function(a){return a.dias_previsto?a.dias_previsto:"-"},calculateSortValue:function(a){return a.dias_previsto?parseInt(a.dias_previsto,10):null}},{dataField:"horas_previsto",caption:"Horas previstas",alignment:"right",width:80,calculateCellValue:function(a){return a.horas_previsto?a.horas_previsto:"-"},calculateSortValue:function(a){return a.horas_previsto?fn_converter_horas_para_segundos(a.horas_previsto):null}},{dataField:"dias_realizado",caption:"Dias realizados",dataType:"number",width:80,calculateCellValue:function(a){return a.dias_realizado?a.dias_realizado:"-"},calculateSortValue:function(a){return a.dias_realizado?parseInt(a.dias_realizado,10):null}},{dataField:"horas_realizado",caption:"Horas realizadas",alignment:"right",width:80,calculateCellValue:function(a){return a.horas_realizado?a.horas_realizado:"-"},calculateSortValue:function(a){return a.horas_realizado?fn_converter_horas_para_segundos(a.horas_realizado):null}},{dataField:"dias_saldo",caption:"Dias de saldo",dataType:"number",width:80,calculateCellValue:function(a){return a.dias_saldo?a.dias_saldo:"-"},calculateSortValue:function(a){return a.dias_saldo?parseInt(a.dias_saldo,10):null}},{dataField:"horas_saldo",caption:"Horas de saldo",alignment:"right",width:80,calculateCellValue:function(a){return a.horas_saldo?a.horas_saldo:"-"},calculateSortValue:function(a){return a.horas_saldo?fn_converter_horas_para_segundos(a.horas_saldo):null}}],onSelectionChanged:function(a){a.component.refresh(!1)},summary:{totalItems:[{name:"dias_previsto",showInColumn:"dias_previsto",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"horas_previsto",showInColumn:"horas_previsto",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"dias_realizado",showInColumn:"dias_realizado",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"horas_realizado",showInColumn:"horas_realizado",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"dias_saldo",showInColumn:"dias_saldo",displayFormat:"Soma: {0}",summaryType:"custom"},{name:"horas_saldo",showInColumn:"horas_saldo",displayFormat:"Soma: {0}",summaryType:"custom"}],calculateCustomSummary:function(a){"dias_previsto"===a.name?("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=a.totalValue+(a.value.dias_previsto?parseInt(a.value.dias_previsto):0))):"horas_previsto"===a.name?("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=somar_horas(a.totalValue,a.value.horas_previsto))):"dias_realizado"===a.name?("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=a.totalValue+(a.value.dias_realizado?parseInt(a.value.dias_realizado):0))):"horas_realizado"===a.name?("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=somar_horas(a.totalValue,a.value.horas_realizado))):"dias_saldo"===a.name?("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=a.totalValue+(a.value.dias_saldo?parseInt(a.value.dias_saldo):0))):"horas_saldo"===a.name&&("start"===a.summaryProcess&&(a.totalValue=0),"calculate"===a.summaryProcess&&a.component.isRowSelected(a.value.id)&&(a.totalValue=somar_horas(a.totalValue,a.value.horas_saldo)))}},onContextMenuPreparing:function(a){"header"==a.target&&Array.isArray(a.items)&&a.items.push({text:"Restaurar estado das colunas",visible:!0,beginGroup:!0,onItemClick:function(a){DevExpress.ui.dialog.confirm("Os filtros, ordenações, agrupamentos, posição, tamanho, e visibilidade das colunas desta listagem serão restauradas ao estado padrão. <b>Deseja continuar?</b>","Restaurar estado das colunas").done(function(a){a&&(e.clearState=!0,e.show(RELATORIO_PROCESSO.ANALITICO))})}})}}).dxDataGrid("instance")},this.configurar_parametros=function(){View.load("processo_relatorios/parametros",function(a,i){i.onselect=function(a){e.params_processo_id=a.processo_id,e.params_responsavel_id=a.responsavel_id,e.params_solicitante_id=a.solicitante_id,e.params_codigo=a.codigo,e.params_descricao=a.descricao,e.params_data_solicitacao_ini=a.data_solicitacao_ini,e.params_data_solicitacao_fim=a.data_solicitacao_fim,e.params_data_recebimento_ini=a.data_recebimento_ini,e.params_data_recebimento_fim=a.data_recebimento_fim,e.params_data_execucao_ini=a.data_execucao_ini,e.params_data_execucao_fim=a.data_execucao_fim,e.params_tipo=a.tipo,e.params_tipo==RELATORIO_PROCESSO.SINTETICO?(e.dx_listagem_analitico.addClass("hidden"),e.dx_listagem_sintetico.removeClass("hidden"),e.listar_sintetico()):(e.dx_listagem_sintetico.addClass("hidden"),e.dx_listagem_analitico.removeClass("hidden"),e.listar_analitico())},i.show(e.params_tipo,e.params_processo_id,e.params_responsavel_id,e.params_solicitante_id,e.params_descricao,e.params_codigo,e.params_data_solicitacao_ini,e.params_data_solicitacao_fim,e.params_data_recebimento_ini,e.params_data_recebimento_fim,e.params_data_execucao_ini,e.params_data_execucao_fim)})},this.unload=function(){View.unload(this.html_id)}}});