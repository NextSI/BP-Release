var dx_Diagrama=function(e){if(e){e=spread({div_html:null,elementos:[],conectores:[],nodes_on_inserting:null,nodes_on_removing:null,edges_on_inserting:null,edges_on_updating:null,edges_on_removing:null,on_content_ready:null,on_dbl_click:null,somente_leitura:!1,diferenca_altura:null},e);var o=document.createElement("div");o.className="div_diagram",o.style="min-width: 100%;",e.div_html.find(".div_diagram").remove(),e.div_html[0].appendChild(o);var t=e.div_html.find(".div_diagram").dxDiagram({nodes:{dataSource:new DevExpress.data.ArrayStore.default({key:"this",data:e.elementos,onInserting:e.nodes_on_inserting,onRemoving:e.nodes_on_removing})},edges:{dataSource:new DevExpress.data.ArrayStore.default({key:"this",data:e.conectores,onInserting:e.edges_on_inserting,onUpdating:e.edges_on_updating,onRemoving:e.edges_on_removing})},customShapes:[{category:"bpm",type:"Início",title:"Início",backgroundImageUrl:"assets/img/processo/atividade_inicio.svg",backgroundImageLeft:0,backgroundImageTop:0,backgroundImageWidth:0,backgroundImageHeight:0,defaultWidth:.5,defaultHeight:.5,allowEditText:!1,textLeft:0,textTop:0,textWidth:1,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]},{category:"bpm",type:"Fim",title:"Fim",backgroundImageUrl:"assets/img/processo/atividade_fim.svg",backgroundImageLeft:0,backgroundImageTop:0,backgroundImageWidth:0,backgroundImageHeight:0,defaultWidth:.5,defaultHeight:.5,allowEditText:!1,textLeft:0,textTop:0,textWidth:1,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]},{category:"bpm",type:"Atividade",title:"Atividade",backgroundImageUrl:"assets/img/processo/atividade.svg",backgroundImageLeft:.1,backgroundImageTop:0,backgroundImageWidth:.8,backgroundImageHeight:0,defaultWidth:1.5,defaultHeight:.75,allowEditText:!1,textLeft:.1,textTop:0,textWidth:.8,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]},{category:"bpm",type:"Exclusivo",title:"Gateway Exclusivo",backgroundImageUrl:"assets/img/processo/gateway_exclusivo.svg",backgroundImageLeft:0,backgroundImageTop:0,backgroundImageWidth:0,backgroundImageHeight:0,defaultWidth:.5,defaultHeight:.5,allowEditText:!1,textLeft:1,textTop:0,textWidth:1,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]},{category:"bpm",type:"Inclusivo",title:"Gateway Inclusivo",backgroundImageUrl:"assets/img/processo/gateway_inclusivo.svg",backgroundImageLeft:0,backgroundImageTop:0,backgroundImageWidth:0,backgroundImageHeight:0,defaultWidth:.5,defaultHeight:.5,allowEditText:!1,textLeft:1,textTop:0,textWidth:1,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]},{category:"bpm",type:"Paralelo",title:"Gateway Paralelo",backgroundImageUrl:"assets/img/processo/gateway_paralelo.svg",backgroundImageLeft:0,backgroundImageTop:0,backgroundImageWidth:0,backgroundImageHeight:0,defaultWidth:.5,defaultHeight:.5,allowEditText:!1,textLeft:1,textTop:0,textWidth:1,textHeight:.9,connectionPoints:[{x:.5,y:0},{x:.9,y:.5},{x:.5,y:1},{x:.1,y:.5}]}],height:"calc(100vh - "+e.diferenca_altura+"px)",toolbox:{groups:[{category:"bpm",title:"BPM"}]},autoLayout:{type:"off"},propertiesPanel:{visibility:"auto",tabs:[{groups:[{title:"Layouts Automáticos",commands:["layoutTreeTopToBottom","layoutTreeBottomToTop","layoutTreeLeftToRight","layoutTreeRightToLeft","layoutLayeredTopToBottom","layoutLayeredBottomToTop","layoutLayeredLeftToRight","layoutLayeredRightToLeft"]}]}]},historyToolbar:{visible:!1},viewToolbar:{visible:!1},mainToolbar:{visible:!0,commands:["undo","redo","separator","zoomLevel","separator",{name:"exportPng",text:"Exportar para .PNG",icon:"export"},"separator",{name:"toogleToolbox",text:"Caixa de elementos",icon:"columnchooser"}]},contextMenu:{enabled:!0,commands:["bringToFront","sendToBack","lock","unlock"]},onCustomCommand:function(e){"toogleToolbox"===e.name&&t._toolbox._popup.toggle()},viewUnits:"Px",simpleView:!0,readOnly:e.somente_leitura,onContentReady:e.on_content_ready,onItemDblClick:e.on_dbl_click}).dxDiagram("instance");return t}},dx_Diagrama_Node_OnInserting=function(e){return function(o){var t=JSON.parse(e.diagram.export());if("verticalContainer"!=o.type&&"horizontalContainer"!=o.type){e.elemento_shape_temporario=t.shapes[t.shapes.length-1];for(var a=0;a<t.connectors.length;a++){var n=t.connectors[a];if(n.endItemKey==e.elemento_shape_temporario.key){e.elemento_connector_temporario=n;break}}}var i=null;for(a=0;a<t.shapes.length;a++){var r=t.shapes[a];if(e.elemento_connector_temporario&&e.elemento_connector_temporario.beginItemKey==r.key)for(var s=r.dataKey.split("_")[1],l=0;l<e.processo.elementos.length;l++){var d=e.processo.elementos[l];if(s==d.id||s==d.elem_key){i=d;break}}}"Início"==o.type||"Atividade"==o.type||"Fim"==o.type?View.load("processo/atividade",function(t,a){a.onsave=e.elemento_onsave,a.onclose=e.render_diagrama,a.show(null,FORMULARIO.NOVO,e.processo,e.formulario,i,null,int_processo_atividade_tipo(o.type))}):"Exclusivo"!=o.type&&"Inclusivo"!=o.type&&"Paralelo"!=o.type||View.load("processo/gateway",function(t,a){a.onsave=e.elemento_onsave,a.onclose=e.render_diagrama,a.show(null,FORMULARIO.NOVO,e.processo,i,null,e.formulario,int_processo_gateway_tipo(o.type))})}},dx_Diagrama_Node_OnRemoving=function(e,o){return function(t){for(var a=0;a<e.processo.elementos.length;a++){var n=e.processo.elementos[a],i=t.id.split("_")[1];i!=n.id&&i!=n.elem_key||o.excluir_elemento(n,e.processo,e.render_diagrama)}}},dx_Diagrama_Edge_OnInserting=function(e){return function(o){incluir_destinos(e,o)}},dx_Diagrama_Edge_OnUpdating=function(e){return function(o){for(var t=o.id.split("_")[1],a=o.id.split("_")[3],n=0;n<e.processo.elementos.length;n++){var i=e.processo.elementos[n];if(t==i.id||t==i.elem_key)for(var r=0;r<i.destinos.length;r++){var s=i.destinos[r];if(a==s.id||a==s.elem_key){e.processo.elementos[n].destinos[r].removido=!0;break}}}incluir_destinos(e,o)}},dx_Diagrama_Edge_OnRemoving=function(e){return function(o){if(o.from&&o.to){for(var t=o.from.split("_")[1],a=o.to.split("_")[1],n=0;n<e.processo.elementos.length;n++){var i=e.processo.elementos[n];if(t==i.id||t==i.elem_key)for(var r=0;r<i.destinos.length;r++){var s=i.destinos[r];if(a==s.id||a==s.elem_key){e.processo.elementos[n].destinos[r].removido=!0;break}}}e.render_diagrama()}}},dx_Diagrama_Importar_Diagrama_Processo=function(e){return function(){setTimeout(function(){if(e.processo.diagrama){for(var o=JSON.parse(e.diagram.export()),t=[],a=0;a<o.shapes.length;a++){for(var n=o.shapes[a],i=0;i<e.processo.diagrama.shapes.length;i++){if((d=e.processo.diagrama.shapes[i]).dataKey==n.dataKey){o.shapes[a].x=d.x,o.shapes[a].y=d.y,o.shapes[a].locked=d.locked,t[d.key]=n.key;break}}e.elemento_shape_temporario&&e.elemento_shape_temporario.dataKey==n.dataKey&&(o.shapes[a].x=e.elemento_shape_temporario.x,o.shapes[a].y=e.elemento_shape_temporario.y,e.elemento_shape_temporario=null)}for(a=0;a<o.connectors.length;a++){var r=o.connectors[a];for(i=0;i<e.processo.diagrama.connectors.length;i++){var s=e.processo.diagrama.connectors[i];if(s.dataKey==r.dataKey){o.connectors[a].beginConnectionPointIndex=s.beginConnectionPointIndex,o.connectors[a].endConnectionPointIndex=s.endConnectionPointIndex,o.connectors[a].points=s.points,o.connectors[a].locked=s.locked,o.connectors[a].texts=s.texts,t[s.key]=r.key;break}}e.elemento_connector_temporario&&e.elemento_connector_temporario.dataKey==r.dataKey&&(o.connectors[a].beginConnectionPointIndex=e.elemento_connector_temporario.beginConnectionPointIndex,o.connectors[a].endConnectionPointIndex=e.elemento_connector_temporario.endConnectionPointIndex,o.connectors[a].points=e.elemento_connector_temporario.points,e.elemento_connector_temporario=null)}var l=1;for(a=0;a<e.processo.diagrama.shapes.length;a++){var d;if("verticalContainer"==(d=e.processo.diagrama.shapes[a]).type||"horizontalContainer"==d.type){if(d.key=(Math.max.apply(null,t)+l).toString(),d.childKeys)for(i=0;i<d.childKeys.length;i++){var c=d.childKeys[i];d.childKeys[i]=t[c];break}o.shapes.push(d),l++}}e.processo.diagrama=o,e.diagram.import(JSON.stringify(o))}e.flag_primeiro_carregamento=!1})}},dx_Diagrama_Importar_Diagrama_Solicitacao=function(e){return function(){setTimeout(function(){e.solicitacao_atividade.solicitacao.versao_processo.diagrama&&e.diagram.import(e.solicitacao_atividade.solicitacao.versao_processo.diagrama)})}},dx_Diagrama_Dbl_Click=function(e){return function(o){if("shape"==o.item.itemType){let r=o.item.dataItem.id.split("_")[0];"gateway"==r?r=PROCESSO_ELEMENTO_TIPO.GATEWAY:"atividade"==r&&(r=PROCESSO_ELEMENTO_TIPO.ATIVIDADE);for(var t=o.item.dataItem.id.split("_")[1],a=null,n=0;n<e.processo.elementos.length;n++){var i=e.processo.elementos[n];if((t==i.id||t==i.elem_key)&&r==i.elemento_tipo){a=i;break}}"Início"==o.item.type||"Atividade"==o.item.type||"Fim"==o.item.type?View.load("processo/atividade",function(o,t){t.onsave=e.elemento_onsave,t.onclose=e.render_diagrama,t.show(a,FORMULARIO.EDITAR,e.processo,e.formulario)}):"Exclusivo"!=o.item.type&&"Inclusivo"!=o.item.type&&"Paralelo"!=o.item.type||View.load("processo/gateway",function(o,t){t.onsave=e.elemento_onsave,t.onclose=e.render_diagrama,t.show(a,FORMULARIO.EDITAR,e.processo,null,null,e.formulario)})}}},incluir_destinos=function(e,o){if(o.from&&o.to){for(var t=o.from.split("_")[1],a=o.to.split("_")[1],n=null,i=null,r=JSON.parse(e.diagram.export()),s=0;s<r.shapes.length;s++){var l=r.shapes[s];if(o.from==l.dataKey&&(n=l.key),o.to==l.dataKey&&(i=l.key),n&&i)break}for(s=0;s<r.connectors.length;s++){var d=r.connectors[s];d.beginItemKey==n&&d.endItemKey==i&&(d.dataKey=o.from+"_"+o.to,e.elemento_connector_temporario=d)}for(s=0;s<e.processo.elementos.length;s++){var c=e.processo.elementos[s];if(t==c.id||t==c.elem_key)for(var m=0;m<e.processo.elementos.length;m++){var g=e.processo.elementos[m];if(a==g.id||a==g.elem_key){e.processo.elementos[s].destinos.push({descricao:g.descricao,elem_key:g.elem_key,elemento_tipo:g.elemento_tipo,id:g.id?g.id:null,key:g.id?g.id:g.elem_key,opcional:!!g.opcional&&g.opcional,permite_retorno:!!g.permite_retorno&&g.permite_retorno,sequencia:g.sequencia,tipo:g.tipo,evento_enviar:null,filtro_evento_enviar:null,tipo_automacao:null});break}}}e.render_diagrama()}};