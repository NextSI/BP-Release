define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.carrega_img=this.dialog.find(".carrega_img"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.modal_carregar_curtida=this.dialog.find(".modal_carregar_curtida"),this.div_load=this.dialog.find(".div_load"),this.titulo=this.dialog.find(".titulo"),this.grupo_id_param=null,this.arr_curtidas_usuario=null,this.arr_membros=[],this.arr_grupo=[],this.arr_motivo_chamado=[],this.arr_tipo_usuario=[],this.arr_todos=[],this.limite=0,this.quantidade=0,this.membros=null,this.count_solicitacao,this.count_membro,this.flag=null,this.show=function(i,a){o.grupo_id_param=i,o.membros=1==a?"S":"N",show_modal(o.modal.attr("id")),"S"==o.membros?o.titulo.text("Membros do Grupo"):o.titulo.text("Solicitações Pendentes"),o.listar()},this.listar=function(){WS.get({route:"grupos_rede_social/listar_info_grupo/",data:{grupo_id:o.grupo_id_param,membros:o.membros,limite:o.limite},func_response:function(i){i&&(o.arr_membros=i.usuarios,o.arr_grupo=i.grupo_usuario,o.arr_motivo_chamado=i.chamado_motivo,o.arr_membros=$.merge(o.arr_grupo,o.arr_membros),o.arr_membros=$.merge(o.arr_membros,o.arr_motivo_chamado),o.arr_tipo_usuario=i.tipo_usuario,o.arr_membros=$.merge(o.arr_membros,o.arr_tipo_usuario),o.count_membro=i.count_membro,o.count_solicitacao=i.count_solicitacao,o.render_usuarios(i.admin_logado),o.flag=!0)}})},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.render_usuarios=function(i){var a=o.tab_listagem.find("tbody"),r=a.find("tr:first"),t=(i=i,function(t){var s=r.clone();s.removeAttr("template-row"),s.css("display",""),$(s.find("[template-field='img_usuario_grupo']"));var e=$(s.find("[template-field='nome_usuario_grupo']")),u=($(s.find(".link_grupo")),$(s.find(".btn_aprovar"))),l=$(s.find(".btn_reprovar")),d=$(s.find(".btn_grupo_usuarios"));e.text(t.nome),1==i&&"S"==o.membros&&"U"==t.tipo&&(l.hasClass("hidden")&&l.removeClass("hidden"),u.hasClass("hidden")||u.addClass("hidden")),1==i&&"N"==o.membros&&(l.hasClass("hidden")&&l.removeClass("hidden"),u.hasClass("hidden")&&u.removeClass("hidden")),1==i&&(d.unbind("click"),d.click(function(){"G"==t.tipo?View.load("grupo_rede_social_pagina/todos_grupo_usuarios",function(i,o){o.show(t.grupo_usuario_id)}):"U"==t.tipo&&View.load("perfil/listar",function(i,a){a.show(t.usuario_id,!0),o.unload()},View.ABA.MULTIPLAS)})),"U"==t.tipo&&(d.unbind("click"),d.click(function(){View.load("perfil/listar",function(i,a){a.show(t.usuario_id,!0),o.unload()},View.ABA.MULTIPLAS)})),s.appendTo(a),l.unbind("click"),l.click(function(){alert_modal("Sair Grupo","Deseja realmente remover usuario do grupo?","Remover",function(){"U"==t.tipo?WS.post("grupos_rede_social/excluir_usuario_grupo/",{grupo_id:o.grupo_id_param,usuario_id:t.usuario_id},function(i){i&&(alert_saved("Solicitação efetuada com sucesso"),s.remove())},[l],null,!0):WS.post("grupos_rede_social/excluir_usuario_grupo_grupo/",{grupo_id:o.grupo_id_param,grupo_usuario_id:t.grupo_usuario_id},function(i){i&&(alert_saved("Solicitação efetuada com sucesso"),s.remove())},[l],null,!0)},!0)}),u.unbind("click"),u.click(function(){alert_modal("Aprovar Solicitação","Deseja realmente aprovar Solicitação?","Aceitar",function(){WS.post("grupos_rede_social/aprovar_usuario_grupo/",{grupo_id:o.grupo_id_param,usuario_id:t.usuario_id,membro_grupo:"S"},function(i){i&&(alert_saved("Solicitação efetuada com sucesso"),s.remove())},[u],null,!0)},!0)})});o.tab_listagem.find("tr:gt(-1)").remove(),$(o.arr_membros).each(function(i,a){"U"==a.tipo?null==a.nome&&""==a.nome||(null!=a.foto_id?o.carrega_img.attr("src",WS_URI+"documento/midia/?documento_id="+a.foto_id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):o.carrega_img.attr("src","assets/img/imagem_usuario_padrao.svg")):"G"==a.tipo?o.carrega_img.attr("src","assets/img/pesquisa_grupo.svg"):"CM"==a.tipo?o.carrega_img.attr("src","assets/img/comunication.svg"):o.carrega_img.attr("src","assets/img/group.svg"),"S"==o.membros?"S"==a.membro_grupo&&t(a):"N"==a.membro_grupo&&t(a)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){o.unload()}),o.flag=!0,this.modal_carregar_curtida.unbind("scroll"),this.modal_carregar_curtida.scroll(function(){o.modal_carregar_curtida.scrollTop()+o.modal_carregar_curtida.height()>o.tab_listagem.get(0).scrollHeight&&(o.div_load.removeClass("hidden"),1==o.flag&&(o.flag=!1,o.limite=o.limite+5,o.listar()))})}});