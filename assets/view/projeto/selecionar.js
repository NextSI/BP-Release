define([],function(){return function(t){"use strict";var e=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.btn_novo_projeto=this.dialog.find(".btn_novo_projeto"),this.cbo_cliente=this.dialog.find(".cbo_cliente"),this.btn_limpar_filtro=this.dialog.find(".btn_limpar_filtro"),this.txt_info=this.dialog.find(".txt_info"),this.div_load=this.dialog.find(".div_load"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.params={limite:0,template:"N",cliente_id:null},this.params_template={limite:0},this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_scroll=!1,this.edt_cliente=null,this.cliente_nome=null,this.projeto_selecionado=new Object,this.show=function(t){e.onselect=t,show_modal(e.modal.attr("id")),e.inicializar_componentes(),e.listar_projetos(!1),create_combobox(e.cbo_cliente,e.listar_clientes,null,!1,{pesquisar_enter:!0});var i=e.cbo_cliente.parent();e.edt_cliente=i.find(".edt_combobox")},this.listar_clientes=function(t){var i=new Object;i.nome_fantasia=e.edt_cliente.val(),WS.get("cliente/listar/",i,function(i){limpar_combobox(e.cbo_cliente),$(i).each(function(t,i){var o=[];o.Nome=i.nome_fantasia,add_option_combobox(e.cbo_cliente,t,i.id,o,null,JSON.stringify(i))}),$(e.cbo_cliente.parent()).find(".ul_row").click(function(){var t=$(this).parent().attr("dados-adicionais")?JSON.parse($(this).parent().attr("dados-adicionais")):null;e.params.cliente_id=null!==t?t.cliente_id:null,e.cliente_nome=null!==t?t.nome_fantasia:null,e.limpar_tabela(),e.listar_projetos(!1)}),$(e.cbo_cliente.parent()).find("input").keypress(function(t){if(13==t.keyCode||13==t.tecla_value){var i=$(this).attr("dados-adicionais")?JSON.parse($(this).attr("dados-adicionais")):null;e.params.cliente_id=null!==i?i.cliente_id:null,e.cliente_nome=null!==i?i.nome_fantasia:null,e.limpar_tabela(),e.listar_projetos(!1)}}),t(!0)})},this.listar_projetos=function(t){void 0!==t&&"boolean"==typeof t||(t=!1),e.params.limite=e.limite,WS.post({route:"projeto/listar/",type:"GET",data:e.params,func_response:function(i){i.length>0?(e.bloqueia_scroll=!1,e.txt_info.addClass("hidden"),e.txt_info.text(""),$(i).each(function(t,i){!function(t,i){i=extender_parametros({codigo:"-",nome:"-",conclusao:"-"},i);var o=$.Tabela_Padrao_Next.create_row(e.tab_listagem);o.removeAttr("template-row"),o.css("display",""),$.Tabela_Padrao_Next.getColumn(o,"codigo_projeto").text(i.codigo),$.Tabela_Padrao_Next.getColumn(o,"nome").text(i.nome),$.Tabela_Padrao_Next.getColumn(o,"percentual").text((null!==i.porcentagem_concluido?i.porcentagem_concluido:"0")+"%"),$.Tabela_Padrao_Next.getColumn(o,"selecionar").find(".btn_selecionar").unbind("click").click(function(){e.projeto_selecionado.obj_projeto=i,e.projeto_selecionado.projeto_id=i.id,e.projeto_selecionado.cliente_id=i.cliente_id,e.onselect(e.projeto_selecionado),e.unload()}),o.dblclick(function(){e.projeto_selecionado.obj_projeto=i,e.projeto_selecionado.projeto_id=i.id,e.projeto_selecionado.cliente_id=i.cliente_id,e.onselect(e.projeto_selecionado),e.unload()}),$.Tabela_Padrao_Next.RenderRow(e.tab_listagem,o)}(0,i)})):(e.bloqueia_scroll=!0,e.txt_info.removeClass("hidden"),e.txt_info.html(null!==e.cliente_nome?"Nenhum registro encontrado para <b>"+e.cliente_nome+"</b>":"Nenhum registrado encontrado")),t&&(e.limite=e.limite+e.limite_a_cada)},html_id:e.html_id})},this.btn_novo_projeto.unbind("click"),this.btn_novo_projeto.click(function(){View.load("projeto/detalhes",function(t,i){i.onconfirm=function(t){e.projeto_selecionado.obj_projeto=t,e.projeto_selecionado.projeto_id=t.id,e.projeto_selecionado.cliente_id=t.cliente_id,e.onselect(e.projeto_selecionado),e.unload()},i.onclose=function(){e.limpar_tabela(),e.listar_projetos(!1)},i.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.btn_limpar_filtro.unbind("click"),this.btn_limpar_filtro.click(function(){set_value_combobox(e.cbo_cliente,"",""),e.params.cliente_id=null,e.cliente_nome=null,e.limpar_tabela(),e.listar_projetos(!1)}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){e.unload()}),this.limpar_tabela=function(){e.txt_info.addClass("hidden"),e.txt_info.text(""),$.Tabela_Padrao_Next.clear(e.tab_listagem),e.params.limite=0,e.limite=0},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&null!==e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){var t={conclusao:{tipo:TABELA_PADRAO_BP_FILTRO.INPUT,minvalue:0,maxvalue:100}};$.Tabela_Padrao_Next.Filtros.Start(e.tab_listagem,t,function(t,i,o){t[o]=i,e.params=extender_parametros(e.params_template,t),setTimeout(function(){e.evento_atualizar()},300)})},this.evento_atualizar=function(){e.limpar_tabela(),e.listar_projetos(!1)},$(e.modal).scroll(function(){var t=e.modal;e.html_id&&$(t).scrollTop()+$(this).height()==$(this).get(0).scrollHeight&&(e.bloqueia_scroll||("N"==App.sessao.dados.loader_bloqueio&&e.div_load.removeClass("hidden"),e.listar_projetos(!0)))})}});