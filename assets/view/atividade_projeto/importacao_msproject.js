define(["react","react-dom","./../componentes_react/CboUsuarios"],function(a,i,o){return function(e){"use strict";var r=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.file_importacao_projeto=this.dialog.find(".file_importacao_projeto"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.cbo_valor_previsto=this.dialog.find(".cbo_valor_previsto"),this.div_valor_previsto=this.dialog.find(".div_valor_previsto"),this.qtd_horas_dia=this.dialog.find("#qtd_horas_dia"),this.edt_valor_hora_atividade=this.dialog.find(".edt_valor_hora_atividade"),this.div_valor_hora=this.dialog.find(".div_valor_hora"),this.chk_marcar_todos=this.dialog.find(".chk_marcar_todos"),this.chk_exibir_prazo_agenda=this.dialog.find("#chk_exibir_prazo_agenda"),this.chk_redefinir_tipo_previsao_inicio=this.dialog.find("#chk_redefinir_tipo_previsao_inicio"),this.chk_atualizar_tipo_valor_hora=this.dialog.find(".chk_atualizar_tipo_valor_hora"),this.chk_atualizar_hierarquia=this.dialog.find(".chk_atualizar_hierarquia"),this.chk_atualizar_codigo=this.dialog.find(".chk_atualizar_codigo"),this.chk_atualizar_marco=this.dialog.find(".chk_atualizar_marco"),this.chk_atualizar_nome=this.dialog.find(".chk_atualizar_nome"),this.chk_atualizar_horas_previstas=this.dialog.find(".chk_atualizar_horas_previstas"),this.chk_atualizar_previsao_inicio=this.dialog.find(".chk_atualizar_previsao_inicio"),this.chk_atualizar_prazo_execucao=this.dialog.find(".chk_atualizar_prazo_execucao"),this.chk_atualizar_data_inicio=this.dialog.find(".chk_atualizar_data_inicio"),this.chk_atualizar_percentual_conclusao=this.dialog.find(".chk_atualizar_percentual_conclusao"),this.chk_atualizar_data_conclusao=this.dialog.find(".chk_atualizar_data_conclusao"),this.chk_atualizar_executores=this.dialog.find(".chk_atualizar_executores"),this.chk_atualizar_predecessoras=this.dialog.find(".chk_atualizar_predecessoras"),this.modal_importacao_projeto_arquivo=this.dialog.find(".modal_importacao_projeto_arquivo"),this.modal_importacao_projeto_usuarios=this.dialog.find(".modal_importacao_projeto_usuarios"),this.lbl_tab_arquivo=this.dialog.find(".lbl_tab_arquivo"),this.lbl_tab_usuarios=this.dialog.find(".lbl_tab_usuarios"),this.lbl_tab_configuracoes=this.dialog.find(".lbl_tab_configuracoes"),this.atualizacao=this.dialog.find(".atualizacao"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.envolvidos=null,this.projeto_id=null,this.qtde_atividades=null,this.show=function(a,i){r.projeto_id=a,r.qtde_atividades=i,i>0&&r.atualizacao.removeClass("hidden"),r.edt_valor_hora_atividade.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),show_modal(r.modal.attr("id"))},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.render_envolvidos=function(){var e=r.tab_listagem.find("tbody"),t=e.find("tr:first");r.tab_listagem.find("tr:gt(1)").remove(),Object.keys(r.envolvidos).map(function(c){!function(c){var _=t.clone();_.removeAttr("template-row"),_.css("display","");var s=$(_.find("[template-field='nome']"));s.text(c.nome),s.attr("recurso_id",c.recurso_id);var d=$(_.find(".div_componente_usuario")),l=a.createElement(o,null,null);i.render(l,d[0]),l.props.setObjParam({ExibirTecnicos:!0,ExibirApenasTecnicos:!0,ExibirGrupos:!0,EmpresaId:App.temp.empresa}),c.usuario_id_sugestao&&(l.props.setUsuario({usuario_id:c.usuario_id_sugestao,usuario_nome:c.nome_sugestao}),r.envolvidos[c.recurso_id].usuario_id_substituto=c.usuario_id_sugestao,r.envolvidos[c.recurso_id].usuario_nome_substituto=c.nome_sugestao),l.props.setFunctionSelect(function(){delete c.grupo_usuarios_id_substituto,delete c.usuario_id_substituto,delete c.grupo_usuarios_nome_substituto,delete c.usuario_nome_substituto,"usuarios"==l.props.UsuarioSelecionado.tipo||"usuario_cliente"==l.props.UsuarioSelecionado.tipo||"usuario_fornecedor"==l.props.UsuarioSelecionado.tipo?(r.envolvidos[c.recurso_id].usuario_id_substituto=l.props.UsuarioSelecionado.id,r.envolvidos[c.recurso_id].usuario_nome_substituto=l.props.UsuarioSelecionado.nome):"grupo_usuarios"==l.props.UsuarioSelecionado.tipo&&(r.envolvidos[c.recurso_id].grupo_usuarios_id_substituto=l.props.UsuarioSelecionado.id,r.envolvidos[c.recurso_id].grupo_usuarios_nome_substituto=l.props.UsuarioSelecionado.nome)}),_.appendTo(e)}(r.envolvidos[c])})},this.unload=function(){r.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),r.file_importacao_projeto.change(function(){var a=null;this.files.length?(a=this.files[0].name,WS.post("projeto/get_envolvidos/",{arquivo_projeto:r.file_importacao_projeto[0].files[0],empresa_id:App.temp.empresa},function(a){r.envolvidos=a,r.modal_importacao_projeto_arquivo.removeClass("active"),r.modal_importacao_projeto_usuarios.addClass("active"),r.lbl_tab_usuarios.removeClass("hidden"),r.lbl_tab_configuracoes.removeClass("hidden"),r.lbl_tab_arquivo.removeClass("active"),r.lbl_tab_usuarios.addClass("active"),r.render_envolvidos()},null,null,!0)):a="Arraste seu arquivo aqui ou clique nesta área",$(this).parent().find("span").text(a)}),this.cbo_valor_previsto.unbind("change"),this.cbo_valor_previsto.change(function(){1==$(this).val()?(r.div_valor_hora.removeClass("hidden"),r.div_valor_previsto.toggleClass("col-md-12 col-md-10")):(r.div_valor_hora.addClass("hidden"),r.div_valor_previsto.removeClass("col-md-10").addClass("col-md-12"))}),this.chk_atualizar_percentual_conclusao.parent().unbind("click"),this.chk_atualizar_percentual_conclusao.parent().click(function(){setTimeout(function(){r.chk_atualizar_data_conclusao.prop("checked",r.chk_atualizar_percentual_conclusao.prop("checked")).change()})}),this.chk_atualizar_data_conclusao.parent().unbind("click"),this.chk_atualizar_data_conclusao.parent().click(function(){setTimeout(function(){r.chk_atualizar_percentual_conclusao.prop("checked",r.chk_atualizar_data_conclusao.prop("checked")).change()})}),this.chk_atualizar_prazo_execucao.parent().unbind("click").click(function(){setTimeout(function(){r.chk_atualizar_previsao_inicio.prop("checked",r.chk_atualizar_prazo_execucao.prop("checked")).change()})}),this.chk_atualizar_previsao_inicio.parent().unbind("click").click(function(){setTimeout(function(){r.chk_atualizar_prazo_execucao.prop("checked",r.chk_atualizar_previsao_inicio.prop("checked")).change()})}),this.chk_redefinir_tipo_previsao_inicio.parent().unbind("click").click(function(){setTimeout(function(){r.chk_redefinir_tipo_previsao_inicio.prop("checked")&&alert_info("Previsão de início e prazo foram marcados para serem atualizados!"),r.chk_atualizar_previsao_inicio.prop("checked",r.chk_redefinir_tipo_previsao_inicio.prop("checked")).change(),r.chk_atualizar_prazo_execucao.prop("checked",r.chk_redefinir_tipo_previsao_inicio.prop("checked")).change()})}),this.chk_marcar_todos.parent().unbind("click"),this.chk_marcar_todos.parent().click(function(){setTimeout(function(){r.chk_atualizar_tipo_valor_hora.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_hierarquia.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_codigo.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_marco.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_nome.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_horas_previstas.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_previsao_inicio.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_prazo_execucao.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_data_inicio.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_percentual_conclusao.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_data_conclusao.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_executores.prop("checked",r.chk_marcar_todos.prop("checked")).change(),r.chk_atualizar_predecessoras.prop("checked",r.chk_marcar_todos.prop("checked")).change()})}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if(""!=r.qtd_horas_dia.val()&&null!=r.qtd_horas_dia.val()&&0!=r.qtd_horas_dia.val()){$(this).parent().parent().find("div.info_import").remove(),$(this).parent().parent().append('<div class="info_import" style="margin: 5px 0;"><span class="text-warning"> <i class="fa fa-spinner fa-pulse"></i> Por favor, aguarde! Este procedimento pode levar vários minutos. </span><br/ ><small>Você pode continuar usando o sistema em uma outra aba do navegador.</div>');var a={tipo_valor_hora:r.cbo_valor_previsto.val(),valor_hora:r.edt_valor_hora_atividade.val(),qtd_horas_dia:r.qtd_horas_dia.val(),exibir_prazo_agenda:r.chk_exibir_prazo_agenda.prop("checked"),redefinir_tipo_previsao_inicio:r.chk_redefinir_tipo_previsao_inicio.prop("checked"),atualizar_tipo_valor_hora:r.chk_atualizar_tipo_valor_hora.prop("checked")||0==r.qtde_atividades,atualizar_hierarquia:r.chk_atualizar_hierarquia.prop("checked")||0==r.qtde_atividades,atualizar_codigo:r.chk_atualizar_codigo.prop("checked")||0==r.qtde_atividades,atualizar_marco:r.chk_atualizar_marco.prop("checked")||0==r.qtde_atividades,atualizar_nome:r.chk_atualizar_nome.prop("checked")||0==r.qtde_atividades,atualizar_horas_previstas:r.chk_atualizar_horas_previstas.prop("checked")||0==r.qtde_atividades,atualizar_previsao_inicio:r.chk_atualizar_previsao_inicio.prop("checked")||0==r.qtde_atividades,atualizar_prazo_execucao:r.chk_atualizar_prazo_execucao.prop("checked")||0==r.qtde_atividades,atualizar_data_inicio:r.chk_atualizar_data_inicio.prop("checked")||0==r.qtde_atividades,atualizar_percentual_conclusao:r.chk_atualizar_percentual_conclusao.prop("checked")||0==r.qtde_atividades,atualizar_data_conclusao:r.chk_atualizar_data_conclusao.prop("checked")||0==r.qtde_atividades,atualizar_executores:r.chk_atualizar_executores.prop("checked")||0==r.qtde_atividades,atualizar_predecessoras:r.chk_atualizar_predecessoras.prop("checked")||0==r.qtde_atividades};WS.post("projeto/importar/",{arquivo_projeto:r.file_importacao_projeto[0].files[0],envolvidos:JSON.stringify(r.envolvidos),projeto_id:r.projeto_id,configuracoes:JSON.stringify(a)},function(a){r.btn_salvar.parent().parent().find("div.info_import").remove(),alert_saved(a+" importado com sucesso"),r.unload()},null,null,!0,!1,null,r.html_id,function(){r.btn_salvar.parent().parent().find("div.info_import").remove()})}else alert_modal("Atenção!","Por favor, digite a quantidade de horas por dia (aba Configurações).","Ok",function(){})})}});