define([],function(){return function(t){"use strict";var e=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_revisao=this.dialog.find(".edt_revisao").attr("id","edt_revisao_"+e.html_id),this.edt_versao=this.dialog.find(".edt_versao"),this.edt_data=this.dialog.find(".edt_data"),this.cbo_autor=this.dialog.find(".cbo_autor"),this.projeto_revisao_id=null,this.projeto_id=null,this.show=function(t,a){e.cbo_autor.selectpicker();var i=getDateNow(!0);switch(set_datepicker(e.edt_data,i),e.projeto_id=a,e.listar_autor(App.sessao.usuario_id),void 0!==e.projeto_revisao_id&&null!=e.projeto_revisao_id&&e.preencher(),t){case FORMULARIO.NOVO:e.btn_salvar.show(),e.btn_excluir.hide(),e.permite_alterar(!0);break;case FORMULARIO.EDITAR:e.btn_salvar.show(),e.btn_excluir.hide(),e.permite_alterar(!0),e.edt_data.parents(".col-md-4").addClass("col-md-offset-2"),e.edt_versao.parents('[class*="col-"]').removeClass("hidden");break;case FORMULARIO.VISUALIZAR:e.btn_salvar.hide(),e.btn_excluir.hide(),e.permite_alterar(!1),e.edt_data.parents(".col-md-4").addClass("col-md-offset-2"),e.edt_versao.parents('[class*="col-"]').removeClass("hidden");break;case FORMULARIO.EXCLUIR:e.btn_salvar.hide(),e.btn_excluir.show(),e.permite_alterar(!1),e.edt_data.parents(".col-md-4").addClass("col-md-offset-2"),e.edt_versao.parents('[class*="col-"]').removeClass("hidden")}e.tipo=t,set_tinymce(e.edt_revisao,""),show_modal(e.modal.attr("id")),set_focus(e.edt_revisao)},this.close=function(){close_modal(e.modal.attr("id")),void 0!==e.onclose&&e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.permite_alterar=function(t){e.edt_versao.attr("disabled",!t),e.edt_data.attr("disabled",!t),e.cbo_autor.attr("disabled",!t),setTimeout(function(){tinyMCE.get(e.edt_revisao.attr("id")).getBody().setAttribute("contenteditable",t)},300)},this.preencher=function(){WS.get({route:"projeto_revisao/objeto/",data:{projeto_revisao_id:e.projeto_revisao_id},func_response:function(t){t&&(e.edt_versao.val(t.sequencia),set_tinymce(e.edt_revisao,t.revisao),e.listar_autor(t.usuario_id),set_datepicker(e.cbo_autor,t.data))},html_id:e.html_id})},this.listar_autor=function(t){e.cbo_autor.find("option").remove(),add_option(e.cbo_autor,"","- Selecionar -"),WS.get({route:"projeto/listar_gerente_projeto/",data:{projeto_id:e.projeto_id},func_response:function(a){for(var i=0;i<a.length;i++){var o=a[i];add_option(e.cbo_autor,o.usuario_id,o.nome)}t&&e.cbo_autor.val(t).trigger("change"),e.cbo_autor.selectpicker("refresh")},html_id:e.html_id})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){e.unload()}),this.btn_excluir.unbind("click").click(function(t){WS.post({route:"projeto_revisao/excluir",data:{projeto_revisao_id:e.projeto_revisao_id},type:"POST",func_response:function(t){t&&(alert_saved("Revisão excluida com sucesso"),e.unload())},html_id:e.html,disable_buttons:[e.btn_excluir,e.btn_salvar,e.btn_cancelar]})}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("projeto_revisao/salvar",{projeto_revisao_id:e.projeto_revisao_id,projeto_id:e.projeto_id,revisao:get_tinymce(e.edt_revisao),data:get_datepicker(e.edt_data),usuario_id:e.cbo_autor.val()},function(t){alert_saved("Revisão salva com sucesso"),e.unload()},[e.btn_excluir,e.btn_salvar,e.btn_cancelar])})}});