define([],function(){return function(e){"use strict";var t=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.title="Carteira de Entidades do Representante",this.btn_refresh=this.dialog.find(".btn_refresh"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.cbo_representantes=this.dialog.find(".cbo_representantes"),this.usuario_id=App.sessao.usuario_id,this.show=function(){1==App.sessao.dados.admin?(t.cbo_representantes.removeClass("hidden"),t.listar_representantes()):t.listar()},this.listar_representantes=function(e){t.cbo_representantes.find("option").remove(),WS.get("representante/listar/",null,function(n){add_option(t.cbo_representantes,-1,"Todos"),n.filter(function(e){return e.representante_id==App.sessao.dados.representante_id}).length>0&&(add_option(t.cbo_representantes,App.sessao.dados.representante_id,App.sessao.dados.nome),e=App.sessao.dados.representante_id);for(var i=0;i<n.length;i++){var a=n[i];a.representante_id!==App.sessao.dados.representante_id&&add_option(t.cbo_representantes,a.representante_id,a.nome_fantasia)}e&&t.cbo_representantes.val(e).trigger("change"),t.cbo_representantes.selectpicker("refresh"),t.listar()})},this.listar=function(){var e=t.tab_listagem.find("tbody"),n=e.find("tr:first");parseInt(t.usuario_id,10)>0||parseInt(t.cbo_representantes.val(),10)>0?WS.get("representante/listar_entidades_by_representante/",{usuario_id:t.usuario_id,representante_id:t.cbo_representantes.val()},function(i){t.tab_listagem.find(".rows").remove(),$(i).each(function(t,i){!function(t){var i=n.clone();i.removeAttr("template-row"),i.css("display",""),i.addClass("rows"),$(i.find("[template-field='nome_fantasia']")).text(t.entidade_nome_fantaisa?t.entidade_nome_fantaisa:""),$(i.find("[template-field='email']")).text(t.entidade_email_principal?t.entidade_email_principal:""),$(i.find("[template-field='razao_social']")).text(t.entidade_razao_social?t.entidade_razao_social:""),$(i.find("[template-field='telefone1']")).text(t.entidade_telefone1?t.entidade_telefone1:""),$(i.find("[template-field='telefone2']")).text(t.entidade_telefone2?t.entidade_telefone2:""),$(i.find("[template-field='telefone3']")).text(t.entidade_telefone3?t.entidade_telefone3:""),$(i.find("[template-field='telefone4']")).text(t.entidade_telefone4?t.entidade_telefone4:"");var a=$(i.find(".lb_tipo"));"C"==t.entidade_tipo?(a.addClass("label-info"),a.attr("title","Cliente")):"O"==t.entidade_tipo&&(a.addClass("label-primary"),a.attr("title","Organização")),a.tooltip(),a.text(t.entidade_tipo),i.appendTo(e)}(i)})}):t.tab_listagem.find(".rows").remove()},this.btn_refresh.unbind("click"),this.btn_refresh.click(function(){t.listar()}),this.cbo_representantes.unbind("change"),this.cbo_representantes.change(function(){parseInt(this.value,10)>0?t.usuario_id=null:t.usuario_id=App.sessao.usuario_id,t.listar()}),this.unload=function(){View.unload(this.html_id)}}});