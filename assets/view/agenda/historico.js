define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Hist√≥rico de Agenda",this.cbo_periodo=this.dialog.find(".cbo_periodo"),this.cbo_de=this.dialog.find(".cbo_de"),this.cbo_acao=this.dialog.find(".cbo_acao"),this.cbo_usuario_acao=this.dialog.find(".cbo_usuario_acao"),this.edt_inicio=this.dialog.find(".edt_inicio"),this.edt_fim=this.dialog.find(".edt_fim"),this.btn_pesquisar=this.dialog.find(".btn_pesquisar"),this.instancia_tabela_historico=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_limite=!1,this.todos_ativos=!1,this.group_filtros=this.dialog.find("[filtros]"),this.btn_abrir_filtros=this.dialog.find(".btn_abrir_filtros"),this.btn_atualizar=this.dialog.find(".btn_atualizar"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.btn_ordenacao=this.dialog.find(".orderbypointer"),this.requisicao_params={limite:i.limite},this.show=function(){$(window).width()<=992&&i.group_filtros.addClass("hidden"),add_option(i.cbo_periodo,0,App.lang.historico_agenda.historico_agenda_periodo_dia_agenda,"selected"),add_option(i.cbo_periodo,1,App.lang.historico_agenda.historico_agenda_periodo_data_acao),add_option(i.cbo_acao,0,App.lang.historico_agenda.historico_agenda_inclusao),add_option(i.cbo_acao,1,App.lang.historico_agenda.historico_agenda_alteracao),add_option(i.cbo_acao,2,App.lang.historico_agenda.historico_agenda_exclusao),add_option(i.cbo_acao,3,App.lang.historico_agenda.historico_agenda_visualizacao),i.cbo_periodo.selectpicker(),i.cbo_acao.selectpicker(),i.cbo_de.selectpicker(),i.cbo_usuario_acao.selectpicker(),i.listar_acao_usuario(),i.listar_colaboradores();var a=getDateNow(!0),o=AddDays(getDateNow(),30,!0);set_datepicker(i.edt_inicio,a),set_datepicker(i.edt_fim,o),i.listar(!0)},this.listar=function(a){var o=function(a,o){var t=$.Tabela_Padrao_Next.create_row(i.instancia_tabela_historico),r=($.Tabela_Padrao_Next.getColumn(t,"de").text(o.usuario_nome),$.Tabela_Padrao_Next.getColumn(t,"detalhes").text(o.detalhes),$.Tabela_Padrao_Next.getColumn(t,"acao_usuario").text(null!=o.acao_usuario?o.acao_usuario:""),$.Tabela_Padrao_Next.getColumn(t,'acao_data[data-bp-column="acao_data"]').text(null!=o.acao_data?o.acao_data.format_date():""),null!=o.dia?o.dia.format_date():" - "),e=null!=o.acao_data?o.acao_data.format_date():" - ",s=null!=o.acao?acao_agenda_nome(o.acao):"",_=$.Tabela_Padrao_Next.getColumn(t,'dia[data-bp-column="dia"]');_.html(r+_.html()),$.Tabela_Padrao_Next.getColumn(_,"dia").attr("data-bp-column-value",r),$.Tabela_Padrao_Next.getColumn(_,"acao_data").attr("data-bp-column-value",e),$.Tabela_Padrao_Next.getColumn(_,"acao").attr("data-bp-column-value",s),$.Tabela_Padrao_Next.getColumn(t,'acao[data-bp-column="acao"]').text(s),$.Tabela_Padrao_Next.RenderRow(i.instancia_tabela_historico,t)};void 0!==a&&"boolean"==typeof a||(a=!1),i.bloqueia_limite||(i.atualizar_parametros(),WS.get({route:"agenda_evento/agenda_historicos/",data:i.requisicao_params,func_response:function(t){if(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),t){a&&(i.limite=i.limite+i.limite_a_cada);for(var r=0;r<t.length;r++){var e=t[r];o(0,e)}0==t.length&&(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),i.bloqueia_limite=!0)}},html_id:i.html_id}))},this.unload=function(){View.unload(this.html_id)},this.listar_acao_usuario=function(a){i.cbo_usuario_acao.find(".opt_usuarios option").remove(),WS.get("usuario/listar/",{tipo_usuario:USUARIO_TIPO.ANALISTA},function(o){for(var t=0;t<o.length;t++){var r=o[t];$(i.cbo_usuario_acao).add_opt_to_group("opt_usuarios",r.usuario_id,r.nome)}a&&i.cbo_usuario_acao.val(a).trigger("change"),i.cbo_usuario_acao.selectpicker("refresh")})},this.listar_colaboradores=function(a){i.cbo_de.find(".opt_usuarios option").remove(),WS.get("usuario/usuarios_agenda_usuario_logado/",{},function(o){for(var t=0;t<o.length;t++){var r=o[t];$(i.cbo_de).add_opt_to_group("opt_usuarios",r.usuario_id,r.nome)}a&&i.cbo_de.val(a).trigger("change"),i.cbo_de.selectpicker("refresh")})},this.btn_pesquisar.unbind("click").click(function(a){i.limpar_tabela(),i.listar(!0)}),this.atualizar_parametros=function(){i.requisicao_params.de=JSON.stringify(i.cbo_de.val()),i.requisicao_params.acao=JSON.stringify(i.cbo_acao.val()),i.requisicao_params.dt_inicio=get_datepicker(i.edt_inicio),i.requisicao_params.dt_fim=get_datepicker(i.edt_fim),i.requisicao_params.tipo_periodo=i.cbo_periodo.val(),i.requisicao_params.usuario_acao=JSON.stringify(i.cbo_usuario_acao.val()),i.requisicao_params.limite=i.limite},this.limpar_tabela=function(a){i.limite=0,i.bloqueia_limite=!1,$.Tabela_Padrao_Next.clear(i.instancia_tabela_historico),arguments.length>0&&arguments[0]&&i.listar(!0)},this.func_organizacao=function(a,o){i.requisicao_params.orderby=a,i.requisicao_params.asc=o,i.limpar_tabela(!0)},this.btn_ordenacao.unbind("click").click(function(a){var o=$(this),t=$(o).attr("data-ordername"),r=$(o).attr("data-asc");if(0===r.length){for(var e=0;e<i.btn_ordenacao.length;e++)if($(i.btn_ordenacao[e])!==$(o)){try{$(i.btn_ordenacao[e]).find(".icon_orderby").removeClass("fa-sort-up fa-sort-down").addClass("hidden fa-sort-down")}catch(a){}$(i.btn_ordenacao[e]).attr("data-asc","")}r=!0,$(o).attr("data-asc",r),$(o).find(".icon_orderby").removeClass("hidden")}else r=!(r="true"==r),$(o).attr("data-asc",r),$(o).find(".icon_orderby").toggleClass("fa-sort-down fa-sort-up");i.func_organizacao(t,r)}),this.btn_atualizar.unbind("click").click(function(a){i.btn_pesquisar.trigger("click")}),this.btn_abrir_filtros.unbind("click").click(function(a){var o=$(this),t=o.filter('[data-visible="true"]').length>0;(t=!t)?i.group_filtros.removeClass("hidden"):i.group_filtros.removeClass("hidden").addClass("hidden"),o.attr("data-visible",t)}),$(this.cbo_de).Todos_Extension(),$(this.cbo_usuario_acao).Todos_Extension(),$(window).unbind("resize").resize(function(){$(window).width()<992?i.group_filtros.removeClass("hidden").addClass("hidden"):i.group_filtros.removeClass("hidden")}),this.btn_carregar_mais.unbind("click").click(function(){i.bloqueia_limite||(i.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),i.btn_carregar_mais.find("span.icn_carregar_mais").remove(),i.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),i.listar(!0))})}});