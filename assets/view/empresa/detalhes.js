define(["react","react-dom","./../componentes_react/InputCEP"],function(i,a,e){return function(o){"use strict";var t=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.title="Empresa",this.tipo=null,this.onclose=null,this.btn_importar_licenca=this.dialog.find(".btn_importar_licenca"),this.btn_editar_licenca=this.dialog.find(".btn_editar_licenca"),this.div_vigencia=this.dialog.find(".div_vigencia"),this.lbl_vigencia_de=this.dialog.find(".lbl_vigencia_de"),this.lbl_vigencia_ate=this.dialog.find(".lbl_vigencia_ate"),this.div_licenca_retorno=this.dialog.find(".div_licenca_retorno"),this.edt_situacao=this.dialog.find(".edt_situacao"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_razao_social=this.dialog.find(".edt_razao_social"),this.edt_cnpj=this.dialog.find(".edt_cnpj"),this.edt_site=this.dialog.find(".edt_site"),this.edt_dominio_interacao=this.dialog.find(".edt_dominio_interacao"),this.edt_email_principal=this.dialog.find(".edt_email_principal"),this.edt_texto_rodape=this.dialog.find(".edt_texto_rodape"),this.tab_dados_gerais=this.dialog.find(".tab_dados_gerais"),this.tab_relatorio=this.dialog.find(".tab_relatorio"),this.div_dados_gerais=this.dialog.find(".div_dados_gerais"),this.div_relatorio=this.dialog.find(".div_relatorio"),this.div_vincular=this.dialog.find(".div_vincular"),this.div_btn=this.dialog.find(".div_btn"),this.edt_endereco=this.dialog.find(".edt_endereco"),this.edt_numero=this.dialog.find(".edt_numero"),this.edt_complemento=this.dialog.find(".edt_complemento"),this.edt_bairro=this.dialog.find(".edt_bairro"),this.edt_municipio=this.dialog.find(".edt_municipio"),this.btn_municipio=this.dialog.find(".btn_municipio"),this.edt_pais=this.dialog.find(".edt_pais"),this.btn_pais=this.dialog.find(".btn_pais"),this.chk_padrao=this.dialog.find(".chk_padrao"),this.chk_vincular_empresa=this.dialog.find(".chk_vincular_empresa"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.lbl_tab_relatorio=this.dialog.find(".lbl_tab_relatorio"),this.div_logo_empresa=this.dialog.find(".div_logo_empresa"),this.btn_alterar_logo=this.dialog.find(".btn_alterar_logo"),this.btn_remover_logo=this.dialog.find(".btn_remover_logo"),this.btn_alterar_logo_cabecalho=this.dialog.find(".btn_alterar_logo_cabecalho"),this.btn_remover_logo_cabecalho=this.dialog.find(".btn_remover_logo_cabecalho"),this.btn_alterar_logo_rodape=this.dialog.find(".btn_alterar_logo_rodape"),this.btn_remover_logo_rodape=this.dialog.find(".btn_remover_logo_rodape"),this.btn_alterar_logo_marcacao=this.dialog.find(".btn_alterar_logo_marcacao"),this.btn_remover_logo_marcacao=this.dialog.find(".btn_remover_logo_marcacao"),this.files_logo_empresa=this.dialog.find(".files_logo_empresa"),this.files_cabecalho=this.dialog.find(".files_cabecalho"),this.files_rodape=this.dialog.find(".files_rodape"),this.files_marcacao=this.dialog.find(".files_marcacao"),this.carrega_img=this.dialog.find(".carrega_img"),this.carrega_img_cabecalho=this.dialog.find(".carrega_img_cabecalho"),this.carrega_img_rodape=this.dialog.find(".carrega_img_rodape"),this.carrega_img_marcacao=this.dialog.find(".carrega_img_marcacao"),this.edt_telefone1=this.dialog.find(".edt_telefone1"),this.edt_telefone2=this.dialog.find(".edt_telefone2"),this.edt_telefone3=this.dialog.find(".edt_telefone3"),this.edt_telefone4=this.dialog.find(".edt_telefone4"),this.div_componente_cep=this.dialog.find(".div_componente_cep"),this.inputCEP=i.createElement(e,null,null),this.edt_erp_grupo=this.dialog.find(".edt_erp_grupo"),this.edt_erp_empresa=this.dialog.find(".edt_erp_empresa"),this.edt_erp_filial=this.dialog.find(".edt_erp_filial"),this.empresa_id=null,this.logo_id=null,this.logo_cabecalho_id=null,this.logo_rodape_id=null,this.logo_marcacao_id=null,this.cod_municipio=null,this.cod_pais=null,this.licenca_arquivo="",this.licenca_situacao=null,this.show=function(i,e,o){switch(t.div_dados_gerais.attr("id","div_dados_gerais"+t.html_id),t.div_relatorio.attr("id","div_relatorio"+t.html_id),t.tab_dados_gerais.attr("href","#"+t.div_dados_gerais.attr("id")),t.tab_relatorio.attr("href","#"+t.div_relatorio.attr("id")),App.sessao.dados.tipo==USUARIO_TIPO.ANALISTA&&1!=App.sessao.dados.admin||(t.div_vincular.hide(),t.div_btn.removeClass(),t.div_btn.addClass("text-right col-xs-12 col-sm-12 col-md-12")),o||(t.lbl_tab_relatorio.addClass("hidden"),t.div_logo_empresa.addClass("hidden")),a.render(t.inputCEP,t.div_componente_cep[0]),t.inputCEP.props.setCampoEndereco(t.edt_endereco),t.inputCEP.props.setCampoBairro(t.edt_bairro),t.inputCEP.props.setCampoCidade(t.edt_municipio,null,t.alterar_cod_municipio),t.inputCEP.props.setCampoPais(t.edt_pais,t.alterar_cod_pais),t.inputCEP.props.set_cepObrigatorio(!0),e){case FORMULARIO.NOVO:t.btn_salvar.show(),t.btn_excluir.hide(),t.permite_alterar(!0),t.cod_pais="1058",t.edt_pais.val("BRASIL");break;case FORMULARIO.EDITAR:t.btn_salvar.show(),t.btn_excluir.hide(),t.div_vincular.hide(),t.div_btn.removeClass(),t.div_btn.addClass("text-right col-xs-12 col-sm-12 col-md-12"),t.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:t.btn_salvar.hide(),t.btn_excluir.hide(),t.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:t.btn_salvar.hide(),t.btn_excluir.show(),t.permite_alterar(!1)}t.tipo=e,void 0!==i&&i?(t.empresa_id=i,t.preencher()):App.titulo_aba(t.html_id,"Empresa - Novo"),set_focus(t.edt_razao_social)},this.alterar_cod_municipio=function(){t.cod_municipio=t.inputCEP.props.CodigoMunicipio},this.alterar_cod_pais=function(){t.cod_pais=t.inputCEP.props.CodigoPais},this.close=function(){void 0!==t.onclose&&t.onclose&&t.onclose()},this.unload=function(){t.close(),View.unload(this.html_id)},this.permite_alterar=function(i){t.btn_importar_licenca.prop("disabled",!i),t.btn_editar_licenca.prop("disabled",!i),t.edt_nome.prop("readonly",!i),t.edt_razao_social.prop("readonly",!i),t.edt_cnpj.prop("readonly",!i),t.edt_site.prop("readonly",!i),t.edt_dominio_interacao.prop("readonly",!i),t.edt_email_principal.prop("readonly",!i),t.edt_texto_rodape.prop("readonly",!i),t.inputCEP.props.setCampoCepLeitura(!i),t.edt_endereco.prop("readonly",!i),t.edt_numero.prop("readonly",!i),t.edt_complemento.prop("readonly",!i),t.edt_bairro.prop("readonly",!i),t.btn_alterar_logo.prop("disabled",!i),t.btn_alterar_logo_marcacao.prop("disabled",!i),t.btn_alterar_logo_cabecalho.prop("disabled",!i),t.btn_alterar_logo_rodape.prop("disabled",!i),t.edt_telefone1.prop("readonly",!i),t.edt_telefone2.prop("readonly",!i),t.edt_telefone3.prop("readonly",!i),t.edt_telefone4.prop("readonly",!i)},this.preencher=function(){WS.get("empresa/objeto/",{empresa_id:t.empresa_id},function(i){null!=i.nome&&App.titulo_aba(t.html_id,"Empresa - "+i.nome.substring(0,15)),t.carrega_licenca(i),t.edt_nome.val(i.nome_fantasia),t.edt_razao_social.val(i.razao_social),t.edt_cnpj.val(i.cnpj),t.edt_site.val(i.site),t.edt_dominio_interacao.val(i.dominio_interacao),t.edt_email_principal.val(i.email_principal),t.edt_texto_rodape.val(i.texto_rodape),t.inputCEP.props.setCampoCep(i.cep),t.edt_endereco.val(i.endereco),t.edt_numero.val(i.numero),t.edt_complemento.val(i.complemento),t.edt_bairro.val(i.bairro),t.cod_municipio=i.cod_municipio,t.cod_pais=i.cod_pais,t.edt_municipio.val(i.municipio),t.edt_pais.val(i.pais),t.edt_telefone1.val(i.telefone1),t.edt_telefone2.val(i.telefone2),t.edt_telefone3.val(i.telefone3),t.edt_telefone4.val(i.telefone4),"S"==i.padrao?(t.chk_padrao.bootstrapSwitch("state",!0),t.chk_padrao.prop("checked",!0)):(t.chk_padrao.bootstrapSwitch("state",!1),t.chk_padrao.prop("checked",!1)),null!=i.logo_id&&0==i.logo_id.excluido?"S"==i.logo_id.midia&&(t.logo_id=i.logo_id.id,t.carrega_img.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+i.logo_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime())):t.carrega_img.attr("src","assets/img/img.svg"),null!=i.logo_cabecalho_id&&0==i.logo_cabecalho_id.excluido&&"S"==i.logo_cabecalho_id.midia&&(t.logo_cabecalho_id=i.logo_cabecalho_id.id,t.carrega_img_cabecalho.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+i.logo_cabecalho_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime())),null!=i.logo_rodape_id&&0==i.logo_rodape_id.excluido&&"S"==i.logo_rodape_id.midia&&(t.logo_rodape_id=i.logo_rodape_id.id,t.carrega_img_rodape.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+i.logo_rodape_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime())),null!=i.logo_marcacao_id&&0==i.logo_marcacao_id.excluido&&"S"==i.logo_marcacao_id.midia&&(t.logo_marcacao_id=i.logo_marcacao_id.id,t.carrega_img_marcacao.attr("src",WS_URI+"documento/midia/?tipo=v&tamanho=60&documento_id="+i.logo_marcacao_id.id+"&token_midia="+App.sessao.token_midia+"&considera_excluido=S&anticache="+(new Date).getTime())),t.edt_erp_grupo.val(i.erp_grupo),t.edt_erp_empresa.val(i.erp_empresa),t.edt_erp_filial.val(i.erp_filial)})},this.carrega_licenca=function(i){t.div_vigencia.hide(),t.div_licenca_retorno.hide(),1==i.licenca_valida?(t.lbl_vigencia_de.text(i.vigencia_de.format_date()),t.lbl_vigencia_ate.text(i.vigencia_ate.format_date()),t.div_vigencia.show(),t.licenca_arquivo=i.arquivo_licenca):(t.div_licenca_retorno.text("Arquivo de licença inválido. Verifique se o CNPJ da empresa está correto."),t.div_licenca_retorno.show(),t.licenca_arquivo=""),t.situacao_datas(i)},this.situacao_datas=function(i){switch(i.vigencia_de&&i.vigencia_ate&&""!=i.vigencia_de&&""!=i.vigencia_ate?i.data_atual>=i.vigencia_de&&i.data_atual<=i.vigencia_ate?t.licenca_situacao=LICENCA_SITUACAO.VALIDA:i.vigencia_ate<i.data_atual?t.licenca_situacao=LICENCA_SITUACAO.EXPIRADA:i.data_atual<=i.vigencia_de?t.licenca_situacao=LICENCA_SITUACAO.NAO_INICIADA:t.licenca_situacao=LICENCA_SITUACAO.EXPIRADA:t.licenca_situacao=LICENCA_SITUACAO.INVALIDA,t.edt_situacao.removeClass("label-info"),t.edt_situacao.removeClass("label-success"),t.edt_situacao.removeClass("label-danger"),parseInt(t.licenca_situacao,10)){case LICENCA_SITUACAO.NAO_INICIADA:t.edt_situacao.addClass("label-info"),t.edt_situacao.text("Não Iniciada");break;case LICENCA_SITUACAO.VALIDA:t.edt_situacao.addClass("label-success"),t.edt_situacao.text("Valida");break;case LICENCA_SITUACAO.EXPIRADA:t.edt_situacao.addClass("label-danger"),t.edt_situacao.text("Expirada");break;case LICENCA_SITUACAO.INVALIDA:t.edt_situacao.addClass("label-danger"),t.edt_situacao.text("Inválida")}},this.preview_logo=function(i){var a=i.target.files[0],e=new FileReader;e.onload=function(i){t.carrega_img.attr("src",i.target.result)},e.readAsDataURL(a)},this.preview_logo_cabecalho=function(i){var a=i.target.files[0],e=new FileReader;e.onload=function(i){t.carrega_img_cabecalho.attr("src",i.target.result)},e.readAsDataURL(a)},this.preview_logo_rodape=function(i){var a=i.target.files[0],e=new FileReader;e.onload=function(i){t.carrega_img_rodape.attr("src",i.target.result)},e.readAsDataURL(a)},this.preview_logo_marcacao=function(i){var a=i.target.files[0],e=new FileReader;e.onload=function(i){t.carrega_img_marcacao.attr("src",i.target.result)},e.readAsDataURL(a)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){t.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){$.each(t.files_logo_empresa,function(i,a){a.files.length>0&&(t.logo_id=a.files[0])}),$.each(t.files_cabecalho,function(i,a){a.files.length>0&&(t.logo_cabecalho_id=a.files[0])}),$.each(t.files_rodape,function(i,a){a.files.length>0&&(t.logo_rodape_id=a.files[0])}),$.each(t.files_marcacao,function(i,a){a.files.length>0&&(t.logo_marcacao_id=a.files[0])}),WS.post("empresa/salvar",{empresa_id:t.empresa_id,nome_fantasia:t.edt_nome.val(),razao_social:t.edt_razao_social.val(),cnpj:t.edt_cnpj.val(),logo_id:t.logo_id,logo_cabecalho_id:t.logo_cabecalho_id,logo_rodape_id:t.logo_rodape_id,logo_marcacao_id:t.logo_marcacao_id,email_principal:t.edt_email_principal.val(),site:t.edt_site.val(),dominio_interacao:t.edt_dominio_interacao.val(),texto_rodape:t.edt_texto_rodape.val(),cep:t.inputCEP.props.CampoCep,endereco:t.edt_endereco.val(),numero:t.edt_numero.val(),complemento:t.edt_complemento.val(),bairro:t.edt_bairro.val(),cod_municipio:t.cod_municipio,cod_pais:t.cod_pais,padrao:t.chk_padrao.prop("checked"),vincular_empresa:t.chk_vincular_empresa.prop("checked"),telefone1:t.edt_telefone1.val(),telefone2:t.edt_telefone2.val(),telefone3:t.edt_telefone3.val(),telefone4:t.edt_telefone4.val(),licenca_arquivo:t.licenca_arquivo,erp_grupo:t.edt_erp_grupo.val(),erp_empresa:t.edt_erp_empresa.val(),erp_filial:t.edt_erp_filial.val()},function(i){t.empresa_id=i.id,alert_saved(i.nome_fantasia+" salvo com sucesso"),t.unload()},[t.btn_excluir,t.btn_salvar,t.btn_cancelar,t.btn_importar_licenca,t.btn_editar_licenca],null,!0)}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("empresa/excluir",{empresa_id:t.empresa_id},function(i){alert_saved(i.nome_fantasia+" excluido com sucesso"),t.unload()})}),this.btn_alterar_logo.unbind("click"),this.btn_alterar_logo.click(function(){t.files_logo_empresa.click()}),t.files_logo_empresa[0].addEventListener("change",t.preview_logo,!1),this.btn_editar_licenca.unbind("click"),this.btn_editar_licenca.click(function(){View.load("empresa/licenca",function(i,a){a.onok=function(i){t.validar_licenca(i)},a.show(t.licenca_arquivo)})}),this.btn_importar_licenca.unbind("click"),this.btn_importar_licenca.click(function(){var i=$('<input type="file">');i[0].addEventListener("change",function(i){var a=i.target.files[0];void 0!==a&&a&&t.validar_licenca(a)},!1),i.click()}),this.validar_licenca=function(i){WS.post("empresa/licenca/validar",{nome_fantasia:t.edt_nome.val(),razao_social:t.edt_razao_social.val(),cnpj:t.edt_cnpj.val(),licenca_arquivo:i},function(i){t.carrega_licenca(i)},[t.btn_excluir,t.btn_salvar,t.btn_cancelar,t.btn_importar_licenca,t.btn_editar_licenca],null,!0)},this.btn_remover_logo.unbind("click"),this.btn_remover_logo.click(function(){alert_modal("Remover Logo","Deseja remover este logo?","Remover",function(){WS.post("documento/excluir",{documento_id:t.logo_id,excluir:!0,excluir_foto_empresa:!0,empresa_filial_id:t.empresa_id},function(i){alert_saved("Logo removido com sucesso"),t.carrega_img.attr("src","assets/img/img.svg")},null,null,!0)},!0)}),this.btn_alterar_logo_cabecalho.unbind("click"),this.btn_alterar_logo_cabecalho.click(function(){t.files_cabecalho.click()}),t.files_cabecalho[0].addEventListener("change",t.preview_logo_cabecalho,!1),this.btn_remover_logo_cabecalho.unbind("click"),this.btn_remover_logo_cabecalho.click(function(){alert_modal("Remover Logo do Cabeçalho","Deseja remover o logo do Cabeçalho?","Remover",function(){WS.post("documento/excluir",{documento_id:t.logo_cabecalho_id,excluir:!0},function(i){alert_saved("Logo do Cabeçalho removido com sucesso")},null,null,!0)},!0)}),this.btn_alterar_logo_rodape.unbind("click"),this.btn_alterar_logo_rodape.click(function(){t.files_rodape.click()}),t.files_rodape[0].addEventListener("change",t.preview_logo_rodape,!1),this.btn_remover_logo_rodape.unbind("click"),this.btn_remover_logo_rodape.click(function(){alert_modal("Remover Logo do Rodapé","Deseja remover o logo do Rodapé?","Remover",function(){WS.post("documento/excluir",{documento_id:t.logo_rodape_id,excluir:!0},function(i){alert_saved("Logo do Rodapé removido com sucesso")},null,null,!0)},!0)}),this.btn_alterar_logo_marcacao.unbind("click"),this.btn_alterar_logo_marcacao.click(function(){t.files_marcacao.click()}),t.files_marcacao[0].addEventListener("change",t.preview_logo_marcacao,!1),this.btn_remover_logo_marcacao.unbind("click"),this.btn_remover_logo_marcacao.click(function(){alert_modal("Remover Logo da Marcação","Deseja remover o logo da Marcação?","Remover",function(){WS.post("documento/excluir",{documento_id:t.logo_marcacao_id,excluir:!0},function(i){alert_saved("Logo da Marcação removido com sucesso")},null,null,!0)},!0)}),this.btn_municipio.unbind("click"),this.btn_municipio.click(function(){View.load("municipio/selecionar",function(i,a){a.show(function(i){t.cod_municipio=i.cod_municipio,t.edt_municipio.val(i.municipio)})})}),this.btn_pais.unbind("click"),this.btn_pais.click(function(){View.load("pais/selecionar",function(i,a){a.show(function(i){t.cod_pais=i.cod_pais,t.edt_pais.val(i.nome)})})})}});