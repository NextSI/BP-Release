define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.lbl_descricao=this.dialog.find(".lbl_descricao"),this.dx_grid=this.dialog.find(".dx_grid"),this.btn_sim=this.dialog.find(".btn_sim"),this.btn_nao=this.dialog.find(".btn_nao"),this.btn_ok=this.dialog.find(".btn_ok"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.dataGrid=null,this.convidados=!1,this.ativos=!1,this.show=function(i,o,t,e,n){if(e)a.title.text("Feriados"),a.listar_feriados(n),a.btn_nao.addClass("hidden"),a.btn_sim.addClass("hidden"),a.btn_ok.removeClass("hidden");else{let e="Eventos dos ";a.convidados=Array.isArray(o)&&o.length>0,a.ativos=Array.isArray(t)&&t.length>0,a.convidados&&(e+="Convidados"),a.convidados&&a.ativos&&(e+=" e "),a.ativos&&(e+="Ativos"),a.title.text(e);let n="";a.convidados&&(n+="Convidados"),a.convidados&&a.ativos&&(n+=" e "),a.ativos&&(n+="Ativos"),n+=" já possui(em) evento(s) no horário informado.",a.lbl_descricao.text(n),a.listar_eventos_convidado(i,o,t)}},this.preencher=function(i){var o=detectmob()?"select":"dragAndDrop";a.dataGrid=a.dx_grid.dxDataGrid({dataSource:i,paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},searchPanel:{visible:!1,highlightCaseSensitive:!0},groupPanel:{visible:!1},filterPanel:{visible:!1},filterRow:{visible:!1,applyFilter:"auto"},headerFilter:{visible:!1},grouping:{autoExpandAll:!0},selection:{mode:"none"},columnChooser:{enabled:!1,allowSearch:!1,mode:o},searchPanel:{visible:!1,width:200,placeholder:"Pesquisa geral"},allowColumnReordering:!0,rowAlternationEnabled:!1,allowColumnResizing:!0,showBorders:!0,stateStoring:i.stateStoring,export:i.export,columns:i.columns}).dxDataGrid("instance")},this.listar_eventos_convidado=function(i,o,t){var e=new Date(i);e.setDate(e.getDate()-7),e=new Date(e).toISOString().slice(0,10),WS.post("agenda_evento/agenda_calendario/",{data_inicio:e,qtd_dias:15,grupo_usuarios_id:JSON.stringify(["-1"]),ativos_id:JSON.stringify(t),usuarios_id:Array.isArray(o)?JSON.stringify(o):null,ativos_id:Array.isArray(t)?JSON.stringify(t):null},function(i){var o=[];if(a.btn_nao.removeClass("hidden"),!a.ativos||"S"===i.ativo_eventos_simultaneos){a.btn_sim.removeClass("hidden");let i=a.lbl_descricao.text();a.lbl_descricao.text(i+" Deseja gerar o evento para ele(s) mesmo assim?")}i.usuarios.forEach(function(a,t){a.eventos.forEach(function(t,e){i.dias.includes(t.dia)&&o.push({evento_dia:t.dia,evento_descricao:"S"==t.agenda_tipo_particular?"Evento Particular":t.descricao,evento_hora_inicio:t.hora_inicio,evento_hora_fim:t.hora_fim,usuario_nome:a.nome})})}),o.columns=[{dataField:"usuario_nome",caption:"Usuário",groupIndex:0},{dataField:"evento_descricao",caption:"Evento"},{dataField:"evento_dia",caption:"Dia",dataType:"date"},{dataField:"evento_hora_inicio",caption:"Hora Início",dataType:"time"},{dataField:"evento_hora_fim",caption:"Hora Fim",dataType:"time"}],o.stateStoring={enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("gridAgendaEventosConflitantes")},customSave:function(i){App.set_parametro_usuario("gridAgendaEventosConflitantes",i)}},o.export={enabled:!1,fileName:"Next BP - Eventos conflitantes de convidado "+agora(),allowExportSelectedData:!1},a.preencher(o),show_modal(a.modal.attr("id"))})},this.listar_feriados=function(i){var o=i;o.columns=[{dataField:"nome",caption:"Feriado"},{dataField:"data_feriado",caption:"Dia",dataType:"date",groupIndex:0},{dataField:"hora_inicio",caption:"Hora Início",dataType:"time"},{dataField:"hora_fim",caption:"Hora Fim",dataType:"time"}],o.stateStoring={enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("gridAgendaFeriadosConflitantes")},customSave:function(i){App.set_parametro_usuario("gridAgendaFeriadosConflitantes",i)}},o.export={enabled:!0,fileName:"Next BP - Feriados conflitantes com evento "+agora(),allowExportSelectedData:!0},a.preencher(o),show_modal(a.modal.attr("id"))},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose(a.render_usuario)},this.btn_sim.on("click",function(i){a.render_usuario=!0,a.unload()}),this.btn_nao.on("click",function(i){a.render_usuario=!1,a.unload()}),this.btn_cancelar.on("click",function(){a.unload()}),this.btn_ok.on("click",function(){a.unload()}),this.unload=function(){a.close(),View.unload(this.html_id)}}});