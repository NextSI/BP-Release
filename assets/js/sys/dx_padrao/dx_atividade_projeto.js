var dx_Atividade_Projeto_Id=function(){return{dataField:"id",caption:App.lang.atividade_projeto.id,visible:!1,showInColumnChooser:!1}},dx_Atividade_Projeto_Codigo=function(){return{dataField:"codigo",caption:App.lang.atividade_projeto.codigo_atividade,width:80}},dx_Atividade_Projeto_Nome_Atividade=function(){return{dataField:"atividade_simplificada",caption:App.lang.atividade_projeto.nome_atividade,width:250}},dx_Atividade_Projeto_Previsao_Inicio=function(){var i=set_format_date(!1);return{caption:App.lang.atividade_projeto.previsao_inicio,width:160,dataType:"date",format:i,dataField:"previsao_inicio"}},dx_Atividade_Projeto_Inicio=function(){var i=set_format_date(!1);return{caption:App.lang.atividade_projeto.inicio,width:160,dataType:"date",format:i,dataField:"inicio"}},dx_Atividade_Projeto_Prazo=function(){var i=set_format_date(!1);return{caption:App.lang.atividade_projeto.prazo,width:160,dataType:"date",format:i,dataField:"prazo"}},dx_Atividade_Projeto_Status=function(){return{dataField:"status",caption:App.lang.atividade_projeto.status,width:100,calculateCellValue:function(i){return str_nome_status(str_identifica_status(i.inicio,i.prazo,i.conclusao))}}},dx_Atividade_Projeto_Tipo_Predecessora=function(){return{dataField:"tipo",caption:App.lang.atividade_projeto.tipo_predecessora,validationRules:[{type:"required"}],lookup:{dataSource:[{id:"1",descricao:"Finish-to-Start (FS)"},{id:"2",descricao:"Start-to-Start (SS)"},{id:"3",descricao:"Finish-to-Finish (FF)"},{id:"4",descricao:"Start-to-Finish (SF)"}],displayExpr:"descricao",valueExpr:"id"},width:150}},dx_Atividade_Projeto_Botoes=function(i){var a=get_icon_class();return{type:"buttons",buttons:[{hint:App.lang.generico.excluir,icon:"fa fa-trash",visible:function(i){return!i.row.removed},cssClass:a,onClick:function(a){i.dataGrid.deleteRow(a.row.rowIndex)}},{hint:App.lang.generico.recuperar_registro,icon:"fa fa-undo",visible:function(i){return i.row.removed},cssClass:"icon_black",onClick:function(a){i.dataGrid.undeleteRow(a.row.rowIndex)}}]}},dx_Atividade_Projeto_Colunas=function(i){return[dx_Atividade_Projeto_Id(),dx_Atividade_Projeto_Codigo(),dx_Atividade_Projeto_Nome_Atividade(),dx_Atividade_Projeto_Previsao_Inicio(),dx_Atividade_Projeto_Inicio(),dx_Atividade_Projeto_Prazo(),dx_Atividade_Projeto_Status(),dx_Atividade_Projeto_Tipo_Predecessora(),dx_Atividade_Projeto_Botoes(i)]},dx_Atividade_Projeto_Btn_Novo=function(i,a){return{widget:"dxButton",options:{icon:"fa fa-plus",hint:App.lang.generico.adicionar,text:App.lang.generico.adicionar,onClick:function(){(App.sessao.dados.admin||i.permissoes_projeto.gerente_projeto||i.permissoes_projeto.permissao_atividade)&&dx_Atividade_Projeto_Adicionar_Atividade(i,a)}},location:"after",name:"btnNovo",locateInMenu:"auto"}},dx_Atividade_Projeto_Editing_Mode=function(){return{mode:"batch",allowUpdating:!0,useIcons:!0}},dx_Atividade_Projeto_Adicionar_Atividade=function(i,a){i.dxPopup=i.popup.dxPopup({contentTemplate:function(t){WS.get({route:"atividade_projeto/listar/",data:{projeto_id:i.projeto_id},func_response:function(e){e.atividades.push({atividade_simplificada:e.projeto.nome,id:"raiz",projeto_atividade_sintetica_pai_id:null,tipo_atividade:"P",marco:!1,horas_previstas:"000:00"}),a.render(i.ListarAtividadeProjeto,t[0]),i.ListarAtividadeProjeto.props.setParams({div:t,html_id:i.html_id,data:e||[],dialog:i.dialog,parametro_usuario:"projeto_predecessora",somente_leitura:!0,diferenca_altura:10,obter_tamanho_div_pai:!0})},html_id:i.html_id})},toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:App.lang.generico.selecionar,onClick:function(a){for(var t=i.ListarAtividadeProjeto.props.treeList.getSelectedRowsData(),e=0;e<t.length;e++){var o=t[e],d=o.id,r=!1;i.projeto_atividade_id==d&&(r=!0);var _=i.arr_atividades_predecessoras.filter(function(i){if(i.id==d)return i});r||0!=_.length||(o.tipo=null,dx_Atividade_Projeto_Preencher_Celulas(i,o))}i.dxPopup.hide()}}}],showTitle:!0,title:App.lang.atividade_projeto.selecione_predecessora,visible:!0}).dxPopup("instance")},dx_Atividade_Projeto_Preencher_Celulas=function(i,a){for(var t=!0,e=0;e<i.dataGrid.getController("editing").getChanges().length;e++){var o=i.dataGrid.getController("editing").getChanges()[e];if("insert"==o.type&&o.data.id==a.id)return void(t=!1)}t&&(i.dataGrid.addRow(),i.dataGrid.cellValue(0,"id",a.id),i.dataGrid.cellValue(0,"codigo",a.codigo),i.dataGrid.cellValue(0,"atividade_simplificada",a.atividade_simplificada),i.dataGrid.cellValue(0,"previsao_inicio",a.previsao_inicio),i.dataGrid.cellValue(0,"inicio",a.inicio),i.dataGrid.cellValue(0,"prazo",a.prazo),i.dataGrid.cellValue(0,"status",a.status),i.dataGrid.cellValue(0,"tipo",a.tipo),i.dataGrid.cellValue(0,"cancelada",a.cancelada))},dx_Atividade_Projeto_Verificar_Tipo_Atividade_Predecessora=function(i,a,t){var e={alterar:"",data:null,data_anterior:null};switch(+i){case ATIVIDADE_PREDECESSORA_TIPO.FINISH_TO_START:e.data=a.prazo,e.alterar="previsao_inicio",e.data_anterior=get_datepicker(t.edt_previsao_inicio);break;case ATIVIDADE_PREDECESSORA_TIPO.START_TO_START:e.data=a.inicio||a.previsao_inicio,e.alterar="previsao_inicio",e.data_anterior=get_datepicker(t.edt_previsao_inicio);break;case ATIVIDADE_PREDECESSORA_TIPO.FINISH_TO_FINISH:e.data=a.prazo,e.alterar="prazo",e.data_anterior=get_datepicker(t.edt_prazo_projeto);break;case ATIVIDADE_PREDECESSORA_TIPO.START_TO_FINISH:e.data=a.inicio||a.previsao_inicio,e.alterar="prazo",e.data_anterior=get_datepicker(t.edt_prazo_projeto)}return e},dx_Atividade_Projeto_Atualizar_Data_Conforme_Tipo_Atividade_Predecessora=function(i,a,t){var e=dx_Atividade_Projeto_Verificar_Tipo_Atividade_Predecessora(i,a,t);if(e.data&&(e.data||e.data_anterior)){var o=new Validation,d="";(e.data_anterior||e.data)&&(d="Deseja alterar a data de ","previsao_inicio"==e.alterar?d+="previsÃ£o de inicio":d+="prazo",e.data_anterior&&(d+=" de "+e.data_anterior.format_date()),e.data&&(d+=" para "+e.data.format_date())),o.add(new ValidationMessage(Validation.CODES.ERR_FIELD,d)),o.is_valid()||alert_modal(a.atividade_simplificada,o,"Alterar",function(){"previsao_inicio"==e.alterar?(t.edt_previsao_inicio.val(e.data.substr(0,10)),t.edt_prazo_dias.change(),t.edt_previsao_inicio.blur()):t.edt_prazo_projeto.val(e.data.substr(0,10))},!0)}},dx_Atividade_Projeto_On_Editor_Preparing=function(i){return function(a){if("tipo"===a.dataField&&"dataRow"===a.parentType){var t=a.editorOptions.onValueChanged;a.editorOptions.onValueChanged=function(e){if(i.cbo_tipo_previsao_inicio.val()==TIPO_PREVISAO_INICIO.DEVE_INICIAR_EM){var o=e.value;dx_Atividade_Projeto_Atualizar_Data_Conforme_Tipo_Atividade_Predecessora(o,a.row.data,i)}t(e)}}}};