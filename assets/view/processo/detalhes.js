define(["react","react-dom","./../central_documentos/SelectPasta"],function(a,o,e){return function(r){"use strict";var i=this;this.html_id=r,this.dialog=$("#"+this.html_id),this.title="Modelagem de Processo",this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.tipo=null,this.onclose=null,this.btn_fechar=null,this.scrollview=this.dialog.find(".scrollview"),this.menu_configuracoes=this.dialog.find(".menu_configuracoes"),this.menu_atividades=this.dialog.find(".menu_atividades"),this.menu_supervisores=this.dialog.find(".menu_supervisores"),this.aba_configuracoes=this.dialog.find(".aba_configuracoes"),this.aba_atividades=this.dialog.find(".aba_atividades"),this.aba_supervisores=this.dialog.find(".aba_supervisores"),this.lbl_titulo_processo=this.dialog.find(".lbl_titulo_processo"),this.edt_nome=this.dialog.find(".edt_nome"),this.nome_tabela=this.dialog.find(".nome_tabela"),this.edt_instrucao_trabalho=this.dialog.find(".edt_instrucao_trabalho"),this.chk_ativo=this.dialog.find(".chk_ativo"),this.chk_cliente=this.dialog.find(".chk_cliente"),this.chk_diretorio=this.dialog.find(".chk_diretorio"),this.tr_escolha_pasta_anexos_solicitacao=this.dialog.find(".tr_escolha_pasta_anexos_solicitacao"),this.tr_armazenar_anexos_modulo_documentos=this.dialog.find(".tr_armazenar_anexos_modulo_documentos"),this.cbo_categoria_processos=this.dialog.find(".cbo_categoria_processos"),this.btn_categoria_processos_visualizar=this.dialog.find(".btn_categoria_processos_visualizar"),this.btn_categoria_processos_recarregar=this.dialog.find(".btn_categoria_processos_recarregar"),this.btn_categoria_processos_novo=this.dialog.find(".btn_categoria_processos_novo"),this.div_pasta=this.dialog.find(".div_pasta"),this.selectPasta=a.createElement(e,null,null),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_visualizar=this.dialog.find(".btn_calendario_trabalho_visualizar"),this.btn_calendario_trabalho_recarregar=this.dialog.find(".btn_calendario_trabalho_recarregar"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.cbo_formulario=this.dialog.find(".cbo_formulario"),this.btn_formulario_visualizar=this.dialog.find(".btn_formulario_visualizar"),this.btn_formulario_recarregar=this.dialog.find(".btn_formulario_recarregar"),this.btn_formulario_novo=this.dialog.find(".btn_formulario_novo"),this.chk_permite_anexos=this.dialog.find(".chk_permite_anexos"),this.chk_exibir_modal_confirmacao_envio=this.dialog.find(".chk_exibir_modal_confirmacao_envio"),this.chk_permite_download_formulario_nao_concluido=this.dialog.find(".chk_permite_download_formulario_nao_concluido"),this.div_anexo_relacao=this.dialog.find(".div_anexo_relacao"),this.chk_esconder_grupos_campos_vazios=this.dialog.find(".chk_esconder_grupos_campos_vazios"),this.chk_excluir_solicitacoes_em_branco=this.dialog.find(".chk_excluir_solicitacoes_em_branco"),this.dx_abertura_automatica=this.dialog.find(".dx_abertura_automatica"),this.divAtvArvore=this.dialog.find(".divAtvArvore"),this.divAtvDiagrama=this.dialog.find(".divAtvDiagrama"),this.tab_supervisores=this.dialog.find(".tab_supervisores"),this.cbo_supervisores=this.dialog.find(".cbo_supervisores"),this.chk_cliente_acompanha=this.dialog.find(".chk_cliente_acompanha"),this.div_cliente_acompanha=this.dialog.find(".cliente_acompanha"),this.chk_solicitante_acompanha=this.dialog.find(".chk_solicitante_acompanha"),this.div_solicitante_acompanha=this.dialog.find(".solicitante_acompanha"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar_processo=this.dialog.find(".btn_salvar_processo"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_versoes=this.dialog.find(".btn_versoes"),this.btn_atv_arvore=this.dialog.find(".btn_atv_arvore"),this.btn_atv_diagrama=this.dialog.find(".btn_atv_diagrama"),this.btn_atv_diagrama_reprocessar=this.dialog.find(".btn_atv_diagrama_reprocessar"),this.divComponenteDrawer=this.dialog.find(".divComponenteDrawer"),this.tab_atividades=this.dialog.find(".tab_atividades"),this.processoDiagram=this.dialog.find(".processoDiagram"),this.array_abertura_automatica=[],this.permitir_abertura_manual=this.dialog.find(".permitir_abertura_manual"),this.processo={processo_id:null,nome:"",nova_versao_observacao:"",instrucao_trabalho:"",ativo:!1,categoria_processos_id:null,calendario_trabalho_id:null,formulario_id:null,permite_anexos:!0,solicitante_acompanha:!1,documento_pasta_id:null,elementos:[],diagrama:null},this.arr_versoes=[],this.formulario=null,this.array_supervisores=[],this.array_grupo_supervisores=[],this.conectores_diagrama=[],this.versao_processo_id=null,this.dxDiagram=null,this.flag_listar_versoes=!0,this.show=function(a,e){switch(i.scrollview.dxScrollView().dxScrollView("instance"),i.scrollview.css("height","calc(100vh - 45px)"),o.render(i.selectPasta,i.div_pasta[0]),i.aba_configuracoes.attr("id","aba_configuracoes"+i.html_id),i.aba_atividades.attr("id","aba_atividades"+i.html_id),i.aba_supervisores.attr("id","aba_supervisores"+i.html_id),i.menu_configuracoes.attr("href","#"+i.aba_configuracoes.attr("id")),i.menu_atividades.attr("href","#"+i.aba_atividades.attr("id")),i.menu_supervisores.attr("href","#"+i.aba_supervisores.attr("id")),i.edt_instrucao_trabalho.attr("id","edt_instrucao_trabalho"+i.html_id),e){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:i.btn_salvar_processo.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_salvar_processo.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar_processo.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}i.tipo=e;const r={scrollview:i.scrollview,btnToggle:i.btn_versoes,processo_id:a,fnRenderVersoes:i.getFnRenderVersoes,fnPreencher:i.preencher,fnRestaurarVersao:i.fnRestaurarVersao,fnAtivarVersao:i.fnAtivarVersao,fnGerarVersao:i.fnGerarVersao,readOnly:e===FORMULARIO.VISUALIZAR||e===FORMULARIO.EXCLUIR,getFnDiagram:i.getFnDiagram};ReactDOM.render(React.createElement(window.components.ProcessoDrawerRight.default,r),i.divComponenteDrawer[0]),void 0!==a&&a?(i.processo.processo_id=a,i.preencher()):(set_tinymce(i.edt_instrucao_trabalho,""),i.listar_formulario(),i.listar_categoria_processos(),i.listar_documento_pasta(),i.listar_calendario_trabalho(),i.listar_versoes(),i.listar_periodicidade(),i.render_abertura_automatica(),i.chk_exibir_modal_confirmacao_envio.prop("checked",!0).trigger("change"),i.nome_tabela.val("p_")),create_combobox(i.cbo_supervisores,i.listar_supervisores),set_focus(i.edt_nome),setTimeout(function(){i.btn_fechar=$('[aba-id-md5="'+i.html_id+'"] .btn_fechar'),i.btn_fechar.click(function(){void 0!==i.onclose&&i.onclose&&i.onclose()})},300)},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.permite_alterar=function(a){i.edt_nome.prop("disabled",!a),i.cbo_supervisores.prop("disabled",!a),i.selectPasta.props.setDesabilitado(!a),i.cbo_categoria_processos.prop("disabled",!a),i.cbo_calendario_trabalho.prop("disabled",!a),i.btn_formulario_novo.prop("disabled",!a),i.btn_categoria_processos_novo.prop("disabled",!a),i.btn_calendario_trabalho_novo.prop("disabled",!a)},this.listar_supervisores=function(a){var o=i.cbo_supervisores.parent(),e=o.find(".edt_combobox");WS.get("usuario/listar_usuarios_grupos/",{nome:e.val(),equipe_interna:!0,listar_grupos:!0,modulo:MODULOS.PROCESSO},function(r){limpar_combobox(i.cbo_supervisores),$(r).each(function(a,o){var e=[];e.Nome=o.nome;var r=$('<span class="label lb_tipo" style="margin: 5px;"></span>');"usuarios"==o.tipo?(r.addClass("tipo_supervisor label-info"),r.attr("title","Usu치rio"),r.attr("data-original-title","Usu치rio"),r.text("U"),r.attr("tipo","usuarios")):"grupo_usuarios"==o.tipo&&(r.addClass("tipo_supervisor label-warning"),r.attr("title","Grupo de Usu치rios"),r.attr("data-original-title","Grupo de Usu치rios"),r.text("GU"),r.attr("tipo","grupo_usuarios")),r.tooltip(),add_option_combobox(i.cbo_supervisores,a,o.id>0?o.id:null,e,r)}),a(!0),e.keypress(function(a){if(13==a.keyCode){var o=i.cbo_supervisores.parent().find(".ncbo_scroll").find(".row_selected"),r=e.attr("selected-value"),s=o.find(".tipo_supervisor").attr("tipo"),t=e.val();if(r>0){if("usuarios"==s){var c=!1;if($(i.array_supervisores).each(function(a,o){o.usuario_id===r&&"N"==o.excluido&&(c=!0)}),!c){var n={usuario_id:r,nome:t,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};i.array_supervisores.push(n),i.render_supervisores(n)}}else if("grupo_usuarios"==s&&(c=!1,$(i.array_grupo_supervisores).each(function(a,o){o.grupo_usuarios_id===r&&"N"==o.excluido&&(c=!0)}),!c)){var _={grupo_usuarios_id:r,nome:t,excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};i.array_grupo_supervisores.push(_),i.render_supervisores(null,_)}e.val(""),set_focus(e)}}}),o.find(".ul_row").bind("click",function(){var a=$(this).parent().attr("id_registro"),o=$(this).find(".tipo_supervisor").attr("tipo");if(a>0){if("usuarios"==o){var r=!1;$(i.array_supervisores).each(function(o,e){e.usuario_id===a&&"N"==e.excluido&&(r=!0)}),setTimeout(function(){if(!r){var o={usuario_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};i.array_supervisores.push(o),i.render_supervisores(o)}},150)}else"grupo_usuarios"==o&&(r=!1,$(i.grupo_usuarios_equipe).each(function(o,e){e.grupo_usuarios_id===a&&"N"==e.excluido&&(r=!0)}),setTimeout(function(){if(!r){var o={grupo_usuarios_id:a,nome:e.val(),excluido:"N",permite_edicao:!1,notifica_cancelamento:!0,reabertura_solicitacoes_concluidas:!1};i.array_grupo_supervisores.push(o),i.render_supervisores(null,o)}},150));e.val(""),set_focus(e)}e.val(""),set_focus(e)})})},this.render_supervisores=function(a,o){var e=i.tab_supervisores.find("tbody"),r=e.find("[template-row]"),s=function(a,o,s){let t=r.clone();t.removeAttr("template-row"),t.css("display",""),t.addClass("rows");let c=$(t.find("[template-field='tipo']")),n=$(t.find(".chk_permite_edicao")),_=$(t.find(".chk_notifica_cancelamento")),l=$(t.find(".chk_reabertura_solicitacoes_concluidas"));n.removeClass("template_switch"),App.aplicar_checkbox(n.parent()),_.removeClass("template_switch"),App.aplicar_checkbox(_.parent()),l.removeClass("template_switch"),App.aplicar_checkbox(l.parent()),o?($(n).prop("checked",i.array_grupo_supervisores[s].permite_edicao).change(),$(n).change(function(a){i.array_grupo_supervisores[s].permite_edicao=$(this).prop("checked")}),$(_).prop("checked",i.array_grupo_supervisores[s].notifica_cancelamento).change(),$(_).change(function(a){i.array_grupo_supervisores[s].notifica_cancelamento=$(this).prop("checked")}),$(l).prop("checked",i.array_grupo_supervisores[s].reabertura_solicitacoes_concluidas).change(),$(l).change(function(a){i.array_grupo_supervisores[s].reabertura_solicitacoes_concluidas=$(this).prop("checked")})):($(n).prop("checked",i.array_supervisores[s].permite_edicao).change(),$(n).change(function(a){i.array_supervisores[s].permite_edicao=$(this).prop("checked")}),$(_).prop("checked",i.array_supervisores[s].notifica_cancelamento).change(),$(_).change(function(a){i.array_supervisores[s].notifica_cancelamento=$(this).prop("checked")}),$(l).prop("checked",i.array_supervisores[s].reabertura_solicitacoes_concluidas).change(),$(l).change(function(a){i.array_supervisores[s].reabertura_solicitacoes_concluidas=$(this).prop("checked")})),o?(c.addClass("label-warning"),c.attr("title","Grupo de Usu치rios"),c.attr("data-original-title","Grupo de Usu치rios"),c.text("GU")):(c.addClass("label-info"),c.attr("title","Usu치rio"),c.attr("data-original-title","Usu치rio"),c.text("U")),c.tooltip(),$(t.find("[template-field='nome']")).text(a.nome);var d=$(t.find(".btn_usuario_remover"));d.unbind("click"),d.click(function(){o?alert_modal("Valida칞칚o","Deseja remover o Grupo de Usu치rios?","Remover",function(){$(i.array_grupo_supervisores).each(function(o,e){e.grupo_usuarios_id==a.grupo_usuarios_id&&(t.remove(),i.array_grupo_supervisores[o].excluido="S")})},!0):alert_modal("Valida칞칚o","Deseja remover o Usu치rio?","Remover",function(){$(i.array_supervisores).each(function(o,e){e.usuario_id==a.usuario_id&&(t.remove(),i.array_supervisores[o].excluido="S")})},!0)}),t.appendTo(e)};i.tab_supervisores.find(".rows").remove(),$(i.array_supervisores).each(function(a,o){"N"==o.excluido&&s(o,!1,a)}),$(i.array_grupo_supervisores).each(function(a,o){"N"==o.excluido&&s(o,!0,a)})},this.preencher=function(a,o,e){i.versao_processo_id=e;var r=function(a){i.array_supervisores=a.array_supervisores,i.array_grupo_supervisores=a.array_grupo_supervisores,i.render_supervisores(),i.lbl_titulo_processo.text(a.nome),i.edt_nome.val(a.nome),a.nome_tabela?(i.nome_tabela.val(a.nome_tabela).prop("disabled",!0),i.cbo_formulario.prop("disabled",!0),i.btn_formulario_recarregar.prop("disabled",!0),i.btn_formulario_novo.prop("disabled",!0)):i.nome_tabela.val("p_"),set_tinymce(i.edt_instrucao_trabalho,a.instrucao_trabalho),i.chk_ativo.prop("disabled",!1),i.chk_cliente.prop("disabled",!1),i.chk_diretorio.prop("disabled",!1),i.chk_cliente_acompanha.prop("disabled",!1),i.chk_solicitante_acompanha.prop("disabled",!1),i.chk_permite_anexos.prop("disabled",!1),i.chk_exibir_modal_confirmacao_envio.prop("disabled",!1),i.chk_permite_download_formulario_nao_concluido.prop("disabled",!1),i.chk_esconder_grupos_campos_vazios.prop("disabled",!1),i.chk_excluir_solicitacoes_em_branco.prop("disabled",!1),i.chk_ativo.prop("checked",!0===a.ativo).change(),i.chk_cliente.prop("checked",!0===a.relaciona_cliente).change(),i.chk_diretorio.prop("checked",!0===a.escolher_pasta_solicitacao).change(),i.chk_permite_download_formulario_nao_concluido.prop("checked",!0===a.permite_download_formulario_nao_concluido).change(),i.listar_categoria_processos(a.categoria_processos_id),i.processo.documento_pasta_id=a.documento_pasta_id,i.listar_documento_pasta(a.documento_pasta_id,a.documento_pasta_path),i.listar_calendario_trabalho(a.calendario_trabalho_id),i.listar_formulario(a.formulario_id),i.chk_permite_anexos.prop("checked",!0===a.permite_anexos).change(),i.chk_exibir_modal_confirmacao_envio.prop("checked",!0===a.exibir_modal_confirmacao_envio||"S"==a.exibir_modal_confirmacao_envio).trigger("change"),i.chk_esconder_grupos_campos_vazios.prop("checked",!0===a.esconder_grupos_campos_vazios||"S"==a.esconder_grupos_campos_vazios).trigger("change"),i.chk_excluir_solicitacoes_em_branco.prop("checked",!0===a.excluir_solicitacoes_em_branco||"S"==a.excluir_solicitacoes_em_branco).trigger("change"),i.chk_cliente_acompanha.prop("checked",!0===a.cliente_acompanha).change(),i.chk_solicitante_acompanha.prop("checked",!0===a.solicitante_acompanha).change(),i.processo.solicitante_acompanha=!0===a.solicitante_acompanha,i.array_abertura_automatica=a.array_abertura_automatica,i.render_abertura_automatica(a.formulario_id),i.tipo!=FORMULARIO.VISUALIZAR&&i.tipo!=FORMULARIO.EXCLUIR||(i.chk_ativo.prop("disabled",!0),i.chk_cliente.prop("disabled",!0),i.chk_diretorio.prop("disabled",!0),i.chk_permite_anexos.prop("disabled",!0),i.chk_exibir_modal_confirmacao_envio.prop("disabled",!0),i.chk_esconder_grupos_campos_vazios.prop("disabled",!0),i.chk_excluir_solicitacoes_em_branco.prop("disabled",!0),i.chk_cliente_acompanha.prop("disabled",!0),i.chk_solicitante_acompanha.prop("disabled",!0),i.chk_permite_download_formulario_nao_concluido.prop("disabled",!0)),i.conectores_diagrama=[],i.processo.elementos=a.elementos,i.processo.diagrama=a.diagrama?JSON.parse(a.diagrama):null,i.flag_listar_versoes&&(i.flag_listar_versoes=!1,i.listar_versoes()),i.listar_periodicidade(a.permitir_abertura_manual),"function"==typeof o&&o(),i.menu_atividades.parent().hasClass("active")&&(i.divAtvArvore.hasClass("hidden")?i.render_diagrama():i.render_atividades())};a?r(a):i.processo.processo_id&&WS.get("processo/objeto/",{processo_id:i.processo.processo_id,versao_processo_id:e},r)},this.listar_categoria_processos=function(a){i.cbo_categoria_processos.find("option").remove(),add_option(i.cbo_categoria_processos,"","Nenhum"),WS.get("categoria_processos/listar/",null,function(o){for(var e=0;e<o.length;e++){var r=o[e];add_option(i.cbo_categoria_processos,r.categoria_processos_id,r.nome)}i.cbo_categoria_processos.selectpicker("refresh"),a&&i.cbo_categoria_processos.selectpicker("val",a).change()})},this.listar_documento_pasta=function(a,o){if(a){var e=void 0===o||""===o;i.selectPasta.props.setDocumentoPastaID(a,e)}void 0!==o&&""!==o&&i.selectPasta.props.setDocumentoPastaPath(o),i.selectPasta.props.handleSelecionar=function(){i.processo.documento_pasta_id=i.selectPasta.props.documentoPastaID}},this.listar_calendario_trabalho=function(a){i.cbo_calendario_trabalho.find("option").remove(),add_option(i.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(o){for(var e=0;e<o.length;e++){var r=o[e];add_option(i.cbo_calendario_trabalho,r.calendario_trabalho_id,r.nome)}i.cbo_calendario_trabalho.selectpicker("refresh"),a&&i.cbo_calendario_trabalho.selectpicker("val",a).change()})},this.listar_formulario=function(a){i.cbo_formulario.find("option").remove(),add_option(i.cbo_formulario,"","Nenhum"),WS.get("formulario/listar/",null,function(o){for(var e=0;e<o.length;e++){var r=o[e];add_option(i.cbo_formulario,r.formulario_id,r.nome)}i.cbo_formulario.selectpicker("refresh"),a&&i.cbo_formulario.selectpicker("val",a).change()})},this.listar_versoes=function(){WS.get("processo/listar_versoes/",{processo_id:i.processo.processo_id},function(a){i.arr_versoes=a,i.fnRenderVersoes()})},this.listar_periodicidade=function(a){a=void 0!==a&&a,i.permitir_abertura_manual.dxSwitch({value:a,disabled:!0}),i.habilitar_chk_permite_abertura_manual()},this.render_atividades=function(){require(["./assets/view/processo/util"],function(a){(new a).render_atividades(i.tab_atividades,i.processo,i.formulario,i.elemento_onsave)})},this.render_diagrama=function(){require(["./assets/view/processo/util"],function(a){var o=new a,e=[];i.conectores_diagrama=[],o.gerar_elem_key(i.processo,e,i.conectores_diagrama),setTimeout(()=>{const a={fnGetInstanceDiagram:i.fnGetInstanceDiagram,fnSalvarElemento:i.elemento_onsave,nodesDataSource:e,edgesDataSource:i.conectores_diagrama,processo:i.processo,formulario:i.formulario,div:i.divComponenteDrawer,util:o};ReactDOM.render(React.createElement(window.components.ProcessoDiagram.default,a),i.processoDiagram[0])})})},this.elemento_onsave=function(a,o){if(void 0!==a){if(void 0!==i.processo.elementos&&i.processo.elementos){for(var e=-1,r=0;r<i.processo.elementos.length;r++)if(i.processo.elementos[r].elem_key==a.elem_key){e=r;break}if(e<0)i.processo.elementos.push(a);else if(i.processo.elementos[e]=a,i.conectores_diagrama.length>0){let o=null;a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY?o="gateway_"+(a.id?a.id:a.elem_key):a.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE&&(o="atividade_"+(a.id?a.id:a.elem_key));let e=i.conectores_diagrama.filter(a=>a.from==o);for(let r=0;r<a.destinos.length;r++){let s=a.destinos[r],t=null;if(s.elemento_tipo==PROCESSO_ELEMENTO_TIPO.ATIVIDADE?t="atividade_"+(parseInt(s.id)?s.id:s.elem_key):s.elemento_tipo==PROCESSO_ELEMENTO_TIPO.GATEWAY&&(t="gateway_"+(parseInt(s.id)?s.id:s.elem_key)),0==e.filter(a=>a.to==t).length){let a={from:o,id:o+"_"+t,to:t};i.conectores_diagrama.push(a)}}}}if(o)for(r=0;r<i.processo.elementos.length;r++)if(o.elem_key==i.processo.elementos[r].elem_key){var s={tipo:a.tipo,elemento_tipo:a.elemento_tipo,descricao:a.descricao,elem_key:a.elem_key,permite_retorno:!!a.permite_retorno&&a.permite_retorno,opcional:!!a.opcional&&a.opcional,sequencia:a.sequencia,evento_enviar:null,filtro_evento_enviar:null,tipo_automacao:null};i.processo.elementos[r].destinos.push(s)}}i.menu_atividades.parent().hasClass("active")&&(i.divAtvArvore.hasClass("hidden")||i.render_atividades())},this.carregar_formulario=function(a){i.processo.formulario_id=a,WS.get("formulario/objeto/",{formulario_id:a},function(a){i.formulario=a})},this.fnRenderVersoes=null,this.getFnRenderVersoes=function(a){i.fnRenderVersoes=a},this.fnRestaurarVersao=function(a){WS.post("processo/restaurar_versao/",{versao_processo_id:a,restaurar:!0},async function(a){i.arr_versoes=a,i.formulario=await WS.asyncGet("formulario/objeto/",{formulario_id:i.processo.formulario_id}),i.fnRenderVersoes(),i.preencher()})},this.fnAtivarVersao=function(a,o){WS.post("processo/ativar_versao/",{versao_processo_id:a,versao_teste:o},function(a){i.arr_versoes=a,i.fnRenderVersoes(),i.preencher()})},this.fnGerarVersao=function(){View.load("processo/nova_versao",function(a,o){o.show(i.processo.processo_id),o.onsave=async function(a,o,e){WS.post("processo/gerar_versao/",{processo_id:i.processo.processo_id,nome:i.edt_nome.val(),nome_tabela:i.nome_tabela.val(),nova_versao_observacao:a,instrucao_trabalho:get_tinymce(i.edt_instrucao_trabalho),ativo:i.chk_ativo.prop("checked"),categoria_processos_id:i.cbo_categoria_processos.val(),documento_pasta_id:i.processo.documento_pasta_id,calendario_trabalho_id:i.cbo_calendario_trabalho.val(),formulario_id:i.cbo_formulario.val(),permite_anexos:i.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:i.chk_exibir_modal_confirmacao_envio.prop("checked"),esconder_grupos_campos_vazios:i.chk_esconder_grupos_campos_vazios.prop("checked"),excluir_solicitacoes_em_branco:i.chk_excluir_solicitacoes_em_branco.prop("checked"),elementos:JSON.stringify(i.processo.elementos),relaciona_cliente:i.chk_cliente.prop("checked"),escolher_pasta_solicitacao:i.chk_diretorio.prop("checked"),cliente_acompanha:i.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:i.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(i.array_supervisores),array_grupo_supervisores:JSON.stringify(i.array_grupo_supervisores),array_abertura_automatica:JSON.stringify(i.array_abertura_automatica),permite_download_formulario_nao_concluido:i.chk_permite_download_formulario_nao_concluido.prop("checked"),permitir_abertura_manual:i.permitir_abertura_manual.dxSwitch("instance").option("value"),diagrama:i.dxDiagram?await i.exportDiagram():JSON.stringify(i.processo.diagrama),versao_processo_id:i.versao_processo_id,tipo_versao:o,ativar_versao:e},function(a){i.processo.processo_id=a.processo.id,i.processo.elementos=a.processo.elementos,alert_saved(a.processo.nome+" salvo com sucesso"),i.unload()},[i.btn_cancelar,i.btn_excluir,i.btn_salvar_processo])}})},this.fnGetInstanceDiagram=function(a){i.dxDiagram=a,i.fnDiagram(a),View.setShowEvent(i.html_id,()=>{i.divComponenteDrawer.find(".divTmp").show(),i.divComponenteDrawer.children().dxDrawer("instance").repaint()})},this.fnDiagram=null,this.getFnDiagram=function(a){i.fnDiagram=a},this.exportDiagram=async function(){let a=JSON.parse(i.dxDiagram.export()),o=await i.dxDiagram.getEdgeDataSource().store().load().then(a=>a);for(let e=0;e<o.length;e++){const r=o[e];if(void 0!==r.elemKey&&r.elemKey!=r.id)for(let o=0;o<a.connectors.length;o++){const e=a.connectors[o];r.id===e.dataKey&&(a.connectors[o].dataKey=r.elemKey)}}return i.processo.diagrama=a,JSON.stringify(a)},this.habilitar_chk_permite_abertura_manual=(()=>{const a=Array.isArray(i.array_abertura_automatica)&&i.array_abertura_automatica.length>0;i.permitir_abertura_manual.dxSwitch("instance").option("disabled",!a),a||i.permitir_abertura_manual.dxSwitch("instance").option("value",!0)}),this.dx_abertura_automatica_on_row_removed=(a=>{i.habilitar_chk_permite_abertura_manual()}),this.dx_abertura_automatica_on_row_inserted=(a=>{i.habilitar_chk_permite_abertura_manual()}),this.render_abertura_automatica=(a=>{ReactDOM.unmountComponentAtNode(i.dx_abertura_automatica[0]),ReactDOM.render(React.createElement(window.components.DataGridProcessoRecorrencia.default,{processoId:i.processo.processo_id,formularioId:a||null,data:i.array_abertura_automatica,onRowRemoved:i.dx_abertura_automatica_on_row_removed,onRowInserted:i.dx_abertura_automatica_on_row_inserted}),i.dx_abertura_automatica[0])}),this.edt_nome.unbind("keyup"),this.edt_nome.keyup(function(){i.lbl_titulo_processo.text(i.edt_nome.val())}),this.nome_tabela.unbind("keydown").bind("keydown",function(a){if(!new RegExp("^[_0-9a-zA-Z\b]+$").test(a.key))return a.preventDefault(),!1;setTimeout(function(){0!==i.nome_tabela.val().indexOf("p_")?i.nome_tabela.val("p_"):i.nome_tabela.val(removerAcentos(i.nome_tabela.val()))})}),this.nome_tabela.unbind("paste").bind("paste",function(a){a.preventDefault()}),this.btn_categoria_processos_visualizar.unbind("click"),this.btn_categoria_processos_visualizar.click(function(){""!=i.cbo_categoria_processos.val()&&View.load("categoria_processos/detalhes",function(a,o){o.show(i.cbo_categoria_processos.val(),FORMULARIO.VISUALIZAR)})}),this.btn_categoria_processos_recarregar.unbind("click"),this.btn_categoria_processos_recarregar.click(function(){i.listar_categoria_processos(i.cbo_categoria_processos.val())}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&i.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_visualizar.unbind("click"),this.btn_calendario_trabalho_visualizar.click(function(){""!=i.cbo_calendario_trabalho.val()&&View.load("calendario_trabalho/detalhes",function(a,o){o.show(i.cbo_calendario_trabalho.val(),FORMULARIO.VISUALIZAR)})}),this.btn_calendario_trabalho_recarregar.unbind("click"),this.btn_calendario_trabalho_recarregar.click(function(){i.listar_calendario_trabalho(i.cbo_calendario_trabalho.val())}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(a,o){o.onclose=function(){o.calendario_trabalho_id&&i.listar_calendario_trabalho(o.calendario_trabalho_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_formulario_visualizar.unbind("click"),this.btn_formulario_visualizar.click(function(){""!=i.cbo_formulario.val()&&View.load("formulario/detalhes",function(a,o){o.show(i.cbo_formulario.val(),FORMULARIO.VISUALIZAR)},View.ABA.MULTIPLAS)}),this.btn_formulario_recarregar.unbind("click"),this.btn_formulario_recarregar.click(function(){i.listar_formulario(i.cbo_formulario.val())}),this.btn_formulario_novo.unbind("click"),this.btn_formulario_novo.click(function(){View.load("formulario/detalhes",function(a,o){o.onclose=function(){o.formulario_id&&i.listar_formulario(o.formulario_id)},o.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.cbo_formulario.unbind("change"),this.cbo_formulario.change(function(){i.cbo_formulario.val()&&i.carregar_formulario(i.cbo_formulario.val())}),this.chk_permite_anexos.change(function(){$(this).prop("checked")?(i.div_anexo_relacao.fadeIn(),i.tr_escolha_pasta_anexos_solicitacao.fadeOut(),i.chk_diretorio.prop("checked",!1).change()):(i.div_anexo_relacao.fadeOut(),i.tr_escolha_pasta_anexos_solicitacao.fadeIn())}),this.chk_solicitante_acompanha.change(function(){i.processo.solicitante_acompanha=$(this).prop("checked")}),this.chk_diretorio.change(function(){$(this).prop("checked")?(i.tr_armazenar_anexos_modulo_documentos.fadeOut(),i.tr_armazenar_anexos_modulo_documentos.prop("checked",!1).change()):i.tr_armazenar_anexos_modulo_documentos.fadeIn()}),this.chk_cliente.change(function(){$(this).prop("checked")?i.div_cliente_acompanha.fadeIn():i.div_cliente_acompanha.fadeOut()}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(a,o){o.onclose=function(){o.categoria_processos_id&&i.listar_categoria_processos(o.categoria_processos_id)},o.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar_processo.unbind("click"),this.btn_salvar_processo.click(async function(a){WS.post("processo/salvar",{processo_id:i.processo.processo_id,nome:i.edt_nome.val(),nome_tabela:i.nome_tabela.val(),instrucao_trabalho:get_tinymce(i.edt_instrucao_trabalho),ativo:i.chk_ativo.prop("checked"),categoria_processos_id:i.cbo_categoria_processos.val(),documento_pasta_id:i.processo.documento_pasta_id,calendario_trabalho_id:i.cbo_calendario_trabalho.val(),formulario_id:i.cbo_formulario.val(),permite_anexos:i.chk_permite_anexos.prop("checked"),exibir_modal_confirmacao_envio:i.chk_exibir_modal_confirmacao_envio.prop("checked"),esconder_grupos_campos_vazios:i.chk_esconder_grupos_campos_vazios.prop("checked"),excluir_solicitacoes_em_branco:i.chk_excluir_solicitacoes_em_branco.prop("checked"),permite_download_formulario_nao_concluido:i.chk_permite_download_formulario_nao_concluido.prop("checked"),elementos:JSON.stringify(i.processo.elementos),relaciona_cliente:i.chk_cliente.prop("checked"),escolher_pasta_solicitacao:i.chk_diretorio.prop("checked"),cliente_acompanha:i.chk_cliente_acompanha.prop("checked"),solicitante_acompanha:i.chk_solicitante_acompanha.prop("checked"),array_supervisores:JSON.stringify(i.array_supervisores),array_grupo_supervisores:JSON.stringify(i.array_grupo_supervisores),array_abertura_automatica:JSON.stringify(i.array_abertura_automatica),permitir_abertura_manual:i.permitir_abertura_manual.dxSwitch("instance").option("value"),diagrama:i.dxDiagram?await i.exportDiagram():JSON.stringify(i.processo.diagrama),versao_processo_id:i.versao_processo_id},function(o){i.processo.processo_id=o.id,i.processo.elementos=o.elementos,i.tipo=FORMULARIO.EDITAR,alert_saved(o.nome+" salvo com sucesso"),a.currentTarget.classList.contains("salvar-e-sair")?i.unload():i.preencher(o,function(){i.menu_atividades.parent().hasClass("active")&&(i.divAtvArvore.hasClass("hidden")?i.render_diagrama():i.render_atividades())})},[i.btn_cancelar,i.btn_excluir,i.btn_salvar_processo])}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("processo/excluir",{processo_id:i.processo.processo_id},function(a){alert_saved(a.nome+" excluido com sucesso"),i.unload()},[i.btn_cancelar,i.btn_excluir,i.btn_salvar_processo])}),this.menu_atividades.unbind("click").click(function(){i.menu_atividades.parent().hasClass("active")||(i.divAtvDiagrama.hasClass("hidden")?(i.btn_atv_diagrama.show(),i.render_atividades()):(i.btn_atv_arvore.show(),i.btn_atv_diagrama_reprocessar.show()))}),this.menu_configuracoes.off("click").on("click",()=>{i.btn_atv_diagrama.hide(),i.btn_atv_diagrama_reprocessar.hide(),i.btn_atv_arvore.hide()}),this.menu_supervisores.off("click").on("click",()=>{i.btn_atv_diagrama.hide(),i.btn_atv_diagrama_reprocessar.hide(),i.btn_atv_arvore.hide()}),this.btn_atv_diagrama.off("click").on("click",()=>{i.divAtvArvore.addClass("hidden"),i.divAtvDiagrama.removeClass("hidden"),i.btn_atv_diagrama.hide(),i.btn_atv_diagrama_reprocessar.fadeIn(1e3),i.btn_atv_arvore.fadeIn(1e3),i.render_diagrama()}),this.btn_atv_diagrama_reprocessar.off("click").on("click",()=>{alertaPopUp("Reprocessar Diagrama",'Deseja continuar? Todo o diagrama ser치 reprocessado com base nas atividades e gateways da aba "츼rvore".',"Sim, continuar",()=>{i.processo.diagrama=null,i.render_diagrama()},"N칚o",()=>{},null,"200px")}),this.btn_atv_arvore.off("click").on("click",async()=>{i.divComponenteDrawer.find(".divTmp").find(".btn_cancelar.close").trigger("click"),i.divAtvArvore.removeClass("hidden"),i.divAtvDiagrama.addClass("hidden"),i.btn_atv_diagrama.fadeIn(1e3),i.btn_atv_diagrama_reprocessar.hide(),i.btn_atv_arvore.hide(),i.processo.diagrama=JSON.parse(await i.exportDiagram()),i.render_atividades()}),i.dialog.keydown(function(a){if(a.ctrlKey&&(67==a.keyCode||88==a.keyCode)){var o=$("<input>");$("body").append(o),o.val(" ").select(),document.execCommand("copy"),o.remove()}})}});