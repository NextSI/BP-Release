define([],function(){var Importar_Excel=function(html_id){"use strict";var main=this;this.html_id=html_id,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.div_cadastro_cliente=this.dialog.find(".div_cadastro_cliente"),this.primeira_etapa=this.dialog.find(".primeira_etapa"),this.segunda_etapa=this.dialog.find(".segunda_etapa"),this.terceira_etapa=this.dialog.find(".terceira_etapa"),this.quarta_etapa=this.dialog.find(".quarta_etapa"),this.edt_quantidade_linhas=this.dialog.find(".edt_quantidade_linhas"),this.planilha=this.dialog.find(".planilha"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.add_coluna_planilha=this.dialog.find(".add_coluna_planilha"),this.cbo_codigo=this.dialog.find(".cbo_codigo"),this.cbo_unidade=this.dialog.find(".cbo_unidade"),this.cbo_razao_social=this.dialog.find(".cbo_razao_social"),this.cbo_nome_fantasia=this.dialog.find(".cbo_nome_fantasia"),this.cbo_bloqueado=this.dialog.find(".cbo_bloqueado"),this.cbo_tipo_pessoa=this.dialog.find(".cbo_tipo_pessoa"),this.cbo_tipo_cadastro=this.dialog.find(".cbo_tipo_cadastro"),this.cbo_cep=this.dialog.find(".cbo_cep"),this.cbo_endereco=this.dialog.find(".cbo_endereco"),this.cbo_numero=this.dialog.find(".cbo_numero"),this.cbo_complemento=this.dialog.find(".cbo_complemento"),this.cbo_bairro=this.dialog.find(".cbo_bairro"),this.cbo_municipio=this.dialog.find(".cbo_municipio"),this.cbo_pais=this.dialog.find(".cbo_pais"),this.cbo_cnpj=this.dialog.find(".cbo_cnpj"),this.cbo_inscricao_estadual=this.dialog.find(".cbo_inscricao_estadual"),this.cbo_inscricao_municipal=this.dialog.find(".cbo_inscricao_municipal"),this.cbo_id_estrangeiro=this.dialog.find(".cbo_id_estrangeiro"),this.cbo_tipo_orgao=this.dialog.find(".cbo_tipo_orgao"),this.cbo_data_fundacao=this.dialog.find(".cbo_data_fundacao"),this.cbo_telefone1=this.dialog.find(".cbo_telefone1"),this.cbo_telefone2=this.dialog.find(".cbo_telefone2"),this.cbo_telefone3=this.dialog.find(".cbo_telefone3"),this.cbo_telefone4=this.dialog.find(".cbo_telefone4"),this.cbo_site=this.dialog.find(".cbo_site"),this.cbo_email_principal=this.dialog.find(".cbo_email_principal"),this.cbo_email_agenda=this.dialog.find(".cbo_email_agenda"),this.cbo_observacoes=this.dialog.find(".cbo_observacoes"),this.cbo_classificacao=this.dialog.find(".cbo_classificacao"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.btn_proxima_etapa=this.dialog.find(".btn_proxima_etapa"),this.btn_voltar=this.dialog.find(".btn_voltar"),this.codigo=this.dialog.find(".codigo"),this.arr_indice=[],this.var_response=[],this.arr_planilha=[],this.clientes_existentes=[],this.parametros_cliente=null,this.pode_importar=!1,this.cliente_codigo_automatico=!1,this.show=function(){main.limpar_formulario_importar_atividade(),show_modal(main.modal.attr("id")),WS.get("cliente/get_parametros/",null,function(a){main.parametros_cliente=a,main.cliente_codigo_automatico="S"==a.cliente_codigo_automatico,1==main.cliente_codigo_automatico&&main.codigo.addClass("hidden")}),main.primeira_etapa_func(!1)},this.limpar_formulario_importar_atividade=function(){main.edt_quantidade_linhas.val(""),main.planilha.val("")},this.close=function(){close_modal(main.modal.attr("id")),void 0!==main.onclose&&main.onclose&&main.onclose()},this.unload=function(){main.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){main.unload()}),this.primeira_etapa_func=function(a){var e=new Array;e=[".xls"];var n=null;main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){var a=main.planilha[0].files.length,i=new Validation;if(0==a&&i.add(new ValidationMessage(Validation.CODES.ERR,"Selecione uma planilha.")),a>0){var l=main.planilha[0].files[0].name;n=l.substring(l.lastIndexOf(".")).toLowerCase(),-1==jQuery.inArray(n,e)&&i.add(new ValidationMessage(Validation.CODES.ERR,'Selecionar planilha no formato "xls".'))}""==main.edt_quantidade_linhas.val()&&i.add(new ValidationMessage(Validation.CODES.ERR,"Informe a linha que começará a importação.")),i.is_valid()?WS.post("cliente/importar_excel/",{quantidade_linhas:main.edt_quantidade_linhas.val(),planilha:main.planilha[0].files[0]},function(a){a&&($.each(a,function(a,e){$.map(e,function(a,e){-1==main.arr_indice.indexOf(e)&&main.arr_indice.push(e)})}),main.var_response=a,main.btn_voltar.removeClass("hidden"),main.segunda_etapa_func(!1))},[main.btn_proxima_etapa,main.btn_cancelar,main.btn_voltar],null,!0):alert_modal("Validação",i)})},this.segunda_etapa_func=function(retorno){main.arr_planilha=[],main.primeira_etapa.addClass("hidden"),main.segunda_etapa.removeClass("hidden"),retorno||(main.add_coluna_planilha.find("option").remove(),add_option(main.add_coluna_planilha,"","-- Selecione --"),$.each(main.arr_indice,function(a,e){add_option(main.add_coluna_planilha,e,e)}),main.add_coluna_planilha.selectpicker("refresh")),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.primeira_etapa_func(!0),main.primeira_etapa.removeClass("hidden"),main.segunda_etapa.addClass("hidden"),main.btn_voltar.addClass("hidden")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){main.validation()&&($.each(main.var_response,function(i,item){var codigo_valor=main.cbo_codigo.val().length>0?eval("item."+main.cbo_codigo.val()):null,unidade_valor=main.cbo_unidade.val().length>0?eval("item."+main.cbo_unidade.val()):null,razao_social_valor=main.cbo_razao_social.val().length>0?eval("item."+main.cbo_razao_social.val()):null,nome_fantasia_valor=main.cbo_nome_fantasia.val().length>0?eval("item."+main.cbo_nome_fantasia.val()):null,bloqueado_valor=main.cbo_bloqueado.val().length>0?eval("item."+main.cbo_bloqueado.val()):null,tipo_pessoa_valor=main.cbo_tipo_pessoa.val().length>0?eval("item."+main.cbo_tipo_pessoa.val()):null,tipo_cadastro_valor=main.cbo_tipo_cadastro.val().length>0?eval("item."+main.cbo_tipo_cadastro.val()):null,cep_valor=main.cbo_cep.val().length>0?eval("item."+main.cbo_cep.val()):null,endereco_valor=main.cbo_endereco.val().length>0?eval("item."+main.cbo_endereco.val()):null,numero_valor=main.cbo_numero.val().length>0?eval("item."+main.cbo_numero.val()):null,complemento_valor=main.cbo_complemento.val().length>0?eval("item."+main.cbo_complemento.val()):null,bairro_valor=main.cbo_bairro.val().length>0?eval("item."+main.cbo_bairro.val()):null,municipio_valor=main.cbo_municipio.val().length>0?eval("item."+main.cbo_municipio.val()):null,pais_valor=main.cbo_pais.val().length>0?eval("item."+main.cbo_pais.val()):null,cnpj_valor=main.cbo_cnpj.val().length>0?eval("item."+main.cbo_cnpj.val()):null,inscricao_estadual_valor=main.cbo_inscricao_estadual.val().length>0?eval("item."+main.cbo_inscricao_estadual.val()):null,inscricao_municipal_valor=main.cbo_inscricao_municipal.val().length>0?eval("item."+main.cbo_inscricao_municipal.val()):null,id_estrangeiro_valor=main.cbo_id_estrangeiro.val().length>0?eval("item."+main.cbo_id_estrangeiro.val()):null,tipo_orgao_valor=main.cbo_tipo_orgao.val().length>0?eval("item."+main.cbo_tipo_orgao.val()):null,data_fundacao_valor=main.cbo_data_fundacao.val().length>0?eval("item."+main.cbo_data_fundacao.val()):null,telefone1_valor=main.cbo_telefone1.val().length>0?eval("item."+main.cbo_telefone1.val()):null,telefone2_valor=main.cbo_telefone2.val().length>0?eval("item."+main.cbo_telefone2.val()):null,telefone3_valor=main.cbo_telefone3.val().length>0?eval("item."+main.cbo_telefone3.val()):null,telefone4_valor=main.cbo_telefone4.val().length>0?eval("item."+main.cbo_telefone4.val()):null,site_valor=main.cbo_site.val().length>0?eval("item."+main.cbo_site.val()):null,email_principal_valor=main.cbo_email_principal.val().length>0?eval("item."+main.cbo_email_principal.val()):null,email_agenda_valor=main.cbo_email_agenda.val().length>0?eval("item."+main.cbo_email_agenda.val()):null,observacoes_valor=main.cbo_observacoes.val().length>0?eval("item."+main.cbo_observacoes.val()):null,classificacao_valor=main.cbo_classificacao.val().length>0?eval("item."+main.cbo_classificacao.val()):null,importar=!0;if(null!=tipo_pessoa_valor&&tipo_pessoa_valor[0]&&(tipo_pessoa_valor=tipo_pessoa_valor[0].toUpperCase().trim(),""==tipo_pessoa_valor&&(importar=!1)),null!=tipo_cadastro_valor){var F="F"==tipo_cadastro_valor[0]||"f"==tipo_cadastro_valor[0]?"F":"",R="R"==tipo_cadastro_valor[0]||"r"==tipo_cadastro_valor[0]?"R":"",S="S"==tipo_cadastro_valor[0]||"s"==tipo_cadastro_valor[0]?"S":"",E="E"==tipo_cadastro_valor[0]||"e"==tipo_cadastro_valor[0]?"E":"",N="N"==tipo_cadastro_valor[0]||"n"==tipo_cadastro_valor[0]?"N":"";tipo_cadastro_valor=F+R+S+E+N,tipo_cadastro_valor=tipo_cadastro_valor.trim()}if(null!=tipo_orgao_valor){var N="N"==tipo_orgao_valor[0]||"n"==tipo_orgao_valor[0]?"N":"",M="M"==tipo_orgao_valor[0]||"m"==tipo_orgao_valor[0]?"M":"",O="O"==tipo_orgao_valor[0]||"o"==tipo_orgao_valor[0]?"O":"",S="S"==tipo_orgao_valor[0]||"s"==tipo_orgao_valor[0]?"S":"";tipo_orgao_valor=M+O+S+N,tipo_orgao_valor=tipo_orgao_valor.trim()}if(null!=classificacao_valor){var L="L"==classificacao_valor[0]||"l"==classificacao_valor[0]?"L":"",S="S"==classificacao_valor[0]||"s"==classificacao_valor[0]?"S":"",P="P"==classificacao_valor[0]||"p"==classificacao_valor[0]?"P":"";classificacao_valor=P+L+S,classificacao_valor=classificacao_valor.trim()}(codigo_valor||unidade_valor||razao_social_valor||nome_fantasia_valor||bloqueado_valor||tipo_pessoa_valor||tipo_cadastro_valor||cep_valor||endereco_valor||numero_valor||complemento_valor||bairro_valor||municipio_valor||pais_valor||cnpj_valor||inscricao_estadual_valor||inscricao_municipal_valor||id_estrangeiro_valor||tipo_orgao_valor||data_fundacao_valor||telefone1_valor||telefone2_valor||telefone3_valor||telefone4_valor||site_valor||email_principal_valor||email_agenda_valor||observacoes_valor||classificacao_valor)&&main.arr_planilha.push({codigo:codigo_valor,unidade:unidade_valor,razao_social:razao_social_valor,nome_fantasia:nome_fantasia_valor,bloqueado:bloqueado_valor,tipo_pessoa:tipo_pessoa_valor,tipo_cadastro:tipo_cadastro_valor,cep:cep_valor,endereco:endereco_valor,numero:numero_valor,complemento:complemento_valor,bairro:bairro_valor,municipio:municipio_valor,pais:pais_valor,cnpj:cnpj_valor,inscricao_estadual:inscricao_estadual_valor,inscricao_municipal:inscricao_municipal_valor,id_estrangeiro:id_estrangeiro_valor,tipo_orgao:tipo_orgao_valor,data_fundacao:data_fundacao_valor,telefone1:telefone1_valor,telefone2:telefone2_valor,telefone3:telefone3_valor,telefone4:telefone4_valor,site:site_valor,email_principal:email_principal_valor,email_agenda:email_agenda_valor,observacoes:observacoes_valor,cod_municipio:null,cod_pais:null,importar:importar,classificacao:classificacao_valor})}),main.terceira_etapa_func(!1))})},this.validation=function(){var a=new Validation;return main.cliente_codigo_automatico||(0==main.cbo_codigo.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Código.")),0==main.cbo_unidade.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Unidade."))),0==main.cbo_razao_social.val().length&&"S"==main.parametros_cliente.cliente_obrig_razao_social&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Razão Social.")),0==main.cbo_nome_fantasia.val().length&&"S"==main.parametros_cliente.cliente_obrig_nome_fantasia&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Nome Fantasia.")),0==main.cbo_tipo_pessoa.val().length&&"S"==main.parametros_cliente.cliente_obrig_tipo&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Tipo de Pessoa.")),0==main.cbo_tipo_cadastro.val().length&&"S"==main.parametros_cliente.cliente_obrig_tipo&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Tipo de Cadastro.")),0==main.cbo_cep.val().length&&"S"==main.parametros_cliente.cliente_obrig_cep&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do CEP.")),0==main.cbo_endereco.val().length&&"S"==main.parametros_cliente.cliente_obrig_endereco&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Endereço.")),0==main.cbo_numero.val().length&&"S"==main.parametros_cliente.cliente_obrig_numero&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Número.")),0==main.cbo_bairro.val().length&&"S"==main.parametros_cliente.cliente_obrig_bairro&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Bairro.")),0==main.cbo_municipio.val().length&&"S"==main.parametros_cliente.cliente_obrig_municipio&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do Município.")),0==main.cbo_pais.val().length&&"S"==main.parametros_cliente.cliente_obrig_pais&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do País.")),0==main.cbo_cnpj.val().length&&"S"==main.parametros_cliente.cliente_obrig_cnpj&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do CNPJ/CPF.")),0==main.cbo_inscricao_estadual.val().length&&"S"==main.parametros_cliente.cliente_obrig_inscricao_estadual&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna da Inscrição Estadual.")),!!a.is_valid()||(alert_modal("Validação",a),!1)},this.terceira_etapa_func=function(a){main.segunda_etapa.addClass("hidden"),main.terceira_etapa.removeClass("hidden"),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.segunda_etapa_func(!0),main.segunda_etapa.removeClass("hidden"),main.terceira_etapa.addClass("hidden")});var e=main.terceira_etapa.find('[template-row="cadastro_cliente"]'),n=0;main.div_cadastro_cliente.find(".cadastro_cliente").remove(),$(main.arr_planilha).each(function(a,i){!function(a,i){var l=e.clone();l.removeAttr("template-row").remove(),l.css("display",""),$(l.find("[template-field='nome']")).text((null!=i.codigo?i.codigo:"")+" "+(null!=i.nome_fantasia&&""!=i.nome_fantasia?i.nome_fantasia:"Nome não informado"));var o=$(l.find("[template-field='municipio']"));o.val(i.municipio?i.municipio:""),"S"===main.parametros_cliente.cliente_obrig_municipio&&""==o.val()&&(l.addClass("alert-danger"),n++);var t=$(l.find("[template-field='pais']"));null!=i.pais&&""!=i.pais?t.val(i.pais):(t.val("BRASIL"),i.pais="BRASIL",i.cod_pais="1058",main.arr_planilha[a]=i);var r=$(l.find("[template-button='btn_municipio']"));r.unbind("click"),r.click(function(){View.load("municipio/selecionar",function(e,t){t.show(function(e){i.cod_municipio=e.cod_municipio,i.municipio=e.municipio,o.val(e.municipio),main.arr_planilha[a]=i,l.hasClass("alert-danger")&&(l.removeClass("alert-danger"),n--)})})});var c=$(l.find("[template-button='btn_add_municipio']"));c.unbind("click"),c.click(function(){View.load("municipio/detalhes",function(e,t){t.onsave=function(e){i.cod_municipio=e.cod_municipio,i.municipio=e.municipio,o.val(e.municipio),main.arr_planilha[a]=i,l.hasClass("alert-danger")&&(l.removeClass("alert-danger"),n--)},t.show(null,FORMULARIO.NOVO)})});var s=$(l.find("[template-button='btn_pais']"));s.unbind("click"),s.click(function(){View.load("pais/selecionar",function(e,n){n.show(function(e){i.cod_pais=e.cod_pais,i.pais=e.nome,t.val(e.nome),main.arr_planilha[a]=i})})}),l.appendTo(main.div_cadastro_cliente)}(a,i)}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){if(n>0){var a=new Validation;a.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Ajuste as linhas em vermelho antes de continuar")),alert_modal("Validação",a)}else main.quarta_etapa_func(!1)})},this.quarta_etapa_func=function(a){main.terceira_etapa.addClass("hidden"),main.quarta_etapa.removeClass("hidden"),main.btn_proxima_etapa.css("display","none"),main.btn_confirmar.css("display",""),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.btn_confirmar.css("display","none"),main.btn_proxima_etapa.css("display",""),main.tab_listagem.find("tr:gt(1)").remove(),main.terceira_etapa_func(!0),main.terceira_etapa.removeClass("hidden"),main.quarta_etapa.addClass("hidden")}),WS.get("cliente/listar/",null,function(a){main.clientes_existentes=a});var e=main.tab_listagem.find("tbody").find("tr:first"),n=0,i=function(a,l,o){var t=e.clone();t.removeAttr("template-row").remove(),t.css("display",""),t.attr("id",""+a),t.addClass("tr_cliente");var r=$(t.find("[template-field='importar']"));if(r.attr("type","checkbox"),r.bootstrapSwitch(!0),r.bootstrapSwitch(!0),!0===l.importar?(r.bootstrapSwitch("state",!0),r.prop("checked",!0)):(r.bootstrapSwitch("state",!1),r.prop("checked",!1)),r.unbind("click"),r.bootstrapSwitch("onSwitchChange",function(e,n){l.importar=r.prop("checked"),main.arr_planilha[a]=l}),!main.cliente_codigo_automatico){var c=$(t.find("[template-field='codigo']")),s=$(t.find("[template-field='unidade']")),d=!1,_=null,m=null;if($(main.clientes_existentes).each(function(a,e){null!==l.unidade&&l.unidade==e.unidade&&null!==l.codigo&&l.codigo==e.codigo&&(d=!0,_=e.codigo,m=e.unidade)}),d){t.addClass("alert-warning"),c.html('<span class="label label-warning count_codigo">Código já existe</span><div class="form-group"><input class="form-control edt_new_codigo" maxlength="50" type="text" value="'+_+'"></div>');var p=c.find(".edt_new_codigo"),u=c.find(".count_codigo");p.keyup(function(){msg_count(p,u,50)}),p.unbind("change"),p.change(function(){""!==p.val().trim()&&p.val()!==_&&(l.codigo=p.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))}),s.html('<span class="label label-warning count_unidade">Unidade já existe</span><div class="form-group"><input class="form-control edt_new_unidade" maxlength="2" type="text" value="'+m+'"></div>');var v=s.find(".edt_new_unidade"),g=s.find(".count_unidade");v.keyup(function(){msg_count(v,g,2)}),v.unbind("change"),v.change(function(){""!==v.val().trim()&&v.val()!==m&&(l.unidade=v.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null!=l.codigo&&l.codigo.toString().trim().length>50){t.addClass("alert-danger"),c.html('<span class="label label-danger count_codigo">50 caracteres apenas</span><div class="form-group"><input class="form-control edt_new_codigo" maxlength="50" type="text" value="'+l.codigo+'"></div>');p=c.find(".edt_new_codigo"),u=c.find(".count_codigo");p.keyup(function(){msg_count(p,u,50)}),p.unbind("change"),p.change(function(){""!==p.val().trim()&&(l.codigo=p.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null==l.codigo){t.addClass("alert-danger"),c.html('<span class="label label-danger count_codigo">Campo obrigatório</span><div class="form-group"><input class="form-control edt_new_codigo" maxlength="50" type="text"></div>');p=c.find(".edt_new_codigo"),u=c.find(".count_codigo");p.keyup(function(){msg_count(p,u,50)}),p.unbind("change"),p.change(function(){""!==p.val().trim()&&(l.codigo=p.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null!=l.codigo&&isNaN(l.codigo)){t.addClass("alert-danger"),c.html('<span class="label label-danger count_codigo">Números apenas</span><div class="form-group"><input class="form-control edt_new_codigo" maxlength="50" type="text" value="'+l.codigo+'"></div>');p=c.find(".edt_new_codigo"),u=c.find(".count_codigo");p.keyup(function(){msg_count(p,u,50)}),p.unbind("change"),p.change(function(){""!==p.val().trim()&&(l.codigo=p.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else c.text(null!=l.codigo?l.codigo:"");if(null!=l.unidade&&l.unidade.toString().trim().length>2){t.addClass("alert-danger"),s.html('<span class="label label-danger count_unidade">2 caracteres apenas</span><div class="form-group"><input class="form-control edt_new_unidade" maxlength="2" type="text" value="'+l.unidade+'"></div>');v=s.find(".edt_new_unidade"),g=s.find(".count_unidade");v.keyup(function(){msg_count(v,g,2)}),v.unbind("change"),v.change(function(){""!==v.val().trim()&&(l.unidade=v.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null==l.unidade){t.addClass("alert-danger"),s.html('<span class="label label-danger count_unidade">Campo obrigatório</span><div class="form-group"><input class="form-control edt_new_unidade" maxlength="2" type="text"></div>');v=s.find(".edt_new_unidade"),g=s.find(".count_unidade");v.keyup(function(){msg_count(v,g,2)}),v.unbind("change"),v.change(function(){""!==v.val().trim()&&(l.unidade=v.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null!=l.unidade&&isNaN(l.unidade)){t.addClass("alert-danger"),s.html('<span class="label label-danger count_unidade">Números apenas</span><div class="form-group"><input class="form-control edt_new_unidade" maxlength="2" type="text" value="'+l.unidade+'"></div>');v=s.find(".edt_new_unidade"),g=s.find(".count_unidade");v.keyup(function(){msg_count(v,g,2)}),v.unbind("change"),v.change(function(){""!==v.val().trim()&&(l.unidade=v.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else s.text(null!=l.unidade?l.unidade:"")}var f=$(t.find("[template-field='nome_fantasia']"));if(null!=l.nome_fantasia&&l.nome_fantasia.toString().trim().length>45){t.addClass("alert-danger"),f.html('<span class="label label-danger count_nome">45 caracteres apenas</span><div class="form-group"><input class="form-control edt_new_nome" maxlength="45" type="text" value="'+l.nome_fantasia+'"></div>');var h=f.find(".edt_new_nome"),b=f.find(".count_nome");h.keyup(function(){msg_count(h,b,45)}),h.unbind("change"),h.change(function(){""!==h.val().trim()&&(l.nome_fantasia=h.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_nome_fantasia&&null==l.nome_fantasia){t.addClass("alert-danger"),f.html('<span class="label label-danger count_nome">Campo obrigatório</span><div class="form-group"><input class="form-control edt_new_nome" maxlength="45" type="text"></div>');h=f.find(".edt_new_nome"),b=f.find(".count_nome");h.keyup(function(){msg_count(h,b,45)}),h.unbind("change"),h.change(function(){""!==h.val().trim()&&(l.nome_fantasia=h.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else f.text(null!=l.nome_fantasia?l.nome_fantasia:"");var x=$(t.find("[template-field='razao_social']"));if(null!=l.razao_social&&l.razao_social.toString().trim().length>45){t.addClass("alert-danger"),x.html('<span class="label label-danger count_razao_social">45 caracteres apenas</span><div class="form-group"><input class="form-control edt_new_razao_social" maxlength="45" type="text" value="'+l.razao_social+'"></div>');var S=x.find(".edt_new_razao_social"),C=x.find(".count_razao_social");S.keyup(function(){msg_count(S,C,45)}),S.unbind("change"),S.change(function(){""!=S.val().trim()&&(l.razao_social=S.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_razao_social&&null==l.razao_social){t.addClass("alert-danger"),x.html('<span class="label label-danger count_razao_social">Campo obrigatório</span><div class="form-group"><input class="form-control edt_new_razao_social" maxlength="45" type="text"></div>');S=x.find(".edt_new_razao_social"),C=x.find(".count_razao_social");S.keyup(function(){msg_count(S,C,45)}),S.unbind("change"),S.change(function(){""!=S.val().trim()&&(l.razao_social=S.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else x.text(null!=l.razao_social?l.razao_social:"");$(t.find("[template-field='bloqueado']")).html(str_yes_no(l.bloqueado));var y=$(t.find("[template-field='cnpj']"));if(null!=l.cnpj&&l.cnpj.toString().trim().length>18){t.addClass("alert-danger"),y.html('<span class="label label-danger count_cnpj">18 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_cnpj" maxlength="18" type="text" value="'+l.cnpj+'"></div>');var w=y.find(".edt_cnpj"),k=y.find(".count_cnpj");w.keyup(function(){msg_count(w,k,18)}),w.unbind("change"),w.change(function(){""!=w.val().trim()&&(l.cnpj=w.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_cnpj&&null==l.cnpj){t.addClass("alert-danger"),y.html('<span class="label label-danger count_cnpj">Campo obrigatório</span><div class="form-group"><input class="form-control edt_new_cnpj" maxlength="18" type="text"></div>');w=y.find(".edt_new_cnpj"),k=y.find(".count_cnpj");w.keyup(function(){msg_count(w,k,18)}),w.unbind("change"),w.change(function(){""!=w.val().trim()&&(l.cnpj=w.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if(null!=l.cnpj&&isNaN(l.cnpj)){t.addClass("alert-danger"),y.html('<span class="label label-danger count_cnpj">Números apenas</span><div class="form-group"><input class="form-control edt_new_cnpj" maxlength="18" type="text" value="'+l.cnpj+'"></div>');w=y.find(".edt_new_cnpj"),k=y.find(".count_cnpj");w.keyup(function(){msg_count(w,k,18)}),w.unbind("change"),w.change(function(){""!==w.val().trim()&&(l.cnpj=w.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else y.text(null!=l.cnpj?l.cnpj:"");var E=$(t.find("[template-field='id_estrangeiro']"));if(null!=l.id_estrangeiro&&l.id_estrangeiro.toString().trim().length>20){t.addClass("alert-danger"),E.html('<span class="label label-danger count_id_estrangeiro">20 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_id_estrangeiro" maxlength="20" type="text" value="'+l.id_estrangeiro+'"></div>');var R=E.find(".edt_id_estrangeiro"),V=E.find(".count_id_estrangeiro");R.keyup(function(){msg_count(R,V,20)}),R.unbind("change"),R.change(function(){!R.val().length>20&&(l.id_estrangeiro=R.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else E.text(null!=l.id_estrangeiro?l.id_estrangeiro:"");var j=$(t.find("[template-field='inscricao_estadual']"));if(null!=l.inscricao_estadual&&l.inscricao_estadual.toString().trim().length>18){t.addClass("alert-danger"),j.html('<span class="label label-danger count_insc_est">18 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_inscricao_estadual" maxlength="18" type="text" value="'+l.inscricao_estadual+'"></div>');var N=j.find(".edt_inscricao_estadual"),O=j.find(".count_insc_est");N.keyup(function(){msg_count(N,O,18)}),N.unbind("change"),N.change(function(){""!=N.val().trim()&&(l.inscricao_estadual=N.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_inscricao_estadual&&null==l.inscricao_estadual){t.addClass("alert-danger"),j.html('<span class="label label-danger count_insc_est">Campo obrigatório</span><br><div class="form-group"><input class="form-control edt_inscricao_estadual" maxlength="18" type="text"></div>');N=j.find(".edt_inscricao_estadual"),O=j.find(".count_insc_est");N.keyup(function(){msg_count(N,O,18)}),N.unbind("change"),N.change(function(){""!=N.val().trim()&&(l.inscricao_estadual=N.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else j.text(null!=l.inscricao_estadual?l.inscricao_estadual:"");var z=$(t.find("[template-field='inscricao_municipal']"));if(null!=l.inscricao_municipal&&l.inscricao_municipal.toString().trim().length>15){t.addClass("alert-danger"),z.html('<span class="label label-danger count_inscricao_municipal">15 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_inscricao_municipal" maxlength="15" type="text" value="'+l.inscricao_municipal+'"></div>');var M=z.find(".edt_inscricao_municipal"),I=z.find(".count_inscricao_municipal");M.keyup(function(){msg_count(M,I,15)}),M.unbind("change"),M.change(function(){!M.val().length>15&&(l.inscricao_municipal=M.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else z.text(null!=l.inscricao_municipal?l.inscricao_municipal:"");var q=$(t.find("[template-field='tipo_orgao']")),D=l.tipo_orgao;null!=D&&("N"==(D=D.trim())?D="Normal":"M"==D?D="MEI":"O"==D?D="Órgão Público":"S"==D&&(D="Simples Nacional"),q.text(D));var F=$(t.find("[template-field='tipo_pessoa']"));if("J"==l.tipo_pessoa)F.text("Pessoa Jurídica");else if("F"==l.tipo_pessoa)F.text("Pessoa Física");else{t.addClass("alert-danger"),F.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_tipo_pessoa selectpicker"><option value="">Selecione</option><option value="J">Jurídica</option><option value="F">Física</option></select></div>');var P=F.find(".edt_new_tipo_pessoa");P.selectpicker("refresh"),P.unbind("change"),P.change(function(){null!=P.val()&&""!=P.val()&&(l.tipo_pessoa=P.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}var L=$(t.find("[template-field='tipo_cadastro']"));if("F"==l.tipo_cadastro)L.text("Consumidor Final");else if("R"==l.tipo_cadastro)L.text("Revendedor");else if("S"==l.tipo_cadastro)L.text("Solidário");else if("E"==l.tipo_cadastro)L.text("Exportação");else if("N"==l.tipo_cadastro)L.text("Não contribuinte");else{t.addClass("alert-danger"),L.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_tipo_cadastro selectpicker"><option value="">Selecione</option><option value="F">Consumidor Final</option><option value="R">Revendedor</option><option value="S">Solidário</option><option value="E">Exportação</option><option value="N">Não contribuinte</option></select></div>');var A=L.find(".edt_new_tipo_cadastro");A.selectpicker("refresh"),A.unbind("change"),A.change(function(){null!=A.val()&&""!=A.val()&&(l.tipo_cadastro=A.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}var J=$(t.find("[template-field='classificacao']"));if("S"==l.classificacao)J.text("Suspect");else if("P"==l.classificacao)J.text("Organização");else if("L"==l.classificacao)J.text("Lead");else{t.addClass("alert-danger"),J.html('<span class="label label-danger">Não Existente</span><br><div class="form-group"><select class="form-control edt_new_classificacao selectpicker"><option value="">Selecione</option><option value="L">Lead</option><option value="S">Suspect</option><option value="P">Prospect</option></select></div>');var T=J.find(".edt_new_classificacao");T.selectpicker("refresh"),T.unbind("change"),T.change(function(){null!=T.val()&&""!=T.val()&&(l.classificacao=T.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}$(t.find("[template-field='pais']")).text(l.pais?l.pais:""),$(t.find("[template-field='municipio']")).text(l.municipio?l.municipio:"");var U=$(t.find("[template-field='cep']"));if(null!=l.cep&&l.cep.toString().trim().length>10){t.addClass("alert-danger"),U.html('<span class="label label-danger count_cep">10 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_cep" maxlength="10" type="text" value="'+l.cep+'"></div>');var W=U.find(".edt_cep"),B=U.find(".count_cep");W.keyup(function(){msg_count(W,B,10)}),W.unbind("change"),W.change(function(){""!=W.val().trim()&&(l.cep=W.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_cep&&null==l.cep){t.addClass("alert-danger"),U.html('<span class="label label-danger count_cep">Campo obrigatório</span><br><div class="form-group"><input class="form-control edt_cep" maxlength="10" type="text"></div>');W=U.find(".edt_cep"),B=U.find(".count_cep");W.keyup(function(){msg_count(W,B,10)}),W.unbind("change"),W.change(function(){""!=W.val().trim()&&(l.cep=W.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else U.text(null!=l.cep?l.cep:"");var Q=$(t.find("[template-field='numero']"));if(null!=l.numero&&l.numero.toString().trim().length>15){t.addClass("alert-danger"),Q.html('<span class="label label-danger count_numero">15 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_numero" maxlength="15" type="text" value="'+l.numero+'"></div>');var G=Q.find(".edt_numero"),H=Q.find(".count_numero");G.keyup(function(){msg_count(G,H,15)}),G.unbind("change"),G.change(function(){""!=G.val().trim()&&(l.numero=G.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_numero&&null==l.numero){t.addClass("alert-danger"),Q.html('<span class="label label-danger count_numero">Campo obrigatório</span><br><div class="form-group"><input class="form-control edt_numero" maxlength="15" type="text"></div>');G=Q.find(".edt_numero"),H=Q.find(".count_numero");G.keyup(function(){msg_count(G,H,15)}),G.unbind("change"),G.change(function(){""!=G.val().trim()&&(l.numero=G.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else Q.text(null!=l.numero?l.numero:"");var K=$(t.find("[template-field='endereco']"));if(null!=l.endereco&&l.endereco.toString().trim().length>80){t.addClass("alert-danger"),K.html('<span class="label label-danger count_endereco">80 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_endereco" maxlength="80" type="text" value="'+l.endereco+'"></div>');var X=K.find(".edt_endereco"),Y=K.find(".count_endereco");X.keyup(function(){msg_count(X,Y,80)}),X.unbind("change"),X.change(function(){""!=X.val().trim()&&(l.endereco=X.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_endereco&&null==l.endereco){t.addClass("alert-danger"),K.html('<span class="label label-danger count_endereco">Campo obrigatório</span><br><div class="form-group"><input class="form-control edt_endereco" maxlength="80" type="text"></div>');X=K.find(".edt_endereco"),Y=K.find(".count_endereco");X.keyup(function(){msg_count(X,Y,80)}),X.unbind("change"),X.change(function(){""!=X.val().trim()&&(l.endereco=X.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else K.text(null!=l.endereco?l.endereco:"");var Z=$(t.find("[template-field='complemento']"));if(null!=l.complemento&&l.complemento.toString().trim().length>100){t.addClass("alert-danger"),Z.html('<span class="label label-danger count_complemento">100 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_complemento" maxlength="100" type="text" value="'+l.complemento+'"></div>');var aa=Z.find(".edt_complemento"),ea=Z.find(".count_complemento");aa.keyup(function(){msg_count(aa,ea,100)}),aa.unbind("change"),aa.change(function(){!aa.val().length>100&&(l.complemento=aa.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else Z.text(null!=l.complemento?l.complemento:"");var na=$(t.find("[template-field='bairro']"));if(null!=l.bairro&&l.bairro.toString().trim().length>60){t.addClass("alert-danger"),na.html('<span class="label label-danger count_bairro">60 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_bairro" maxlength="60" type="text" value="'+l.bairro+'"></div>');var ia=na.find(".edt_bairro"),la=na.find(".count_bairro");ia.keyup(function(){msg_count(ia,la,60)}),ia.unbind("change"),ia.change(function(){""!=ia.val().trim()&&(l.bairro=ia.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else if("S"===main.parametros_cliente.cliente_obrig_bairro&&null==l.bairro){t.addClass("alert-danger"),na.html('<span class="label label-danger count_bairro">Campo obrigatório</span><br><div class="form-group"><input class="form-control edt_bairro" maxlength="60" type="text"></div>');ia=na.find(".edt_bairro"),la=na.find(".count_bairro");ia.keyup(function(){msg_count(ia,la,60)}),ia.unbind("change"),ia.change(function(){""!=ia.val().trim()&&(l.bairro=ia.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else na.text(null!=l.bairro?l.bairro:"");var oa=$(t.find("[template-field='email_principal']"));if(null!=l.email_principal&&l.email_principal.toString().trim().length>60){t.addClass("alert-danger"),oa.html('<span class="label label-danger count_email_principal">60 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_email_principal" maxlength="60" type="text" value="'+l.email_principal+'"></div>');var ta=oa.find(".edt_email_principal"),ra=oa.find(".count_email_principal");ta.keyup(function(){msg_count(ta,ra,60)}),ta.unbind("change"),ta.change(function(){!ta.val().length>60&&(l.email_principal=ta.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else oa.text(null!=l.email_principal?l.email_principal:"");var ca=$(t.find("[template-field='email_agenda']"));if(null!=l.email_agenda&&l.email_agenda.toString().trim().length>500){t.addClass("alert-danger"),ca.html('<span class="label label-danger count_email_agenda">500 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_email_agenda" maxlength="500" type="text" value="'+l.email_agenda+'"></div>');var sa=ca.find(".edt_email_agenda"),da=ca.find(".count_email_agenda");sa.keyup(function(){msg_count(sa,da,500)}),sa.unbind("change"),sa.change(function(){!sa.val().length>500&&(l.email_agenda=sa.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else ca.text(null!=l.email_agenda?l.email_agenda:"");var _a=$(t.find("[template-field='site']"));if(null!=l.site&&l.site.toString().trim().length>60){t.addClass("alert-danger"),_a.html('<span class="label label-danger count_site">60 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_site" type="text" maxlength="60" value="'+l.site+'"></div>');var ma=_a.find(".edt_site"),pa=_a.find(".count_site");ma.keyup(function(){msg_count(ma,pa,60)}),ma.unbind("change"),ma.change(function(){!ma.val().length>60&&(l.site=ma.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else _a.text(null!=l.site?l.site:"");var ua=$(t.find("[template-field='tel1']"));if(null!=l.telefone1&&l.telefone1.toString().trim().length>15){t.addClass("alert-danger"),ua.html('<span class="label label-danger count_tel1">15 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_tel1" maxlength="15" type="text" value="'+l.telefone1+'"></div>');var va=ua.find(".edt_tel1"),ga=ua.find(".count_tel1");va.keyup(function(){msg_count(va,ga,15)}),va.unbind("change"),va.change(function(){!va.val().length>15&&(l.telefone1=va.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else ua.text(null!=l.telefone1?l.telefone1:"");var fa=$(t.find("[template-field='tel2']"));if(null!=l.telefone2&&l.telefone2.toString().trim().length>15){t.addClass("alert-danger"),fa.html('<span class="label label-danger count_tel2">15 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_tel2" maxlength="15" type="text" value="'+l.telefone2+'"></div>');var ha=fa.find(".edt_tel2"),ba=fa.find(".count_tel2");ha.keyup(function(){msg_count(ha,ba,15)}),ha.unbind("change"),ha.change(function(){!ha.val().legnth>15&&(l.telefone2=ha.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else fa.text(null!=l.telefone2?l.telefone2:"");var xa=$(t.find("[template-field='tel3']"));if(null!=l.telefone3&&l.telefone3.toString().trim().length>15){t.addClass("alert-danger"),xa.html('<span class="label label-danger count_tel3">15 caracteres apenas</span><br><div class="form-group"><input class="form-control edt_tel3" maxlength="15" type="text" value="'+l.telefone3+'"></div>');var Sa=xa.find(".edt_tel3"),Ca=xa.find(".count_tel3");etd_tel3.keyup(function(){msg_count(Sa,Ca,15)}),Sa.unbind("change"),Sa.change(function(){!Sa.val().length>15&&(l.telefone3=Sa.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else xa.text(null!=l.telefone3?l.telefone3:"");var ya=$(t.find("[template-field='tel4']"));if(null!=l.telefone4&&l.telefone4.toString().trim().length>15){t.addClass("alert-danger"),ya.html('<span class="label label-danger count_tel4">15 caracteres</span><br><div class="form-group"><input class="form-control edt_tel4" maxlength="15" type="text" value="'+l.telefone4+'"></div>');var wa=ya.find(".edt_tel4"),ka=ya.find(".count_tel4");wa.keyup(function(){msg_count(wa,ka,15)}),wa.unbind("change"),wa.change(function(){!wa.val().length>15&&(l.telefone4=wa.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else ya.text(null!=l.telefone4?l.telefone4:"");var Ea=$(t.find("[template-field='observacao']"));if(null!=l.observacoes&&l.observacoes.toString().trim().length>500){t.addClass("alert-danger"),Ea.html('<span class="label label-danger count_observacoes">500 caracteres apenas</span><br><div class="form-group"><textarea class="form-control edt_observacoes" maxlength="500" rows="4" type="text" value="'+l.observacoes+'"></textarea></div>');var Ra=Ea.find(".edt_observacoes"),Va=Ea.find(".count_observacoes");Ra.keyup(function(){msg_count(Ra,Va,500)}),Ra.unbind("change"),Ra.change(function(){!Ra.val().length>500&&(l.observacoes=Ra.val(),main.arr_planilha[a]=l,t.remove(),i(a,l,!0))})}else Ea.text(null!=l.observacoes?l.observacoes:"");l.valida=!t.hasClass("alert-danger")&&!t.hasClass("alert-warning"),main.arr_planilha[a]=l,t.appendTo(main.tab_listagem),1==main.arr_planilha[a].valida&&++n==main.arr_planilha.length&&(main.pode_importar=!0)};$(main.arr_planilha).each(function(a,e){i(a,e)}),main.btn_confirmar.unbind("click"),main.btn_confirmar.click(function(){if(main.pode_importar)WS.post("cliente/salvar_importacao/",{clientes:JSON.stringify(main.arr_planilha)},function(a){alert_saved("Importação realizada com sucesso"),main.unload()},[main.btn_confirmar,main.btn_cancelar]);else{var a=new Validation;a.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Analise as linhas destacadas antes de continuar")),alert_modal("Validação",a)}})}};return Importar_Excel});