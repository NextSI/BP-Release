define([],function(){return function(i){"use strict";this.atividade=null,this.dataInicial=null,this.dataFinal=null,this.filtros=null;var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Executores - ",this.cores=ColorsGrafico(),this.div_filtros=this.dialog.find(".div_filtros"),this.btn_search=this.dialog.find(".btn_search"),this.btn_exportacao=this.dialog.find(".btn_exportacao"),this.btn_exportacao_excel=this.dialog.find(".btn_exportacao_excel"),this.div_dt_ini=this.dialog.find(".div_dt_ini"),this.div_dt_fim=this.dialog.find(".div_dt_fim"),this.div_filtro_processos=this.dialog.find(".div_filtro_processos"),this.divTabela=this.dialog.find(".divTabela"),this.tbl_dados=this.dialog.find(".tbl_dados"),this.div_tabelas_relatorio=this.dialog.find(".div_tabelas_relatorio"),this.div_grafico=this.dialog.find(".div_grafico"),this.tituloTabela=this.dialog.find(".tituloTabela"),this.dt_ini=null,this.dt_fim=null,this.campoIni=null,this.campoFim=null,this.show=function(i,a,d,o,e,n,s){this.atividade=o,this.dataInicial=i,this.dataFinal=a,this.filtros=d,this.considerar_atividade_tipo_inicio=e,this.considerar_atividade_tipo_fim=n,this.considerar_atividade_retornada=s,t.dt_ini=i,t.dt_fim=a;var r=t.div_dt_ini.dxDateBox({type:"date",displayFormat:"dd/MM/yyyy",value:t.dataInicial,width:"100%",onValueChanged:function(i){_.option("min",i.value),t.dt_ini=formatDate(i.value,!0)}}).dxDateBox("instance"),_=t.div_dt_fim.dxDateBox({type:"date",displayFormat:"dd/MM/yyyy",value:t.dataFinal,width:"100%",onValueChanged:function(i){r.option("max",i.value),t.dt_fim=formatDate(i.value,!0)}}).dxDateBox("instance");t.div_filtro_processos.dxDropDownBox({placeholder:"Selecione filtros",width:"100%"}).dxDropDownBox("instance"),setTimeout(function(){r.option("max",t.dt_fim),_.option("min",t.dt_ini)}),t.carrega_relatorio_processo(t.dt_ini,t.dt_fim)},this.btn_exportacao.unbind("click"),this.btn_exportacao.click(function(){exportar_div(t.div_tabelas_relatorio,"Relatorio_de_Executores.png")}),this.carrega_relatorio_processo=function(i,a){WS.get("processo/listar_relatorio_unitario/",{dia_inicio:t.dt_ini,dia_fim:t.dt_fim,atividade:t.atividade,considerar_atividade_tipo_inicio:t.considerar_atividade_tipo_inicio,considerar_atividade_tipo_fim:t.considerar_atividade_tipo_fim,considerar_atividade_retornada:t.considerar_atividade_retornada},function(i){t.div_tabelas_relatorio.removeClass("hidden"),t.limpar(),function(i){var a=[],d=0,o=[],e=[];$.each(i,function(i,n){$.each(t.cores,function(i,t){e.push(t.nome_hex),o.push(t.hex)}),t.title=n.atividade,t.tbl_dados.append("<tr><td>"+n.executor+'</td><td><span class="badge" style="padding-right: 10px; background:'+o[i]+'"><font color="'+e[i]+'">'+n.quantidade+"</font></td></tr>"),d=parseInt(n.quantidade,10)+d,a.push([n.nome,parseInt(n.quantidade,10)])}),App.titulo_aba(t.html_id,"Executores - "+t.title),t.tituloTabela.text(t.title),t.tbl_dados.append('<tr><td><span class="badge" style="padding-right: 100px; background: #3333FF">Total</td><td>'+d+"</td></tr>"),a=[],d=0,o=[],e=[];var n="Atividade";$.each(i,function(i,t){"Atividade"==n&&(n=t.atividade),a.push({name:t.executor,data:[parseInt(t.quantidade,10)],stack:"Quantidade"})}),t.div_grafico.highcharts({chart:{type:"column"},title:{text:"Quantidade x Atividade"},xAxis:{categories:[n]},yAxis:{allowDecimals:!1,min:0,title:{text:"Quantidade"}},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+" <br/>Total: "+this.y}},plotOptions:{column:{stacking:"normal"}},series:a})}(i)})},this.limpar=function(){t.tbl_dados.find("tr:gt(0)").remove()},this.btn_exportacao_excel.unbind("click"),this.btn_exportacao_excel.click(function(){App.obter_token_publico(function(i){App.download(WS_URI+"processo/gera_excel_unitario/?dia_inicio="+t.dt_ini+"&dia_fim="+t.dt_fim+"&atividade="+t.atividade+"&considerar_atividade_tipo_inicio="+t.considerar_atividade_tipo_inicio+"&considerar_atividade_tipo_fim="+t.considerar_atividade_tipo_fim+"&considerar_atividade_retornada="+t.considerar_atividade_retornada+"&token_publico="+i)})}),this.unload=function(){View.unload(this.html_id)},this.btn_search.unbind("click"),this.btn_search.click(function(i){t.carrega_relatorio_processo(t.dt_ini,t.dt_fim)}),this.unload=function(){View.unload(this.html_id)}}});