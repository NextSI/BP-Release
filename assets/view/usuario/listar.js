define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Usuários",this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.tipo=null,this.onclose=null,this.onsave=null,this.dx_listagem_usuarios=this.dialog.find(".dx_listagem_usuarios"),this.dataGrid=null,this.clearState=!1,this.listar=function(){i.dataGrid&&i.dataGrid.beginCustomLoading(),WS.get("usuario/listar/",{bloqueado:null,listar_usuario:!0},function(a){i.preencher(a)})},this.preencher=function(a){var t=document.createElement("div");t.className="div_listagem_usuarios",t.style="min-width: 100%;",i.dx_listagem_usuarios.find(".div_listagem_usuarios").remove(),i.dx_listagem_usuarios[0].appendChild(t);var o=detectmob()?"select":"dragAndDrop",e=get_icon_class();i.dx_listagem_usuarios.find(".div_listagem_usuarios").css("height","calc(100vh - 42px)");var n=function(a){View.load("usuario/permissoes",function(t,o){o.onclose=function(){setTimeout(function(){View.get_md5_tela_ativa()==i.html_id&&i.listar()})},o.show(a.usuario_id,FORMULARIO.EDITAR,a.tipo,a.admin)})},s=function(a,t){View.load("usuario/detalhes",function(o,e){e.onclose=function(){setTimeout(function(){View.get_md5_tela_ativa()==i.html_id&&i.listar()})},e.show(a?a.usuario_id:null,t)},View.ABA.MULTIPLAS)},l=function(a){WS.post("login/solicitar_senha/",{usuario_id:a.usuario_id,idioma:a.idioma},function(a){a&&alert_saved("E-mail enviado com sucesso")})},u=function(a){View.load("usuario/clonar_permissoes",function(t,o){o.onclose=function(){setTimeout(function(){View.get_md5_tela_ativa()==i.html_id&&i.listar()})},o.show(a.usuario_id,a.tipo)})};i.dataGrid=i.dx_listagem_usuarios.find(".div_listagem_usuarios").dxDataGrid({dataSource:a,keyExpr:"usuario_id",allowColumnReordering:!0,showBorders:!0,columnResizingMode:"widget",rowAlternationEnabled:!1,searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:o},stateStoring:{enabled:!0,type:"custom",customLoad:function(a){return App.get_parametro_usuario("listagem_usuarios")},customSave:function(a){App.set_parametro_usuario("listagem_usuarios",a)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de usuários "+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},groupPanel:{visible:!0},columnFixing:{enabled:!0},onToolbarPreparing:function(a){var t=[{widget:"dxButton",options:{icon:"fa fa-plus",hint:App.lang.usuario_listar.botoes_cabecalho.hint_usuario,text:App.lang.usuario_listar.botoes_cabecalho.hint_usuario,onClick:function(){s(null,FORMULARIO.NOVO)}},location:"after",name:"BtnNovoUsuario",locateInMenu:"auto"},{widget:"dxButton",options:{icon:"fa fa-sync",hint:App.lang.usuario_listar.botoes_cabecalho.hint_refresh,text:App.lang.usuario_listar.botoes_cabecalho.hint_refresh,onClick:function(){i.listar()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"},{widget:"dxButton",options:{icon:"fa fa-cog",hint:App.lang.usuario_listar.botoes_cabecalho.hint_configuracoes,text:App.lang.usuario_listar.botoes_cabecalho.hint_configuracoes,onClick:function(){View.load("perfil/configuracoes",function(a,t){t.onclose=function(){setTimeout(function(){View.get_md5_tela_ativa()==i.html_id&&i.listar()})},t.show()})},visible:App.sessao.dados.admin},showText:"inMenu",location:"after",name:"BtnConfiguracoes",locateInMenu:"auto"}];a.toolbarOptions.items=add_botao_dx_toolbar(t,a.toolbarOptions.items)},onContentReady:function(a){add_filtro_cor_tema(a),i.clearState&&(i.dx_listagem_usuarios.find(".div_listagem_usuarios").dxDataGrid("instance").state({}),i.clearState=!1)},editing:{useIcons:!0},columns:[{dataField:"usuario_id",caption:App.lang.usuario_listar.colunas.id,dataType:"number",width:50},{dataField:"nome",caption:App.lang.usuario_listar.colunas.nome,width:100},{dataField:"username",caption:App.lang.usuario_listar.colunas.usuario,width:100},{dataField:"email",caption:App.lang.usuario_listar.colunas.email,width:100},{dataField:"bloqueado",caption:App.lang.usuario_listar.colunas.bloqueado,dataType:"boolean",calculateCellValue:function(a){return"S"==a.bloqueado},width:50},{dataField:"admin",caption:App.lang.usuario_listar.colunas.admin,dataType:"boolean",calculateCellValue:function(a){return"S"==a.admin},width:50},{dataField:"tipo_descricao",caption:App.lang.usuario_listar.colunas.tipo_entidade,width:100},{dataField:"area_nome",caption:App.lang.usuario_listar.colunas.area,width:100},{dataField:"cargo_descricao",caption:"Cargo",width:100},{dataField:"calendario_trabalho_nome",caption:App.lang.usuario_listar.colunas.calendario_trabalho,width:100},{dataField:"cpf",caption:App.lang.usuario_listar.colunas.cpf,width:100},{dataField:"telefone1",caption:App.lang.usuario_listar.colunas.telefone1,width:100},{dataField:"telefone2",caption:App.lang.usuario_listar.colunas.telefone2,width:100},{dataField:"telefone3",caption:App.lang.usuario_listar.colunas.telefone3,width:100},{dataField:"telefone4",caption:App.lang.usuario_listar.colunas.telefone4,width:100},{dataField:"entidade_nome",caption:App.lang.usuario_listar.colunas.entidade,width:100},{dataField:"ultimo_acesso",caption:App.lang.usuario_listar.colunas.ultimo_acesso,dataType:"datetime",format:"dd/MM/yyyy HH:mm",width:120},{type:"buttons",buttons:[{hint:App.lang.usuario_listar.botoes.hint_permissoes,icon:"fa fa-lock",cssClass:e,visible:function(a){return"N"==a.row.data.admin},onClick:function(a){n(a.row.data)}},{hint:App.lang.usuario_listar.botoes.hint_editar_usuario,icon:"fa fa-pencil-alt",cssClass:e,onClick:function(a){s(a.row.data,FORMULARIO.EDITAR)}},{hint:App.lang.usuario_listar.botoes.hint_visualizar_usuario,icon:"fa fa-eye",cssClass:e,onClick:function(a){s(a.row.data,FORMULARIO.VISUALIZAR)}},{hint:App.lang.usuario_listar.botoes.hint_enviar_senha_email,icon:"fa fa-paper-plane",cssClass:e,onClick:function(a){l(a.row.data)}},{hint:App.lang.usuario_listar.botoes.hint_copiar_permissoes,icon:"fa fa-clone",cssClass:e,visible:function(a){return"N"==a.row.data.admin},onClick:function(a){u(a.row.data)}},{hint:App.lang.usuario_listar.botoes.hint_excluir_usuario,icon:"fa fa-trash",cssClass:e,onClick:function(a){s(a.row.data,FORMULARIO.EXCLUIR)}}]}],onRowClick:function(a){onDoubleClick(a,function(){s(a.data,FORMULARIO.EDITAR)})},onContextMenuPreparing:function(a){"header"==a.target&&Array.isArray(a.items)&&a.items.push({text:"Restaurar estado das colunas",visible:!0,beginGroup:!0,onItemClick:function(a){DevExpress.ui.dialog.confirm("Os filtros, ordenações, agrupamentos, posição, tamanho, e visibilidade das colunas desta listagem serão restauradas ao estado padrão. <b>Deseja continuar?</b>","Restaurar estado das colunas").done(function(a){a&&(i.clearState=!0,i.listar())})}});var t=i.dataGrid.getSelectedRowsData(),o=i.dataGrid.getCombinedFilter(),e=new DevExpress.data.DataSource.default({store:t,pageSize:0});e.filter(o),e.load().done(function(i){a.row&&"data"===a.row.rowType&&(a.items=[{text:App.lang.usuario_listar.botoes.hint_permissoes,visible:"N"==a.row.data.admin,onItemClick:function(){n(a.row.data)}},{text:App.lang.usuario_listar.botoes.hint_editar_usuario,onItemClick:function(){s(a.row.data,FORMULARIO.EDITAR)}},{text:App.lang.usuario_listar.botoes.hint_visualizar_usuario,onItemClick:function(){s(a.row.data,FORMULARIO.EDITAR)}},{text:App.lang.usuario_listar.botoes.hint_enviar_senha_email,onItemClick:function(){l(a.row.data)}},{text:App.lang.usuario_listar.botoes.hint_copiar_permissoes,visible:"N"==a.row.data.admin,onItemClick:function(){u(a.row.data)}},{text:App.lang.usuario_listar.botoes.hint_excluir_usuario,onItemClick:function(){s(a.row.data,FORMULARIO.EDITAR)}},{text:App.lang.usuario_listar.botoes.hint_editar_usuarios_selecionados,visible:i.length,onItemClick:function(){for(var a=0;a<i.length;a++){var t=i[a];s(t,FORMULARIO.EDITAR)}}},{text:App.lang.usuario_listar.botoes.hint_visualizar_usuarios_selecionados,visible:i.length,onItemClick:function(){for(var a=0;a<i.length;a++){var t=i[a];s(t,FORMULARIO.VISUALIZAR)}}},{text:App.lang.usuario_listar.botoes.hint_excluir_usuarios_selecionados,visible:i.length,onItemClick:function(){for(var a=0;a<i.length;a++){var t=i[a];s(t,FORMULARIO.EXCLUIR)}}}])})},summary:{groupItems:[{column:"usuario_id",summaryType:"count",displayFormat:"{0} registros"}]}}).dxDataGrid("instance"),i.dataGrid.endCustomLoading()},this.unload=function(){View.unload(this.html_id)},i.listar()}});