define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Contatos",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_novo=this.dialog.find(".btn_novo"),this.btn_listar=this.dialog.find(".btn_listar"),this.edt_nome=this.dialog.find(".edt_nome"),this.btn_filtrar=this.dialog.find(".btn_filtrar"),this.btn_limpar_filtro=this.dialog.find(".btn_limpar_filtro"),this.edt_email=this.dialog.find(".edt_email"),this.btn_configuracoes=this.dialog.find(".btn_configuracoes"),this.div_carregar_mais=this.dialog.find(".div_carregar_mais"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.btn_exportar_excel=this.dialog.find(".btn_exportar_excel"),this.limite=0,this.pode_buscar=!0,t.btn_limpar_filtro.hide(),App.temp.contato_listar||(App.temp.contato_listar={},App.temp.contato_listar.nome="",App.temp.contato_listar.email=""),this.listar=function(){var i=t.tab_listagem.find("tbody"),a=i.find("tr:first");""==App.temp.contato_listar.nome.trim()&&""==App.temp.contato_listar.email.trim()||t.btn_limpar_filtro.show(),$(t.campo_dinamico).each(function(i,a){a.valor&&t.btn_limpar_filtro.show()});var n={nome:t.nome,email:t.email,visualizar_contato:!0,limite:t.limite,campo_dinamico:t.campo_dinamico};WS.get("contato/listar/",n,function(n){t.div_carregar_mais.removeClass("hidden"),t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),0==t.limite&&t.tab_listagem.find("tr:gt(1)").remove(),0===n.length&&(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),t.pode_buscar=!1),t.pode_buscar&&$(n).each(function(n,e){!function(n){var e=a.clone();e.removeAttr("template-row"),e.css("display",""),$(e.find("[template-field='nome']")).text(n.nome),$(e.find("[template-field='email']")).text(n.email),$(e.find("[template-field='telefone1']")).text(n.telefone1),$(e.find("[template-field='telefone2']")).text(n.telefone2),$(e.find("[template-field='telefone3']")).text(n.telefone3),$(e.find("[template-field='telefone4']")).text(n.telefone4);var o=$(e.find(".btn_visualizar"));o.unbind("click"),o.click(function(){View.load("contato/detalhes",function(i,a){a.onclose=t.listar,a.show(n.contato_id,FORMULARIO.VISUALIZAR)},View.ABA.MULTIPLAS)});var r=$(e.find(".btn_editar")),c=function(){View.load("contato/detalhes",function(i,a){a.onclose=t.listar,a.show(n.contato_id,FORMULARIO.EDITAR)},View.ABA.MULTIPLAS)};r.unbind("click"),r.click(c),e.dblclick(c);var l=$(e.find(".btn_excluir"));l.unbind("click"),l.click(function(){View.load("contato/detalhes",function(i,a){a.onclose=t.listar,a.show(n.contato_id,FORMULARIO.EXCLUIR)},View.ABA.MULTIPLAS)}),e.appendTo(i)}(e)})}),!0===App.sessao.dados.admin?t.btn_configuracoes.removeClass("hidden"):t.btn_configuracoes.addClass("hidden")},this.btn_exportar_excel.unbind("click"),this.btn_exportar_excel.click(function(i){App.obter_token_publico(function(i){App.download(WS_URI+"contato/gerar_excel/?nome="+(void 0!==t.nome?t.nome:"")+"&email="+(void 0!==t.email?t.email:"")+"&cliente_id="+(void 0!==t.cliente_id?t.cliente_id:"")+"&prospect_id="+(void 0!==t.prospect_id?t.prospect_id:"")+"&campo_dinamico="+JSON.stringify(t.campo_dinamico)+"&token_publico="+i)})}),this.btn_filtrar.unbind("click"),this.btn_filtrar.click(function(){View.load("contato/parametros",function(i,a){a.onclose=t.limpar_listar,a.show(function(i){t.nome=i.nome,t.email=i.email,t.campo_dinamico=i.campo_dinamico,App.temp.contato_listar.nome=t.nome,App.temp.contato_listar.email=t.email},App.temp.contato_listar.nome,App.temp.contato_listar.email,t.campo_dinamico)})}),this.btn_limpar_filtro.unbind("click"),this.btn_limpar_filtro.click(function(){App.temp.contato_listar.nome="",App.temp.contato_listar.email="",t.nome="",t.email="",t.campo_dinamico=void 0,t.btn_limpar_filtro.hide(),t.limpar_listar()}),this.btn_novo.unbind("click"),this.btn_novo.click(function(){View.load("contato/detalhes",function(i,a){a.onclose=t.listar,a.show(null,FORMULARIO.NOVO)},View.ABA.MULTIPLAS)}),this.btn_listar.unbind("click"),this.btn_listar.click(function(){t.limpar_listar()}),this.btn_configuracoes.unbind("click"),this.btn_configuracoes.click(function(){View.load("contato/configuracoes",function(i,t){t.show()})}),this.btn_carregar_mais.unbind("click").click(function(){t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),t.pode_buscar&&(t.limite=t.limite+100),t.listar()}),this.limpar_listar=function(){t.limpar_limite(),t.listar()},this.limpar_limite=function(){t.pode_buscar=!0,t.limite=0},this.unload=function(){View.unload(this.html_id)},this.edt_nome.unbind("keyup"),this.edt_nome.keyup($.debounce(500,t.listar)),this.edt_email.unbind("keyup"),this.edt_email.keyup($.debounce(500,t.listar)),this.listar()}});