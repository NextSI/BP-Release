define([],function(){return function(t){"use strict";var a=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.ondelete=null,this.div_info_usuario=this.dialog.find(".div_info_usuario"),this.lbl_autenticacao_nome=this.dialog.find(".lbl_autenticacao_nome"),this.lbl_autenticacao_detalhes=this.dialog.find(".lbl_autenticacao_detalhes"),this.edt_senha=this.dialog.find(".edt_senha"),this.chk_entrar_entrar_automaticamente=this.dialog.find("#chk_entrar_entrar_automaticamente"),this.chk_entrar_memorizar_senha=this.dialog.find("#chk_entrar_memorizar_senha"),this.dxButtonEsqueciSenha=this.dialog.find("#dxButtonEsqueciSenha"),this.dxButtonEntrar=this.dialog.find("#dxButtonEntrar"),this.dxButtonTrocarUsuario=this.dialog.find("#dxButtonTrocarUsuario"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.usuario=null,this.ldap_servers=[{id:0,nome:"Servidor Next BP"}],this.show=function(){show_modal(a.modal.attr("id")),a.loadCheckMemorizarSenha(),a.loadCheckEntrarAutomaticamente(),a.loadButtonEntrar(),a.loadButtonEsqueciSenha(),a.loadButtonTrocarUsuario(),a.autenticacao()},this.entrar=function(){WS.post("login/validar/",{username:cripto(App.temp.usuario.login?App.temp.usuario.login:App.temp.usuario.ldap_login),senha:cripto(a.edt_senha.val()),servidor_ldap_id:App.temp.usuario.servidor_ldap_id},function(t){var n=a.chk_entrar_memorizar_senha.dxCheckBox("instance").option("value"),e=a.chk_entrar_entrar_automaticamente.dxCheckBox("instance").option("value");App.renovar_sessao(t);var o=[];localStorage.getItem("bp_usuarios")&&"undefined"!=localStorage.getItem("bp_usuarios")&&(o=JSON.parse(localStorage.getItem("bp_usuarios")));var i=n?cripto(a.edt_senha.val()):null;o.map(function(t,a){App.temp.usuario.login==t.login&&App.temp.usuario.webservice_url==t.webservice_url&&(o[a].senha=i,o[a].entrar_automaticamente=e,o[a].time=(new Date).getTime(),App.temp.usuario=o[a])}),"undefined"!=typeof Storage&&localStorage.setItem("bp_usuarios",JSON.stringify(o)),a.close()},[a.dxButtonEntrar],null,!0,null,function(t){a.dxButtonEntrar.dxButton("instance").option({text:"Por favor, aguarde..."})},a.html_id,function(){a.dxButtonEntrar.dxButton("instance").option({text:"Entrar"})})},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.autenticacao=function(){a.lbl_autenticacao_nome.text(""),a.lbl_autenticacao_detalhes.text(""),a.edt_senha.val(""),a.chk_entrar_memorizar_senha.dxCheckBox("instance").option("disabled",!1),a.chk_entrar_memorizar_senha.dxCheckBox("instance").option("value",!1),a.chk_entrar_entrar_automaticamente.dxCheckBox("instance").option("disabled",!1),a.chk_entrar_entrar_automaticamente.dxCheckBox("instance").option("value",!1),void 0!==App.temp.usuario&&App.temp.usuario?(a.lbl_autenticacao_nome.text(App.temp.usuario.nome),a.lbl_autenticacao_detalhes.text(App.temp.usuario.login),a.div_info_usuario.show(),a.edt_senha.val(base64_decode(App.temp.usuario.senha)),App.temp.usuario.senha&&a.chk_entrar_memorizar_senha.dxCheckBox("instance").option("value",!0),App.temp.usuario.entrar_automaticamente&&(a.chk_entrar_entrar_automaticamente.dxCheckBox("instance").option("value",!0),a.entrar()),set_focus(a.edt_senha)):(a.close(),App.logout())},this.loadCheckMemorizarSenha=function(){a.chk_entrar_memorizar_senha.dxCheckBox({text:"Memorizar senha"})},this.loadCheckEntrarAutomaticamente=function(){a.chk_entrar_entrar_automaticamente.dxCheckBox({text:"Entrar automaticamente"})},this.loadButtonEntrar=function(){a.dxButtonEntrar.dxButton({text:"Entrar",icon:"chevronright",useSubmitBehavior:!0,hoverStateEnabled:!1,template:function(t,a){$("<i class='dx-icon dx-icon-chevronright' style='color: #FFF;'></i><span class='dx-button-text'>"+t.text+"</span>").appendTo(a),$(a).parent().addClass("btn-primary"),$(a).addClass("btn-primary")},onClick:function(t){t.validationGroup.validate().isValid&&a.entrar()}})},this.loadButtonEsqueciSenha=function(){a.dxButtonEsqueciSenha.dxButton({text:"Esqueci minha senha",type:"danger",stylingMode:"contained",onClick:function(t){View.load("login/solicitar_senha",function(t,n){n.onclose=a.listar,n.show(App.temp.usuario.login)})}})},this.loadButtonTrocarUsuario=function(){a.dxButtonTrocarUsuario.dxButton({text:"Entrar com outro usu√°rio",type:"normal",stylingMode:"contained",icon:"chevronleft",onClick:function(t){a.close(),App.logout()}})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.close(),App.logout()})}});