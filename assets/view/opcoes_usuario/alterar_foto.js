define([],function(){return function(t){"use strict";var i=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.files=this.dialog.find(".files"),this.carrega_img=this.dialog.find(".carrega_img"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.show=function(t){i.tipo=t,i.permite_alterar(),show_modal(i.modal.attr("id")),set_focus(i.edt_senha_atual)},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.preview_foto=function(t){var a=t.target.files[0],s=new FileReader;s.onload=function(t){i.carrega_img.attr("src",t.target.result)},s.readAsDataURL(a)},this.permite_alterar=function(){switch(i.tipo){case FORMULARIO.NOVO:case FORMULARIO.EDITAR:i.btn_salvar.show();break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide()}},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){var t=null;$.each(i.files,function(i,a){a.files.length>0&&(t=a.files[0])}),WS.post("usuario/alterar_foto",{foto_id:t},function(t){alert_saved("Foto alterada com sucesso"),App.sessao.dados.foto_id=t.foto_id,App.renovar_foto_usuario(),i.unload()},[i.files,i.btn_cancelar,i.btn_salvar],null,!0)}),i.files[0].addEventListener("change",i.preview_foto,!1)}});