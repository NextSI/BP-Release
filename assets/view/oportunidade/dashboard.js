define(["react","react-dom","./DashboardRepresentante"],function(e,t,a){return function(i){"use strict";var n=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Dashboard Representantes",this.div_dashboard=this.dialog.find(".div_dashboard"),this.info_metas=this.dialog.find(".info_metas"),this.btn_refresh=this.dialog.find(".btn_refresh"),this.edt_dt_ini=this.dialog.find(".edt_dt_ini"),this.edt_dt_fim=this.dialog.find(".edt_dt_fim"),this.div_legenda=this.dialog.find(".div_legenda"),this.div_valor_oportunidades_ganhas=this.dialog.find(".div_valor_oportunidades_ganhas"),this.valor_oportunidades_ganhas=this.dialog.find(".valor_oportunidades_ganhas"),this.arr_metas=[],this.valor_total_oportunidades_ganhas=0,this.show=function(){set_datepicker(n.edt_dt_ini),set_datepicker(n.edt_dt_fim),n.info_metas.tooltip();var e=new Date,t=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),i=new Date(t,a,1),o=new Date(t,a,0),r=t+"-"+a+"-"+("0"+i.getDate()).slice(-2),d=t+"-"+a+"-"+("0"+o.getDate()).slice(-2);setTimeout(function(){set_datepicker(n.edt_dt_ini,r),set_datepicker(n.edt_dt_fim,d),n.listar()},150)},this.grafico_velocimetro=function(e,t){var a=t.valor_ganho?t.valor_ganho:0,i=0,o="",r=0,d=parseInt(get_datepicker(n.edt_dt_fim).substr(5,2))-parseInt(get_datepicker(n.edt_dt_ini).substr(5,2));$.each(n.arr_metas,function(e,a){a.representante_id==t.representante_id&&(i=parseFloat(i)+parseFloat(a.valor),o=o+a.meta_descricao+": "+a.valor.format_number(2,!0)+" | ")}),o=d<2?""!=o?o.substring(0,o.length-2):"Meta não definida":""!=o?'<span class="btn-link" style="cursor:pointer">Visualizar Metas do Período</span>':"Meta não definida",i>0&&(r=parseFloat(a)/parseFloat(i)*100,r=parseFloat(r.toFixed(2)));var s=$(e.find(".div_velocimetro"));const l=[{nome:"Vendas",valor:r}];for(let e=0;e<t.metas_eventos.length;e++){const a=t.metas_eventos[e];l.push({nome:a.meta_eventos_nome,valor:a.realizado/a.previsto*100})}s.dxTabPanel({items:l,itemTitleTemplate:function(e,t,a){return e.nome},itemTemplate:function(e,a,i){let r=$("<div>").css({height:"calc(100% - 36px)"});i.append(r);let d=r.dxCircularGauge({height:"100%",scale:{startValue:0,endValue:100,tickInterval:10,label:{customizeText:e=>`${e.valueText} %`}},rangeContainer:{ranges:[{startValue:0,endValue:60,color:"#DF5353"},{startValue:60,endValue:80,color:"#DDDF0D"},{startValue:80,endValue:95,color:"#55BF3B"},{startValue:95,endValue:100,color:"#0000cc"}]},export:{enabled:!0},title:{text:`${e.valor} % Atingimento Meta \n ${o}`,font:{size:12}},tooltip:{enabled:!0,customizeTooltip:t=>({text:`${e.valor} %`})},value:e.valor}).dxCircularGauge("instance");$(s.find("tspan")[1]).length>0&&"Meta não definida"!=o&&($(s.find("tspan")[1]).unbind("click"),$(s.find("tspan")[1]).click(function(){View.load("oportunidade/metas_periodo_representante",function(e,a){a.onclose=n.listar(),a.show(t.representante_id,get_datepicker(n.edt_dt_ini),get_datepicker(n.edt_dt_fim))},View.ABA.NAO)})),setTimeout(function(){d.render()})},selectedIndex:0,animationEnabled:!0,swipeEnabled:!0})},this.listar=function(){var i=n.div_dashboard.find("[template-row='representantes']"),o=function(o,r){var d=i.clone();d.removeAttr("template-row"),d.show(),d.addClass("col-md-12 rows"),d.attr("id",r.usuario_id);var s=e.createElement(a,null,null);t.render(s,d.find(".div_dashboard_representante")[0]),s.props.setParams({ObjRepresentante:r,DataInicial:get_datepicker(n.edt_dt_ini),DataFinal:get_datepicker(n.edt_dt_fim),isDashboard:!0}),d.appendTo(n.div_dashboard),$(d).find(".div_velocimetro").height($(d).find(".panel").height()),n.grafico_velocimetro(d,r)},r=new Object;r.dt_ini=get_datepicker(n.edt_dt_ini),r.dt_fim=get_datepicker(n.edt_dt_fim),n.valor_oportunidades_ganhas.text("R$ 0,00"),WS.get("oportunidade/get_dashboard/",r,function(e){n.arr_metas=e.metas,n.valor_total_oportunidades_ganhas=e.valor_total_oportunidades_ganhas,n.valor_oportunidades_ganhas.text("R$ "+(+n.valor_total_oportunidades_ganhas).format_number(2,!0)),n.div_valor_oportunidades_ganhas.show(),e=(e=e.dados).sort(function(e,t){var a=0,i=0;$.each(n.arr_metas,function(n,o){o.representante_id==e.representante_id&&(a=parseFloat(a)+parseFloat(o.valor)),o.representante_id==t.representante_id&&(i=parseFloat(i)+parseFloat(o.valor))});var o=0,r=0;return a>0&&void 0!==e.valor_ganho&&e.valor_ganho&&(o=parseFloat(e.valor_ganho)/parseFloat(a)*100),i>0&&void 0!==t.valor_ganho&&t.valor_ganho&&(r=parseFloat(t.valor_ganho)/parseFloat(i)*100),r-o}),n.div_dashboard.find(".rows").remove();for(var t=0;t<e.length;t++){var a=e[t];o(0,a)}n.div_legenda.show()})},this.btn_refresh.unbind("click"),this.btn_refresh.click(function(){n.listar()}),this.unload=function(){View.unload(this.html_id)}}});