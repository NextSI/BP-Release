define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.dados=null,this.main_pai=null,this.cbo_servidor_ldap=this.dialog.find(".cbo_servidor_ldap"),this.edt_usuario_ldap=this.dialog.find(".edt_usuario_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_autenticar=this.dialog.find(".btn_autenticar"),this.show=function(i,d){this.main_pai=i,this.limpar_preencher_cbo_usuario=d,show_modal(a.modal.attr("id")),a.preencher_dados_ldap(a.main_pai.servidor_ldap_id)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_autenticar.unbind("click"),this.btn_autenticar.click(function(){a.validar_login_ldap(a.edt_usuario_ldap.val(),a.edt_senha_ldap.val(),a.cbo_servidor_ldap.val())}),this.validar_login_ldap=function(i,d,o){a.main_pai.login_ldap=i,a.main_pai.senha_ldap=d,a.main_pai.servidor_ldap_id=o,WS.get("servidor_ldap/validar_login/",{usuario_ldap:i,senha_ldap:d,servidor_ldap:o},function(l){l[0].autenticado?(a.listar_usuarios_ldap(i,d,o),a.unload()):alert_modal("Falha de autenticação","Verifique os seguintes itens: <br><br> - Usuário e/ou senha estão corretos <br> - Servidor do LDAP está ativo")})},this.listar_usuarios_ldap=function(i,d,o){WS.get("servidor_ldap/listar_usuarios/",{login_ldap:i,senha_ldap:d,servidor_ldap:o},function(l){if(a.limpar_preencher_cbo_usuario){a.main_pai.cbo_usuario_ldap.find("option").remove();for(var t=0,n=l.usuarios.length;t<n;t++){var s=l.usuarios[t];s&&add_option(a.main_pai.cbo_usuario_ldap,s.id_usuario,s.usuario)}a.main_pai.cbo_usuario_ldap.selectpicker("refresh")}else a.main_pai.lista_usuarios_ldap=l,a.main_pai.login_ldap=i,a.main_pai.senha_ldap=d,a.main_pai.servidor_ldap_id=o,a.main_pai.show()})},this.preencher_dados_ldap=function(i){var d="";WS.get("servidor_ldap/listar/",null,function(o){a.cbo_servidor_ldap.find("option").remove(),add_option(a.cbo_servidor_ldap,"","Nenhum",d);for(var l=0;l<o.length;l++)d=o[0].id_servidor_ldap==o[l].id?"selected":"",add_option(a.cbo_servidor_ldap,o[l].id,o[l].nome,d);i&&a.cbo_servidor_ldap.val(i).trigger("change")})}}});