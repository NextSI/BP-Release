define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_pesquisar=this.dialog.find(".btn_pesquisar"),this.cbo_cliente=this.dialog.find(".cbo_cliente"),this.cbo_projeto=this.dialog.find(".cbo_projeto"),this.cbo_usuarios=this.dialog.find(".cbo_usuarios"),this.cbo_tipo_projeto=this.dialog.find(".cbo_tipo_projetos"),this.edt_inicio=this.dialog.find(".edt_inicio"),this.edt_fim=this.dialog.find(".edt_fim"),this.edt_inicio_prazo=this.dialog.find(".edt_inicio_prazo"),this.edt_fim_prazo=this.dialog.find(".edt_fim_prazo"),this.edt_inicio_apontamento=this.dialog.find(".edt_inicio_apontamento"),this.edt_fim_apontamento=this.dialog.find(".edt_fim_apontamento"),this.chk_mostrar_projeto=this.dialog.find(".chk_mostrar_projeto"),this.chk_mostrar_valores=this.dialog.find(".chk_mostrar_valores"),this.chk_exibir_atividades_sem_apontamentos=this.dialog.find(".chk_exibir_atividades_sem_apontamentos"),this.chk_visualizar_totais_parciais=this.dialog.find(".chk_visualizar_totais_parciais"),this.cbo_cliente_item=this.dialog.find(".cbo_cliente li"),this.cliente_id=null,this.cliente_nome=null,this.projeto_id=null,this.usuario_id=null,this.tipo=null,this.inicio=null,this.fim=null,this.inicio_prazo=null,this.fim_prazo=null,this.inicio_apontamento=null,this.fim_apontamento=null,this.mostrar_projeto=null,this.mostrar_valores=null,this.exibir_atividades_sem_apontamentos=null,this.visualizar_totais_parciais=null,this.smc_cbo_projeto=null,this.show=function(i,t,e,n,s,a,_,r,c,l,d,p,u,h,f,m){create_combobox(o.cbo_cliente,o.listar_clientes),o.criar_events_cliente(o.cbo_cliente),set_value_combobox(o.cbo_cliente,t,e),o.cliente_nome=e,o.cliente_id=t,o.projeto_id=n,o.usuario_id=s,o.onselect=i,o.listar_projeto(t,n),o.listar_usuarios(s,n),o.chk_mostrar_projeto.bootstrapSwitch("state",_),o.chk_mostrar_valores.bootstrapSwitch("state",r),o.chk_exibir_atividades_sem_apontamentos.bootstrapSwitch("state",c),o.chk_visualizar_totais_parciais.bootstrapSwitch("state",l),set_datepicker(o.edt_inicio,d),set_datepicker(o.edt_fim,p),set_datepicker(o.edt_inicio_apontamento,f),set_datepicker(o.edt_fim_apontamento,m),set_datepicker(o.edt_inicio_prazo,u),set_datepicker(o.edt_fim_prazo,h),o.cbo_tipo_projeto.find('option[value="'+a+'"]').prop("selected",!0),o.cbo_tipo_projeto.selectpicker("refresh"),show_modal(o.modal.attr("id"))},this.listar_usuarios=function(i,t){o.cbo_usuarios.find("option").remove(),add_option(o.cbo_usuarios,-1,"-- Todos --"),null!=t&&t.length>0&&void 0!==t?WS.get("projeto/listar_equipe_multiplos/",{projeto_id:t.join(",")},function(t){for(var e in t)add_option(o.cbo_usuarios,t[e].usuario_id,t[e].nome);if(null!=i&&i.length>0&&void 0!==i)for(var n=0;n<i.length;n++)$(o.cbo_usuarios).find('option[value="'+i[n].toString()+'"]').prop("selected",!0);o.cbo_usuarios.selectpicker("refresh")}):o.cbo_usuarios.selectpicker("refresh")},this.listar_clientes=function(i,t){var e=t.parent(),n=e.find(".edt_combobox");WS.get("cliente/listar_clientes_projeto/",{texto_pesquisa:n.val(),somente_cliente:App.sessao.dados.tipo==USUARIO_TIPO.CLIENTE},function(n){limpar_combobox(t),$(n).each(function(i,o){var e=[];e.Nome=o.nome_fantasia,e["RazÃ£o"]=o.razao_social,e.CNPJ=o.cnpj,add_option_combobox(t,i,o.cliente_id>0?o.cliente_id:null,e)}),i(!0),e.find(".ul_row").click(function(){var i=$(this).parent().attr("id_registro"),t=$(this).find("li:nth-child(1)").text();o.cliente_id=""!=i?[i]:null,o.cliente_nome=t,o.cbo_cliente_change()})})},this.criar_events_cliente=function(i){var t=i.parent().find(".edt_combobox");o.smc_cbo_projeto=t,t.keyup(function(e){13==e.keyCode&&setTimeout(function(){var e=i.parent().find(".ncbo_scroll").find(".row_selected");if(""==t.val().trim())o.cliente_id=[];else{var n=e.attr("id_registro");n>0&&(o.cliente_id=""!=n?[n]:null,o.cliente_nome=$(e).find("li").text(),o.listar_projeto(o.cliente_id,null))}o.cbo_cliente_change()},150)})},this.listar_projeto=function(i,t){o.cbo_projeto.find("option").remove(),add_option(o.cbo_projeto,"-1","-- Todos --"),null!=i&&"undefined"!=i&&i.length>0?WS.get("projeto/get_relatorio_projeto/",{cliente_id:JSON.stringify(i),usuario_id:App.sessao.usuario_id},function(i){o.cbo_projeto.find("option").remove(),add_option(o.cbo_projeto,"-1","-- Todos --");for(var e=0;e<i.length;e++){var n=i[e];add_option(o.cbo_projeto,n.id,n.nome)}if(null!=t&&t.length>0&&void 0!==t)for(e=0;e<t.length;e++)$(o.cbo_projeto).find('option[value="'+t[e].toString()+'"]').prop("selected",!0);o.cbo_projeto.selectpicker("refresh")},[o.smc_cbo_projeto]):o.cbo_projeto.selectpicker("refresh")},this.close=function(){close_modal(o.modal.attr("id")),void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.cbo_cliente_change=function(){o.listar_projeto(o.cliente_id,null)},this.cbo_projeto.unbind("change"),this.cbo_projeto.change(function(){o.listar_usuarios(null,o.cbo_projeto.val()),$(o.cbo_projeto.val()).each(function(i,t){-1==t?o.cbo_projeto.find('option:not(option[value="-1"])').prop("selected",!1):(o.cbo_projeto.find('option[value="-1"]').prop("selected",!1),o.cbo_projeto.selectpicker("refresh"))})}),this.cbo_usuarios.unbind("change"),this.cbo_usuarios.change(function(){$(o.cbo_usuarios.val()).each(function(i,t){-1==t?(o.cbo_usuarios.find('option:not(option[value="-1"])').prop("selected",!1),o.cbo_usuarios.selectpicker("refresh")):(o.cbo_usuarios.find("option[value='-1']").prop("selected",!1),$(o.cbo_usuarios).selectpicker("refresh"))})}),this.btn_pesquisar.unbind("click"),this.btn_pesquisar.click(function(){var i={cliente_id:o.cliente_id,cliente_nome:o.cliente_nome,usuario_id:o.cbo_usuarios.val(),projeto_id:o.cbo_projeto.val(),usuario_id:o.cbo_usuarios.val(),tipo:o.cbo_tipo_projeto.val(),mostrar_projeto:o.chk_mostrar_projeto.bootstrapSwitch("state"),mostrar_valores:o.chk_mostrar_valores.bootstrapSwitch("state"),exibir_atividades_sem_apontamentos:o.chk_exibir_atividades_sem_apontamentos.bootstrapSwitch("state"),visualizar_totais_parciais:o.chk_visualizar_totais_parciais.bootstrapSwitch("state"),inicio:get_datepicker(o.edt_inicio),fim:get_datepicker(o.edt_fim),inicio_prazo:get_datepicker(o.edt_inicio_prazo),fim_prazo:get_datepicker(o.edt_fim_prazo),inicio_apontamento:get_datepicker(o.edt_inicio_apontamento),fim_apontamento:get_datepicker(o.edt_fim_apontamento)};o.onselect(i),o.unload()}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){o.unload()})}});