define(["react","react-dom","./../componentes_react/CboClientes"],function(t,i,e){return function(a){"use strict";var o=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Orçamentos",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_novo=this.dialog.find(".btn_novo"),this.btn_listar=this.dialog.find(".btn_listar"),this.list_aguardando_aprovacao=this.dialog.find(".list_aguardando_aprovacao"),this.list_aprovados=this.dialog.find(".list_aprovados"),this.list_reprovados=this.dialog.find(".list_reprovados"),this.list_todas=this.dialog.find(".list_todas"),this.panel_filtros=this.dialog.find(".panel_filtros"),this.btn_visualizar_itens=this.dialog.find(".btn_visualizar_itens"),this.lb_valor_negocio=this.dialog.find(".lb_valor_negocio"),this.lb_valor_ipi=this.dialog.find(".lb_valor_ipi"),this.lb_valor_total=this.dialog.find(".lb_valor_total"),this.edt_entidades=null,this.btn_refresh=this.dialog.find(".btn_refresh"),this.edt_ini=this.dialog.find(".edt_ini"),this.edt_fim=this.dialog.find(".edt_fim"),this.div_component_cbo_clientes=this.dialog.find(".div_component_cbo_clientes"),this.cboClientes=t.createElement(e,{initial_values:{placeholder:"Nome da Entidade"}},null),this.entidade_tipo=null,this.entidade_id=null,this.filtros=null,this.show=function(){if(set_datepicker(o.edt_ini),set_datepicker(o.edt_fim),App.temp.orcamento_listar)switch(set_datepicker(o.edt_ini,App.temp.orcamento_listar.dt_ini),set_datepicker(o.edt_fim,App.temp.orcamento_listar.dt_fim),App.temp.orcamento_listar.situacao){case ORCAMENTO_FILTROS.AGUARDANDO_APROVACAO:o.list_aguardando_aprovacao.click();break;case ORCAMENTO_FILTROS.APROVADO:o.list_aprovados.click();break;case ORCAMENTO_FILTROS.REPROVADO:o.list_reprovados.click();break;case ORCAMENTO_FILTROS.TODOS:o.list_todas.click()}else App.temp.orcamento_listar={},App.temp.orcamento_listar.situacao=ORCAMENTO_FILTROS.AGUARDANDO_APROVACAO,o.inicializar_datas(o.edt_ini,o.edt_fim),App.temp.orcamento_listar.dt_ini=get_datepicker(o.edt_ini),App.temp.orcamento_listar.dt_fim=get_datepicker(o.edt_fim);o.renderiza_componentes(),o.listar()},this.renderiza_componentes=function(){o.renderiza_combobox_cliente(),o.cboClientes.props.setCliente(o.filtros),o.cboClientes.props.setFunctionSelect(o.evt_alterar_cliente)},this.renderiza_combobox_cliente=function(){i.render(o.cboClientes,o.div_component_cbo_clientes[0]),o.cboClientes.props.setConfiguracoes={main_externo:o,exibe_tipo_entidade:!0,placeholder:"Filtrar Entidade",WS_params:{desconsiderar_empresa:!0,desconsiderar_fornecedor:!0,limite:0}}},this.evt_alterar_cliente=function(){o.filtros=spread({},o.filtros,{cliente_id:o.cboClientes.props.ClienteSelecionado.id,cliente_nome:o.cboClientes.props.ClienteSelecionado.nome_fantasia,cliente_tipo:o.cboClientes.props.ClienteSelecionado.tipo}),o.entidade_tipo=o.filtros.cliente_tipo,o.entidade_id=o.filtros.cliente_id,o.listar()},this.unload=function(){View.unload(this.html_id)},this.inicializar_datas=function(t,i){set_datepicker(t),set_datepicker(i);var e=new Date,a=e.getFullYear(),o=("0"+(e.getMonth()+1)).slice(-2),n=new Date(a,o,1),d=new Date(a,o,0),s=a+"-"+o+"-"+("0"+n.getDate()).slice(-2),l=a+"-"+o+"-"+("0"+d.getDate()).slice(-2);set_datepicker(t,s),set_datepicker(i,l)},this.listar=function(){var t=o.tab_listagem.find("tbody"),i=t.find("tr:first"),e=new Object;e.situacao=App.temp.orcamento_listar.situacao,e.supervisor=!0,e.entidade_tipo=o.entidade_tipo,e.entidade_id=o.entidade_id,e.dt_ini=App.temp.orcamento_listar.dt_ini,e.dt_fim=App.temp.orcamento_listar.dt_fim,WS.get("oportunidade_orcamento/listar/",e,function(e){o.tab_listagem.find(".new_row").remove(),$(e).each(function(e,a){!function(e){var a=i.clone();a.removeAttr("template-row"),a.css("display",""),a.addClass("new_row"),$(a.find("[template-field='oportunidade_orcamento_id']")).text("#"+("S"==e.utilizar_controle_sequencia_orcamento||!0===e.utilizar_controle_sequencia_orcamento?e.sequencia:e.oportunidade_orcamento_id)),$(a.find("[template-field='oportunidade_id']")).text("Oportunidade #"+e.oportunidade_id),$(a.find("[template-field='insert_hora']")).text(e.insert_hora.format_date_time());var n=$(a.find(".entidade_tipo"));"C"==e.entidade_tipo?(n.addClass("label-info"),n.attr("title","Cliente")):"O"==e.entidade_tipo&&(n.addClass("label-primary"),n.attr("title","Organização"));var d=$(a.find(".lb_situacao"));e.situacao==ORCAMENTO_FILTROS.APROVADO?(d.removeClass("label-warning"),d.addClass("label-success"),d.text("Aprovado")):e.situacao==ORCAMENTO_FILTROS.REPROVADO?(d.removeClass("label-warning"),d.addClass("label-danger"),d.text("Reprovado")):4==e.situacao&&(d.removeClass("label-warning"),d.addClass("label-default"),d.text("Orçamento Aprovado e Aguardando Envio de E-mail")),n.tooltip(),n.text(e.entidade_tipo),null!=e.data_aprovacao&&""!=e.data_aprovacao&&"null"!=e.data_aprovacao&&($(a.find(".lb_nome_usuario")).text(e.usuario_aprovacao_nome),$(a.find(".lb_data")).text(e.data_aprovacao.format_date_time()));var s=$(a.find(".lb_justificativa"));null!=e.justificativa_aprovacao&&e.situacao==ORCAMENTO_FILTROS.REPROVADO&&s.text(e.justificativa_aprovacao),$(a.find("[template-field='entidade_nome']")).text(e.entidade_nome),$(a.find("[template-field='representante_nome']")).text(e.representante_nome),$(a.find("[template-field='oportunidade_nome']")).text(e.oportunidade_nome),$(a.find("[template-field='tipo_oportunidade_nome']")).text(e.tipo_oportunidade_nome),$(a.find("[template-field='valor_total']")).text(e.valor_total>0?e.valor_total.format_number(2,!0):"0,00");var l=$(a.find(".btn_visualizar_itens"));l.unbind("click"),l.click(function(){View.load("orcamento/detalhes",function(t,i){i.onclose=o.listar,i.show(FORMULARIO.VISUALIZAR,e.oportunidade_orcamento_id,e)},View.ABA.MULTIPLAS)}),a.appendTo(t)}(a)})},[o.list_aguardando_aprovacao,o.list_aprovados,o.list_reprovados,o.list_todas])},this.list_aguardando_aprovacao.unbind("click"),this.list_aguardando_aprovacao.click(function(){o.dialog.find(".active").removeClass("active"),o.list_aguardando_aprovacao.addClass("active"),App.temp.orcamento_listar.situacao=ORCAMENTO_FILTROS.AGUARDANDO_APROVACAO,o.listar()}),this.list_aprovados.unbind("click"),this.list_aprovados.click(function(){o.panel_filtros.find(".active").removeClass("active"),o.list_aprovados.addClass("active"),App.temp.orcamento_listar.situacao=ORCAMENTO_FILTROS.APROVADO,o.listar()}),this.list_reprovados.unbind("click"),this.list_reprovados.click(function(){o.panel_filtros.find(".active").removeClass("active"),o.list_reprovados.addClass("active"),App.temp.orcamento_listar.situacao=ORCAMENTO_FILTROS.REPROVADO,o.listar()}),this.list_todas.unbind("click"),this.list_todas.click(function(){o.panel_filtros.find(".active").removeClass("active"),o.list_todas.addClass("active"),App.temp.orcamento_listar.situacao=ORCAMENTO_FILTROS.TODOS,o.listar()}),this.btn_refresh.unbind("click"),this.btn_refresh.click(function(){if(""==o.div_component_cbo_clientes.find(".edt_combobox").val().trim()&&(o.entidade_tipo=null,o.entidade_id=null),""==get_datepicker(o.edt_ini)||""==get_datepicker(o.edt_fim)){var t=new Validation;return t.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Informe o período")),void alert_modal("Validação",t)}App.temp.orcamento_listar.dt_ini=get_datepicker(o.edt_ini),App.temp.orcamento_listar.dt_fim=get_datepicker(o.edt_fim),o.listar()})}});