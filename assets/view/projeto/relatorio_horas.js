define([],function(){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Relatório de Horas Gastas",this.div_relatorios=this.dialog.find(".div_relatorios"),this.div_template=this.dialog.find(".div_template"),this.btn_parametros=this.dialog.find(".btn_parametros"),this.span_data_inicio=this.dialog.find(".span_data_inicio"),this.span_data_fim=this.dialog.find(".span_data_fim"),this.div_data=this.dialog.find(".div_data"),this.th_total_horas_realizadas_no_periodo=this.dialog.find(".th_total_horas_realizadas_no_periodo"),this.cliente_id=null,this.projeto_id=null,this.count_horas_previstas=null,this.show=function(){t.btn_parametros.trigger("click")},this.listar=function(a){var i=t.div_template.clone(),o=i.find(".tab_cabecalho");$(o.find("[template-field='projeto_nome']")).text(a.projeto.nome),$(o.find("[template-field='cliente_nome']")).text(null!=a.projeto.cliente_nome?a.projeto.cliente_nome:""),$(o.find("[template-field='projeto_tipo']")).text(null!=a.projeto.tipo_nome?a.projeto.tipo_nome:""),$(o.find("[template-field='projeto_status']")).text(null!=a.projeto.status_nome?a.projeto.status_nome:""),$(i.find("[template-field='cabecalho_projeto_horas_previstas']")).text(format_time(a.projeto.horas_previstas)),$(i.find("[template-field='cabecalho_projeto_horas_trabalhadas']")).text(format_time(a.totais_atividades.total_projeto_horas_trabalhadas));var e=$(i.find("[template-field='cabecalho_projeto_saldo']")),d=a.totais_atividades.total_projeto_saldo_horas&&"-"==a.totais_atividades.total_projeto_saldo_horas.toString().substring(0,1)?"text-danger":"text-success";e.append('<span class="'+d+'">'+a.totais_atividades.total_projeto_saldo_horas+"</span>"),$(i.find("[template-field='cabecalho_projeto_saldo_percentual']")).append('<span class="'+d+'">'+(null!=a.totais_atividades.total_projeto_saldo_horas_percentual?a.totais_atividades.total_projeto_saldo_horas_percentual:"0")+"%</span>"),$(i.find("[template-field='rodape_projeto_horas_trabalhadas_periodo_totais']")).text(format_time(a.totais_atividades.total_atividades_horas_trabalhadas_periodo)),$(i.find("[template-field='rodape_projeto_horas_trabalhadas_antes_periodo_totais']")).text(format_time(a.totais_atividades.total_atividades_horas_trabalhadas_antes_periodo));var s=i.find(".tab_body").find("tbody"),_=s.find("tr:first"),r=function(a){var t=_.clone();t.removeAttr("template-row"),t.css("display",""),$(t.find("[template-field='sequencia']")).text(a.ordem),$(t.find("[template-field='codigo']")).text(null!=a.codigo?a.codigo:""),$(t.find("[template-field='atividade']")).text(null!=a.atividade_simplificada?a.atividade_simplificada:""),$(t.find("[template-field='assunto']")).text(a.assunto?a.assunto:""),$(t.find("[template-field='horas_previstas']")).text(format_time(a.horas_previstas)),$(t.find("[template-field='horas_trabalhadas_periodo']")).text(format_time(a.horas_trabalhadas_periodo)),$(t.find("[template-field='horas_trabalhadas_antes_periodo']")).text(format_time(a.horas_trabalhadas_antes_periodo));var i=$(t.find("[template-field='saldo']")),o=$(t.find("[template-field='saldo_percentual']")),e=a.saldo_horas&&"-"==a.saldo_horas.toString().substring(0,1)?"text-danger":"text-success";null!=a.saldo_horas?(i.append('<span class="'+e+'">'+a.saldo_horas+"</span>"),o.append('<span class="'+e+'">'+(a.saldo_percentual?a.saldo_percentual:"0")+"%</span>")):(i.append('<span class="'+e+'">000:00</span>'),o.text("")),t.appendTo(s)};$(a.atividades).each(function(a,t){r(t)}),0==a.atividades.length&&r({ordem:"",codigo:null,atividade:"Nenhuma atividade",assunto:null,horas_previstas:null,horas_gastas:null,saldo_horas:null}),i.css("display",""),i.appendTo(t.div_relatorios),$("<br><br>").appendTo(t.div_relatorios)},this.carrega_projetos=function(){WS.get("projeto/relatorio_horas/",{projeto_id:t.projeto_id,cliente_id:t.cliente_id,data_inicio:t.data_inicio,data_fim:t.data_fim},function(a){for(var i=0;i<a.length;i++){var o=a[i];t.listar(o)}})},this.unload=function(){View.unload(this.html_id)},this.btn_parametros.unbind("click"),this.btn_parametros.click(function(){View.load("projeto/parametros",function(a,i){t.div_relatorios.find("br").remove(),t.div_relatorios.find(".div_template").remove(),i.onclose=t.carrega_projetos,i.show(function(a){t.cliente_id=a.cliente_id,t.projeto_id=a.projeto_id,t.data_inicio=a.data_inicio,t.data_fim=a.data_fim,""!=a.data_inicio&&""!=a.data_fim?(t.div_data.removeClass("hidden"),t.span_data_inicio.text(""!=a.data_inicio?a.data_inicio.format_date():""),t.span_data_fim.text(""!=a.data_fim?a.data_fim.format_date():""),t.th_total_horas_realizadas_no_periodo.text("Total Horas Realizadas no Período")):(t.th_total_horas_realizadas_no_periodo.text("Total Horas Realizadas"),t.div_data.addClass("hidden"))})})})}});