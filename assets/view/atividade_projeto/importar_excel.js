define([],function(){var Importar_Excel=function(html_id){"use strict";var main=this;this.html_id=html_id,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.edt_linha_inicial=this.dialog.find(".edt_linha_inicial"),this.chk_enviar_email_atividade=this.dialog.find(".chk_enviar_email_atividade"),this.info_tipo_data=this.dialog.find("#info_tipo_data"),this.select_formato_data=this.dialog.find(".select_formato_data"),this.div_alert=this.dialog.find(".div_alert"),this.div_tabela_usuario=this.dialog.find(".div_tabela_usuario"),this.div_check_email=this.dialog.find(".div_check_email"),this.primeira_etapa=this.dialog.find(".primeira_etapa"),this.escolher_aba_planilha=this.dialog.find(".escolher_aba_planilha"),this.seleciona_colunas=this.dialog.find(".seleciona_colunas"),this.segunda_etapa=this.dialog.find(".segunda_etapa"),this.terceira_etapa=this.dialog.find(".terceira_etapa"),this.quarta_etapa=this.dialog.find(".quarta_etapa"),this.add_coluna_planilha=this.dialog.find(".add_coluna_planilha"),this.cbo_codigo=this.dialog.find(".cbo_codigo"),this.cbo_nome_atividade=this.dialog.find(".cbo_nome_atividade"),this.cbo_atividade=this.dialog.find(".cbo_atividade"),this.cbo_assunto=this.dialog.find(".cbo_assunto"),this.cbo_concluido=this.dialog.find(".cbo_concluido"),this.cbo_horas_previstas=this.dialog.find(".cbo_horas_previstas"),this.cbo_consultor=this.dialog.find(".cbo_consultor"),this.cbo_responsavel=this.dialog.find(".cbo_responsavel"),this.cbo_solicitacao=this.dialog.find(".cbo_solicitacao"),this.cbo_inicio=this.dialog.find(".cbo_inicio"),this.cbo_prazo=this.dialog.find(".cbo_prazo"),this.cbo_conclusao=this.dialog.find(".cbo_conclusao"),this.cbo_observacao=this.dialog.find(".cbo_observacao"),this.cbo_marco=this.dialog.find(".cbo_marco"),this.cbo_valor_hora=this.dialog.find(".cbo_valor_hora"),this.cbo_prazo_dias=this.dialog.find(".cbo_prazo_dias"),this.cbo_previsao_inicio=this.dialog.find(".cbo_previsao_inicio"),this.cbo_sintetica_pai=this.dialog.find(".cbo_sintetica_pai"),this.cbo_tipo_atividade=this.dialog.find(".cbo_tipo_atividade"),this.cbo_worksheet=this.dialog.find(".cbo_worksheet"),this.planilha=this.dialog.find(".importar_planilha"),this.tbl_importar_atividades_assuntos=this.dialog.find(".tbl_importar_atividades_assuntos"),this.tbl_importar_atividades_usuarios=this.dialog.find(".tbl_importar_atividades_usuarios"),this.tbl_importar_atividades_verificar=this.dialog.find(".tbl_importar_atividades_verificar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_confirmar=this.dialog.find(".btn_confirmar"),this.btn_proxima_etapa=this.dialog.find(".btn_proxima_etapa"),this.btn_voltar=this.dialog.find(".btn_voltar"),this.projeto_id=null,this.arr_assunto_planilha=new Array,this.arr_assunto_planilha_filtrado=new Array,this.arr_assuntos_confirmados=new Array,this.usr_responsavel_planilha=new Array,this.usr_consultor_planilha=new Array,this.usr_usuarios_atividades=new Array,this.usr_usuarios_atividades_filtrado=new Array,this.arr_planilha=new Array,this.arr_enviar_planilha=new Array,this.cliente_id=null,this.assunto=new Array,this.usuario=new Array,this.arr_indice=new Array,this.colunas=new Array,this.var_response=null,this.enviar_email=!0,this.formato_data=null,this.arr_worksheet=null,this.show=function(a,i){show_modal(main.modal.attr("id")),main.projeto_id=a,main.cliente_id=i,main.edt_linha_inicial.val(""),main.planilha.val(""),WS.get("projeto/listar_equipe/",{projeto_id:main.projeto_id},function(a){main.usuario=a}),WS.get("assunto_projeto/listar/",null,function(a){main.assunto=a}),main.importar_planilha()},this.close=function(){close_modal(main.modal.attr("id")),void 0!==main.onclose&&main.onclose&&main.onclose()},this.unload=function(){main.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){main.unload()}),this.importar_planilha=function(){main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){var a=new Validation;if(0==main.planilha[0].files.length)a.add(new ValidationMessage(Validation.CODES.ERR,"Importe uma planilha antes de continuar"));else if(main.planilha[0].files.length>0){var i=main.planilha[0].files[0].name,o=i.substring(i.lastIndexOf(".")).toLowerCase(),t=new Array;t=[".xls",".xlsx"],-1==$.inArray(o,t)&&a.add(new ValidationMessage(Validation.CODES.ERR,"Selecione uma planilha no formato .xls")),""==main.edt_linha_inicial.val()&&a.add(new ValidationMessage(Validation.CODES.ERR,"Informe a linha que começará a importação"))}a.is_valid()?WS.post("atividade_projeto/importar_excel/",{projeto_id:main.projeto_id,linha_inicial:main.edt_linha_inicial.val(),planilha:main.planilha[0].files[0]},function(a){a&&(main.arr_worksheet=a,main.selecionar_worksheet(!1),main.btn_voltar.removeClass("hidden"))},[main.btn_proxima_etapa,main.btn_cancelar],null,!0):alert_modal("Validação",a)})},this.selecionar_worksheet=function(a){main.primeira_etapa.css("display","none"),main.escolher_aba_planilha.css("display",""),a||(main.cbo_worksheet.find("option").remove(),$(Object.keys(main.arr_worksheet)).each(function(a,i){add_option(main.cbo_worksheet,a,i,1==Object.keys(main.arr_worksheet).length?"selected":"")}),main.cbo_worksheet.selectpicker("refresh")),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.importar_planilha(),main.escolher_aba_planilha.css("display","none"),main.primeira_etapa.css("display",""),main.btn_voltar.addClass("hidden")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){var a=new Validation;if(0==main.cbo_worksheet.val().length&&a.add(new ValidationMessage(Validation.CODES.ERR,"Escolha uma aba da planilha")),a.is_valid()){main.var_response=null;var i=Object.keys(main.arr_worksheet)[parseInt(main.cbo_worksheet.val())];main.var_response=main.arr_worksheet[i],main.selecionar_coluna(!1)}else alert_modal("Validação",a)})},this.selecionar_coluna=function(retorno){main.escolher_aba_planilha.css("display","none"),main.seleciona_colunas.css("display",""),retorno||(main.add_coluna_planilha.find("option").remove(),add_option(main.add_coluna_planilha,"","-- Selecione --"),$.each(main.var_response.colunas,function(a,i){add_option(main.add_coluna_planilha,i,i)})),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.selecionar_worksheet(),main.seleciona_colunas.css("display","none"),main.escolher_aba_planilha.css("display","")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){main.arr_planilha=[],$.each(main.var_response.linhas,function(i,item){var codigo_valor=main.cbo_codigo.val().length>0?eval("item."+main.cbo_codigo.val()):null,nome_atividade=main.cbo_nome_atividade.val().length>0?eval("item."+main.cbo_nome_atividade.val()):null,atividade_valor=main.cbo_atividade.val().length>0?eval("item."+main.cbo_atividade.val()):null,assunto_valor=main.cbo_assunto.val().length>0?eval("item."+main.cbo_assunto.val()):null,concluido_valor=main.cbo_concluido.val().length>0?eval("item."+main.cbo_concluido.val()):null,horas_previstas_valor=main.cbo_horas_previstas.val().length>0?eval("item."+main.cbo_horas_previstas.val()):null,valor_hora_valor=main.cbo_valor_hora.val().length>0?eval("item."+main.cbo_valor_hora.val()):null,consultor_valor=main.cbo_consultor.val().length>0?eval("item."+main.cbo_consultor.val()):null,responsavel_valor=main.cbo_responsavel.val().length>0?eval("item."+main.cbo_responsavel.val()):null,solicitacao_valor=main.cbo_solicitacao.val().length>0?eval("item."+main.cbo_solicitacao.val()):null,inicio_valor=main.cbo_inicio.val().length>0?eval("item."+main.cbo_inicio.val()):null,prazo_valor=main.cbo_prazo.val().length>0?eval("item."+main.cbo_prazo.val()):null,conclusao_valor=main.cbo_conclusao.val().length>0?eval("item."+main.cbo_conclusao.val()):null,observacao_valor=main.cbo_observacao.val().length>0?eval("item."+main.cbo_observacao.val()):null,prazo_dias_valor=main.cbo_prazo_dias.val().length>0?eval("item."+main.cbo_prazo_dias.val()):null,previsao_inicio_valor=main.cbo_previsao_inicio.val().length>0?eval("item."+main.cbo_previsao_inicio.val()):null,sintetica_pai=main.cbo_sintetica_pai.val().length>0?item[main.cbo_sintetica_pai.val()]:null,tipo_atividade=main.cbo_tipo_atividade.val().length>0?item[main.cbo_tipo_atividade.val()]:null,marco=main.cbo_marco.val().length>0?eval("item."+main.cbo_marco.val()):null,words_regex=/([a-zA-Z]+)\b/,valor_hora=valor_hora_valor=valor_hora_valor?parseFloat(valor_hora_valor.toString().replace(",",".")).toFixed(2).replace(".",","):"0,00",data_solicitacao=null,data_previsao_inicio=null,data_inicio=null,data_prazo=null,data_conclusao=null;null!==solicitacao_valor&&(solicitacao_valor=solicitacao_valor.toString(),words_regex.test(solicitacao_valor.substring(0,10))||(data_solicitacao=solicitacao_valor.substring(0,10))),null!==previsao_inicio_valor&&(previsao_inicio_valor=previsao_inicio_valor.toString(),words_regex.test(previsao_inicio_valor.substring(0,10))||(data_previsao_inicio=previsao_inicio_valor.substring(0,10))),null!==inicio_valor&&(inicio_valor=inicio_valor.toString(),words_regex.test(inicio_valor.substring(0,10))||(data_inicio=inicio_valor.substring(0,10))),null!==prazo_valor&&(prazo_valor=prazo_valor.toString(),words_regex.test(prazo_valor.substring(0,10))||(data_prazo=prazo_valor.substring(0,10))),null!==conclusao_valor&&(conclusao_valor=conclusao_valor.toString(),words_regex.test(conclusao_valor.substring(0,10))||(data_conclusao=conclusao_valor.substring(0,10))),main.arr_planilha.push({codigo:codigo_valor,nome_atividade:nome_atividade,atividade:atividade_valor,assunto:assunto_valor,concluido:concluido_valor,horas_previstas:horas_previstas_valor,valor_hora:valor_hora,consultor:consultor_valor,responsavel:responsavel_valor,solicitacao:data_solicitacao,previsao_inicio:data_previsao_inicio,inicio:data_inicio,prazo:data_prazo,conclusao:data_conclusao,observacao:observacao_valor,key_assunto:null,id_consultor:null,id_responsavel:null,assunto_selecionado:null,assunto_selecionado_id:null,projeto_id:main.projeto_id,prazo_dias:prazo_dias_valor,sintetica_pai:sintetica_pai,tipo_atividade:tipo_atividade,marco:marco}),"A"!=tipo_atividade&&tipo_atividade||(main.cbo_consultor.val().length>0&&eval("item."+main.cbo_consultor.val())&&main.usr_consultor_planilha.push({nome:eval("item."+main.cbo_consultor.val()),tipo:"Executor"}),main.cbo_responsavel.val().length>0&&eval("item."+main.cbo_responsavel.val())&&main.usr_responsavel_planilha.push({nome:eval("item."+main.cbo_responsavel.val()),tipo:"Responsável"}))});var vld_result=new Validation;0==main.cbo_nome_atividade.val().length&&vld_result.add(new ValidationMessage(Validation.CODES.ERR,"Informe a coluna do nome da Atividade")),vld_result.is_valid()?($.each(main.arr_planilha,function(a,i){"A"!=i.tipo_atividade&&i.tipo_atividade||(i.conclusao&&(i.concluido=100),null==i.assunto&&(i.assunto="Assunto em branco"),main.arr_assunto_planilha.push(i.assunto))}),main.selecionar_assuntos(!1)):alert_modal("Validação",vld_result)})},this.selecionar_assuntos=function(a){var i;main.seleciona_colunas.css("display","none"),main.segunda_etapa.css("display","");for(var o=0;o<main.arr_assunto_planilha.length;o++){i="undefined";for(var t=0;t<main.arr_assunto_planilha_filtrado.length;t++)if(main.arr_assunto_planilha[o]==main.arr_assunto_planilha_filtrado[t].descricao){i=!0;break}"undefined"==i&&main.arr_assunto_planilha_filtrado.push({descricao:main.arr_assunto_planilha[o],assunto:null,assunto_id_selecionado:null,key:null})}var n=function(a,i){a.find("option").remove(),add_option(a,-1,"-- Selecione --"),add_option(a,0,"Novo Assunto");var o=!1;$.each(main.assunto,function(t,n){add_option(a,n.assunto_projeto_id,n.descricao),null!=i&&""!=i&&n.descricao==i&&(o=!0,a.val(n.assunto_projeto_id).trigger("change"))}),o||a.val(0).trigger("change")},l=main.tbl_importar_atividades_assuntos.find("tbody"),e=l.find("tr:first");a||$(main.arr_assunto_planilha_filtrado).each(function(i,o){null!=o&&function(i,o){var t=e.clone();t.removeAttr("template-row").remove(),t.css("display",""),$(t.find("[template-field='desc_assunto_planilha']")).text(null!=i.descricao?i.descricao:"Assunto em branco");var r=$(t.find("[template-field='template_assunto_planilha']"));r.addClass("cbo_padrao_assunto");var s=$(t.find("[template-button='btn_novo_assunto']")),d=$(t.find("[template-button='btn_visualizar_assunto']"));r.unbind("change"),r.change(function(){i.assunto_id_selecionado=r.val();var a=r.find("option[value='"+r.val()+"']").text();i.assunto=a,main.arr_assunto_planilha_filtrado[o]=i}),s.unbind("click"),s.click(function(){View.load("assunto_projeto/detalhes",function(a,i){i.onclose=function(){WS.get("assunto_projeto/listar/",null,function(a){main.assunto=a;var o=main.dialog.find(".cbo_padrao_assunto");$(o).each(function(a,o){add_option($(o),i.assunto_projeto_id,i.assunto_projeto_descricao)}),n(r,i.assunto_projeto_descricao)})},i.show(null,FORMULARIO.NOVO)})}),d.unbind("click"),d.click(function(){r.val()>0&&View.load("assunto_projeto/detalhes",function(a,i){i.show(r.val(),FORMULARIO.VISUALIZAR)})}),a||n(r,i.descricao),t.appendTo(l)}(o,i)}),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.tbl_importar_atividades_assuntos.find("tr:gt(1)").remove(),main.selecionar_coluna(!0),main.seleciona_colunas.css("display",""),main.segunda_etapa.css("display","none")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){for(var a=0;a<main.arr_assunto_planilha_filtrado.length;a++){var i=new Validation;if(null==main.arr_assunto_planilha_filtrado[a].assunto_id_selecionado&&i.add(new ValidationMessage(Validation.CODES.ERR,"Selecionar o assunto.")),!i.is_valid())return void alert_modal("Validação",i)}main.selecionar_usuarios(!1)})},this.selecionar_usuarios=function(a){var i;main.segunda_etapa.css("display","none"),main.terceira_etapa.css("display",""),main.usr_usuarios_atividades=main.usr_consultor_planilha.concat(main.usr_responsavel_planilha);for(var o=0;o<main.usr_usuarios_atividades.length;o++){i="undefined";for(var t=0;t<main.usr_usuarios_atividades_filtrado.length;t++)if(main.usr_usuarios_atividades[o].nome==main.usr_usuarios_atividades_filtrado[t].nome&&main.usr_usuarios_atividades[o].tipo==main.usr_usuarios_atividades_filtrado[t].tipo){i=!0;break}"undefined"==i&&main.usr_usuarios_atividades_filtrado.push({nome:main.usr_usuarios_atividades[o].nome,tipo:main.usr_usuarios_atividades[o].tipo,usuario_id_selecionado:null})}var n=main.tbl_importar_atividades_usuarios.find("tbody"),l=n.find("tr:first"),e=function(a,i){var o=l.clone();o.removeAttr("template-row").remove(),o.css("display",""),$(o.find("[template-field='template_nome_usuario']")).text(a.nome),$(o.find("[template-field='template_tipo_usuario']")).text(a.tipo);var t=$(o.find("[template-field='template_cbo_usuario_tipo']"));t.unbind("change"),t.change(function(){a.usuario_id_selecionado=t.val(),main.usr_usuarios_atividades_filtrado[i]=a}),"Responsável"==a.tipo?(t.attr("template-field","responsavel"),function(a,i){a.find("option").remove(),add_option(a,-1,"-- Selecione --");var o=!1;$.each(main.usuario,function(t,n){add_option(a,n.usuario_id,n.nome),null!=i&&""!=i&&n.nome==i&&(o=!0,a.val(n.usuario_id).trigger("change"))}),o||a.val(-1).trigger("change")}(t,a.nome)):(t.attr("template-field","executor"),function(a,i){a.find("option").remove(),add_option(a,-1,"-- Selecione --");var o=!1;$.each(main.usuario,function(t,n){add_option(a,n.usuario_id,n.nome),null!=i&&""!=i&&n.nome==i&&(o=!0,a.val(n.usuario_id).trigger("change"))}),o||a.val(-1).trigger("change")}(t,a.nome)),o.appendTo(n)};a||(main.usr_usuarios_atividades_filtrado.length>0?($(main.usr_usuarios_atividades_filtrado).each(function(a,i){e(i,a)}),main.div_tabela_usuario.removeClass("hidden"),main.div_alert.addClass("hidden")):(main.div_tabela_usuario.addClass("hidden"),main.div_alert.removeClass("hidden"))),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.tbl_importar_atividades_usuarios.find("tr:gt(1)").remove(),main.selecionar_assuntos(!0),main.segunda_etapa.css("display",""),main.terceira_etapa.css("display","none")}),main.btn_proxima_etapa.unbind("click"),main.btn_proxima_etapa.click(function(){main.confirmar_dados()})},this.confirmar_dados=function(){main.terceira_etapa.css("display","none"),main.quarta_etapa.css("display",""),main.btn_proxima_etapa.css("display","none"),main.btn_confirmar.css("display",""),main.div_check_email.removeClass("hidden"),$.each(main.arr_assunto_planilha_filtrado,function(a,i){var o=String((new Date).getTime()+String(1e4*Math.random()));main.arr_assunto_planilha_filtrado[a].key=o}),$(main.arr_planilha).each(function(a,i){$(main.arr_assunto_planilha_filtrado).each(function(o,t){i.assunto===t.descricao&&(i.key_assunto=t.key,i.assunto_selecionado_id=t.assunto_id_selecionado,i.assunto_selecionado=t.assunto,main.arr_planilha[a]=i)})}),$(main.arr_planilha).each(function(a,i){var o=function(a){var i=null;return main.usr_usuarios_atividades_filtrado.filter(function(o,t){o.nome===a&&"Executor"===o.tipo&&(i=o.usuario_id_selecionado)}),i}(i.consultor),t=function(a){var i=null;return main.usr_usuarios_atividades_filtrado.filter(function(o,t){o.nome===a&&"Responsável"===o.tipo&&(i=o.usuario_id_selecionado)}),i}(i.responsavel);main.arr_planilha[a].id_consultor=o,main.arr_planilha[a].id_responsavel=t});var a=main.tbl_importar_atividades_verificar.find("tbody").find("tr:first");$(main.arr_planilha).each(function(i,o){!function(i,o){var t=a.clone();t.removeAttr("template-row").remove(),t.css("display","");var n=$(t.find("[template-field='codigo_planilha']"));n.text(null!=i.codigo?i.codigo:""),n.click(function(a){if(0==t.find("#edt_codigo_planilha").length){n.html('<textarea id="edt_codigo_planilha" maxlength="50" cols="35" rows="5">'+(i.codigo?i.codigo.substring(0,50):"")+'</textarea><br><input type="button" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_codigo" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_codigo" style="margin-top: 4px; margin-left: 3px;">');var l=t.find("#edt_codigo_planilha"),e=t.find("#btn_salva_alteracoes_codigo"),r=t.find("#btn_cancela_alteracoes_codigo");l.focus(),e.click(function(a){a.stopPropagation(),main.arr_planilha[o].codigo=l.val(),n.html('<td template-field="codigo_planilha">'+l.val()+"</td>")}),r.click(function(a){a.stopPropagation(),n.html('<td template-field="codigo_planilha">'+(i.codigo?i.codigo:"")+"</td>")}),l.keypress(function(a){13==a.which&&(main.arr_planilha[o].codigo=l.val(),n.html('<td template-field="codigo_planilha">'+l.val()+"</td>"))})}});var l=$(t.find("[template-field='nome_atividade_planilha']"));l.text(null!=i.nome_atividade?i.nome_atividade:""),l.click(function(){if(0==t.find("#edt_nome_atividade_planilha").length){l.html('<textarea id="edt_nome_atividade_planilha" maxlength="70" cols="35" rows="5">'+(i.nome_atividade?i.nome_atividade.substring(0,70):"")+'</textarea><br><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_nome" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_nome" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_nome_atividade_planilha"),n=t.find("#btn_salva_alteracoes_nome"),e=t.find("#btn_cancela_alteracoes_nome");a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].nome_atividade=a.val(),l.html('<td template-field="nome_atividade_planilha">'+a.val()+"</td>")}),e.click(function(a){a.stopPropagation(),l.html('<td template-field="nome_atividade_planilha">'+(i.nome_atividade?i.nome_atividade:"")+"</td>")}),a.keypress(function(i){13==i.which&&(main.arr_planilha[o].nome_atividade=a.val(),l.html('<td template-field="nome_atividade_planilha">'+a.val()+"</td>"))})}});var e=$(t.find("[template-field='atividade_planilha']"));e.text(null!=i.atividade?i.atividade:""),e.click(function(){if(0==t.find("#edt_atividade_planilha").length){e.html('<textarea id="edt_atividade_planilha" cols="35" rows="5">'+(i.atividade?i.atividade:"")+'</textarea><br><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_descricao" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_descricao" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_atividade_planilha"),n=t.find("#btn_salva_alteracoes_descricao"),l=t.find("#btn_cancela_alteracoes_descricao");a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].atividade=a.val(),e.html('<td template-field="atividade_planilha">'+a.val()+"</td>")}),l.click(function(a){a.stopPropagation(),e.html('<td template-field="atividade_planilha">'+(i.atividade?i.atividade:"")+"</td>")}),a.keypress(function(i){13==i.which&&(main.arr_planilha[o].atividade=a.val(),e.html('<td template-field="atividade_planilha">'+a.val()+"</td>"))})}}),$(t.find("[template-field='assunto_planilha']")).text(null!=i.assunto_selecionado?i.assunto_selecionado:"");var r=$(t.find("[template-field='concluido_planilha']"));r.text(null!=i.concluido?i.concluido:""),r.click(function(){if(0==t.find("#edt_concluido_planilha").length){r.html('<input type="number" id="edt_concluido_planilha" min="0" max="100" value="'+(null!=i.concluido?i.concluido.toString().replace("%",""):"")+'" style="min-width: 130px;"><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_concluido" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_concluido" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_concluido_planilha"),n=t.find("#btn_salva_alteracoes_concluido"),l=t.find("#btn_cancela_alteracoes_concluido");a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].concluido=a.val()<0?0:a.val()>100?100:a.val(),r.html('<td template-field="concluido_planilha">'+a.val()<0?0:a.val()>100?100:a.val()+"</td>")}),l.click(function(a){a.stopPropagation(),r.html('<td template-field="concluido_planilha">'+(i.concluido?i.concluido:"")+"</td>")}),a.keypress(function(i){if(13==i.which&&(main.arr_planilha[o].concluido=a.val()<0?0:a.val()>100?100:a.val(),r.html('<td template-field="concluido_planilha">'+a.val()<0?0:a.val()>100?100:a.val()+"</td>")),a.val().toString().length>=3||8!=event.which&&0!=event.which&&(event.which<48||event.which>57))return!1})}});var s=$(t.find("[template-field='valor_hora']"));s.text(i.valor_hora=i.valor_hora?parseFloat(i.valor_hora.toString().replace(",",".")).toFixed(2).replace(".",","):0),s.click(function(){if(i.valor_hora=i.valor_hora?parseFloat(i.valor_hora.toString().replace(",",".")).toFixed(2).replace(".",","):"0,00",0==t.find("#edt_valor_hora").length){s.html('<input type="text" id="edt_valor_hora"  value="'+(i.valor_hora?i.valor_hora:"")+'" style="min-width: 130px;"><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_valor_hora" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_valor_hora" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_valor_hora"),n=t.find("#btn_salva_alteracoes_valor_hora"),l=t.find("#btn_cancela_alteracoes_valor_hora");a.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].valor_hora=parseFloat(a.maskMoney("unmasked")[0]).toFixed(2).replace(".",","),s.html('<td template-field="valor_hora">'+parseFloat(a.maskMoney("unmasked")[0]).toFixed(2).replace(".",",")+"</td>")}),l.click(function(a){a.stopPropagation(),s.html('<td template-field="valor_hora">'+(i.valor_hora?i.valor_hora:"")+"</td>")}),a.keypress(function(i){13==i.which&&(main.arr_planilha[o].valor_hora=parseFloat(a.maskMoney("unmasked")[0]).toFixed(2).replace(".",","),s.html('<td template-field="valor_hora">'+parseFloat(a.maskMoney("unmasked")[0]).toFixed(2).replace(".",",")+"</td>"))})}});var d=$(t.find("[template-field='horas_previstas']"));d.text(null!=i.horas_previstas?i.horas_previstas:""),d.click(function(){if(0==t.find("#edt_horas_previstas").length){d.html('<input type="text" id="edt_horas_previstas"  value="'+(null!=i.horas_previstas?i.horas_previstas:"")+'" style="min-width: 130px;"><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_horas_previstas" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_horas_prevista" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_horas_previstas"),n=t.find("#btn_salva_alteracoes_horas_previstas"),l=t.find("#btn_cancela_alteracoes_horas_prevista");a.mask("000:00"),a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].horas_previstas=a.val(),d.html('<td template-field="horas_previstas">'+a.val()+"</td>")}),l.click(function(a){a.stopPropagation(),d.html('<td template-field="horas_previstas">'+(i.horas_previstas?i.horas_previstas:"")+"</td>")}),a.keypress(function(i){13==i.which&&(main.arr_planilha[o].horas_previstas=a.val(),d.html('<td template-field="horas_previstas">'+a.val()+"</td>"))})}}),$(t.find("[template-field='consultor_planilha']")).text(null!=i.consultor?i.consultor:""),$(t.find("[template-field='responsavel_planilha']")).text(null!=i.responsavel?i.responsavel:"");var c=$(t.find('[template-field="prazo_dias"]'));c.text(i.prazo_dias?i.prazo_dias:""),c.click(function(){if(0==t.find("#edt_prazo_dias").length){c.html('<input type="number" id="edt_prazo_dias" value="'+(i.prazo_dias?i.prazo_dias:"")+'" style="min-width: 130px;"><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_prazo_dias" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_prazo_dias" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_prazo_dias"),n=t.find("#btn_salva_alteracoes_prazo_dias"),l=t.find("#btn_cancela_alteracoes_prazo_dias");a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].prazo_dias=a.val(),c.html('<td template-field="prazo_dias">'+a.val()+"</td>")}),l.click(function(a){a.stopPropagation(),c.html('<td template-field="prazo_dias">'+(i.prazo_dias?i.prazo_dias:"")+"</td>")}),a.keypress(function(i){if(13==i.which&&(main.arr_planilha[o].prazo_dias=a.val(),c.html('<td template-field="prazo_dias">'+a.val()+"</td>")),8!=event.which&&0!=event.which&&(event.which<48||event.which>57))return!1})}});var _=$(t.find("[template-field='datas']")),p=/([a-zA-Z]+)\b/,m=null,u=null,v=null,h=null,f=null;null!==i.solicitacao&&(i.solicitacao=i.solicitacao.toString(),p.test(i.solicitacao.substring(0,10))||(m=i.solicitacao.substring(0,10))),null!==i.previsao_inicio&&(i.previsao_inicio=i.previsao_inicio.toString(),p.test(i.previsao_inicio.substring(0,10))||(u=i.previsao_inicio.substring(0,10))),null!==i.inicio&&(i.inicio=i.inicio.toString(),p.test(i.inicio.substring(0,10))||(v=i.inicio.substring(0,10))),$(t.find('[template-field="tipo_planilha"]')).text(null!=i.tipo_atividade?i.tipo_atividade:""),$(t.find('[template-field="sintetico_pai_planilha"]')).text(null!=i.sintetica_pai?i.sintetica_pai:""),null!==i.prazo&&(i.prazo=i.prazo.toString(),p.test(i.prazo.substring(0,10))||(h=i.prazo.substring(0,10))),null!==i.conclusao&&(i.conclusao=i.conclusao.toString(),p.test(i.conclusao.substring(0,10))||(f=i.conclusao.substring(0,10))),_.append('<label for="data_solicitacao">Data solicitação</label><input type="date" id="data_solicitacao" class="form-control" data-toggle="tooltip">');var b=_.find("input#data_solicitacao");null!==m?(set_datepicker(b,m.format_date(!0)),""==get_datepicker(b)&&(b.tooltip({title:"Não foi possível carregar a data: formato inválido. Por favor, informe manualmente.",placement:"left"}),b.tooltip(),b.prev().css("color","red"),b.prev().append(" *"))):(b.tooltip({title:"Não foi possível carregar a data: formato inválido ou não foi informado na planilha.",placement:"left"}),b.tooltip()),_.append('<label for="data_previsao_inicio">Data previsão inicio</label><input type="date" id="data_previsao_inicio" class="form-control" data-toggle="tooltip">');var g=_.find("input#data_previsao_inicio");null!==u?(set_datepicker(g,u.format_date(!0)),""==get_datepicker(g)&&(g.tooltip({title:"Não foi possível carregar a data: formato inválido. Por favor, informe manualmente.",placement:"left"}),g.tooltip(),g.prev().css("color","red"),g.prev().append(" *"))):(g.tooltip({title:"Não foi possível carregar a data: formato inválido ou não foi informado na planilha.",placement:"left"}),g.tooltip()),_.append('<label for="data_inicio">Data inicio</label><input type="date" id="data_inicio" class="form-control" data-toggle="tooltip">');var k=_.find("input#data_inicio");null!==v?(set_datepicker(k,v.format_date(!0)),""==get_datepicker(k)&&(k.tooltip({title:"Não foi possível carregar a data: formato inválido. Por favor, informe manualmente.",placement:"left"}),k.tooltip(),k.prev().css("color","red"),k.prev().append(" *"))):(k.tooltip({title:"Não foi possível carregar a data: formato inválido ou não foi informado na planilha.",placement:"left"}),k.tooltip()),_.append('<label for="data_prazo">Data prazo</label><input type="date" id="data_prazo" class="form-control" data-toggle="tooltip">');var y=_.find("input#data_prazo");null!==h?(set_datepicker(y,h.format_date(!0)),""==get_datepicker(y)&&(y.tooltip({title:"Não foi possível carregar a data: formato inválido. Por favor, informe manualmente.",placement:"left"}),y.tooltip(),y.prev().css("color","red"),y.prev().append(" *"))):(y.tooltip({title:"Não foi possível carregar a data: formato inválido ou não foi informado na planilha.",placement:"left"}),y.tooltip()),_.append('<label for="data_conclusao">Data conclusão</label><input type="date" id="data_conclusao" class="form-control" data-toggle="tooltip">');var x=_.find("input#data_conclusao");null!==f?(set_datepicker(x,f.format_date(!0)),""==get_datepicker(x)&&(x.tooltip({title:"Não foi possível carregar a data: formato inválido. Por favor, informe manualmente.",placement:"left"}),x.tooltip(),x.prev().css("color","red"),x.prev().append(" *"))):(x.tooltip({title:"Não foi possível carregar a data: formato inválido ou não foi informado na planilha.",placement:"left"}),x.tooltip()),b.change(function(){main.arr_planilha[o].solicitacao=get_datepicker(b)}),g.change(function(){main.arr_planilha[o].previsao_inicio=get_datepicker(g)}),k.change(function(){main.arr_planilha[o].inicio=get_datepicker(k)}),y.change(function(){main.arr_planilha[o].prazo=get_datepicker(y)}),x.change(function(){main.arr_planilha[o].conclusao=get_datepicker(x)}),main.arr_planilha[o].solicitacao=get_datepicker(b),main.arr_planilha[o].previsao_inicio=get_datepicker(g),main.arr_planilha[o].inicio=get_datepicker(k),main.arr_planilha[o].prazo=get_datepicker(y),main.arr_planilha[o].conclusao=get_datepicker(x);var w=$(t.find("[template-field='observacao_planilha']"));w.text(null!=i.observacao?i.observacao:""),w.click(function(){if(0==t.find("#edt_observacao_planilha").length){w.html('<textarea id="edt_observacao_planilha" maxlength="1000" cols="35" rows="5">'+(i.observacao?i.observacao.substring(0,1e3):"")+'</textarea><br><input type="submit" value="Salvar" class="btn btn-primary btn-sm" id="btn_salva_alteracoes_observacao" style="margin-top: 4px;"><input type="button" value="Cancelar" class="btn btn-secondary btn-sm" id="btn_cancela_alteracoes_observacao" style="margin-top: 4px; margin-left: 3px;">');var a=t.find("#edt_observacao_planilha"),n=t.find("#btn_salva_alteracoes_observacao"),l=t.find("#btn_cancela_alteracoes_observacao");a.focus(),n.click(function(i){i.stopPropagation(),main.arr_planilha[o].observacao=a.val(),w.html('<td template-field="observacao_planilha">'+a.val()+"</td>")}),l.click(function(a){a.stopPropagation(),w.html('<td template-field="observacao_planilha">'+(i.observacao?i.observacao:"")+"</td>")}),a.keypress(function(i){13==i.which&&(main.arr_planilha[o].observacao=a.val(),w.html('<td template-field="observacao_planilha">'+a.val()+"</td>"))})}}),t.appendTo(main.tbl_importar_atividades_verificar)}(o,i)});main.chk_enviar_email_atividade.unbind("click"),main.chk_enviar_email_atividade.bootstrapSwitch("onSwitchChange",function(a,i){var o;o=main.chk_enviar_email_atividade,main.enviar_email=o.prop("checked")}),main.info_tipo_data.click(function(){var a=getDateNow(!0).format_date(),i=a.substring(0,2),o=a.substring(3,5),t=a.substring(6),n=i+"/"+o+"/"+(t=t.substring(2));alert_modal("Formato da data","É o formato da data que se encontra na planilha de importação. <br> Por exemplo, se na sua planilha a data estiver como <b>"+getDateNow(!0).format_date()+'</b>, a opção correta na seleção seria "dd-mm-aaaa". <br><br> <ul><li>dd - dia</li><li>mm - mês</li><li>aaaa - ano (4 dígitos). Ex: '+getDateNow(!0).format_date()+"</li><li>aa - ano (2 dígitos). Ex: "+n+" </li></ul>","Ok",function(){},!1)}),main.select_formato_data.unbind("change"),main.select_formato_data.change(function(){main.formato_data=$(".select_formato_data option:selected").val(),main.select_formato_data.selectpicker("refresh")}),main.btn_voltar.unbind("click"),main.btn_voltar.click(function(){main.tbl_importar_atividades_verificar.find("tr:gt(1)").remove(),main.selecionar_usuarios(!0),main.terceira_etapa.css("display",""),main.quarta_etapa.css("display","none"),main.btn_proxima_etapa.css("display",""),main.btn_confirmar.css("display","none"),main.div_check_email.addClass("hidden")}),main.btn_confirmar.unbind("click"),main.btn_confirmar.click(function(){WS.post("atividade_projeto/salvar_importacao/",{planilha:JSON.stringify(main.arr_planilha),assuntos:JSON.stringify(main.arr_assunto_planilha_filtrado),enviar_email:main.enviar_email},function(a){alert_saved("Importação realizada com sucesso"),main.unload()},[main.btn_confirmar,main.btn_voltar,main.btn_cancelar])})}};return Importar_Excel});