define(["react","react-dom","./../componentes_react/CboUsuarios","./../central_documentos/SelectPasta","./../componentes_react/CboAssunto","./../componentes_react/CboTipoDocumento"],function(o,a,i,s,t,e){return function(n){"use strict";var r=this;this.html_id=n,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.file_importacao_processo=this.dialog.find(".file_importacao_processo"),this.cbo_categoria_processos=this.dialog.find(".cbo_categoria_processos"),this.btn_categoria_processos_visualizar=this.dialog.find(".btn_categoria_processos_visualizar"),this.btn_categoria_processos_recarregar=this.dialog.find(".btn_categoria_processos_recarregar"),this.btn_categoria_processos_novo=this.dialog.find(".btn_categoria_processos_novo"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_visualizar=this.dialog.find(".btn_calendario_trabalho_visualizar"),this.btn_calendario_trabalho_recarregar=this.dialog.find(".btn_calendario_trabalho_recarregar"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.tab_listagem_anexo=this.dialog.find(".tab_listagem_anexo"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.div_pasta=this.dialog.find(".div_pasta"),this.div_componente_pasta=this.dialog.find(".div_componente_pasta"),this.selectPasta=o.createElement(s,null,null),this.grid_consultas_integracao=this.dialog.find(".grid_consultas_integracao"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.envolvidos=null,this.documento_pasta_id=null,this.anexos=null,this.consultas_integracao=[],this.show=function(){r.listar_categoria_processos(),r.listar_calendario_trabalho(),a.render(r.selectPasta,r.div_componente_pasta[0]),r.selectPasta.props.setDesabilitado(!1),show_modal(r.modal.attr("id"))},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.listar_categoria_processos=function(o){r.cbo_categoria_processos.find("option").remove(),add_option(r.cbo_categoria_processos,"","Nenhum"),WS.get("categoria_processos/listar/",null,function(a){for(var i=0;i<a.length;i++){var s=a[i];add_option(r.cbo_categoria_processos,s.categoria_processos_id,s.nome)}o&&r.cbo_categoria_processos.val(o).trigger("change")})},this.listar_calendario_trabalho=function(o){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(a){for(var i=0;i<a.length;i++){var s=a[i];add_option(r.cbo_calendario_trabalho,s.calendario_trabalho_id,s.nome)}o&&r.cbo_calendario_trabalho.val(o).trigger("change")})},this.render_anexos=function(){var i=r.tab_listagem_anexo.find("tbody"),s=i.find("tr:first");r.tab_listagem_anexo.find("tr:gt(1)").remove(),r.anexos&&$(r.anexos).each(function(n,_){_.indice=n,function(n){var _=s.clone();_.removeAttr("template-row"),_.css("display","");var c=_.find("[template-field='assunto']");c.text(n.assunto_descricao?n.assunto_descricao:"Não informado"),c.attr("assunto_id",n.assunto_id),_.find('[template-field="campo"]').text(n.campo),_.find('[template-field="grupo"]').text(n.grupo),_.find("[template-field='tipo_documento']").text(n.tipo_documento_descricao?n.tipo_documento_descricao:"Não Informado");var l=_.find(".div_componente_tipo_documento"),d=o.createElement(e,null,null);a.render(d,l[0]),d.props.setParams({OnSelect:function(o){r.anexos=r.anexos.map(function(a,i){return n.indice==a.indice&&(a.tipo_documento_id_substituto=o.tipo_documento_id),a})}});var u=_.find(".div_componente_assunto"),p=o.createElement(t,null,null);a.render(p,u[0]),p.props.setParams({OnSelect:function(o){r.anexos=r.anexos.map(function(a,i){return n.indice==a.indice&&(a.assunto_id_substituto=o.assunto_id),a})}}),n.tipo_documento_id_sugerido&&d.props.setTipoDocumento({tipo_documento_id:n.tipo_documento_id_sugerido,nome:n.tipo_documento_nome_sugerido}),n.assunto_id_sugerido&&p.props.setAssunto({assunto_id:n.assunto_id_sugerido,descricao:n.assunto_descricao_sugerido}),_.appendTo(i)}(_)})},this.render_envolvidos=function(){var s=r.tab_listagem.find("tbody"),t=s.find("tr:first");r.tab_listagem.find("tr:gt(1)").remove();var e=function(e){var n=t.clone();n.removeAttr("template-row"),n.css("display","");var _=$(n.find("[template-field='nome']"));_.text(e.nome),_.attr("usuario_id",e.usuario_id);var c=$(n.find(".div_componente_usuario")),l=o.createElement(i,null,null);a.render(l,c[0]),l.props.setObjParam({EquipeInterna:!0,Clientes:!0,Fornecedores:!0,ExibirGrupos:!0,EmpresaId:App.temp.empresa}),e.usuario_id_sugestao?(l.props.setUsuario({usuario_id:e.usuario_id_sugestao,usuario_nome:e.nome_sugestao}),r.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto=e.usuario_id_sugestao):e.grupo_usuarios_id_sugestao&&(l.props.setUsuario({usuario_id:e.grupo_usuarios_id_sugestao,usuario_nome:e.grupo_usuarios_nome_sugestao}),r.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto=e.grupo_usuarios_id_sugestao),l.props.setFunctionSelect(function(){"usuarios"==l.props.UsuarioSelecionado.tipo||"usuario_cliente"==l.props.UsuarioSelecionado.tipo||"usuario_fornecedor"==l.props.UsuarioSelecionado.tipo?e.usuario_id?(delete r.envolvidos.usuarios_envolvidos[e.usuario_id].grupo_usuarios_id_substituto,r.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto=l.props.UsuarioSelecionado.id):e.grupo_usuarios_id&&(delete r.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto,r.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].usuario_id_substituto=l.props.UsuarioSelecionado.id):"grupo_usuarios"==l.props.UsuarioSelecionado.tipo&&(e.usuario_id?(delete r.envolvidos.usuarios_envolvidos[e.usuario_id].usuario_id_substituto,r.envolvidos.usuarios_envolvidos[e.usuario_id].grupo_usuarios_id_substituto=l.props.UsuarioSelecionado.id):e.grupo_usuarios_id&&(delete r.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].usuario_id_substituto,r.envolvidos.grupo_usuarios_envolvidos[e.grupo_usuarios_id].grupo_usuarios_id_substituto=l.props.UsuarioSelecionado.id))}),n.appendTo(s)};r.envolvidos&&(Object.keys(r.envolvidos.usuarios_envolvidos).map(function(o){e(r.envolvidos.usuarios_envolvidos[o])}),Object.keys(r.envolvidos.grupo_usuarios_envolvidos).map(function(o){e(r.envolvidos.grupo_usuarios_envolvidos[o])}))},this.render_consultas_integracao=function(){r.dataGridConsultas_integracao=r.grid_consultas_integracao.dxDataGrid({dataSource:r.consultas_integracao,keyExpr:"nome_modelagem",editing:{mode:"cell",allowUpdating:!0,useIcons:!1},sorting:null,columns:[{caption:"Nome",dataField:"nome_modelagem",allowEditing:!1},{caption:"Consulta de Integração",dataField:"consulta_integracao_id",calculateDisplayValue:"consulta_integracao_nome",editCellTemplate(o,a){let i=$("<div>");ReactDOM.render(React.createElement(window.components.SelecaoConsultaIntegracao.default,{aoAlterar:(o,i)=>{a.setValue(o),a.row.data.consulta_integracao_nome=i.nome,r.consultas_integracao[a.row.dataIndex].consulta_integracao_id=o,r.consultas_integracao[a.row.dataIndex].consulta_integracao_nome=i.nome}}),i[0]),i.appendTo(o)}}]}).dxDataGrid("instance")},this.btn_categoria_processos_visualizar.unbind("click"),this.btn_categoria_processos_visualizar.click(function(){""!=r.cbo_categoria_processos.val()&&View.load("categoria_processos/detalhes",function(o,a){a.show(r.cbo_categoria_processos.val(),FORMULARIO.VISUALIZAR)})}),this.btn_categoria_processos_recarregar.unbind("click"),this.btn_categoria_processos_recarregar.click(function(){r.listar_categoria_processos(r.cbo_categoria_processos.val())}),this.btn_categoria_processos_novo.unbind("click"),this.btn_categoria_processos_novo.click(function(){View.load("categoria_processos/detalhes",function(o,a){a.onclose=function(){a.categoria_processos_id&&r.listar_categoria_processos(a.categoria_processos_id)},a.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_visualizar.unbind("click"),this.btn_calendario_trabalho_visualizar.click(function(){""!=r.cbo_calendario_trabalho.val()&&View.load("calendario_trabalho/detalhes",function(o,a){a.show(r.cbo_calendario_trabalho.val(),FORMULARIO.VISUALIZAR)})}),this.btn_calendario_trabalho_recarregar.unbind("click"),this.btn_calendario_trabalho_recarregar.click(function(){r.listar_calendario_trabalho(r.cbo_calendario_trabalho.val())}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(o,a){a.onclose=function(){a.calendario_trabalho_id&&r.listar_calendario_trabalho(a.calendario_trabalho_id)},a.show(null,FORMULARIO.NOVO)})}),r.selectPasta.props.handleSelecionar=function(){r.documento_pasta_id=r.selectPasta.props.documentoPastaID},this.unload=function(){r.close(),View.unload(this.html_id)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),r.file_importacao_processo.change(function(){var o=null;this.files.length?(o=this.files[0].name,WS.post("processo/get_envolvidos/",{arquivo_processo:r.file_importacao_processo[0].files[0]},function(o){r.envolvidos=o,r.anexos=o.anexos,r.render_anexos(),r.render_envolvidos(),o.permite_anexos&&r.div_pasta.removeClass("hidden"),r.consultas_integracao=o.consulta_integracao,r.render_consultas_integracao()},null,null,!0)):o="Arraste seu arquivo aqui ou clique nesta área",$(this).parent().find("span").text(o)}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("processo/importar/",{arquivo_processo:r.file_importacao_processo[0].files[0],categoria_processos_id:r.cbo_categoria_processos.val(),calendario_trabalho_id:r.cbo_calendario_trabalho.val(),documento_pasta_id:r.documento_pasta_id,envolvidos:JSON.stringify(r.envolvidos),anexos:JSON.stringify(r.anexos),consultas_integracao:JSON.stringify(r.consultas_integracao)},function(o){alert_saved(o.nome+" importado com sucesso"),r.unload()},null,null,!0)})}});