define([],function(){return function(o){"use strict";var t=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.title="Grupo de motivos",this.grafico_grupo_motivo=this.dialog.find(".grafico_grupo_motivo"),this.grafico_por_motivo=this.dialog.find(".grafico_por_motivo"),this.grafico_remanescentes=this.dialog.find(".grafico_remanescentes"),this.grafico_no_prazo=this.dialog.find(".grafico_no_prazo"),this.grafico_fora_do_prazo=this.dialog.find(".grafico_fora_do_prazo"),this.grafico_em_andamento=this.dialog.find(".grafico_em_andamento"),this.grafico_encerrados_por_responsavel=this.dialog.find(".grafico_encerrados_por_responsavel"),this.grafico_interagidos_no_periodo=this.dialog.find(".grafico_interagidos_no_periodo"),this.edt_data_inicio=this.dialog.find(".edt_data_inicio"),this.edt_data_fim=this.dialog.find(".edt_data_fim"),this.btn_filtrar=this.dialog.find(".btn_filtrar"),this.btn_add_filtro=this.dialog.find(".btn_add_filtro"),this.div_filtros=this.dialog.find(".div_filtros"),this.cbo_status=this.dialog.find(".cbo_status"),this.cbo_grupo_motivo=this.dialog.find(".cbo_grupo_motivo"),this.cbo_motivo=this.dialog.find(".cbo_motivo"),this.cbo_empresas=this.dialog.find(".cbo_empresas"),this.total_chamados=this.dialog.find(".total_chamados"),this.chamados_sla=this.dialog.find(".chamados_sla"),this.chamados_atendidos=this.dialog.find(".chamados_atendidos"),this.total_atendidos=0,this.show=function(){t.atualiza_select(),t.listar_grupo_motivo(),t.listar_empresas(),set_datepicker(t.edt_data_inicio),set_datepicker(t.edt_data_fim),t.cbo_status.selectpicker("selectAll");var o=new Date,e=o.getFullYear(),a=("0"+(o.getMonth()+1)).slice(-2),i=new Date(e,a,1),r=new Date(e,a,0),n=e+"-"+a+"-"+("0"+i.getDate()).slice(-2),s=e+"-"+a+"-"+("0"+r.getDate()).slice(-2);setTimeout(function(){set_datepicker(t.edt_data_inicio,n),set_datepicker(t.edt_data_fim,s)},150)},this.render_graficos=function(){WS.get("chamado/grafico_grupo_motivo/",{data_inicio:get_datepicker(t.edt_data_inicio),data_fim:get_datepicker(t.edt_data_fim),ids_grupo_motivo:t.cbo_grupo_motivo.val(),ids_motivo:t.cbo_motivo.val(),ids_empresas:t.cbo_empresas.val(),status:t.cbo_status.val()},function(o){t.total_atendidos=0,$.each(o.grafico_no_prazo,function(o,e){t.total_atendidos+=parseFloat(e.qtd)}),$.each(o.grafico_fora_do_prazo,function(o,e){t.total_atendidos+=parseFloat(e.qtd)});var e=void 0!==o.grafico_fora_do_prazo?o.grafico_fora_do_prazo.map(function(o){return+o.qtd}).reduce(function(o,t){return t+o},0):0,a=void 0!==o.grafico_no_prazo?o.grafico_no_prazo.map(function(o){return+o.qtd}).reduce(function(o,t){return t+o},0):0,i=[{descricao:"Encerrados no prazo",qtd:a},{descricao:"Encerrados fora do prazo",qtd:e},{descricao:"Remanescentes",qtd:void 0!==o.grafico_remanescentes?o.grafico_remanescentes.map(function(o){return+o.qtd}).reduce(function(o,t){return t+o},0):0}];t.render_grafico_grupo_motivo(i,e,a),t.render_grafico_remanescentes(o.grafico_remanescentes),t.render_grafico_no_prazo(o.grafico_no_prazo),t.render_grafico_fora_do_prazo(o.grafico_fora_do_prazo),t.render_grafico_em_andamento(o.grafico_em_andamento),t.render_grafico_encerrados_por_responsavel(o.grafico_encerrados_por_responsavel),t.render_grafico_interagidos_no_periodo(o.grafico_interagidos_no_periodo),t.total_chamados.html(o.total_abertos_no_periodo)})},this.render_grafico_grupo_motivo=function(o,e,a){var i=parseInt(a)/(parseInt(a)+parseInt(e))*100;t.chamados_atendidos.removeClass("hidden"),t.chamados_sla.html(i.toFixed(2)+"%"),e<=0&&t.chamados_atendidos.addClass("hidden");var r,n=[];$.each(o,function(o,t){n.push([t.descricao,parseFloat(t.qtd)])}),r=[{colorByPoint:!0,data:n}],t.grafico_grupo_motivo.highcharts(t.gera_obj_grafico("Status",null,r))},this.render_grafico_remanescentes=function(o){var e,a=[],i=[];$.each(o,function(o,t){i.push(t.cor),a.push([t.descricao,parseFloat(t.qtd)])}),e=[{colorByPoint:!0,data:a}],t.grafico_remanescentes.highcharts(t.gera_obj_grafico("Remanescentes",i,e))},this.render_grafico_no_prazo=function(o){var e,a=[],i=[];$.each(o,function(o,t){a.push(t.cor),i.push([t.descricao,parseFloat(t.qtd)])}),e=[{colorByPoint:!0,data:i}],t.grafico_no_prazo.highcharts(t.gera_obj_grafico("Encerrados no prazo",a,e))},this.render_grafico_fora_do_prazo=function(o){var e,a=[],i=[];$.each(o,function(o,t){a.push(t.cor),i.push([t.descricao,parseFloat(t.qtd)])}),e=[{colorByPoint:!0,data:i}],t.grafico_fora_do_prazo.highcharts(t.gera_obj_grafico("Encerrados fora do prazo",a,e))},this.render_grafico_em_andamento=function(o){var e,a=[],i=[];$.each(o,function(o,t){a.push(t.cor),i.push([t.descricao,parseFloat(t.qtd)])}),e=[{colorByPoint:!0,data:i}],t.grafico_em_andamento.highcharts(t.gera_obj_grafico("Em andamento",a,e))},this.render_grafico_encerrados_por_responsavel=function(o){var e=[],a=[],i=[],r=[];$.each(o,function(o,t){e.push(t.nome_usuario),a.push(parseInt(t.qtd_encerrados)),i.push(parseInt(t.qtd_interagidos))}),r.push({name:"Encerrados",data:a}),r.push({name:"Em aberto",data:i}),t.grafico_encerrados_por_responsavel.highcharts(t.gera_obj_grafico_encerrados_x_responsavel_interagidos("Chamados interagidos por responsável no período",e,r))},this.render_grafico_interagidos_no_periodo=function(o){var e,a=[],i=[];$.each(o,function(o,t){a.push(t.cor),i.push([t.descricao,parseFloat(t.qtd)])}),e=[{colorByPoint:!0,data:i}],t.grafico_interagidos_no_periodo.highcharts(t.gera_obj_grafico("Interagidos no período",a,e))},this.gera_obj_grafico=function(o,t,e){return{chart:{type:"column"},exporting:{enabled:!1},colors:t||{},title:{text:o},subtitle:{text:""},xAxis:{type:"category"},yAxis:[{title:{text:"Total"},labels:{enabled:!1}}],plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,formatter:function(){return this.y}}}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{enabled:!1},series:e}},this.gera_obj_grafico_encerrados_x_responsavel_interagidos=function(o,t,e){return{chart:{type:"column"},exporting:{enabled:!1},colors:["#ff6666","#434348"],title:{text:o},subtitle:{text:""},xAxis:{categories:t},yAxis:[{title:{text:"Total"},labels:{enabled:!1}}],plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,formatter:function(){return this.y}}}},credits:{enabled:!1},legend:{enabled:!0},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',shared:!0},series:e}},this.listar_grupo_motivo=function(o){WS.get("grupo_motivo_chamado/listar/",null,function(o){for(var e=0;e<o.length;e++){var a=o[e];add_option(t.cbo_grupo_motivo,a.grupo_id,a.nome)}t.cbo_grupo_motivo.selectpicker({countSelectedText:function(o,t){return o+" grupos de motivo selecionados"}}),t.cbo_grupo_motivo.selectpicker("refresh"),t.cbo_grupo_motivo.selectpicker("selectAll")})},t.cbo_grupo_motivo.change(function(o){var e=$(this).val();e.length>0&&(t.cbo_motivo.find("option").remove(),t.cbo_motivo.selectpicker("refresh"),t.listar_motivo(null,e))}),this.listar_motivo=function(o,e){WS.get("chamado_motivo/listar/",{grupo_motivo_id:e},function(o){$.each(o,function(o,e){add_option(t.cbo_motivo,e.id,e.nome)}),t.cbo_motivo.selectpicker({countSelectedText:function(o,t){return o+" motivos selecionados"}}),t.cbo_motivo.selectpicker("refresh")})},this.listar_empresas=function(o){WS.get("empresa/listar/",null,function(o){$.each(o,function(o,e){add_option(t.cbo_empresas,e.empresa_id,e.nome_fantasia)}),t.cbo_motivo.selectpicker({countSelectedText:function(o,t){return o+" empresas selecionadas"}}),t.cbo_empresas.selectpicker("refresh")})},this.btn_filtrar.unbind("click"),this.btn_filtrar.click(function(o){""!=t.edt_data_inicio.val()&&""!=t.edt_data_fim.val()?t.render_graficos():alert_modal("Relatório","Digite um período válido")}),this.atualiza_select=function(){t.cbo_status.selectpicker({countSelectedText:function(o,t){return o+" status selecionados"}}),t.cbo_status.selectpicker("refresh")},this.unload=function(){View.unload(this.html_id)}}});