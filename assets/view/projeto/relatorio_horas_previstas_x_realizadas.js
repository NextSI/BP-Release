define([],function(){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="RelatÃ³rio de Horas Previstas X Realizadas",this.div_relatorios=this.dialog.find(".div_relatorios"),this.div_template=this.dialog.find(".div_template"),this.btn_parametros=this.dialog.find(".btn_parametros"),this.btn_pdf=this.dialog.find(".btn_pdf"),this.btn_excel=this.dialog.find(".btn_excel"),this.valor_hora=this.dialog.find(".valor_hora"),this.valor_previsto=this.dialog.find(".valor_previsto"),this.valor_trabalhado=this.dialog.find(".valor_trabalhado"),this.texto_template=this.dialog.find(".texto_template"),this.tfoot=this.dialog.find(".tab_foot"),this.cliente_id=null,this.cliente_nome=null,this.projeto_id=null,this.tipo=null,this.usuario_id=null,this.inicio=null,this.fim=null,this.inicio_prazo=null,this.fim_prazo=null,this.inicio_apontamento=null,this.fim_apontamento=null,this.mostrar_projeto=null,this.mostrar_valores=null,this.exibir_atividades_sem_apontamentos=null,this.visualizar_totais_parciais=!1,this.total_parcial_projeto=null,this.arr_horas_trabalhadas_apontamento=[],this.arr=[],this.div_rows=this.dialog.find(".tab_body"),App.temp.relatorio_horas_previstas_x_realizadas||(App.temp.relatorio_horas_previstas_x_realizadas={},App.temp.relatorio_horas_previstas_x_realizadas.cliente_id="",App.temp.relatorio_horas_previstas_x_realizadas.cliente_nome="",App.temp.relatorio_horas_previstas_x_realizadas.projeto_id="",App.temp.relatorio_horas_previstas_x_realizadas.usuario_id="",App.temp.relatorio_horas_previstas_x_realizadas.tipo="",App.temp.relatorio_horas_previstas_x_realizadas.mostrar_projeto="",App.temp.relatorio_horas_previstas_x_realizadas.mostrar_valores="",App.temp.relatorio_horas_previstas_x_realizadas.exibir_atividades_sem_apontamentos="",App.temp.relatorio_horas_previstas_x_realizadas.visualizar_totais_parciais="",App.temp.relatorio_horas_previstas_x_realizadas.inicio="",App.temp.relatorio_horas_previstas_x_realizadas.fim="",App.temp.relatorio_horas_previstas_x_realizadas.inicio_prazo="",App.temp.relatorio_horas_previstas_x_realizadas.fim_prazo="",App.temp.relatorio_horas_previstas_x_realizadas.inicio_apontamento="",App.temp.relatorio_horas_previstas_x_realizadas.fim_apontamento=""),this.show=function(){t.btn_parametros.trigger("click")},this.format_horas=function(a){try{if(null!=a||""!=a){if(a.toString().indexOf("-")>-1){if((a=(a=a.toString().replace("-","")).trim()).length>6){for(var t=9-(i=a).length,o=0;o<t;o++)i="-0"+i;return i.substring(0,7)}if(a.length>4){for(t=6-(i=a).length,o=0;o<t;o++)i="-0"+i;return i.substring(0,7)}return"000:00"}if(a.length>6){for(t=9-(i=a).length,o=0;o<t;o++)i="0"+i;return i.substring(0,6)}if(a.length>4){var i;for(t=6-(i=a).length,o=0;o<t;o++)i="0"+i;return i.substring(0,6)}return"000:00"}return"000:00"}catch(a){}},this.listar=function(a){var o=t.div_template.clone(),i=[],e=o.find(".tab_cabecalho"),r=o.find(".tab_body"),_=(o.find(".tab_foot").find("tfoot"),r.find("tbody")),s=_.find("[template-row='row_apontamento']"),l=_.find("[template-row='row_atividade']"),p=$(e.find("[template-field='cliente_nome']")),d=$(e.find("[template-field='projeto_nome']")),n=$(e.find("[template-field='total_horas_projeto']")),m=$(e.find("[template-field='total_horas_trabalhadas']")),h=$(e.find("[template-field='total_horas_geral']")),v=$(e.find("[template-field='total_valor_previsto']")),f=$(e.find("[template-field='total_valor_trabalhado']")),c=$(e.find("[template-field='saldo_valor_geral']"));t.total_parcial_projeto=null,0==t.mostrar_valores?($(e.find(".valor_hora")).hide(),$(e.find(".valor_previsto")).hide(),$(e.find(".valor_trabalhado")).hide(),$(e.find(".valor_trabalhado_total")).hide()):($(e.find(".valor_hora")).show(),$(e.find(".valor_previsto")).show(),$(e.find(".valor_trabalhado")).show(),$(e.find(".valor_trabalhado_total")).show()),null!=a.cliente_nome&&""!=a.cliente_nome&&p.append(a.cliente_nome?a.cliente_nome:"-"),null!=a.projeto_nome&&""!=a.projeto_nome&&d.append(a.projeto_nome?a.projeto_nome:"-"),null!=a.projeto_horas_previstas&&""!=a.projeto_horas_previstas&&n.append(t.format_horas(a.projeto_horas_previstas)),null!=a.projeto_horas_trabalhadas&&""!=a.projeto_horas_trabalhadas&&m.append(t.format_horas(a.projeto_horas_trabalhadas)),null!=a.projeto_saldo_horas&&""!=a.projeto_saldo_horas&&h.append(a.projeto_saldo_horas),null!=a.projeto_valor_previsto&&""!=a.projeto_valor_previsto&&v.append("R$"+(null!=a.projeto_valor_previsto?a.projeto_valor_previsto.format_number(2,!0):"0,00")),null!=a.projeto_valor_trabalhado&&""!=a.projeto_valor_trabalhado&&f.append("R$"+(null!=a.projeto_valor_trabalhado?a.projeto_valor_trabalhado.format_number(2,!0):"0,00"));var u=null;u=a.projeto_valor_previsto-a.projeto_valor_trabalhado,c.append(null==u||isNaN(u)?"":"R$"+u.format_number(2,!0));var x=function(a,o){var e=s.clone();e.removeAttr("template-row"),e.css("display",""),i.push(o.horas_trabalhadas),$(e.find("[template-field='apontamento']")).text(o.apontamento?o.apontamento.format_date_time():"-"),$(e.find("[template-field='tecnico']")).text(o.tecnico?o.tecnico:"-"),$(e.find("[template-field='responsavel']")).text(o.responsavel?o.responsavel:"-");var l=$(e.find("[template-field='descricao_atividade']"));l.tooltip({title:null!=o.atividade_simplificada?o.atividade_simplificada:l.hide(),placement:"auto"}),l.tooltip();var p=$(e.find("[template-field='descricao']"));p.tooltip({title:null!=o.descricao?o.descricao:p.hide(),placement:"auto"}),p.tooltip(),$(e.find("[template-field='horas_previstas']")).text(t.format_horas(o.horas_previstas)),$(e.find("[template-field='horas_trabalhadas']")).text(t.format_horas(o.horas_trabalhadas)),$(e.find("[template-field='horas_traslado']")).text(t.format_horas(o.horas_traslado)),$(e.find("[template-field='horas_totais']")).text(t.format_horas(o.horas_totais)),$(e.find("[template-field='valor_hora']")).text("R$"+(null!=o.valor_hora?o.valor_hora.format_number(2,!0):"0,00")),$(e.find("[template-field='valor_previsto']")).text("R$"+(null!=o.valor_previsto?o.valor_previsto.format_number(2,!0):"0,00")),$(e.find("[template-field='valor_trabalhado']")).text("R$"+(null!=o.apontamento_projeto_atividade_valor_trabalhado?o.apontamento_projeto_atividade_valor_trabalhado.format_number(2,!0):"0,00"));var d=$(e.find("[template-field='data_solicitacao']"));null!=o.data_solicitacao?d.text(o.data_solicitacao.format_date_time()):d.text("-");var n=$(e.find("[template-field='data_inicio']"));null!=o.inicio?n.text(o.inicio.format_date_time()):n.text("-");var m,h,v=$(e.find("[template-field='data_prazo']"));null!=o.prazo?v.text(o.prazo.format_date_time()):v.text("-"),0==t.mostrar_projeto?((m=$(e.find("[template-projeto]"))).css("display","none"),m.prev().attr("colspan",3),$(e.find("[template-type]")).addClass("hidden"),(h=$(r.find("[template-projeto]"))).css("display","none"),h.next().attr("colspan",3),$(r.find("[template-type]")).addClass("hidden")):((m=$(e.find("[template-projeto]"))).show(),m.next().attr("colspan",3),$(e.find("[template-type]")).removeClass("hidden"),(h=$(r.find("[template-projeto]"))).show(),h.next().attr("colspan",3),$(r.find("[template-type]")).removeClass("hidden")),e.appendTo(_)};t.arr_horas_trabalhadas_apontamento.push(i),parseInt($(a.atividades).length),$(a.atividades).each(function(a,o){!function(a,o){var i=l.clone();i.removeAttr("template-row"),i.css("display",""),$(i.find("[template-field='atividade_nome']")).text(o.projeto_atividade_simplificada),$(i.find("[template-field='horas_previstas_atividade']")).text(t.format_horas(o.projeto_atividade_horas_previstas)),$(i.find("[template-field='saldo_horas_atividade']")).text(o.projeto_atividade_saldo_horas),$(i.find("[template-field='valor_previsto_atividade']")).text("R$"+(null!=o.projeto_atividade_valor_previsto?o.projeto_atividade_valor_previsto.format_number(2,!0):"0,00")),$(i.find("[template-field='saldo_valor_atividade']")).append("R$"+(o.projeto_atividade_valor_previsto-o.projeto_atividade_valor_trabalhado).format_number(2,!0)),i.appendTo(_),$(t.texto_template.clone()).css("display","").appendTo(_);var e=null,r=null,s=null,p=null;if($(o.apontamentos).each(function(a,t){x(a,t),e=null==e?t.horas_trabalhadas:somar_horas(t.horas_trabalhadas,e),r=null==r?t.horas_traslado:somar_horas(t.horas_traslado,r),s=null==s?t.horas_totais:somar_horas(t.horas_totais,s),null!=t.projeto_atividade_valor_trabalhado&&(null==p?p=parseFloat(t.projeto_atividade_valor_trabalhado):p+=parseFloat(t.projeto_atividade_valor_trabalhado))}),1==t.visualizar_totais_parciais){null==t.total_parcial_projeto?t.total_parcial_projeto=e:t.total_parcial_projeto=somar_horas(t.total_parcial_projeto,e),$(i.find("[template-field='horas_trabalhadas_atividade']")).text(t.format_horas(e));var d=$(i.find("[template-field='valor_trabalhado_atividade']"));null==p?d.text("R$0,00"):d.text("R$"+o.projeto_atividade_valor_trabalhado.format_number(2,!0))}else t.total_parcial_projeto=somar_horas(t.total_parcial_projeto,e),$(i.find("[template-field='horas_trabalhadas_atividade']")).text(t.format_horas(o.projeto_atividade_horas_trabalhadas)),(d=$(i.find("[template-field='valor_trabalhado_atividade']"))).text("R$"+(null!=o.projeto_atividade_valor_trabalhado?o.projeto_atividade_valor_trabalhado.format_number(2,!0):"0,00"));var n=$(t.tfoot.clone());n.css("display",""),$(n.find("[template-field='horas_trabalhadas_total']")).text(t.format_horas(e)),$(n.find("[template-field='horas_traslado_total']")).text(t.format_horas(r)),$(n.find("[template-field='horas_totais_total']")).text(t.format_horas(s));var m=$(n.find("[template-field='valor_trabalhado_total']"));null==o.projeto_atividade_valor_trabalhado?m.text("R$0,00"):m.text("R$"+o.projeto_atividade_valor_trabalhado.format_number(2,!0)),n.appendTo(_)}(0,o)}),0==a.length&&x(a),o.css("display",""),o.appendTo(t.div_relatorios)},this.carrega_projetos=function(){t.arr_horas_trabalhadas_apontamento=[],WS.get("projeto/relatorio_horas_previstas_x_realizadas/",{cliente_id:JSON.stringify(t.cliente_id),projeto_id:JSON.stringify(t.projeto_id),usuario_id:JSON.stringify(t.usuario_id),tipo:t.tipo,mostrar_projeto:t.mostrar_projeto,mostrar_valores:t.mostrar_valores,exibir_atividades_sem_apontamentos:t.exibir_atividades_sem_apontamentos,visualizar_totais_parciais:t.visualizar_totais_parciais,inicio:t.inicio,fim:t.fim,inicio_prazo:t.inicio_prazo,fim_prazo:t.fim_prazo,inicio_apontamento:t.inicio_apontamento,fim_apontamento:t.fim_apontamento},function(a){if(0==t.mostrar_valores?($(t.div_template.find(".valor_hora")).hide(),$(t.div_template.find(".valor_previsto")).hide(),$(t.div_template.find(".valor_trabalhado")).hide(),$(t.div_template.find(".valor_trabalhado_total")).hide()):($(t.div_template.find(".valor_hora")).show(),$(t.div_template.find(".valor_previsto")).show(),$(t.div_template.find(".valor_trabalhado")).show(),$(t.div_template.find(".valor_trabalhado_total")).show()),a.length>0)for(var o=0;o<a.length;o++){var i=a[o];t.listar(i)}else i=a,t.listar({cliente:"Nenhum cliente",apontamentos:[{descricao:"Nenhum apontamento",horas_previstas:"000:00",horas_trabalhadas:"000:00",nome_fantasia:"",projeto:"",tecnico:""}]})})},this.unload=function(){View.unload(this.html_id)},this.btn_parametros.unbind("click"),this.btn_parametros.click(function(){View.load("projeto/parametros_relatorios_horas_previstas",function(a,o){t.div_relatorios.find("br").remove(),t.div_relatorios.find(".div_template").remove(),o.show(function(a){t.cliente_id=a.cliente_id,t.cliente_nome=a.cliente_nome,t.projeto_id=a.projeto_id,t.usuario_id=null==a.usuario_id?App.sessao.usuario_id:a.usuario_id,t.tipo=a.tipo,t.mostrar_projeto=a.mostrar_projeto,t.mostrar_valores=a.mostrar_valores,t.exibir_atividades_sem_apontamentos=a.exibir_atividades_sem_apontamentos,t.visualizar_totais_parciais=a.visualizar_totais_parciais,t.inicio=a.inicio,t.fim=a.fim,t.inicio_prazo=a.inicio_prazo,t.fim_prazo=a.fim_prazo,t.inicio_apontamento=a.inicio_apontamento,t.fim_apontamento=a.fim_apontamento,App.temp.relatorio_horas_previstas_x_realizadas.cliente_id=t.cliente_id,App.temp.relatorio_horas_previstas_x_realizadas.cliente_nome=t.cliente_nome,App.temp.relatorio_horas_previstas_x_realizadas.projeto_id=t.projeto_id,App.temp.relatorio_horas_previstas_x_realizadas.usuario_id=t.usuario_id,App.temp.relatorio_horas_previstas_x_realizadas.tipo=t.tipo,App.temp.relatorio_horas_previstas_x_realizadas.mostrar_projeto=t.mostrar_projeto,App.temp.relatorio_horas_previstas_x_realizadas.mostrar_valores=t.mostrar_valores,App.temp.relatorio_horas_previstas_x_realizadas.exibir_atividades_sem_apontamentos=t.exibir_atividades_sem_apontamentos,App.temp.relatorio_horas_previstas_x_realizadas.visualizar_totais_parciais=t.visualizar_totais_parciais,App.temp.relatorio_horas_previstas_x_realizadas.inicio=t.inicio,App.temp.relatorio_horas_previstas_x_realizadas.fim=t.fim,App.temp.relatorio_horas_previstas_x_realizadas.inicio_prazo=t.inicio_prazo,App.temp.relatorio_horas_previstas_x_realizadas.fim_prazo=t.fim_prazo,App.temp.relatorio_horas_previstas_x_realizadas.inicio_apontamento=t.inicio_apontamento,App.temp.relatorio_horas_previstas_x_realizadas.fim_apontamento=t.fim_apontamento,t.carrega_projetos()},App.temp.relatorio_horas_previstas_x_realizadas.cliente_id,App.temp.relatorio_horas_previstas_x_realizadas.cliente_nome,App.temp.relatorio_horas_previstas_x_realizadas.projeto_id,App.temp.relatorio_horas_previstas_x_realizadas.usuario_id,App.temp.relatorio_horas_previstas_x_realizadas.tipo,App.temp.relatorio_horas_previstas_x_realizadas.mostrar_projeto,App.temp.relatorio_horas_previstas_x_realizadas.mostrar_valores,App.temp.relatorio_horas_previstas_x_realizadas.exibir_atividades_sem_apontamentos,App.temp.relatorio_horas_previstas_x_realizadas.visualizar_totais_parciais,App.temp.relatorio_horas_previstas_x_realizadas.inicio,App.temp.relatorio_horas_previstas_x_realizadas.fim,App.temp.relatorio_horas_previstas_x_realizadas.inicio_prazo,App.temp.relatorio_horas_previstas_x_realizadas.fim_prazo,App.temp.relatorio_horas_previstas_x_realizadas.inicio_apontamento,App.temp.relatorio_horas_previstas_x_realizadas.fim_apontamento)})}),this.btn_excel.unbind("click"),this.btn_excel.click(function(){App.obter_token_publico(function(a){App.download(WS_URI+"projeto/gera_excel_relatorio/?cliente_id="+JSON.stringify(t.cliente_id)+"&projeto_id="+JSON.stringify(t.projeto_id)+"&usuario_id="+JSON.stringify(t.usuario_id)+"&tipo="+t.tipo+"&mostrar_projeto="+t.mostrar_projeto+"&mostrar_valores="+t.mostrar_valores+"&exibir_atividades_sem_apontamentos="+t.exibir_atividades_sem_apontamentos+"&visualizar_totais_parciais="+t.visualizar_totais_parciais+"&inicio="+t.inicio+"&fim="+t.fim+"&inicio_prazo="+t.inicio_prazo+"&fim_prazo="+t.fim_prazo+"&inicio_apontamento="+t.inicio_apontamento+"&fim_apontamento="+t.fim_apontamento+"&token_publico="+a)})}),this.show()}});