define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.edt_nome=this.dialog.find(".edt_nome"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_aprovar_gerar_chamado=this.dialog.find(".btn_aprovar_gerar_chamado"),this.edt_data_avaliacao_carta=this.dialog.find(".edt_data_avaliacao_carta"),this.tab_listagem_historico_avaliacao=this.dialog.find(".tab_listagem_historico_avaliacao"),this.edt_responsavel=this.dialog.find(".edt_responsavel"),this.cbo_situacao=this.dialog.find(".cbo_situacao"),this.edt_obervacao_avaliacao=this.dialog.find(".edt_obervacao_avaliacao"),this.div_avaliacao=this.dialog.find(".div_avaliacao"),this.possibilidade_id=null,this.situacao=null,this.carta_inovacao_id=0,this.possibilidade_id=0,this.nome_responsavel="",this.aprovar_gerar_chamado=!1,this.show=function(a,o,t,s,d){var _=getDateNow(!0);set_datepicker(i.edt_data_avaliacao_carta,_),(App.sessao.dados.admin||"S"==App.sessao.dados.supervisor_inovacao)&&i.btn_aprovar_gerar_chamado.removeClass("hidden"),i.usuario_id=o,i.carta_inovacao_id=a,i.nome_responsavel=t,i.edt_responsavel.val(t).prop("disabled",!0),i.possibilidade_id=s,i.preencher(),d!=CARTA_INOVACAO_SITUACAO.AGUARDANDO_AVALIACAO&&d!=CARTA_INOVACAO_SITUACAO.STANDBY||i.div_avaliacao.removeClass("hidden"),d!=CARTA_INOVACAO_SITUACAO.APROVADA&&d!=CARTA_INOVACAO_SITUACAO.REPROVADA||(i.div_avaliacao.removeClass("hidden"),i.btn_salvar.addClass("hidden"),i.div_avaliacao.html("Histórico"),i.btn_aprovar_gerar_chamado.addClass("hidden")),show_modal(i.modal.attr("id"))},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.permite_alterar=function(a){i.edt_nome.prop("readonly",!a)},this.preencher=function(){WS.get("carta_inovacao_avaliacao/listar/",{carta_inovacao_id:i.carta_inovacao_id},function(a){for(var o=0;o<$(a).length;o++)void 0!==a[o]&&null!=a[o].id&&(a[o].situacao==CARTA_INOVACAO_SITUACAO.NAO_INICIADA?a[o].situacao="Não Iniciada":a[o].situacao==CARTA_INOVACAO_SITUACAO.RASCUNHO?a[o].situacao="Rascunho":a[o].situacao==CARTA_INOVACAO_SITUACAO.AGUARDANDO_AVALIACAO?a[o].situacao="Aguardando Avaliação":a[o].situacao==CARTA_INOVACAO_SITUACAO.REPROVADA?(a[o].situacao="Não aprovada",i.permite_alterar(!1)):a[o].situacao==CARTA_INOVACAO_SITUACAO.STANDBY?(a[o].situacao="Standby",i.permite_alterar(!1)):a[o].situacao==CARTA_INOVACAO_SITUACAO.APROVADA&&(a[o].situacao="Em Execução"),i.add_row_avaliacao(a[o]))})},this.add_row_avaliacao=function(a){var o=i.tab_listagem_historico_avaliacao.find("tbody"),t=o.find("tr:first").clone();t.removeAttr("template-row"),t.css("display","");var s=$(t.find('[template-field="data_avaliacao"]')),d=$(t.find('[template-field="situacao"]')),_=$(t.find('[template-field="observacao"]'));s.text(""!=a.data_avaliacao&&null!=a.data_avaliacao?a.data_avaliacao.format_date():""),d.text(a.situacao),_.text(a.observacao),t.appendTo(o)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),i.btn_salvar.unbind("click"),i.btn_salvar.click(function(a){"S"!=App.sessao.dados.supervisor_inovacao&&1!=App.sessao.dados.admin||(i.cbo_situacao.val()==CARTA_INOVACAO_SITUACAO.REPROVADA?i.situacao=CARTA_INOVACAO_SITUACAO.REPROVADA:i.cbo_situacao.val()==CARTA_INOVACAO_SITUACAO.APROVADA&&(i.situacao=CARTA_INOVACAO_SITUACAO.APROVADA)),i.salva_aprovacao()}),i.cbo_situacao.change(function(a){if(App.sessao.dados.admin||"S"==App.sessao.dados.supervisor_inovacao){var o=$(a.currentTarget).val();o==CARTA_INOVACAO_SITUACAO.STANDBY||o==CARTA_INOVACAO_SITUACAO.REPROVADA?i.btn_aprovar_gerar_chamado.addClass("hidden"):i.btn_aprovar_gerar_chamado.removeClass("hidden")}}),i.btn_aprovar_gerar_chamado.unbind("click"),i.btn_aprovar_gerar_chamado.click(function(a){i.aprovar_gerar_chamado=!0,i.salva_aprovacao()}),this.salva_aprovacao=function(){i.btn_salvar.prop("disabled",!0),i.btn_cancelar.prop("disabled",!0),WS.post("carta_inovacao_avaliacao/salvar",{carta_inovacao_id:i.carta_inovacao_id,responsavel_id:i.usuario_id,possibilidade_id:i.possibilidade_id,situacao:i.cbo_situacao.val(),data_avaliacao:get_datepicker(i.edt_data_avaliacao_carta),observacao:i.edt_obervacao_avaliacao.val(),aprovar_gerar_chamado:i.aprovar_gerar_chamado},function(a){alert_saved("Carta salva com sucesso!"),i.onsave(),i.unload()})}}});