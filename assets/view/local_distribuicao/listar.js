define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title="Locais de Distribuição",this.dx_listagem_local_distribuicao=this.dialog.find(".dx_listagem_local_distribuicao"),this.clearState=!1,this.show=function(){a.listar()},this.listar=function(){WS.get("local_distribuicao/listar/",null,function(i){a.preencher(i)})},this.preencher=function(i){var e=document.createElement("div");e.className="div_listagem_local_distribuicao",e.style="min-width: 100%;",a.dx_listagem_local_distribuicao.find(".div_listagem_local_distribuicao").remove(),a.dx_listagem_local_distribuicao[0].appendChild(e);var t=detectmob()?"select":"dragAndDrop",o=get_icon_class();a.dx_listagem_local_distribuicao.find(".div_listagem_local_distribuicao").css("height","calc(100vh - 42px)");var l=a.dx_listagem_local_distribuicao.find(".div_listagem_local_distribuicao").dxDataGrid({dataSource:i,keyExpr:"id",allowColumnReordering:!0,showBorders:!0,columnResizingMode:"widget",rowAlternationEnabled:!1,searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnChooser:{enabled:!0,allowSearch:!0,mode:t},stateStoring:{enabled:!0,type:"custom",customLoad:function(i){return App.get_parametro_usuario("local_distribuicao")},customSave:function(i){App.set_parametro_usuario("local_distribuicao",i)}},selection:{mode:"multiple"},export:{enabled:!0,fileName:"Relatório de locais de distribuicao "+agora(),allowExportSelectedData:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},groupPanel:{visible:!0},columnFixing:{enabled:!0},onToolbarPreparing:function(i){var e=[{widget:"dxButton",options:{icon:"fa fa-plus",hint:"Adicionar um local de distribuição",text:"Adicionar um local de distribuição",onClick:function(){l.addRow()}},location:"after",name:"BtnNovoRegistro",locateInMenu:"auto"},{widget:"dxButton",options:{icon:"fa fa-sync",hint:"Recarregar listagem de locais",text:"Recarregar listagem de locais",onClick:function(){a.listar()}},showText:"inMenu",location:"after",name:"BtnRefresh",locateInMenu:"auto"}];i.toolbarOptions.items=add_botao_dx_toolbar(e,i.toolbarOptions.items);for(var t=0;t<i.toolbarOptions.items.length;t++){var o=i.toolbarOptions.items[t];"saveButton"===o.name&&(o.options.onClick=function(i){WS.post("local_distribuicao/salvar_dx/",{data:CircularJSON.stringify(l.getController("editing").getChanges())},function(i){alert_tooltip(!0===i?"Todos os locais foram salvos":"Falha ao salvar os locais",!0===i?"success":"error"),!0===i&&a.listar()})})}},onContentReady:function(i){add_filtro_cor_tema(i),a.clearState&&(a.dx_listagem_local_distribuicao.find(".div_listagem_local_distribuicao").dxDataGrid("instance").state({}),a.clearState=!1)},focusedRowEnabled:!1,editing:{mode:"batch",allowUpdating:!0,useIcons:!0},columns:[{dataField:"nome",caption:"Nome do local"},{type:"buttons",buttons:[{hint:"Apagar registro",icon:"fa fa-trash",cssClass:o,visible:function(i){return!i.row.removed},onClick:function(i){l.deleteRow(i.row.rowIndex),i.event.preventDefault()}},{hint:"Recuperar registro",icon:"fa fa-undo",cssClass:o,visible:function(i){return i.row.removed},onClick:function(i){l.undeleteRow(i.row.rowIndex),i.event.preventDefault()}}]}],onContextMenuPreparing:function(i){"header"==i.target&&Array.isArray(i.items)&&i.items.push({text:"Restaurar estado das colunas",visible:!0,beginGroup:!0,onItemClick:function(i){DevExpress.ui.dialog.confirm("Os filtros, ordenações, agrupamentos, posição, tamanho, e visibilidade das colunas desta listagem serão restauradas ao estado padrão. <b>Deseja continuar?</b>","Restaurar estado das colunas").done(function(i){i&&(a.clearState=!0,a.listar())})}})}}).dxDataGrid("instance")},event_salvar(a.dialog,a.dx_listagem_local_distribuicao),event_desfazer(a.dialog,a.dx_listagem_local_distribuicao),this.unload=function(){View.unload(this.html_id)}}});