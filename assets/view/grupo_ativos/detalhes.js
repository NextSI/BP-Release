define(["react","react-dom","./../componentes_react/CboUsuarios"],function(a,i,o){return function(s){"use strict";var e=this;this.html_id=s,this.dialog=$("#"+this.html_id),this.title="Grupo de Ativos - Detalhes",this.onclose=null,this.params={grupo_ativos_id:null,tipo:FORMULARIO.NOVO},this.arr_responsaveis=[],this.arr_ativos=[],this.edt_nome=this.dialog.find(".edt_nome"),this.div_componente_usuario=this.dialog.find(".div_componente_usuario"),this.cboUsuarios=a.createElement(o,null,null),this.cbo_agenda_ativo=this.dialog.find(".cbo_agenda_ativo"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.tab_geral=this.dialog.find(".tab_geral"),this.tab_ativos=this.dialog.find(".tab_ativos"),this.tab_usuarios=this.dialog.find(".tab_usuarios"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_ativos=this.dialog.find(".menu_ativos"),this.menu_usuarios=this.dialog.find(".menu_usuarios"),this.aba_geral=this.dialog.find(".aba_geral"),this.aba_ativos=this.dialog.find(".aba_ativos"),this.aba_usuarios=this.dialog.find(".aba_usuarios"),this.tab_responsaveis=this.dialog.find(".tab_responsaveis"),this.tab_ativos=this.dialog.find(".tab_ativos"),this.show=function(a){switch(e.params=extender_parametros(e.params,a),e.inicializar_componentes(),e.params.tipo){case FORMULARIO.NOVO:e.btn_salvar.show(),e.btn_excluir.hide(),e.permite_alterar(!0),set_focus(e.edt_codigo);break;case FORMULARIO.EDITAR:e.btn_salvar.show(),e.btn_excluir.hide(),e.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:e.btn_salvar.hide(),e.btn_excluir.hide(),e.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:e.btn_salvar.hide(),e.btn_excluir.show(),e.permite_alterar(!1)}null!=e.params.grupo_ativos_id&&e.preencher()},this.preencher=function(){WS.get({route:"grupo_ativos/objeto/",data:{grupo_ativos_id:e.params.grupo_ativos_id},func_response:function(a){a&&(e.edt_nome.val(a.nome),e.arr_responsaveis=a.arr_responsaveis,e.arr_ativos=a.arr_ativos,e.render_ativos(),e.render_responsaveis())}})},this.permite_alterar=function(a){e.edt_nome.prop("readonly",!a),e.cbo_agenda_ativo.SelectMultiColumn("disabled",!a),e.cboUsuarios.props.setCampoUsuarioLeitura(!a)},this.close=function(){void 0!==e.onclose&&e.onclose&&e.onclose()},this.unload=function(){e.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){e.aba_geral.attr("id","aba_geral"+e.html_id),e.aba_ativos.attr("id","aba_ativos"+e.html_id),e.aba_usuarios.attr("id","aba_usuarios"+e.html_id),e.menu_geral.attr("href","#"+e.aba_geral.attr("id")),e.menu_ativos.attr("href","#"+e.aba_ativos.attr("id")),e.menu_usuarios.attr("href","#"+e.aba_usuarios.attr("id"));var a={route:"agenda_ativo/listar/",method:"GET",params:null,arr_cols:[App.lang.agenda_ativos.nome],arr_campos:["nome"],campo_value:"id",text_value:"nome",habilitar_limite:!0,OnKeyUp:function(a,i){var o={nome:e.cbo_agenda_ativo.SelectMultiColumn("EdtVal")};if(e.cbo_agenda_ativo.SelectMultiColumn("UpdateParams",o),a.which==KEYPRESS_PADRAO.ENTER){var s=e.cbo_agenda_ativo.SelectMultiColumn("dados_selecionado");console.log(s),null==s||$(e.arr_ativos).in_array(s.id.toString(),"id")||(e.arr_ativos.push(s),e.cbo_agenda_ativo.SelectMultiColumn("clean"),e.render_ativos())}},OnClickOverRow:function(a,i,o){null==o||$(e.arr_ativos).in_array(o.id.toString(),"id")||(e.arr_ativos.push(o),e.cbo_agenda_ativo.SelectMultiColumn("clean"),e.render_ativos())}};$(e.cbo_agenda_ativo).SelectMultiColumn(a),i.render(e.cboUsuarios,e.div_componente_usuario[0]),e.cboUsuarios.props.setObjParam({EquipeInterna:!0,EmpresaId:App.temp.empresa,ExibirGrupos:!0}),e.cboUsuarios.props.setFunctionSelect(e.ao_selecionar_responsavel)},this.ao_selecionar_responsavel=function(){var a={},i=!1;$(e.arr_responsaveis).each(function(a,o){o.usuario_id===e.cboUsuarios.props.UsuarioSelecionado.id&&"usuarios"==e.cboUsuarios.props.UsuarioSelecionado.tipo?i=!0:o.grupo_usuarios_id===e.cboUsuarios.props.UsuarioSelecionado.id&&"grupo_usuarios"==e.cboUsuarios.props.UsuarioSelecionado.tipo&&(i=!0)}),!i&&e.cboUsuarios.props.UsuarioSelecionado.id>0&&(a.tipo=e.cboUsuarios.props.UsuarioSelecionado.tipo,a.nome=e.cboUsuarios.props.UsuarioSelecionado.nome,a.manutencao="N","usuarios"==e.cboUsuarios.props.UsuarioSelecionado.tipo?a.usuario_id=e.cboUsuarios.props.UsuarioSelecionado.id:"grupo_usuarios"==e.cboUsuarios.props.UsuarioSelecionado.tipo&&(a.grupo_usuarios_id=e.cboUsuarios.props.UsuarioSelecionado.id),e.arr_responsaveis.push(a),e.render_responsaveis()),e.cboUsuarios.props.setUsuario({usuario_id:null,usuario_nome:""})},this.render_ativos=function(){var a=e.tab_ativos.find("tbody"),i=a.find("tr:first");e.tab_ativos.find("tr:gt(1)").remove(),$(e.arr_ativos).each(function(o,s){!function(o){o=extender_parametros({codigo:"-",nome:"-"},o);var s=i.clone();s.removeAttr("template_row"),s.css("display",""),$(s).find('[template-field="nome"]').text(o.nome),$(s).find('[template-field="codigo"]').text(o.codigo);var r=$(s).find(".btn_ativo_remover");e.params.tipo!=FORMULARIO.EXCLUIR&&e.params.tipo!=FORMULARIO.VISUALIZAR?r.unbind("click").click(function(a){alert_modal("Aviso","Deseja remover o Ativo?","Remover",function(){$(e.arr_ativos).in_array(o.id,"id",function(a,i){e.arr_ativos.splice(a,1),e.render_ativos()})},!0)}):r.addClass("disabled"),s.appendTo(a)}(s)})},this.render_responsaveis=function(){var a=e.tab_responsaveis.find("tbody"),i=a.find("tr:first");a.find("tr:not([template-row])").remove(),$(e.arr_responsaveis).each(function(o,s){!function(o){var s=i.clone();s.removeAttr("template-row"),s.css("display","");var r=$(s.find("[template-field='tipo']"));"usuarios"==o.tipo?(r.addClass("label-info"),r.attr("title","Usuário"),r.attr("data-original-title","Usuário"),r.text("U")):"grupo_usuarios"==o.tipo&&(r.addClass("label-warning"),r.attr("title","Grupo de Usuários"),r.attr("data-original-title","Grupo de Usuários"),r.text("GU")),r.tooltip(),$(s.find("[template-field='nome']")).text(o.nome);var t=$(s.find("[template-field='manutencao']"));t.val(o.manutencao),t.change(function(){$(e.arr_responsaveis).each(function(a,i){("usuarios"==i.tipo&&i.usuario_id==o.usuario_id||"grupo_usuarios"==i.tipo&&i.grupo_usuarios_id==o.grupo_usuarios_id)&&(e.arr_responsaveis[a].manutencao=t.val())})});var n=$(s.find(".btn_usuario_remover"));e.params.tipo!=FORMULARIO.EXCLUIR&&e.params.tipo!=FORMULARIO.VISUALIZAR?(n.unbind("click"),n.click(function(){alert_modal("Aviso","Deseja remover o Responsável?","Remover",function(){$(e.arr_responsaveis).each(function(a,i){"usuarios"==i.tipo?i.usuario_id==o.usuario_id&&(s.remove(),e.arr_responsaveis.splice(a,1),e.render_responsaveis()):"grupo_usuarios"==i.tipo&&i.grupo_usuarios_id==o.grupo_usuarios_id&&(s.remove(),e.arr_responsaveis.splice(a,1),e.render_responsaveis())})},!0)})):n.addClass("disabled"),s.appendTo(a)}(s)}),App.aplicar_checkbox(a)},this.btn_salvar.unbind("click").click(function(a){var i={grupo_ativos_id:e.params.grupo_ativos_id,nome:e.edt_nome.val(),arr_responsaveis:JSON.stringify(e.arr_responsaveis),arr_ativos:JSON.stringify(e.arr_ativos)},o=extender_parametros({grupo_ativos_id:null,nome:null},i);WS.post({route:"grupo_ativos/salvar",data:o,type:"POST",func_response:function(a){a&&(alert_saved("Grupo Ativos "+o.nome+" salvo com sucesso"),e.unload())},disable_buttons:[e.btn_salvar,e.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(a){WS.post({route:"grupo_ativos/excluir",data:{grupo_ativos_id:e.params.grupo_ativos_id},type:"POST",func_response:function(a){a&&(alert_saved("Ativo "+e.edt_nome.val()+" excluido com sucesso"),e.unload())},disable_buttons:[e.btn_excluir,e.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(a){e.unload()})}});