define([],function(){return function(i){"use strict";var s=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.carrega_img=this.dialog.find(".carrega_img"),this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.div_mostar_mais_curtidas=this.dialog.find(".div_mostar_mais_curtidas"),this.btn_mostrar_mais_curtidas=this.dialog.find(".btn_mostrar_mais_curtidas"),this.titulo=this.dialog.find(".titulo"),this.modal_carregar_curtida=this.dialog.find(".modal_carregar_curtida"),this.usuario_id_param=null,this.arr_curtidas_usuario=null,this.arr_curtidas=[],this.usuario_seguindo=null,this.limite=0,this.quantidade=0,this.show=function(i,a){s.usuario_id_param=i,s.usuario_seguindo=a,show_modal(s.modal.attr("id")),s.listar()},this.listar=function(){1==s.usuario_seguindo?(console.log("oi"),s.titulo.text("Quem estou seguindo"),WS.get({route:"mural_mensagem/listar_seguindo/",data:{id_usuario_seguidor:s.usuario_id_param,limite:s.limite},func_response:function(i){i&&i.length>0&&(s.arr_curtidas=i,s.render_usuarios())}})):(s.titulo.text("Quem me segue"),WS.get({route:"mural_mensagem/listar_seguidores/",data:{id_usuario_seguindo:s.usuario_id_param,limite:s.limite},func_response:function(i){i&&(s.arr_curtidas=i,s.render_usuarios())}}))},this.close=function(){close_modal(s.modal.attr("id")),void 0!==s.onclose&&s.onclose&&s.onclose()},this.unload=function(){s.close(),View.unload(this.html_id)},this.render_usuarios=function(){var i=s.tab_listagem.find("tbody"),a=i.find("tr:first");s.tab_listagem.find("tr:gt(-1)").remove(),$(s.arr_curtidas).each(function(d,o){null==o.usuario_seguindo_nome&&""==o.usuario_seguindo_nome||(null!=o.foto_id?s.carrega_img.attr("src",WS_URI+"documento/midia/?documento_id="+o.foto_id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):s.carrega_img.attr("src","assets/img/imagem_usuario_padrao.svg")),function(d){var o=a.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='img_usuario_curtida']"));var u=$(o.find("[template-field='nome_usuario_curtida']")),e=$(o.find(".link_perfil")),r=$(o.find(".btn_seguir")),t=$(o.find(".btn_deixar_seguir"));1==d.count_usuario_logado?(t.hasClass("hidden")&&t.removeClass("hidden"),r.hasClass("hidden")||r.addClass("hidden")):(r.hasClass("hidden")&&r.removeClass("hidden"),t.hasClass("hidden")||t.addClass("hidden")),App.sessao.usuario_id!=s.usuario_id_param&&(App.sessao.usuario_id!=d.id_usuario_seguindo&&App.sessao.usuario_id!=d.id_usuario_seguidor||(t.addClass("hidden"),r.addClass("hidden"))),1==s.usuario_seguindo?(u.text(d.usuario_seguindo_nome),s.quantidade=d.contador_seguindo,e.unbind("click"),e.click(function(){View.load("perfil/listar",function(i,s){s.show(d.id_usuario_seguindo,!1)},View.ABA.MULTIPLAS),s.unload()}),r.unbind("click"),r.click(function(){WS.post("mural_mensagem/seguir",{id_usuario_seguindo:d.id_usuario_seguindo,id_usuario_seguidor:App.sessao.usuario_id},function(i){alert_saved("Seguindo usuario"),i&&(r.addClass("hidden"),t.removeClass("hidden"))},[r],null,!0)}),t.unbind("click"),t.click(function(){alert_modal("Validação","Deixar de seguir "+d.usuario_seguindo_nome+" ?","Ok",function(){WS.post("mural_mensagem/deixar_seguir",{id_usuario_seguindo:d.id_usuario_seguindo,id_usuario_seguidor:App.sessao.usuario_id},function(i){r.removeClass("hidden"),t.addClass("hidden")},[t],null,!0)},!0)})):(u.text(d.usuario_seguidor_nome),s.quantidade=d.contador_seguidor,e.unbind("click"),e.click(function(){View.load("perfil/listar",function(i,s){s.show(d.id_usuario_seguidor,!1)},View.ABA.MULTIPLAS),s.unload()}),r.unbind("click"),r.click(function(){WS.post("mural_mensagem/seguir",{id_usuario_seguindo:d.id_usuario_seguidor,id_usuario_seguidor:App.sessao.usuario_id},function(i){alert_saved("Seguindo usuario"),i&&(r.addClass("hidden"),t.removeClass("hidden"))},[r],null,!0)}),t.unbind("click"),t.click(function(){alert_modal("Validação","Deixar de seguir "+d.usuario_seguidor_nome+" ?","Ok",function(){WS.post("mural_mensagem/deixar_seguir",{id_usuario_seguindo:d.id_usuario_seguidor,id_usuario_seguidor:App.sessao.usuario_id},function(i){r.removeClass("hidden"),t.addClass("hidden")},[t],null,!0)},!0)})),o.appendTo(i)}(o)})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){s.unload()}),this.modal_carregar_curtida.unbind("scroll"),this.modal_carregar_curtida.scroll(function(){s.modal_carregar_curtida.scrollTop()+s.modal_carregar_curtida.height()==s.modal_carregar_curtida.get(0).scrollHeight&&(s.div_load.removeClass("hidden"),s.listar())})}});