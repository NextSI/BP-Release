define([],function(){return function(t){"use strict";var a=this;this.html_id=t,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.onselect=null,this.onclose=null,this.tab_listagem=this.dialog.find(".tab_listagem"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.instancia_tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.tipo_itens=[],this.arr_tipo_itens=[],this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_scroll=!1,this.params={limite:0},this.nao_exibir=[],this.show=function(t,i,e){if("object"==typeof t){var o=extender_parametros({onselect:null,tipo_itens:[],esconder_por_status:[]},t);i=o.onselect,a.nao_exibir=o.tipo_itens}a.onselect=i,a.listar(!0),show_modal(a.modal.attr("id")),set_focus(a.edt_codigo)},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},this.unload=function(){a.close(),View.unload(this.html_id)},this.limpar_tabela=function(t){a.limite=0,a.bloqueia_scroll=!1,$.Tabela_Padrao_Next.clear(a.instancia_tab_listagem),arguments.length>0&&arguments[0]&&a.listar(!0)},this.listar=function(t){if(void 0!==t&&"boolean"==typeof t||(t=!1),!a.bloqueia_scroll){a.params.limite=a.limite,a.params.codigo=a.edt_codigo.val(),a.params.descricao=a.edt_descricao.val();var i=function(t,i){var e=i.pai_id,o=i.id,r=i.raiz_id;i=extender_parametros({codigo:"-",descricao:"-"},i);var l=$.Tabela_Padrao_Next.create_row(a.instancia_tab_listagem);l.attr("elem-key",o),l.attr("parent-key",e),l.attr("nivel",i.nivel),l.attr("data-retraido","false"),l.attr("data-parent-retraido","false"),l.attr("data-tipo","simples"),l.attr("raiz-id",r),l.css({cursor:"pointer"}),$.Tabela_Padrao_Next.getColumn(l,"codigo").text(i.codigo);var n=$.Tabela_Padrao_Next.getColumn(l,"descricao .nome").text(i.descricao),d=$.Tabela_Padrao_Next.getColumn(l,"acao"),s=$.Tabela_Padrao_Next.getColumn(d,"btn_selecionar"),c=function(t,i){var e=$(t);i&&(e=$(t).parents("tr"));var o="true"==e.attr("data-retraido");e.attr("data-retraido",!o),e.attr("data-parent-retraido",!o),a.retrair(e,!o)};if(i.tipo==TIPO_ARVORE.ANALITICO)n.css("padding-left",15*i.nivel+"px"),s.unbind("click").click(function(t){void 0!==a.onselect&&null!=a.onselect&&a.onselect(i),a.unload()}),$.Tabela_Padrao_Next.addEvent(l,{nome:"dblclick",func:function(t){void 0!==a.onselect&&null!=a.onselect&&a.onselect(i),a.unload()}});else if(i.tipo==TIPO_ARVORE.SINTETICO){var _=$.Tabela_Padrao_Next.getColumn(l,"descricao .glyphicon").removeClass("hidden").css({"padding-left":15*i.nivel+"px","font-weight":"bold"});$.Tabela_Padrao_Next.addEvent(_,{nome:"click",func:function(t){c($(this),!0)}}),s.remove(),$.Tabela_Padrao_Next.addEvent(l,{nome:"dblclick",func:function(t){var a=$(this);c(a,!1)}})}0==e?$.Tabela_Padrao_Next.RenderAt(a.instancia_tab_listagem,l,0):$.Tabela_Padrao_Next.RenderRow(a.instancia_tab_listagem,l,e)};WS.get({route:"grupo_itens/listar/",data:a.params,func_response:function(e){if(e){t&&(a.limite=a.limite+a.limite_a_cada);for(var o=0;o<e.length;o++){var r=e[o];i(0,r)}0==e.length&&(a.bloqueia_scroll=!0)}},html_id:a.html_id,disable_buttons:[]})}},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.edt_codigo.unbind("keyup"),this.edt_codigo.keyup($.debounce(500,function(){a.limpar_tabela(!0)})),this.edt_descricao.unbind("keyup"),this.edt_descricao.keyup($.debounce(500,function(){a.limpar_tabela(!0)})),this.retrair=function(t,a){void 0===a&&(a=!1);var i=parseInt($(t).attr("nivel"),10),e=parseInt($(t).attr("raiz-id"),10),o=$(t).find('[data-bp-column="descricao"] [template-button="btn_efect"]'),r=$(t).nextAll('[raiz-id="'+e+'"]');$(t).attr("data-parent-retraido",a);for(var l=0;l<r.length;l++){if(!(i<parseInt($(r[l]).attr("nivel"),10)))return;if(a)$(o).removeClass("glyphicon-triangle-bottom"),$(o).addClass("glyphicon-triangle-right"),$(r[l]).attr("data-retraido","true"),void 0!==$(r[l]).attr("data-retraido-by")&&null!=$(r[l]).attr("data-retraido-by")&&""!=$(r[l]).attr("data-retraido-by")||$(r[l]).attr("data-retraido-by",md5($(t).attr("elem-key"))),$(r[l]).animate({opacity:0},{duration:200,complete:function(){$(this).addClass("hidden")}});else{$(o).addClass("glyphicon-triangle-bottom"),$(o).removeClass("glyphicon-triangle-right");var n=md5($(t).attr("elem-key"));$(r[l]).attr("data-retraido-by")==n&&($(r[l]).attr("data-retraido-by",""),$(r[l]).removeClass("hidden").animate({opacity:1},200)),"A"==$(r[l]).attr("data-tipo")?$(r[l]).attr("data-retraido","false"):"S"==$(r[l]).attr("data-tipo")&&($(r[l]).attr("data-retraido","false"),$(r[l]).attr("data-parent-retraido","false"))}}},$(a.modal).scroll(function(){var t=a.modal;a.html_id&&$(t).scrollTop()+$(this).height()==$(this).get(0).scrollHeight&&(a.bloqueia_scroll||a.listar(!0))})}});