define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.dx_grid=this.dialog.find(".dx_grid"),this.btn_sim=this.dialog.find(".btn_sim"),this.btn_nao=this.dialog.find(".btn_nao"),this.btn_ok=this.dialog.find(".btn_ok"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.dataGrid=null,this.show=function(i,t,e,o){e?(a.title.text("Feriados"),a.listar_feriados(o),a.btn_nao.addClass("hidden"),a.btn_sim.addClass("hidden"),a.btn_ok.removeClass("hidden")):(a.title.text("Eventos de convidados"),a.listar_eventos_convidado(i,t))},this.preencher=function(i){var t=detectmob()?"select":"dragAndDrop";a.dataGrid=a.dx_grid.dxDataGrid({dataSource:i,paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},searchPanel:{visible:!0,highlightCaseSensitive:!0},groupPanel:{visible:!0},filterPanel:{visible:!0},filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},grouping:{autoExpandAll:!0},selection:{mode:"multiple"},columnChooser:{enabled:!0,allowSearch:!0,mode:t},searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},allowColumnReordering:!0,rowAlternationEnabled:!1,allowColumnResizing:!0,showBorders:!0,stateStoring:i.stateStoring,export:i.export,columns:i.columns}).dxDataGrid("instance")},this.listar_eventos_convidado=function(i,t){var e=new Date(i);e.setDate(e.getDate()-7),e=new Date(e).toISOString().slice(0,10),WS.post("agenda_evento/agenda_calendario/",{data_inicio:e,qtd_dias:15,grupo_usuarios_id:JSON.stringify(["-1"]),usuarios_id:t},function(i){var t=[];i.usuarios.forEach(function(a,e){a.eventos.forEach(function(e,o){i.dias.includes(e.dia)&&t.push({evento_dia:e.dia,evento_descricao:"S"==e.agenda_tipo_particular?"Evento Particular":e.descricao,evento_hora_inicio:e.hora_inicio,evento_hora_fim:e.hora_fim,usuario_nome:a.nome})})}),t.columns=[{dataField:"usuario_nome",caption:"Usuário",groupIndex:0},{dataField:"evento_descricao",caption:"Evento"},{dataField:"evento_dia",caption:"Dia",dataType:"date"},{dataField:"evento_hora_inicio",caption:"Hora Início",dataType:"time"},{dataField:"evento_hora_fim",caption:"Hora Fim",dataType:"time"}],t.stateStoring={enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("gridAgendaEventosConflitantes")},customSave:function(i){App.set_parametro_usuario("gridAgendaEventosConflitantes",i)}},t.export={enabled:!0,fileName:"Next BP - Eventos conflitantes de convidado "+agora(),allowExportSelectedData:!0},a.preencher(t),show_modal(a.modal.attr("id"))})},this.listar_feriados=function(i){var t=i;t.columns=[{dataField:"nome",caption:"Feriado"},{dataField:"data_feriado",caption:"Dia",dataType:"date",groupIndex:0},{dataField:"hora_inicio",caption:"Hora Início",dataType:"time"},{dataField:"hora_fim",caption:"Hora Fim",dataType:"time"}],t.stateStoring={enabled:!0,type:"custom",customLoad:function(){return App.get_parametro_usuario("gridAgendaFeriadosConflitantes")},customSave:function(i){App.set_parametro_usuario("gridAgendaFeriadosConflitantes",i)}},t.export={enabled:!0,fileName:"Next BP - Feriados conflitantes com evento "+agora(),allowExportSelectedData:!0},a.preencher(t),show_modal(a.modal.attr("id"))},this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose(a.render_usuario)},this.btn_sim.on("click",function(i){a.render_usuario=!0,a.unload()}),this.btn_nao.on("click",function(i){a.render_usuario=!1,a.unload()}),this.btn_cancelar.on("click",function(){a.unload()}),this.btn_ok.on("click",function(){a.unload()}),this.unload=function(){a.close(),View.unload(this.html_id)}}});