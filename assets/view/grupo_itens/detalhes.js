define([],function(){return function(i){"use strict";var o=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.title=App.lang.grupo_item.aba_detalhes,this.onclose=null,this.params={grupo_itens_id:null,tipo:FORMULARIO.NOVO,tipo_arvore:TIPO_ARVORE.ANALITICO,pai_id:null},this.codigo_automatico=!1,this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.cbo_grupo_item_pai=this.dialog.find(".cbo_grupo_item_pai"),this.show=function(i){switch(o.params=extender_parametros(o.params,i),o.inicializar_componentes(),o.params.tipo){case FORMULARIO.NOVO:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0),set_focus(o.edt_codigo);break;case FORMULARIO.EDITAR:o.btn_salvar.show(),o.btn_excluir.hide(),o.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:o.btn_salvar.hide(),o.btn_excluir.hide(),o.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:o.btn_salvar.hide(),o.btn_excluir.show(),o.permite_alterar(!1)}null!=o.params.grupo_itens_id&&o.preencher()},this.preencher=function(){WS.get({route:"grupo_itens/objeto/",data:{grupo_itens_id:o.params.grupo_itens_id},func_response:function(i){if(i){var t=extender_parametros({codigo:"",descricao:"",bloqueado:!1,tipo:TIPO_ARVORE.ANALITICO},i);o.edt_codigo.val(t.codigo),o.edt_descricao.val(t.descricao),o.chk_bloqueado.prop("checked",t.bloqueado).trigger("change"),o.listar_sinteticas(t.pai_id)}}})},this.permite_alterar=function(i){o.edt_descricao.prop("readonly",!i),o.edt_codigo.prop("readonly",!i),o.chk_bloqueado.prop("disabled",!i),o.cbo_grupo_item_pai.prop("disabled",!i)},this.close=function(){void 0!==o.onclose&&o.onclose&&o.onclose()},this.unload=function(){o.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){o.listar_sinteticas(o.params.pai_id),null==o.params.grupo_itens_id&&o.carregar_configuracoes(function(){o.codigo_automatico&&o.get_next_codigo()})},this.get_next_codigo=function(){WS.get("grupo_itens/gerar_codigo/",null,function(i){i&&o.edt_codigo.val(i)})},this.carregar_configuracoes=function(i){WS.get("grupo_itens/get_parametro/",null,function(t){t&&(o.codigo_automatico="S"==t.grupo_itens_codigo_automatico,void 0!==i&&i())})},this.listar_sinteticas=function(i){o.cbo_grupo_item_pai.find("option").remove(),add_option(o.cbo_grupo_item_pai,"","Nenhuma"),WS.get("grupo_itens/listar/",{arvore:!1},function(t){if(t){o.cbo_grupo_item_pai.find("option").remove(),add_option(o.cbo_grupo_item_pai,"","Nenhuma");for(var e=function(i,a,r){add_option(o.cbo_grupo_item_pai,i.grupo_itens_id,a.repeat(r)+i.codigo+" - "+i.descricao);for(var n=[],_=0;_<t.length;_++)(c=t[_]).pai_id==i.grupo_itens_id&&c.tipo==TIPO_ARVORE.SINTETICO&&n.push(c);for(_=0;_<n.length;_++){var c=n[_];e(c,a,r+1)}},a=0;a<t.length;a++){var r=t[a];r.pai_id||r.tipo!=TIPO_ARVORE.SINTETICO||e(r,"&mdash;",0)}o.cbo_grupo_item_pai.selectpicker("refresh"),i&&o.cbo_grupo_item_pai.val(i).trigger("change")}})},this.btn_salvar.unbind("click").click(function(i){var t={grupo_itens_id:o.params.grupo_itens_id,descricao:o.edt_descricao.val(),codigo:o.edt_codigo.val(),bloqueado:o.chk_bloqueado.prop("checked"),pai_id:o.cbo_grupo_item_pai.val()},e=extender_parametros({grupo_itens_id:null,descricao:null,codigo:null,bloqueado:!1,tipo:o.params.tipo_arvore,pai_id:null},t);WS.post({route:"grupo_itens/salvar",data:e,type:"POST",func_response:function(i){i&&(alert_saved(App.lang.grupo_item.alerta+e.descricao+App.lang.grupo_item.alerta_salvo),o.unload())},disable_buttons:[o.btn_salvar,o.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(i){WS.post({route:"grupo_itens/excluir",data:{grupo_itens_id:o.params.grupo_itens_id},type:"POST",func_response:function(i){i&&(alert_saved(App.lang.grupo_item.alerta+o.edt_descricao.val()+App.lang.grupo_item.alerta_exclusao),o.unload())},disable_buttons:[o.btn_excluir,o.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(i){o.unload()})}});