define([],function(){return function(o){"use strict";var s=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.onremove=null,this.onselect=null,this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.dropdown_responsavel=this.dialog.find(".dropdown_responsavel"),this.title_mod=this.dialog.find(".title_mod"),this.chk_responsavel=this.dialog.find(".chk_responsavel"),this.chk_tipo_usuario=this.dialog.find(".chk_tipo_usuario"),this.chk_grupo_responsavel=this.dialog.find(".chk_grupo_responsavel"),this.cbo_grupo_tipo=this.dialog.find(".cbo_grupo_tipo"),this.cbo_grupo_usuarios=this.dialog.find(".cbo_grupo_usuarios"),this.opt_usuario=this.dialog.find(".opt_usuario"),this.opt_grupo=this.dialog.find(".opt_grupo"),this.solicitacao_atividade_id=null,this.todos_usuarios_responsaveis=null,this.responsavel_id=null,this.todos_grupos=null,this.grupo_usuarios_responsaveis_id=null,this.arr_usuarios=[],this.arr_grupo_usuarios=[],this.multiplos_responsaveis=null,this.dxDropdownResponsavel=null,this.dxDataGrid=null,this.responsaveis_selecionados=null,this.show=function(o,i,e,r,a,n,t,u,p,l){parseInt(t,10)==PROCESSO_ATIVIDADE_TIPO.INICIO&&(s.title_mod.text("Alterar Solicitante"),s.opt_grupo.text("Grupos de Usuarios Solicitantes da atividade"),s.opt_usuario.text("Solicitantes da atividade")),s.todos_usuarios_responsaveis=e,s.responsavel_id=r,s.todos_grupos=a,s.grupo_usuarios_responsaveis_id=n;for(var _=0;_<u.length;_++)s.arr_usuarios.push(u[_].usuario_id);for(_=0;_<p.length;_++)s.arr_grupo_usuarios.push(p[_].grupo_usuarios_id);s.multiplos_responsaveis=l,s.onselect=o,void 0!==i&&i&&(s.solicitacao_atividade_id=i,s.preencher()),show_modal(s.modal.attr("id"))},this.close=function(){close_modal(s.modal.attr("id")),void 0!==s.onclose&&s.onclose&&s.onclose()},this.unload=function(){s.close(),View.unload(this.html_id)},this.radios=function(){!0===s.chk_responsavel.prop("checked")?(s.cbo_grupo_usuarios.prop("disabled",!0),s.cbo_grupo_tipo.prop("disabled",!0),s.dxDropdownResponsavel.option("disabled",!1),s.cbo_tipo.prop("disabled",!1),s.cbo_grupo_usuarios.val("").trigger("change"),s.cbo_grupo_tipo.val(1).trigger("change")):!0===s.chk_grupo_responsavel.prop("checked")&&(s.cbo_grupo_usuarios.prop("disabled",!1),s.cbo_grupo_tipo.prop("disabled",!1),s.dxDropdownResponsavel.option("disabled",!0),s.cbo_tipo.prop("disabled",!0),s.cbo_tipo.val(1).trigger("change")),s.cbo_grupo_usuarios.selectpicker("refresh"),s.cbo_tipo.selectpicker("refresh"),s.cbo_grupo_tipo.selectpicker("refresh")},this.preencher=function(){if(add_option(s.cbo_grupo_usuarios,""," - Selecionar - "),s.cbo_grupo_usuarios.selectpicker("refresh"),s.renderizar_dropdown_responsavel([],!1),null!=s.responsavel_id&&s.responsavel_id.length>0){var o=!1;$(s.todos_usuarios_responsaveis).each(function(i,e){s.responsavel_id==e.usuario_id&&(o=!0)}),o?(s.cbo_tipo.val(1),s.cbo_tipo.change()):(s.cbo_tipo.val(2),s.cbo_tipo.change()),s.chk_responsavel.prop("checked",!0).trigger("click")}else if(null!=s.grupo_usuarios_responsaveis_id&&""!=s.grupo_usuarios_responsaveis_id){var i=!1;$(s.todos_grupos).each(function(o,e){s.grupo_usuarios_responsaveis_id==e.grupo_usuarios_id&&(i=!0)}),i?(s.cbo_grupo_tipo.val(1),s.cbo_grupo_tipo.change()):(s.cbo_grupo_tipo.val(2),s.cbo_grupo_tipo.change()),s.chk_grupo_responsavel.prop("checked",!0).trigger("click")}else s.chk_responsavel.prop("checked",!0).trigger("click"),s.cbo_tipo.val(1),s.cbo_tipo.change()},this.renderizar_dropdown_responsavel=function(o,i){s.dxDropdownResponsavel=s.dropdown_responsavel.dxDropDownBox({valueExpr:function(o){return o.chave},displayExpr:"nome",placeholder:App.lang.combobox.selecione,showClearButton:!0,dataSource:new DevExpress.data.DataSource.default({store:o,pageSize:o.length}),dropDownOptions:{container:s.modal},contentTemplate:function(o){var e=o.component.option("value"),r=$("<div>").dxDataGrid({dataSource:o.component.option("dataSource"),keyExpr:"chave",showBorders:!0,columnResizingMode:"widget",rowAlternationEnabled:!1,searchPanel:{visible:!detectmob(),width:200,placeholder:"Pesquisa geral"},paging:{pageSize:20},pager:{showPageSizeSelector:!0,allowedPageSizes:[20,50,100],showInfo:!0},allowColumnResizing:!0,filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},filterPanel:{visible:!0},sorting:{mode:"multiple"},groupPanel:{visible:!0},columns:[{dataField:"nome",caption:App.lang.generico.nome,allowGrouping:!1},{dataField:"grupo_usuario_nome",caption:App.lang.generico.grupo_usuario,allowGrouping:!1,visible:s.multiplos_responsaveis&&i,groupIndex:s.multiplos_responsaveis&&i?0:null}],hoverStateEnabled:!0,height:345,selection:{mode:!0===s.multiplos_responsaveis?"multiple":"single"},selectedRowKeys:e,onSelectionChanged:function(i){for(var e=i.selectedRowKeys,r=[],a=[],n=0;n<e.length;n++){var t=e[n];r.push(t.chave)}for(o.component.option("value",r),n=0;n<r.length;n++)a.push(r[n].substr(0,r[n].indexOf("_")));s.responsaveis_selecionados=a,s.multiplos_responsaveis||o.component._popup.hide()}});return s.dxDataGrid=r.dxDataGrid("instance"),r}}).dxDropDownBox("instance")},this.chk_tipo_usuario.unbind("click"),this.chk_tipo_usuario.click(function(){s.radios()}),this.cbo_grupo_tipo.unbind("change"),this.cbo_grupo_tipo.change(function(){s.cbo_grupo_usuarios.find("option").remove(),add_option(s.cbo_grupo_usuarios,""," - Selecionar - "),1==s.cbo_grupo_tipo.val()?null!=s.todos_grupos&&""!=s.todos_grupos&&($(s.todos_grupos).each(function(o,i){add_option(s.cbo_grupo_usuarios,i.grupo_usuarios_id,i.nome)}),null!=s.grupo_usuarios_responsaveis_id&&""!=s.grupo_usuarios_responsaveis_id&&""==s.cbo_grupo_usuarios.val()&&s.cbo_grupo_usuarios.val(s.grupo_usuarios_responsaveis_id).trigger("change"),s.cbo_grupo_usuarios.selectpicker("refresh")):WS.get("grupo_usuarios/listar/",{usuario_id:cripto(App.sessao.usuario_id.toString())},function(o){$(o).each(function(o,i){add_option(s.cbo_grupo_usuarios,i.grupo_usuarios_id,i.nome)}),null!=s.grupo_usuarios_responsaveis_id&&""!=s.grupo_usuarios_responsaveis_id&&""==s.cbo_grupo_usuarios.val()&&s.cbo_grupo_usuarios.val(s.grupo_usuarios_responsaveis_id).trigger("change"),s.cbo_grupo_usuarios.selectpicker("refresh")})}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){1==s.cbo_tipo.val()?WS.get("usuario/listar_usuarios_grupos/",{nome:"",cliente_id:-1,equipe_interna:!1,clientes:!1,fornecedores:!1,prospects:!1,considera_tecnico:!1,apenas_tecnico:!1,apenas_supervisionados:!1,modulo:null,listar_grupos:!1,arr_usuarios:s.arr_usuarios,arr_grupo_usuarios:s.arr_grupo_usuarios,limpa_conteudo_apos_selecionar:!1,listar_usuarios_grupos:!0,limite:null},function(o){s.renderizar_dropdown_responsavel(o,!0)}):WS.get("usuario/listar/",null,function(o){s.renderizar_dropdown_responsavel(o,!1)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){s.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){WS.post("solicitacao/set_responsavel",{solicitacao_atividade_id:s.solicitacao_atividade_id,responsavel_id:s.responsaveis_selecionados,grupo_usuarios_responsaveis_id:s.cbo_grupo_usuarios.val()},function(o){alert_saved("Alteração realizada com sucesso!");var i={responsavel_id:s.responsaveis_selecionados,grupo_usuarios_responsaveis_id:s.cbo_grupo_usuarios.val()};s.onselect(i),s.unload()},[s.btn_cancelar,s.btn_salvar])})}});