define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.onremove=null,this.onselect=null,this.modal_dialog=this.dialog.find(".modal-dialog"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.prazo=this.dialog.find(".prazo"),this.div_horas_uteis=this.dialog.find(".div_horas_uteis"),this.div_motivo_reprogramacao=this.dialog.find(".div_motivo_reprogramacao"),this.edt_motivo_reprogramacao=this.dialog.find(".edt_motivo_reprogramacao"),this.solicitacao_atividade_id=null,this.solicitacao_id=null,this.tipo_prazo_execucao=0,this.prazo_execucao=null,this.calendario_trabalho_id=null,this.show=function(a,o,t){switch(i.onselect=a,t){case FORMULARIO.NOVO:i.btn_salvar.show(),i.btn_excluir.hide(),i.edt_nivel.val(10);break;case FORMULARIO.EDITAR:i.btn_salvar.show(),i.btn_excluir.hide();break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar.hide(),i.btn_excluir.show()}i.tipo=t,void 0!==o&&o&&(i.solicitacao_atividade_id=o,i.preencher()),show_modal(i.modal.attr("id"))},this.close=function(){close_modal(i.modal.attr("id")),void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.preencher=function(){WS.get("solicitacao/objeto/",{solicitacao_atividade_id:i.solicitacao_atividade_id},function(a){i.solicitacao_id=a.solicitacao_id,i.calendario_trabalho_id=a.calendario_trabalho_id,a.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.HORAS_UTEIS?(i.tipo_prazo_execucao=SOLICITACAO_TIPO_HORA.HORAS_UTEIS,i.get_prazo_atividade(),i.div_horas_uteis.removeClass("hidden")):a.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.DIAS_CORRIDOS?(i.tipo_prazo_execucao=SOLICITACAO_TIPO_HORA.DIAS_CORRIDOS,i.get_prazo_atividade(),i.div_horas_uteis.removeClass("hidden")):a.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.DATA_PRDECESSORA?(i.tipo_prazo_execucao=SOLICITACAO_TIPO_HORA.DATA_PRDECESSORA,i.get_prazo_atividade(),i.div_horas_uteis.removeClass("hidden")):a.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.DATA_REFERENCIA&&(i.tipo_prazo_execucao=SOLICITACAO_TIPO_HORA.DATA_REFERENCIA,i.get_prazo_atividade(),i.div_horas_uteis.removeClass("hidden")),"S"!==a.versao_processo_atividade_informar_motivo_reprogramacao&&!0!==a.versao_processo_atividade_informar_motivo_reprogramacao||(i.div_motivo_reprogramacao.removeClass("hidden"),i.modal_dialog.removeClass("modal-sm").addClass("modal-md"))})},this.get_prazo_atividade=function(){WS.get("solicitacao/get_prazo_atividade/",{solicitacao_atividade_id:i.solicitacao_atividade_id},function(a){var o=[];a[0].domingo_inicio&&a[0].domingo_fim&&o.push(DIA_DA_SEMANA.DOMINGO),a[0].segunda_inicio&&a[0].segunda_fim&&o.push(DIA_DA_SEMANA.SEGUNDA),a[0].terca_inicio&&a[0].terca_fim&&o.push(DIA_DA_SEMANA.TERCA),a[0].quarta_inicio&&a[0].quarta_fim&&o.push(DIA_DA_SEMANA.QUARTA),a[0].quinta_inicio&&a[0].quinta_fim&&o.push(DIA_DA_SEMANA.QUINTA),a[0].sexta_inicio&&a[0].sexta_fim&&o.push(DIA_DA_SEMANA.SEXTA),a[0].sabado_inicio&&a[0].sabado_fim&&o.push(DIA_DA_SEMANA.SABADO);var t=[{type:"required"}],e="date";i.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.HORAS_UTEIS&&(t.push({type:"custom",validationCallback:function(i){return"00:00"!=fn_horas_uteis(a[0].calendario_trabalho_id,formatDateTime(i.value,!0),formatDateTime(addMinutes(i.value,1),!0))||"00:00"!=fn_horas_uteis(a[0].calendario_trabalho_id,formatDateTime(addMinutes(i.value,-1),!0),formatDateTime(i.value,!0))},message:"Escolha um horário dentro do calendário de trabalho"}),e="datetime"),i.prazo_execucao=a[0].termino_solicitacao,i.prazo.dxDateBox({type:e,useMaskBehavior:!0,disabledDates:function(a){var i=a.date.getDay();return"month"==a.view&&!o.includes(i)||formatDate(a.date,!0)<formatDate(new Date,!0)},dropDownOptions:{container:i.modal}}).dxValidator({validationRules:t})})},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){i.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){i.prazo.dxDateBox().dxValidator("instance").validate().isValid&&WS.post("solicitacao/set_prazo_atividade",{solicitacao_atividade_id:i.solicitacao_atividade_id,tempo_prazo_execucao:i.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.HORAS_UTEIS?fn_horas_uteis(i.calendario_trabalho_id,agora(!0),formatDateTime(i.prazo.dxDateBox("instance").option("value"),!0),!0):null,tipo_prazo_execucao:i.tipo_prazo_execucao,dia_prazo_execucao:i.tipo_prazo_execucao!=SOLICITACAO_TIPO_HORA.HORAS_UTEIS?formatDate(i.prazo.dxDateBox("instance").option("value"),!0):null,dias_prazo_execucao:i.tipo_prazo_execucao==SOLICITACAO_TIPO_HORA.DIAS_CORRIDOS?date_diff(i.prazo.dxDateBox("instance").option("value"),new Date):null,prazo_execucao:formatDateTime(i.prazo.dxDateBox("instance").option("value"),!0),motivo_reprogramacao:i.edt_motivo_reprogramacao.val()},function(a){var o={tempo_restante:a.tempo_restante,percentual:a.percentual,diff_datas:a.diff_datas,prazo_execucao:a.prazo_execucao};i.onselect(o),alert_saved("Prazo para executar salvo com sucesso!"),i.unload()},[i.btn_cancelar,i.btn_salvar])})}});