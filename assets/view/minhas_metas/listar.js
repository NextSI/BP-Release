define([],function(){return function(a){"use strict";var i=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Minhas Metas",this.tab_listagem=this.dialog.find(".tab_listagem"),this.btn_listar=this.dialog.find(".btn_listar"),this.tab_minhas_metas=this.dialog.find(".tab_minhas_metas"),this.tab_minhas_metas_competencias=this.dialog.find(".tab_minhas_metas_competencias"),this.tab_acoes=this.dialog.find(".tab_acoes"),this.tab_metas=this.dialog.find(".tab_metas"),this.tab_indicadores=this.dialog.find(".tab_indicadores"),this.container_tabela=this.dialog.find(".container_tabela"),this.tab_habilidades=this.dialog.find(".tab_habilidades"),this.tab_acoes_competencias=this.dialog.find(".tab_acoes_competencias"),this.tab_metas_competencias=this.dialog.find(".tab_metas_competencias"),this.container_competencias=this.dialog.find(".container_competencias"),this.cbo_autor=this.dialog.find(".cbo_autor"),this.accordion_habilidades=this.dialog.find(".accordion_habilidades"),this.accordion_indicadores=this.dialog.find(".accordion_indicadores"),this.filtro={},this.listar_filtro_responsavel=function(a){i.cbo_autor.find("option").remove(),add_option(i.cbo_autor,"-1","Todos"),WS.get("atuacao_efetiva/listar/",{filtro_cbo_autor:!0},function(e){for(var o=0;o<e.length;o++){var t=e[o];add_option(i.cbo_autor,t.usuario_id,t.autor)}a&&i.cbo_autor.val(a).trigger("change"),i.cbo_autor.selectpicker("refresh")})},i.cbo_autor.unbind("change"),i.cbo_autor.change(function(a){i.filtro.usuario_id=i.cbo_autor.val(),i.lista_competencias(),i.lista_atuacao()}),this.lista_atuacao=function(){var a="";i.accordion_indicadores.find(".nome_usuario").remove(),i.accordion_indicadores.find(".row_accordion").not("[template-accordion]").remove(),WS.get("atuacao_efetiva/listar_minhas_acoes/",{filtro:JSON.stringify(i.filtro)},function(e){$(e).each(function(e,o){!function(e){$.each(e.indicadores,function(o,t){var d=i.accordion_indicadores.find("[template-accordion]").clone();d.removeAttr("template-accordion").css("display",""),d.find("[template-ref-a]").attr("href","#colappse_atuacao_"+t.atuacao_efetiva_indicador_id).text(t.nome+" - Atuação Efetiva #"+e.atuacao_efetiva_id),d.find("[template-ref-div]").attr("id","colappse_atuacao_"+t.atuacao_efetiva_indicador_id);var n=d.find("[template-acoes]"),s=(d.find("[template-info-acao]"),d.find("[template-table]"));if(a!=e.nome){var c=i.accordion_indicadores.find("[template-usuario]").clone();c.removeAttr("template-usuario").addClass("nome_usuario").css("display","").text(e.nome),i.accordion_indicadores.append(c)}a=e.nome,$.each(t.acoes,function(a,e){var o=$('<button class="btn btn-default"> '+e.descricao+"</button>");o.click(function(a){WS.get("atuacao_efetiva_resultado_esperado/listar/",{atuacao_efetiva_indicador_id:t.atuacao_efetiva_indicador_id,possibilidade_acao_id:e.atuacao_efetiva_possibilidade_acao_id,atuacao_efetiva_id:e.atuacao_efetiva_id,indicador_id:e.indicador_id,atualiza_valores:!0},function(a){s.find("tbody tr").not("[template-row]").remove(),a.length>0&&$.each(a,function(a,e){i.add_row(e,s)})})}),n.append(o)}),i.accordion_indicadores.append(d)})}(o)})})},this.lista_competencias=function(){var a="";i.accordion_habilidades.find(".nome_usuario").remove(),i.accordion_habilidades.find(".row_accordion").not("[template-accordion]").remove(),WS.get("competencias_essenciais/listar_minhas_acoes/",{filtro:JSON.stringify(i.filtro)},function(e){$(e).each(function(e,o){!function(e){$.each(e.habilidades,function(o,t){var d=i.accordion_habilidades.find("[template-accordion]").clone();d.removeAttr("template-accordion"),d.css("display",""),d.find("[template-ref-a]").attr("href","#collapse_competencia_"+t.habilidade_id).text(t.descricao+" - Competência Essencial #"+e.competencias_essenciais_id),d.find("[template-ref-div]").attr("id","collapse_competencia_"+t.habilidade_id);var n=d.find("[template-acoes]"),s=(d.find("[template-info-acao]"),d.find("[template-table]"));if(a!=e.nome){var c=i.accordion_habilidades.find("[template-usuario]").clone();c.removeAttr("template-usuario").addClass("nome_usuario").css("display","").text(e.nome),i.accordion_habilidades.append(c)}a=e.nome,$.each(t.acoes,function(a,e){var o=$('<button class="btn btn-default"> '+e.descricao+"</button>");o.click(function(a){WS.get("competencias_essenciais_resultado_esperado/listar/",{habilidade_id:t.habilidade_id,acao_id:e.competencias_essenciais_acao_id},function(a){s.find("tbody tr").not("[template-row]").remove(),a.length>0&&$.each(a,function(a,e){i.add_row(e,s)})})}),n.append(o)}),i.accordion_habilidades.append(d)})}(o)})})},this.add_row=function(a,i){var e=i.find("tbody"),o=e.find("[template-row]").clone();o.removeAttr("template-row"),o.css("display","");var t=$(o.find('[template-field="desdobramento"]')),d=$(o.find('[template-field="tipo"]')),n=$(o.find('[template-field="valor_atual"]')),s=$(o.find('[template-field="data_inicio"]')),c=$(o.find('[template-field="data_fim"]')),r=$(o.find("[template-field='valor_esperado']"));if(r.maskMoney("unmasked")[0],a){if("S"==a.agenda_gerada){var l=o.find(".lbl_info_agenda");o.attr("agenda_gerada","S"),l.removeClass("hidden")}"S"==a.realizado&&o.find(".lbl_realizado").removeClass("hidden"),t.val(a.descricao_acao),n.val(a.valor).prop("readonly",!1).maskMoney("unmasked")[0],r.prop("readonly",!1),a.tipo==TIPO_OBJETIVO.INFORMATIVO?(d.val(a.tipo),n.prop("readonly",!0),r.val(""),r.prop("readonly",!0)):a.tipo==TIPO_OBJETIVO.VALOR?(d.val(a.tipo),r.val(a.valor_alcancado).maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),n.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2})):a.tipo==TIPO_OBJETIVO.PERCENTUAL&&(d.val(a.tipo),r.val(a.percentual_alcancado),n.val(parseInt(a.valor))),set_datepicker(s,a.data_inicio),set_datepicker(c,a.data_fim)}d.unbind("change"),d.change(function(a){var i=$(a.currentTarget).val();switch(n.attr({disabled:!1,readonly:!1}),r.attr("readonly",!1).val(""),+i){case TIPO_OBJETIVO.INFORMATIVO:n.val("").attr("disabled",!0),r.prop({readonly:!0,disabled:!0}).val("");break;case TIPO_OBJETIVO.VALOR:n.val("").focus().maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2}),r.attr({disabled:!1,readonly:!1}).maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:2});break;case TIPO_OBJETIVO.PERCENTUAL:n.maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:0}).val("").focus(),r.attr({disabled:!1,readonly:!1}).maskMoney({thousands:"",decimal:",",allowZero:!0,suffix:"",precision:0})}});var _=$(o.find("[template-salvar]"));_.css("cursor","pointer"),_.click(function(i){var e=0,o=0;+a.tipo==TIPO_RESULTADO.PERCENTUAL?o=r.val():+a.tipo==TIPO_RESULTADO.VALOR&&(e=r.maskMoney("unmasked")[0]);var l=n.maskMoney("unmasked")[0],_={valor_alcancado:e>0?e:0,percentual_alcancado:o>0?r.val():0,valor:l,tipo:d.val(),data_inicio:get_datepicker(s),data_fim:get_datepicker(c),descricao_acao:t.val(),atualiza_valores:!0};1==!!a.indicador_id?(_.atuacao_efetiva_resultado_esperado_id=a.atuacao_efetiva_resultado_esperado_id,WS.post("atuacao_efetiva_resultado_esperado/salvar/",_,function(a){alert_saved("Salvo com sucesso")})):(_.competencias_essenciais_resultado_esperado_id=a.competencias_essenciais_resultado_esperado_id,WS.post("competencias_essenciais_resultado_esperado/salvar/",_,function(a){alert_saved("Salvo com sucesso")}))}),$(o.find("[template-historico]")).click(function(i){var e={};1==!!a.indicador_id?(e.tipo="atuacao",e.atuacao_efetiva_resultado_esperado_id=a.atuacao_efetiva_resultado_esperado_id):(e.tipo="competencia",e.competencias_essenciais_resultado_esperado_id=a.competencias_essenciais_resultado_esperado_id),View.load("minhas_metas/historico",function(a,i){i.show(e)},View.ABA.NAO)});var f=$(o.find(".btn_deletar_objetivo"));f.unbind("click"),f.click(function(){alert_modal("Objetivo","Deseja remover este objetivo?","Remover",function(){$(o).attr("indicador_principal_id")>0?WS.post("atuacao_efetiva_indicador_principal/excluir/",{indicador_principal_id:a.indicador_principal_id},function(a){alert_saved("Indicador excluído com sucesso"),$(o).remove()}):$(o).remove()},!0)}),o.appendTo(e)},this.btn_listar.unbind("click"),this.btn_listar.click(function(){i.lista_competencias(),i.lista_atuacao()}),this.unload=function(){View.unload(this.html_id)},this.lista_atuacao(),this.lista_competencias(),this.listar_filtro_responsavel()}});