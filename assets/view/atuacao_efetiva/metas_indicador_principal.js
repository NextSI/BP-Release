define([],function(){return function(i){"use strict";var a=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.onsave=null,this.atuacao_efetiva_id=null,this.indicador_id=0,this.usuario_id=0,this.edt_nome=this.dialog.find(".edt_nome"),this.cbo_novo_indicador=this.dialog.find(".cbo_novo_indicador"),this.radio_indicador=this.dialog.find(".radio_indicador"),this.edt_indicador=this.dialog.find(".edt_indicador"),this.div_selecao_indicador=this.dialog.find(".div_selecao_indicador"),this.btn_avaliar=this.dialog.find(".btn_avaliar"),this.optradio_sete_dias=this.dialog.find("[name=optradio_sete_dias]"),this.radio_informativa_sete_dias=this.dialog.find(".radio_informativa_sete_dias"),this.radio_percentual_sete_dias=this.dialog.find(".radio_percentual_sete_dias"),this.radio_valor_sete_dias=this.dialog.find(".radio_valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.percentual_sete_dias=this.dialog.find(".percentual_sete_dias"),this.valor_sete_dias=this.dialog.find(".valor_sete_dias"),this.cbo_informativa_sete_dias=this.dialog.find(".cbo_informativa_sete_dias"),this.edt_percentual_sete_dias=this.dialog.find(".edt_percentual_sete_dias"),this.edt_valor_sete_dias=this.dialog.find(".edt_valor_sete_dias"),this.edt_acao_sete_dias=this.dialog.find(".edt_acao_sete_dias"),this.data_sete_dias=this.dialog.find(".data_sete_dias"),this.tab_objetivo=this.dialog.find(".tab_objetivo"),this.btn_incluir_objetivo=this.dialog.find(".btn_incluir_objetivo"),this.btn_salvar_enviar=this.dialog.find(".btn_salvar_enviar"),this.responsabilidade_escolhida=this.dialog.find(".responsabilidade_escolhida"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.atuacao_efetiva_id=0,this.indicador_id=0,this.dataAtual=new Date,this.selected_cbo_atuacao_efetiva_id=null,this.competencias_essenciais_avaliacao_status=0,this.show=function(i,t,d){this.btn_avaliar.addClass("hidden"),"S"==App.sessao.dados.supervisor_empenho&&this.btn_avaliar.removeClass("hidden"),a.usuario_id=d,a.atuacao_efetiva_id=i,a.indicador_id=t,a.carrega_acoes_metas(),show_modal(a.modal.attr("id")),set_focus(a.edt_nome)},this.carrega_acoes_metas=function(){WS.get("atuacao_efetiva_indicador_principal/listar/",{atuacao_efetiva_id:a.atuacao_efetiva_id,indicador_id:a.indicador_id},function(i){i.length>0&&$.each(i,function(i,t){a.add_row(t)})})},this.salva_dados_acaoes_metas=function(i){var t=[];$.each(a.tab_objetivo.find("tbody").find("tr:not([template-row])"),function(i,a){t.push({id:$(this).attr("indicador_principal_id"),descricao:$(a).find("td:nth-child(1) input").val(),tipo:$(a).find("td:nth-child(2) select").val(),valor:$(a).find("td:nth-child(3) input").val(),data_inicio:$(a).find("td:nth-child(4) input").val(),data_fim:$(a).find("td:nth-child(5) input").val()})}),WS.post("atuacao_efetiva_indicador_principal/salvar/",{acoes:JSON.stringify(t),atuacao_efetiva_id:a.atuacao_efetiva_id,indicador_id:a.indicador_id,atuacao_efetiva_resultado_esperado_id:a.atuacao_efetiva_resultado_esperado_id},function(i){alert_saved("Salvo com sucesso"),a.unload(i.id)})},this.add_row=function(i){var t=a.tab_objetivo.find("tbody"),d=t.find("tr:first").clone();d.removeAttr("template-row"),d.css("display","");var e=$(d.find('[template-field="descricao"] input')),o=$(d.find('[template-field="tipo"]')),s=$(d.find('[template-field="valor"] input')),n=$(d.find('[template-field="data_inicio"] input')),_=$(d.find('[template-field="data_fim"] input'));s.attr("disabled",!0),i&&(d.attr("indicador_principal_id",i.indicador_principal_id),e.val(i.descricao),o.find(".cbo_tipo").val(i.tipo).trigger("change"),i.tipo==TIPO_OBJETIVO.INFORMATIVO?(s.val(""),s.prop("disabled",!0)):i.tipo==TIPO_OBJETIVO.VALOR?(s.prop("disabled",!1),s.val(i.valor),s.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2})):i.tipo==TIPO_OBJETIVO.PERCENTUAL&&(s.prop("disabled",!1),s.val(i.valor)),set_datepicker(n,i.data_inicio),set_datepicker(_,i.data_fim)),o.find(".cbo_tipo").change(function(i){s.attr("disabled",!1),s.val(""),$(this).val()==TIPO_OBJETIVO.INFORMATIVO?(s.attr("disabled",!0),s.val("")):$(this).val()==TIPO_OBJETIVO.PERCENTUAL?($(s).removeAttr("type"),$(s).prop("type","number")):$(this).val()==TIPO_OBJETIVO.VALOR&&($(s).removeAttr("type"),$(s).prop("type","text"),s.maskMoney({thousands:".",decimal:",",allowZero:!0,suffix:"",precision:2}))});var c=$(d.find(".btn_deletar_objetivo"));c.unbind("click"),c.click(function(){alert_modal("Objetivo","Deseja remover este objetivo?","Remover",function(){$(d).attr("indicador_principal_id")>0?WS.post("atuacao_efetiva_indicador_principal/excluir/",{indicador_principal_id:i.indicador_principal_id},function(i){alert_saved("Indicador exclu√≠do com sucesso"),$(d).remove()}):$(d).remove()},!0)}),d.appendTo(t)},a.btn_incluir_objetivo.unbind("click").click(function(i){a.add_row()}),this.close=function(){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose()},a.cbo_novo_indicador.change(function(i){a.selected_cbo_atuacao_efetiva_id=$(this).find("option:selected").attr("data-id-atuacao")}),this.unload=function(i){a.close(i),View.unload(this.html_id)},this.preencher=function(){WS.get("atuacao_efetiva/objeto/",{atuacao_efetiva_id:a.atuacao_efetiva_id},function(i){a.edt_indicador.val(i.indicador)})},this.close=function(i){close_modal(a.modal.attr("id")),void 0!==a.onclose&&a.onclose&&a.onclose(i)},this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){a.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){a.usuario_id==App.sessao.dados.supervisor_empenho=="S"?a.salva_dados_acaoes_metas(STATUS_INDICADORES.EM_ANDAMENTO):a.salva_dados_acaoes_metas()}),this.btn_salvar_enviar.unbind("click"),this.btn_salvar_enviar.click(function(){a.salva_dados_acaoes_metas(STATUS_INDICADORES.EM_APROVACAO)}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("atuacao_efetiva/excluir",{atuacao_efetiva_id:a.atuacao_efetiva_id},function(i){alert_saved(i.nome+" excluido com sucesso"),a.unload()})})}});