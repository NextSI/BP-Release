define([],function(){return function(i){"use strict";var t=this;this.html_id=i,this.dialog=$("#"+this.html_id),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.title=this.modal.find(".modal-title"),this.tipo=null,this.onclose=null,this.corpo_email=this.dialog.find(".corpo_email"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_fechar=this.dialog.find(".btn_fechar"),this.email_job_id=null,this.motivo_chamado_id=null,this.para=this.dialog.find(".para"),this.data_solicitacao_envio=this.dialog.find(".data_solicitacao_envio"),this.assunto=this.dialog.find(".assunto"),this.div_anexos=this.dialog.find(".div_anexos"),this.close=function(){close_modal(t.modal.attr("id")),void 0!==t.onclose&&t.onclose&&t.onclose()},this.show=function(i){t.email_job_id=i,show_modal(t.modal.attr("id")),t.preencher()},this.preencher=function(){WS.get("email_job/objeto/",{email_job_id:t.email_job_id},function(i){t.para.html(i.para),t.data_solicitacao_envio.html(i.data_solicitacao_envio.format_date_time()),t.assunto.html(i.assunto),t.corpo_email.html(i.corpo).find("img").css("max-width","100%"),t.corpo_email.html(i.corpo).find('a[href="#link_direto#"] img').css({maxWidth:120,marginRight:10}),i.documentos&&i.documentos.forEach(i=>{if(i.content_id){const o=WS_URI+"documento/download/?documento_revisao_id="+i.documento_revisao_id+"&documento_id="+i.id+"&token_publico="+cripto(WS.token)+"&tipo=S&acao=abrir";t.corpo_email.find('img[src="cid:'+i.content_id+'"]').attr("src",o)}}),t.render_anexos(i.documentos)})},this.render_anexos=function(i){t.div_anexos.removeClass("hidden");var o=$('<div class="form-inline">');$(i).each(function(i,n){!function(i){var n=i.documento_revisao_id,a=$('<div class="input-group">');if("application/pdf"==i.mime_type)(e=$("<button>")).addClass("btn btn-default btn-sm"),e.text(FileShortName(i.nome_arquivo)),e.unbind("click"),e.click(function(){View.load("central_documentos/visualizar_pdf",function(i,t){t.show(n)})}),(l=$("<a>")).attr("type","button"),l.addClass("btn btn-default btn-sm"),l.attr("title",i.nome_arquivo),l.attr("value",i.documento_revisao_id),(d=$("<span>")).addClass("glyphicon glyphicon-download-alt"),l.append(d),a.append(e),a.append(l);else if("image/png"==i.mime_type||"image/bmp"==i.mime_type||"image/jpeg"==i.mime_type||"image/jpg"==i.mime_type||"image/gif"==i.mime_type){var e,d;(e=$("<button>")).addClass("btn btn-default btn-sm"),e.text(FileShortName(i.nome_arquivo)),e.unbind("click"),e.click(function(){View.load("central_documentos/visualizar_documento",function(i,t){t.show(n)})}),(l=$("<a>")).attr("type","button"),l.addClass("btn btn-default btn-sm"),l.attr("title",i.nome_arquivo),l.attr("value",i.documento_revisao_id),(d=$("<span>")).addClass("glyphicon glyphicon-download-alt"),l.append(d),a.append(e),a.append(l)}else{var l;(l=$("<a>")).attr("type","button"),l.addClass("btn btn-default btn-sm"),l.attr("title",i.nome_arquivo),l.text(FileShortName(i.nome_arquivo)),l.attr("value",i.documento_revisao_id),a.append(l)}o.append(a),o.append("&nbsp;&nbsp;&nbsp;"),l.unbind("click"),l.click(function(){App.obter_token_publico(function(i){App.download(WS_URI+"documento/download/?documento_revisao_id="+n+"&token_publico="+i)})}),$(t.div_anexos.find(".anexos")).append(o)}(n)})},this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("email_job/excluir/",{email_job_ids:JSON.stringify(selecionados)},function(i){t.listar()},[t.btn_enviar,t.btn_listar,t.btn_excluir])}),this.btn_fechar.unbind("click"),this.btn_fechar.click(function(){t.unload()}),this.unload=function(){t.close(),View.unload(this.html_id)}}});