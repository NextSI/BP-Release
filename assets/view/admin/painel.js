define([],function(){return function(a){"use strict";var o=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title="Admin",this.info_versao=this.dialog.find(".info_versao"),this.info_qtd_atualizacoes=this.dialog.find(".info_qtd_atualizacoes"),this.info_php_version=this.dialog.find(".info_php_version"),this.info_mysql_version=this.dialog.find(".info_mysql_version"),this.barra_progresso_atualizacao=this.dialog.find(".barra_progresso_atualizacao"),this.barra_progresso_recursos=this.dialog.find(".barra_progresso_recursos"),this.painel_atualizacao_log=this.dialog.find(".painel_atualizacao_log"),this.btn_iniciar_atualizacao=this.dialog.find(".btn_iniciar_atualizacao"),this.btn_atualizar_recursos=this.dialog.find(".btn_atualizar_recursos"),this.menu_reprocessar_central_de_pendencias=this.dialog.find(".menu_reprocessar_central_de_pendencias"),this.btn_historico_atualizacoes=this.dialog.find(".btn_historico_atualizacoes"),this.versoes_modal=this.dialog.find(".versoes_modal"),this.versoes=this.dialog.find(".versoes"),this.update_progress=this.dialog.find(".update-progress"),this.div_info_php=this.dialog.find(".div_info_php"),this.div_info_mysql=this.dialog.find(".div_info_mysql"),this.informacoes_servidor=null,this.atualizacoes_estrutura=null,this.atualizacoes_recursos=null,this.atualizacao_index=0,this.atualizacao_recurso_index=0,this.atualizacao_estrutura_andamento=!1,this.atualizacao_recurso_andamento=!1,this.show=function(){o.info_versao.text(App.version),o.get_info_php(),WS.get({route:"dbu/pendentes/",data:{session_id:App.sessao},func_response:function(a){a&&(o.info_qtd_atualizacoes.text(a.pendentes.length),o.atualizacoes_estrutura=a.pendentes,o.atualizacoes_recursos=a.recursos)},func_fail:function(a){}}),o.menu_reprocessar_central_de_pendencias.find("a").each(function(a){$(this).on("click",function(a){var s="/dbu/cp/"+$(this).attr("rota");o.atualiza_log("Reprocessando Central de Pendências "+$(this).attr("rota")),WS.post({route:s,data:{session_id:App.sessao},func_response:function(a){o.atualiza_log(""),o.atualiza_log("Reprocessamento concluído!")},func_fail:function(a){if(a&&a.validation&&a.validation.messages[0]){o.atualiza_log("Falhou:","text-danger");for(var s=0;s<a.validation.messages.length;s++)o.atualiza_log(a.validation.messages[s].message.trim(),"text-danger")}else o.atualiza_log("Falhou!","text-danger")}})})})},this.iniciar_atualizacao=function(a){o.atualiza_log("Aplicando atualização #"+a),o.atualiza_barra_progresso_atualizacao(o.atualizacao_index),WS.post({route:"dbu/exec/"+a,data:{session_id:App.sessao},func_response:function(a){o.atualiza_log("OK"),o.atualizacao_index++,o.info_qtd_atualizacoes.text(o.atualizacoes_estrutura.length-o.atualizacao_index),void 0!==o.atualizacoes_estrutura[o.atualizacao_index]&&o.iniciar_atualizacao(o.atualizacoes_estrutura[o.atualizacao_index]),o.atualizacao_index==o.atualizacoes_estrutura.length&&(o.atualiza_log(""),o.atualiza_log("Atualização da estrutura concluída!"),o.atualizacao_estrutura_andamento=!1,o.btn_atualizar_recursos.trigger("click"))},func_fail:function(a){if(a&&a.validation&&a.validation.messages[0]){o.atualiza_log("Falhou:","text-danger");for(var s=0;s<a.validation.messages.length;s++)o.atualiza_log(a.validation.messages[s].message.trim(),"text-danger")}else o.atualiza_log("Falhou!","text-danger");o.atualizacao_estrutura_andamento=!1}})},this.atualizar_recursos=function(a){o.atualiza_log("Aplicando recurso #"+a),o.atualiza_barra_progresso_recurso(o.atualizacao_recurso_index),WS.post({route:"dbu/exec_recurso/"+a,data:{session_id:App.sessao},func_response:function(a){o.atualiza_log("OK"),o.atualizacao_recurso_index++,void 0!==o.atualizacoes_recursos[o.atualizacao_recurso_index]&&o.atualizar_recursos(o.atualizacoes_recursos[o.atualizacao_recurso_index]),o.atualizacao_recurso_index==o.atualizacoes_recursos.length&&(o.atualiza_log(""),o.atualiza_log("Atualização da recursos concluída!"),o.atualizacao_estrutura_andamento=!1,o.atualizacao_recurso_andamento=!1)},func_fail:function(a){if(a&&a.validation&&a.validation.messages[0]){o.atualiza_log("Falhou:","text-danger");for(var s=0;s<a.validation.messages.length;s++)o.atualiza_log(a.validation.messages[s].message.trim(),"text-danger")}else o.atualiza_log("Falhou!","text-danger");o.atualizacao_recurso_andamento=!1}})},this.atualiza_log=function(a,s){void 0!==s&&(a='<span class="'+s+'">'+a+"</span>"),o.painel_atualizacao_log.append(a+"\n"),o.painel_atualizacao_log[0].scrollTop=o.painel_atualizacao_log[0].scrollHeight},this.atualiza_barra_progresso_atualizacao=function(a,s){if(s)o.barra_progresso_atualizacao.prop("aria-valuenow","0"),o.barra_progresso_atualizacao.css("width","0%"),o.barra_progresso_atualizacao.find("span").text("0%");else if(null!==a){var i=Math.round((a+1)/o.atualizacoes_estrutura.length*100);o.barra_progresso_atualizacao.prop("aria-valuenow",i),o.barra_progresso_atualizacao.css("width",i+"%"),o.barra_progresso_atualizacao.find("span").text(i+"%"),i>=100?o.barra_progresso_atualizacao.removeClass("progress-bar-info").addClass("progress-bar-success"):o.barra_progresso_atualizacao.removeClass("progress-bar-success").addClass("progress-bar-info")}},this.atualiza_barra_progresso_recurso=function(a,s){if(s)o.barra_progresso_recursos.prop("aria-valuenow","0"),o.barra_progresso_recursos.css("width","0%"),o.barra_progresso_recursos.find("span").text("0%");else if(null!==a){var i=Math.round((a+1)/o.atualizacoes_recursos.length*100);o.barra_progresso_recursos.prop("aria-valuenow",i),o.barra_progresso_recursos.css("width",i+"%"),o.barra_progresso_recursos.find("span").text(i+"%"),i>=100?o.barra_progresso_recursos.removeClass("progress-bar-info").addClass("progress-bar-success"):o.barra_progresso_recursos.removeClass("progress-bar-success").addClass("progress-bar-info")}},this.get_info_php=function(){WS.get({route:"dbu/informacoes_servidor/",data:{session_id:App.sessao},func_response:function(a){o.informacoes_servidor=a,o.info_php_version.text(o.informacoes_servidor.php_version),o.info_mysql_version.text(o.informacoes_servidor.mysql_version),o.div_info_mysql.html(o.informacoes_servidor.mysql_status),o.div_info_php.html(o.informacoes_servidor.php_info)},func_fail:function(a){}})},o.btn_iniciar_atualizacao.on("click",function(){o.atualizacoes_estrutura.length>0?o.atualizacao_estrutura_andamento||o.atualizacao_recurso_andamento||(o.atualizacao_index=0,o.atualiza_log(""),o.atualiza_log("Iniciando atualização de estrutura..."),o.atualiza_barra_progresso_atualizacao(null,!0),o.atualizacao_estrutura_andamento=!0,o.iniciar_atualizacao(o.atualizacoes_estrutura[0])):(o.atualiza_log(""),o.atualiza_log("Nenhuma atualização de estrutura disponível"))}),o.btn_atualizar_recursos.on("click",function(){o.atualizacoes_recursos.length>0?o.atualizacao_estrutura_andamento||o.atualizacao_recurso_andamento||(o.atualizacao_recurso_index=0,o.atualiza_log(""),o.atualiza_log("Iniciando atualização dos recursos..."),o.atualiza_barra_progresso_recurso(null,!0),o.atualizacao_recurso_andamento=!0,o.atualizar_recursos(o.atualizacoes_recursos[0])):(o.atualiza_log(""),o.atualiza_log("Nenhuma atualização de recurso disponível"))}),o.btn_historico_atualizacoes.on("click",function(){ReactDOM.unmountComponentAtNode(o.versoes[0]),o.versoes_modal.modal("show"),ReactDOM.render(React.createElement(window.views.admin.AtualizacaoHistorico.default),o.versoes[0])});const s=()=>{o.div_info_php.hide(),o.div_info_mysql.hide(),o.update_progress.show()};o.info_versao.on("click",s),o.info_qtd_atualizacoes.on("click",s),o.info_mysql_version.on("click",()=>{o.div_info_mysql.html(""),o.get_info_php(),o.update_progress.hide(),o.div_info_php.hide(),o.div_info_mysql.show()}),o.info_php_version.on("click",()=>{o.div_info_php.html(""),o.get_info_php(),o.update_progress.hide(),o.div_info_mysql.hide(),o.div_info_php.show()}),this.show()}});