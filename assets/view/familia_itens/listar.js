define([],function(){return function(a){"use strict";var t=this;this.html_id=a,this.dialog=$("#"+this.html_id),this.title=App.lang.familia_itens.aba_listar,this.onclose=null,this.params={limite:0},this.params_template={limite:0,considerar_bloqueado:!1},this.limite=0,this.incrementar_limite=!1,this.limite_a_cada=50,this.controle_ignore_error=!1,this.ultimo_limite_incrementado=0,this.bloqueia_limite=!1,this.btn_novo_analitico=this.dialog.find(".btn_novo_analitico"),this.btn_novo_sintetico=this.dialog.find(".btn_novo_sintetico"),this.btn_atualizar=this.dialog.find(".btn_atualizar"),this.btn_limpar_filtros=this.dialog.find(".btn_limpar_filtros"),this.btn_ordenacao=this.dialog.find(".orderbypointer"),this.btn_config=this.dialog.find(".btn_config"),this.btn_filtro=this.dialog.find(".btn_filtro"),this.container_filtro=this.dialog.find("[filtro]"),this.chk_mostrar_bloqueados=this.dialog.find(".chk_mostrar_bloqueados"),this.chk_codigo_automatico=this.dialog.find(".chk_codigo_automatico"),this.btn_carregar_mais=this.dialog.find(".btn_carregar_mais"),this.tab_listagem=this.dialog.find(".tab_listagem").Tabela_Padrao_Next(),this.show=function(){t.inicializar_componentes(),t.listar(!0)},this.listar=function(a){if(void 0!==a&&"boolean"==typeof a||(a=!1),!t.bloqueia_limite){t.params.limite=t.limite,t.params.considerar_bloqueado=t.chk_mostrar_bloqueados.prop("checked");var i=function(a,i){var e=i.pai_id,n=i.id,r=i.raiz_id;i=extender_parametros({codigo:"-",descricao:"-"},i);var o=$.Tabela_Padrao_Next.create_row(t.tab_listagem);o.attr("elem-key",n),o.attr("parent-key",e),o.attr("nivel",i.nivel),o.attr("data-retraido","false"),o.attr("data-parent-retraido","false"),o.attr("data-tipo","simples"),o.attr("raiz-id",r),o.css({cursor:"pointer"}),$.Tabela_Padrao_Next.getColumn(o,"codigo").text(i.codigo);var l=$.Tabela_Padrao_Next.getColumn(o,"descricao .nome").text(i.descricao),s=$.Tabela_Padrao_Next.getColumn(o,"acao"),c=$.Tabela_Padrao_Next.getColumn(s,"btn_visualizar"),_=$.Tabela_Padrao_Next.getColumn(s,"btn_editar"),d=$.Tabela_Padrao_Next.getColumn(s,"btn_excluir"),m=$.Tabela_Padrao_Next.getColumn(s,"btn_novo_menu"),f=$.Tabela_Padrao_Next.getColumn(m,"btn_novo_sintetico"),u=$.Tabela_Padrao_Next.getColumn(m,"btn_novo_analitico"),b=function(a,i){var e=$(a);i&&(e=$(a).parents("tr"));var n="true"==e.attr("data-retraido");e.attr("data-retraido",!n),e.attr("data-parent-retraido",!n),t.retrair(e,!n)};if(c.unbind("click").click(function(a){t.evento_visualizar($(this),i)}),_.unbind("click").click(function(a){t.evento_editar($(this),i)}),d.unbind("click").click(function(a){t.evento_excluir($(this),i)}),$.Tabela_Padrao_Next.addEvent(o,{nome:"dblclick",func:function(a){b($(this),!0)}}),i.tipo==TIPO_ARVORE.ANALITICO)l.css("padding-left",15*i.nivel+"px"),m.remove();else if(i.tipo==TIPO_ARVORE.SINTETICO){var h=$.Tabela_Padrao_Next.getColumn(o,"descricao .glyphicon").removeClass("hidden").css({"padding-left":15*i.nivel+"px","font-weight":"bold"});f.unbind("click").click(function(a){View.load("familia_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.SINTETICO,pai_id:n};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),u.unbind("click").click(function(a){View.load("familia_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.ANALITICO,pai_id:n};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),$.Tabela_Padrao_Next.addEvent(h,{nome:"click",func:function(a){b($(this),!0)}})}0==e?$.Tabela_Padrao_Next.RenderAt(t.tab_listagem,o,0):$.Tabela_Padrao_Next.RenderRow(t.tab_listagem,o,e)};WS.get({route:"familia_itens/listar/",data:t.params,func_response:function(e){if(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.carregar_mais_registros),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-arrow-down"></span>'),e){a&&(t.limite=t.limite+t.limite_a_cada);for(var n=0;n<e.length;n++){var r=e[n];i(0,r)}0==e.length&&(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.todos_carregados),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-check"></span>'),t.bloqueia_limite=!0)}},html_id:t.html_id,disable_buttons:[t.btn_atualizar,t.btn_limpar_filtros]})}},this.limpar_tabela=function(){$.Tabela_Padrao_Next.clear(t.tab_listagem),t.params.limite=0,t.limite=0,t.bloqueia_limite=!1},this.unload=function(){View.unload(this.html_id)},this.inicializar_componentes=function(){t.container_filtro.toggle(!1),0==App.sessao.dados.admin&&t.chk_codigo_automatico.parent().remove(),$.Tabela_Padrao_Next.Filtros.Start(t.tab_listagem,{},function(a,i,e){t.params=extender_parametros(t.params_template,a),setTimeout(function(){t.evento_atualizar()},600)})},this.evento_atualizar=function(){t.limpar_tabela(),t.listar(!0)},this.evento_visualizar=function(a,i){View.load("familia_itens/detalhes",function(a,e){var n={tipo:FORMULARIO.VISUALIZAR,familia_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(n)},View.ABA.SIM)},this.evento_editar=function(a,i){View.load("familia_itens/detalhes",function(a,e){var n={tipo:FORMULARIO.EDITAR,familia_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(n)},View.ABA.SIM)},this.evento_excluir=function(a,i){View.load("familia_itens/detalhes",function(a,e){var n={tipo:FORMULARIO.EXCLUIR,familia_itens_id:i.id};e.onclose=function(){t.evento_atualizar()},e.show(n)},View.ABA.SIM)},this.func_organizacao=function(a,i){t.limpar_tabela(),t.params=t.params_template,t.params.orderby=a,t.params.asc=i,setTimeout(function(){t.listar(!0)},300)},this.retrair=function(a,t){void 0===t&&(t=!1);var i=parseInt($(a).attr("nivel"),10),e=parseInt($(a).attr("raiz-id"),10),n=$(a).find('[data-bp-column="descricao"] [template-button="btn_efect"]'),r=$(a).nextAll('[raiz-id="'+e+'"]');$(a).attr("data-parent-retraido",t);for(var o=0;o<r.length;o++){if(!(i<parseInt($(r[o]).attr("nivel"),10)))return;if(t)$(n).removeClass("glyphicon-triangle-bottom"),$(n).addClass("glyphicon-triangle-right"),$(r[o]).attr("data-retraido","true"),void 0!==$(r[o]).attr("data-retraido-by")&&null!=$(r[o]).attr("data-retraido-by")&&""!=$(r[o]).attr("data-retraido-by")||$(r[o]).attr("data-retraido-by",md5($(a).attr("elem-key"))),$(r[o]).animate({opacity:0},{duration:200,complete:function(){$(this).addClass("hidden")}});else{$(n).addClass("glyphicon-triangle-bottom"),$(n).removeClass("glyphicon-triangle-right");var l=md5($(a).attr("elem-key"));$(r[o]).attr("data-retraido-by")==l&&($(r[o]).attr("data-retraido-by",""),$(r[o]).removeClass("hidden").animate({opacity:1},200)),"A"==$(r[o]).attr("data-tipo")?$(r[o]).attr("data-retraido","false"):"S"==$(r[o]).attr("data-tipo")&&($(r[o]).attr("data-retraido","false"),$(r[o]).attr("data-parent-retraido","false"))}}},this.btn_atualizar.unbind("click").click(function(a){t.evento_atualizar()}),this.btn_limpar_filtros.unbind("click").click(function(a){$.tabela_padrao_bp_filtro("clean",t.html_id,t.tab_listagem),t.chk_mostrar_bloqueados.prop("checked",!1).trigger("change"),t.params=t.params_template,t.limpar_tabela(),t.listar(!0)}),this.btn_novo_sintetico.unbind("click").click(function(a){View.load("familia_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.SINTETICO};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),this.btn_novo_analitico.unbind("click").click(function(a){View.load("familia_itens/detalhes",function(a,i){var e={tipo_arvore:TIPO_ARVORE.ANALITICO};i.onclose=function(){t.evento_atualizar()},i.show(e)},View.ABA.SIM)}),this.btn_ordenacao.unbind("click").click(function(a){var i=$(this),e=$(i).attr("data-ordername"),n=$(i).attr("data-asc");if(0===n.length){for(var r=0;r<t.btn_ordenacao.length;r++)if($(t.btn_ordenacao[r])!==$(i)){try{$(t.btn_ordenacao[r]).find(".icon_orderby").removeClass("fa-sort-up fa-sort-down").addClass("hidden fa-sort-down")}catch(a){}$(t.btn_ordenacao[r]).attr("data-asc","")}n=!0,$(i).attr("data-asc",n),$(i).find(".icon_orderby").removeClass("hidden")}else n=!(n="true"==n),$(i).attr("data-asc",n),$(i).find(".icon_orderby").toggleClass("fa-sort-down fa-sort-up");t.func_organizacao(e,n)}),this.btn_filtro.unbind("click").click(function(a){var i=$(this).prop("data-active");i=!i,$(this).prop("data-active",i),t.container_filtro.toggle(i)}),this.btn_config.unbind("click").click(function(a){View.load("familia_itens/configuracao",function(a,t){t.show()})}),this.btn_carregar_mais.unbind("click").click(function(){t.bloqueia_limite||(t.btn_carregar_mais.find("span.txt_carregar_mais").text(App.lang.btn_carregar_mais.aguarde),t.btn_carregar_mais.find("span.icn_carregar_mais").remove(),t.btn_carregar_mais.append('<span class="icn_carregar_mais fa fa-spinner fa-spin">'),t.listar(!0))}),t.show()}});