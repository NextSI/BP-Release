define([],function(){return function(o){"use strict";var i=this;this.html_id=o,this.dialog=$("#"+this.html_id),this.title=App.lang.tipo_item.aba_detalhes,this.onclose=null,this.params={tipo_itens_id:null,tipo:FORMULARIO.NOVO},this.codigo_automatico=!1,this.cbo_motivo=this.dialog.find(".cbo_motivo"),this.cbo_local=this.dialog.find(".cbo_local"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.edt_descricao=this.dialog.find(".edt_descricao"),this.edt_codigo=this.dialog.find(".edt_codigo"),this.aba_geral=this.dialog.find(".aba_geral"),this.aba_modulo=this.dialog.find(".aba_modulo"),this.menu_geral=this.dialog.find(".menu_geral"),this.menu_modulo=this.dialog.find(".menu_modulo"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.chk_modulo_crm=this.dialog.find(".chk_modulo_crm"),this.chk_modulo_projeto=this.dialog.find(".chk_modulo_projeto"),this.show=function(o){switch(i.params=extender_parametros(i.params,o),i.inicializar_componentes(),null!=i.params.tipo_itens_id&&i.preencher(),i.params.tipo){case FORMULARIO.NOVO:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0),set_focus(i.edt_codigo);break;case FORMULARIO.EDITAR:i.btn_salvar.show(),i.btn_excluir.hide(),i.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:i.btn_salvar.hide(),i.btn_excluir.hide(),i.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:i.btn_salvar.hide(),i.btn_excluir.show(),i.permite_alterar(!1)}},this.preencher=function(){WS.get({route:"tipo_itens/objeto/",data:{tipo_itens_id:i.params.tipo_itens_id},func_response:function(o){if(o){var t=spread({},{codigo:"",descricao:"",bloqueado:i.chk_bloqueado.prop("checked"),modulo_projeto:i.chk_modulo_projeto.prop("checked"),modulo_crm:i.chk_modulo_crm.prop("checked")},{codigo:o.codigo,descricao:o.descricao,bloqueado:o.bloqueado,modulo_projeto:o.modulos.projeto,modulo_crm:o.modulos.crm});i.edt_codigo.val(t.codigo),i.edt_descricao.val(t.descricao),i.chk_bloqueado.prop("checked",t.bloqueado).trigger("change"),i.chk_modulo_crm.prop("checked",t.modulo_crm).trigger("change"),i.chk_modulo_projeto.prop("checked",t.modulo_projeto).trigger("change"),i.params.tipo!=FORMULARIO.NOVO&&i.params.tipo!=FORMULARIO.EDITAR&&(i.chk_modulo_crm.prop("disabled",!0),i.chk_modulo_projeto.prop("disabled",!0),i.chk_bloqueado.prop("disabled",!0))}}})},this.permite_alterar=function(o){i.edt_descricao.prop("readonly",!o),i.edt_codigo.prop("readonly",!o)},this.close=function(){void 0!==i.onclose&&i.onclose&&i.onclose()},this.unload=function(){i.close(),View.unload(this.html_id)},this.inicializar_componentes=function(){null==i.params.tipo_itens_id&&i.carregar_configuracoes(function(){i.codigo_automatico&&i.get_next_codigo()}),i.aba_geral.attr("id","aba_geral"+i.html_id),i.aba_modulo.attr("id","aba_modulo"+i.html_id),i.menu_geral.attr("href","#"+i.aba_geral.attr("id")),i.menu_modulo.attr("href","#"+i.aba_modulo.attr("id"))},this.get_next_codigo=function(){WS.get("tipo_itens/gerar_codigo/",null,function(o){o&&i.edt_codigo.val(o)})},this.carregar_configuracoes=function(o){WS.get("tipo_itens/get_parametro/",null,function(t){t&&(i.codigo_automatico="S"==t.tipo_itens_codigo_automatico,void 0!==o&&o())})},this.btn_salvar.unbind("click").click(function(o){var t={tipo_itens_id:i.params.tipo_itens_id,descricao:i.edt_descricao.val(),codigo:i.edt_codigo.val(),bloqueado:i.chk_bloqueado.prop("checked"),modulos:JSON.stringify({projeto:i.chk_modulo_projeto.prop("checked"),crm:i.chk_modulo_crm.prop("checked")})},e=extender_parametros({tipo_itens_id:null,descricao:null,codigo:null},t);WS.post({route:"tipo_itens/salvar",data:e,type:"POST",func_response:function(o){o&&(alert_saved(App.lang.tipo_item.alerta+e.descricao+App.lang.tipo_item.alerta_salvo),i.unload())},disable_buttons:[i.btn_salvar,i.btn_cancelar]})}),this.btn_excluir.unbind("click").click(function(o){WS.post({route:"tipo_itens/excluir",data:{tipo_itens_id:i.params.tipo_itens_id},type:"POST",func_response:function(o){o&&(alert_saved(App.lang.tipo_item.alerta+i.edt_descricao.val()+App.lang.tipo_item.alerta_exclusao),i.unload())},disable_buttons:[i.btn_excluir,i.btn_cancelar]})}),this.btn_cancelar.unbind("click").click(function(o){i.unload()})}});