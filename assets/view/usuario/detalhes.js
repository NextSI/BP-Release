define(["react","react-dom"],function(a,i){return function(e){"use strict";var o,r=this;this.html_id=e,this.dialog=$("#"+this.html_id),this.title="Usuário",this.tipo=null,this.onclose=null,this.scrollview=this.dialog.find(".scrollview"),this.edt_id=this.dialog.find(".edt_id"),this.div_nome_usuario=this.dialog.find(".div_nome_usuario"),this.div_id_usuario=this.dialog.find(".div_id_usuario"),this.edt_nome=this.dialog.find(".edt_nome"),this.edt_email=this.dialog.find(".edt_email"),this.edt_username=this.dialog.find(".edt_username"),this.edt_senha=this.dialog.find(".edt_senha"),this.files=this.dialog.find(".files"),this.carrega_img=this.dialog.find(".carrega_img"),this.btn_exibir_senha=this.dialog.find(".btn_exibir_senha"),this.chk_bloqueado=this.dialog.find(".chk_bloqueado"),this.div_chk_admin=this.dialog.find(".div_chk_admin"),this.chk_admin=this.dialog.find(".chk_admin"),this.chk_alterar_senha_proximo_login=this.dialog.find(".chk_alterar_senha_proximo_login"),this.chk_nunca_expirar_senha=this.dialog.find(".chk_nunca_expirar_senha"),this.cbo_area=this.dialog.find(".cbo_area"),this.btn_area_novo=this.dialog.find(".btn_area_novo"),this.cbo_calendario_trabalho=this.dialog.find(".cbo_calendario_trabalho"),this.btn_calendario_trabalho_novo=this.dialog.find(".btn_calendario_trabalho_novo"),this.edt_codigo_externo=this.dialog.find(".edt_codigo_externo"),this.btn_cancelar=this.dialog.find(".btn_cancelar"),this.btn_salvar=this.dialog.find(".btn_salvar"),this.btn_excluir=this.dialog.find(".btn_excluir"),this.btn_incluir_cliente=this.dialog.find(".btn_incluir_cliente"),this.tab_listagem_cliente=this.dialog.find(".tab_listagem_cliente"),this.div_cliente=this.dialog.find(".div_cliente"),this.modal_usuario_cbo_area=this.dialog.find(".modal_usuario_cbo_area"),this.modal_usuario_cbo_calendario_trabalho=this.dialog.find(".modal_usuario_cbo_calendario_trabalho"),this.lbl_tipo=this.dialog.find(".lbl_tipo"),this.edt_nivel=this.dialog.find(".edt_nivel"),this.cbo_tipo=this.dialog.find(".cbo_tipo"),this.btn_incluir_empresa=this.dialog.find(".btn_incluir_empresa"),this.btn_incluir_fornecedor=this.dialog.find(".btn_incluir_fornecedor"),this.btn_incluir_prospect=this.dialog.find(".btn_incluir_prospect"),this.tab_listagem_fornecedor=this.dialog.find(".tab_listagem_fornecedor"),this.div_fornecedor=this.dialog.find(".div_fornecedor"),this.div_prospect=this.dialog.find(".div_prospect"),this.tab_listagem_prospect=this.dialog.find(".tab_listagem_prospect"),this.btn_incluir_grupo_motivo=this.dialog.find(".btn_incluir_grupo_motivo"),this.tab_listagem_grupo_motivo=this.dialog.find(".tab_listagem_grupo_motivo"),this.div_grupo_motivo=this.dialog.find(".div_grupo_motivo"),this.div_grupo_usuarios=this.dialog.find(".div_grupo_usuarios"),this.div_user_comum=this.dialog.find(".div_user_comum"),this.tab_listagem_empresa=this.dialog.find(".tab_listagem_empresa"),this.div_empresa=this.dialog.find(".div_empresa"),this.tab_dados_gerais=this.dialog.find(".tab_dados_gerais"),this.edt_telefone1=this.dialog.find(".edt_telefone1"),this.edt_telefone2=this.dialog.find(".edt_telefone2"),this.edt_telefone3=this.dialog.find(".edt_telefone3"),this.edt_telefone4=this.dialog.find(".edt_telefone4"),this.edt_cpf=this.dialog.find(".edt_cpf"),this.edt_data_nascimento=this.dialog.find(".edt_data_nascimento"),this.edt_data_admissao=this.dialog.find(".edt_data_admissao"),this.dx_cargo=this.dialog.find(".dx_cargo"),this.cbo_idiomas=this.dialog.find(".cbo_idiomas"),this.edt_assinatura=this.dialog.find(".edt_assinatura"),this.cbo_usuario_ldap=this.dialog.find(".cbo_usuario_ldap"),this.btn_listar_usuarios_ldap=this.dialog.find(".btn_listar_usuarios_ldap"),this.btn_limpar=this.dialog.find(".btn_limpar"),this.edt_usuario_ldap=this.dialog.find(".edt_usuario_ldap"),this.edt_senha_ldap=this.dialog.find(".edt_senha_ldap"),this.edt_servidor_ldap=this.dialog.find(".edt_servidor_ldap"),this.btn_autenticar_ldap=this.dialog.find(".btn_autenticar_ldap"),this.modal=this.dialog.find(".modal"),this.modal.attr("id",this.html_id+"_modal"),this.btn_fechar_modal=this.dialog.find(".btn_fechar_modal"),this.btn_validar_autenticacao=this.dialog.find(".btn_validar_autenticacao"),this.chk_ldap_entrar_entrar_automaticamente=this.dialog.find(".chk_ldap_entrar_entrar_automaticamente"),this.servidor_ldap_id=null,this.usuario_id=null,this.foto_id=null,this.arr_clientes=[],this.arr_clientes_filtrados=[],this.arr_prospects=[],this.arr_prospects_filtrados=[],this.arr_fornecedores=[],this.arr_fornecedores_filtrados=[],this.arr_grupo_motivo=[],this.arr_grupo_motivo_filtrados=[],this.arr_empresa=[],this.arr_empresa_filtrados=[],this.senha="",this.perfis_padrao=null,this.tipo_usuario_inicial=null,this.arr_grupos=[],this.cargo_id=null,this.show=function(a,i){switch(r.scrollview.dxScrollView().dxScrollView("instance"),r.scrollview.css("height","calc(100vh - 77px)"),r.edt_assinatura.attr("id","edt_assinatura"+r.html_id),r.edt_cpf.mask("999.999.999-99"),r.listar_perfis_padrao(),i){case FORMULARIO.NOVO:r.edt_email.val(""),r.edt_senha.val(""),r.div_id_usuario.remove(),r.div_nome_usuario.addClass("col-md-12").removeClass("col-md-10"),r.btn_salvar.show(),r.btn_excluir.hide(),r.edt_nivel.attr("max",parseInt(App.sessao.dados.nivel,10)),r.edt_nivel.val(10).trigger("change"),r.permite_alterar(!0);break;case FORMULARIO.EDITAR:r.btn_salvar.show(),r.btn_excluir.hide(),r.permite_alterar(!0);break;case FORMULARIO.VISUALIZAR:r.btn_salvar.hide(),r.btn_excluir.hide(),r.permite_alterar(!1);break;case FORMULARIO.EXCLUIR:r.btn_salvar.hide(),r.btn_excluir.show(),r.permite_alterar(!1)}r.tipo=i,void 0!==a&&a?(r.usuario_id=a,r.preencher(),1==a&&(r.edt_nome.prop("disabled",!0),r.div_user_comum.addClass("hidden"))):(App.titulo_aba(r.html_id,"Usuário - Novo"),r.listar_areas(),r.listar_calendario_trabalho(),r.cbo_tipo.change(),set_tinymce(r.edt_assinatura,""),r.render_selecao_grupo_usuarios(),r.render_dx_cargo()),App.verifica_permissao(App.temp.empresa,"gestao_chamados")?r.div_grupo_motivo.show():r.div_grupo_motivo.hide(),App.verifica_permissao(App.temp.empresa,"grupo_usuarios")?r.div_grupo_usuarios.show():r.div_grupo_usuarios.hide(),1==App.sessao.dados.admin&&r.div_chk_admin.removeClass("hidden"),set_focus(r.edt_nome)},this.close=function(){close_modal(r.modal.attr("id")),void 0!==r.onclose&&r.onclose&&r.onclose()},this.unload=function(){r.close(),View.unload(this.html_id)},this.permite_alterar=function(a){r.edt_id.prop("readonly",!0),r.edt_nome.prop("readonly",!a),r.edt_email.prop("readonly",!a),r.edt_username.prop("readonly",!a),r.edt_senha.prop("readonly",!a),r.chk_bloqueado.prop("checked",!a).change(),r.chk_alterar_senha_proximo_login.prop("checked",!a).change(),r.chk_nunca_expirar_senha.prop("checked",!a).change(),r.edt_telefone1.prop("readonly",!a),r.edt_telefone2.prop("readonly",!a),r.edt_telefone3.prop("readonly",!a),r.edt_telefone4.prop("readonly",!a),r.edt_cpf.prop("readonly",!a),r.edt_codigo_externo.prop("disabled",!a),r.edt_data_nascimento.prop("disabled",!a),r.edt_data_admissao.prop("disabled",!a),!0===App.sessao.dados.admin?r.chk_admin.prop("disabled",!a):r.chk_admin.prop("disabled",!0),r.files.prop("disabled",!a),r.cbo_area.prop("disabled",!a),r.btn_area_novo.prop("disabled",!a),r.cbo_calendario_trabalho.prop("disabled",!a),r.btn_calendario_trabalho_novo.prop("disabled",!a),r.edt_nivel.prop("disabled",!a),r.cbo_tipo.prop("disabled",!a),r.cbo_usuario_ldap.prop("disabled",!a),r.btn_incluir_empresa.prop("disabled",!a),r.btn_incluir_prospect.prop("disabled",!a),r.btn_incluir_fornecedor.prop("disabled",!a),r.btn_incluir_cliente.prop("disabled",!a),r.btn_incluir_grupo_motivo.prop("disabled",!a),r.btn_limpar.prop("disabled",!a),r.btn_listar_usuarios_ldap.prop("disabled",!a)},this.preencher=function(){WS.get("usuario/objeto/",{usuario_id:r.usuario_id},function(a){null!=a.nome&&App.titulo_aba(r.html_id,"Usuário - "+a.nome.substring(0,15)),r.edt_id.val(a.id),r.edt_nome.val(a.nome),r.edt_username.val(a.username),r.edt_email.val(a.email),App.sessao.dados.senhas_ocultas||App.sessao.dados.senhas_md5?(r.edt_senha.attr("placeholder","Alterar senha"),App.sessao.dados.senhas_md5||(r.senha=a.senha)):r.edt_senha.val(a.senha),r.edt_telefone1.val(a.telefone1),r.edt_telefone2.val(a.telefone2),r.edt_telefone3.val(a.telefone3),r.edt_telefone4.val(a.telefone4),r.edt_cpf.val(a.cpf),r.edt_codigo_externo.val(a.codigo_externo),r.edt_data_nascimento.val(a.data_nascimento),r.edt_data_admissao.val(a.data_admissao),set_tinymce(r.edt_assinatura,a.assinatura_email,r.tipo==FORMULARIO.VISUALIZAR||r.tipo==FORMULARIO.EXCLUIR),a.tipo==USUARIO_TIPO.CLIENTE?(r.arr_clientes=a.usuario_cliente,r.render_clientes()):a.tipo==USUARIO_TIPO.ANALISTA?(r.arr_empresa=a.usuario_empresa,r.render_empresa()):a.tipo==USUARIO_TIPO.FORNECEDOR?(r.arr_fornecedores=a.usuario_fornecedor,r.render_fornecedores()):a.tipo==USUARIO_TIPO.PROSPECT&&(r.arr_prospects=a.usuario_prospect,r.render_prospects()),r.tipo_usuario_inicial=a.tipo,"none"!=r.div_grupo_motivo.css("display")&&(r.arr_grupo_motivo=a.arr_grupo_motivo,r.render_grupo_motivo()),r.arr_grupos=a.grupo_usuarios?a.grupo_usuarios.map(function(a){return a.grupo_usuarios_id}):null,r.render_selecao_grupo_usuarios({selecionado:r.arr_grupos}),r.chk_bloqueado.prop("checked",a.bloqueado).change(),""!=a.ldap_login&&null!=a.ldap_login&&(a.alterar_senha_proximo_login=!1),r.chk_alterar_senha_proximo_login.prop("checked",a.alterar_senha_proximo_login).change(),r.chk_nunca_expirar_senha.prop("checked",a.nunca_expirar_senha).change();var i=r.chk_bloqueado.prop("disabled");r.chk_bloqueado.prop("disabled",!1),r.chk_admin.prop("disabled",!1),!0===a.bloqueado&&r.chk_bloqueado.prop("checked",!0).change(),!0===a.admin&&(r.chk_admin.prop("checked",!0).change(),r.cbo_tipo.find('option[value="1"]').remove(),r.cbo_tipo.find('option[value="4"]').remove(),r.cbo_tipo.find('option[value="5"]').remove()),null!=a.foto_id?"S"==a.foto_id.midia&&r.carrega_img.attr("src",WS_URI+"documento/midia/?documento_id="+a.foto_id.id+"&token_midia="+App.sessao.token_midia+"&anticache="+(new Date).getTime()):r.carrega_img.attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg"),r.chk_bloqueado.prop("disabled",i),r.chk_admin.prop("disabled",i),r.edt_nivel.val(a.nivel).trigger("change"),r.cbo_tipo.val(a.tipo),r.listar_areas(a.area_id),r.listar_calendario_trabalho(a.calendario_trabalho_id),r.servidor_ldap_id=a.servidor_ldap_id,a.ldap_login&&(add_option(r.cbo_usuario_ldap,"0",a.ldap_login),r.cbo_usuario_ldap.selectpicker(),r.cbo_usuario_ldap.selectpicker("refresh"),r.cbo_usuario_ldap.val(0).trigger("change")),o=a.tipo,r.cbo_tipo.change(),r.render_dx_cargo(a.cargo_id)})},this.listar_areas=function(a){r.cbo_area.find("option").remove(),add_option(r.cbo_area,"","Nenhum"),WS.get("area/listar/",null,function(i){for(var e=0;e<i.data.length;e++){var o=i.data[e];add_option(r.cbo_area,o.id,o.nome)}a&&r.cbo_area.val(a).trigger("change")})},this.listar_calendario_trabalho=function(a){r.cbo_calendario_trabalho.find("option").remove(),add_option(r.cbo_calendario_trabalho,"","Nenhum"),WS.get("calendario_trabalho/listar/",null,function(i){for(var e=0;e<i.length;e++){var o=i[e];add_option(r.cbo_calendario_trabalho,o.calendario_trabalho_id,o.nome)}a&&r.cbo_calendario_trabalho.val(a).trigger("change")})},this.preview_foto=function(a){if(0===$(this).get(0).files.length)r.carrega_img.attr("src","assets/img/icones_bp/imagem_usuario_padrao.svg"),$(this).parent().find(".anexo_base_button_text").text("Nenhum arquivo selecionado!");else{var i=a.target.files[0],e=new FileReader;e.onload=function(a){r.carrega_img.attr("src",a.target.result)},e.readAsDataURL(i),$(this).parent().find(".anexo_base_button_text").text($(this).val().split("fakepath\\").length>1?$(this).val().split("fakepath\\")[1].toString():$(this).val().split("fakepath\\")[0].toString())}},this.render_grupo_motivo=function(){var a=r.tab_listagem_grupo_motivo.find("tbody"),i=a.find("tr:first");$(r.arr_grupo_motivo).each(function(a,i){void 0===r.arr_grupo_motivo[a].removido&&(r.arr_grupo_motivo[a].removido=!1)}),r.arr_grupo_motivo_filtrados=r.arr_grupo_motivo.filter(function(a){var i=!0;return!0===a.removido&&(i=!1),i}),r.tab_listagem_grupo_motivo.find("tr:gt(1)").remove(),$(r.arr_grupo_motivo_filtrados).each(function(e,o){!function(e){var o=i.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_grupo_motivo']")).text(e.nome);var t=$(o.find(".btn_deletar_grupo_motivo"));switch(t.unbind("click"),t.click(function(){alert_modal("Grupo de Motivo do chamado","Deseja remover o grupo de motivo?","Remover",function(){$(r.arr_grupo_motivo).each(function(a,i){i.grupo_id==e.grupo_id&&(r.arr_grupo_motivo[a].removido=!0,r.render_grupo_motivo())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(a)}(o)}),App.aplicar_mascaras(a)},this.listar_perfis_padrao=function(){WS.get("perfil_padrao/listar/",null,function(a){r.perfis_padrao=a.lista_perfil_padrao})},this.render_clientes=function(){var a=r.tab_listagem_cliente.find("tbody"),i=a.find("tr:first");$(r.arr_clientes).each(function(a,i){void 0===r.arr_clientes[a].removido&&(r.arr_clientes[a].removido=!1)}),r.arr_clientes_filtrados=r.arr_clientes.filter(function(a){var i=!0;return!0===a.removido&&(i=!1),i}),r.tab_listagem_cliente.find("tr:gt(1)").remove(),$(r.arr_clientes_filtrados).each(function(e,o){!function(e){var o=i.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_cliente"));switch(t.unbind("click"),t.click(function(){alert_modal("Cliente","Deseja remover o cliente?","Remover",function(){$(r.arr_clientes).each(function(a,i){i.cliente_id==e.cliente_id&&(r.arr_clientes[a].removido=!0,r.render_clientes())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(a)}(o)}),App.aplicar_mascaras(a)},this.render_fornecedores=function(){var a=r.tab_listagem_fornecedor.find("tbody"),i=a.find("tr:first");$(r.arr_fornecedores).each(function(a,i){void 0===r.arr_fornecedores[a].removido&&(r.arr_fornecedores[a].removido=!1)}),r.arr_fornecedores_filtrados=r.arr_fornecedores.filter(function(a){var i=!0;return!0===a.removido&&(i=!1),i}),r.tab_listagem_fornecedor.find("tr:gt(1)").remove(),$(r.arr_fornecedores_filtrados).each(function(e,o){!function(e){var o=i.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_fornecedor"));switch(t.unbind("click"),t.click(function(){alert_modal("Fornecedor","Deseja remover o fornecedor?","Remover",function(){$(r.arr_fornecedores).each(function(a,i){i.fornecedor_id==e.fornecedor_id&&(r.arr_fornecedores[a].removido=!0,r.render_fornecedores())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(a)}(o)}),App.aplicar_mascaras(a)},this.render_empresa=function(){var a=r.tab_listagem_empresa.find("tbody"),i=a.find("tr:first");$(r.arr_empresa).each(function(a,i){void 0===r.arr_empresa[a].removido&&(r.arr_empresa[a].removido=!1)}),r.arr_empresa_filtrados=r.arr_empresa.filter(function(a){var i=!0;return!0===a.removido&&(i=!1),i}),r.tab_listagem_empresa.find("tr:gt(1)").remove(),$(r.arr_empresa_filtrados).each(function(e,o){!function(e){var o=i.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_empresa"));switch(t.unbind("click"),t.click(function(){alert_modal("Empresa","Deseja remover a empresa?","Remover",function(){$(r.arr_empresa).each(function(a,i){i.empresa_id==e.empresa_id&&(r.arr_empresa[a].removido=!0,r.render_empresa())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(a)}(o)}),App.aplicar_mascaras(a)},this.validar_campos_autenticacao=function(){var a=!0;""!=r.edt_usuario_ldap.val()&&""!=r.edt_senha_ldap.val()&&(a=!1),r.btn_validar_autenticacao.prop("disabled",a)},this.render_prospects=function(){var a=r.tab_listagem_prospect.find("tbody"),i=a.find("tr:first");$(r.arr_prospects).each(function(a,i){void 0===r.arr_prospects[a].removido&&(r.arr_prospects[a].removido=!1)}),r.arr_prospects_filtrados=r.arr_prospects.filter(function(a){var i=!0;return!0===a.removido&&(i=!1),i}),r.tab_listagem_prospect.find("tr:gt(1)").remove(),$(r.arr_prospects_filtrados).each(function(e,o){!function(e){var o=i.clone();o.removeAttr("template-row"),o.css("display",""),$(o.find("[template-field='nome_fantasia']")).text(e.nome_fantasia),$(o.find("[template-field='razao_social']")).text(e.razao_social);var t=$(o.find(".btn_deletar_prospect"));switch(t.unbind("click"),t.click(function(){alert_modal("prospect","Deseja remover o prospect?","Remover",function(){$(r.arr_prospects).each(function(a,i){i.prospect_id==e.prospect_id&&(r.arr_prospects[a].removido=!0,r.render_prospects())})},!0)}),r.tipo){case FORMULARIO.VISUALIZAR:case FORMULARIO.EXCLUIR:t.prop("disabled",!0)}o.appendTo(a)}(o)}),App.aplicar_mascaras(a)},this.render_selecao_grupo_usuarios=function(e){e||(e={});var o={aoAlterar:function(a){r.arr_grupos=a}};Object.assign(o,e),i.render(a.createElement(window.components.SelecaoGrupoUsuarios.default,o),r.div_grupo_usuarios[0])},this.render_dx_cargo=function(e){r.cargo_id=e,i.render(a.createElement(window.components.SelecaoCargo.default,{selecionado:e,readOnly:r.tipo==FORMULARIO.VISUALIZAR||r.tipo==FORMULARIO.EXCLUIR,dataGridSearchPanelEnabled:!1,dataGridExportEnabled:!1,dataGridColumnChooserEnabled:!1,aoAlterar:a=>{r.cargo_id=a}}),r.dx_cargo[0])},this.btn_exibir_senha.unbind("click"),this.btn_exibir_senha.click(function(){var a=r.btn_exibir_senha.find(".ico_senha");"password"==r.edt_senha.attr("type")?(r.edt_senha.attr("type","text"),a.removeClass("glyphicon-eye-open"),a.addClass("glyphicon glyphicon-eye-close")):(r.edt_senha.attr("type","password"),a.removeClass("glyphicon-eye-close"),a.addClass("glyphicon glyphicon-eye-open"))}),this.edt_usuario_ldap.blur(function(){r.validar_campos_autenticacao()}),this.edt_senha_ldap.blur(function(){r.validar_campos_autenticacao()}),this.btn_area_novo.unbind("click"),this.btn_area_novo.click(function(){View.load("area/detalhes",function(a,i){i.onclose=function(){i.area_id&&r.listar_areas(i.area_id)},i.show(null,FORMULARIO.NOVO)})}),this.btn_calendario_trabalho_novo.unbind("click"),this.btn_calendario_trabalho_novo.click(function(){View.load("calendario_trabalho/detalhes",function(a,i){i.onclose=function(){i.calendario_trabalho_id&&r.listar_calendario_trabalho(i.calendario_trabalho_id)},i.show(null,FORMULARIO.NOVO)})}),this.btn_cancelar.unbind("click"),this.btn_cancelar.click(function(){r.unload()}),this.btn_salvar.unbind("click"),this.btn_salvar.click(function(){if($.each(r.files,function(a,i){i.files.length>0&&(r.foto_id=i.files[0])}),new RegExp(/^[A-Za-z0-9@._-]+$/).test(r.edt_username.val().trim())||""==r.edt_username.val().trim()||null==r.edt_username.val().trim())var a=setInterval(function(){var i=function(){WS.post("usuario/salvar",{usuario_id:r.usuario_id,nome:r.edt_nome.val(),email:r.edt_email.val(),username:r.edt_username.val().trim(),senha:""==r.edt_senha.val()?r.senha:r.edt_senha.val(),admin:1==r.chk_admin.prop("checked")?"S":"N",alterar_senha_proximo_login:1==r.chk_alterar_senha_proximo_login.prop("checked")?"S":"N",nunca_expirar_senha:1==r.chk_nunca_expirar_senha.prop("checked")?"S":"N",bloqueado:1==r.chk_bloqueado.prop("checked")?"S":"N",area_id:r.cbo_area.val(),calendario_trabalho_id:r.cbo_calendario_trabalho.val(),usuario_cliente:JSON.stringify(r.arr_clientes_filtrados),usuario_fornecedor:JSON.stringify(r.arr_fornecedores_filtrados),usuario_prospect:JSON.stringify(r.arr_prospects_filtrados),arr_grupo_motivo:JSON.stringify(r.arr_grupo_motivo_filtrados),usuario_empresa:JSON.stringify(r.arr_empresa_filtrados),nivel:r.edt_nivel.val(),tipo:r.cbo_tipo.val(),foto_id:r.foto_id,telefone1:r.edt_telefone1.val(),telefone2:r.edt_telefone2.val(),telefone3:r.edt_telefone3.val(),telefone4:r.edt_telefone4.val(),cpf:r.edt_cpf.val(),data_nascimento:r.edt_data_nascimento.val(),data_admissao:r.edt_data_admissao.val(),assinatura_email:get_tinymce(r.edt_assinatura),ldap_login:""!=r.cbo_usuario_ldap.val()?r.cbo_usuario_ldap.find("option:selected").text():"",servidor_ldap_id:r.servidor_ldap_id,codigo_externo:r.edt_codigo_externo.val(),grupo_usuarios:JSON.stringify(r.arr_grupos),cargo_id:r.cargo_id},function(a){r.usuario_id=a.id,alert_saved(a.nome+" salvo com sucesso"),r.unload()},null,null,!0)};r.tipo==FORMULARIO.EDITAR?WS.post("perfil_padrao_permissao/existe",{tipo_usuario:r.cbo_tipo.val()},function(a){a&&r.cbo_tipo.val()!=r.tipo_usuario_inicial?function(){if(null!==r.perfis_padrao&&r.perfis_padrao.length>0){var a=null,e="",t="";if(o!=r.cbo_tipo.val()&&""!=(o=r.cbo_tipo.val())){for(var n=0;n<r.perfis_padrao.length;n++)if(r.perfis_padrao[n].codigo==o){a={calendario_trabalho:null==r.perfis_padrao[n].calendario_trabalho_id?0:r.perfis_padrao[n].calendario_trabalho_id,nivel:r.perfis_padrao[n].nivel,area:null==r.perfis_padrao[n].area_id?0:r.perfis_padrao[n].area_id};break}a&&(0!=a.calendario_trabalho&&(e=r.cbo_calendario_trabalho.find('option[value="'+a.calendario_trabalho+'"]').text()),0!=a.area&&(t=r.cbo_area.find('option[value="'+a.area+'"]').text()),alert_modal("Sugestão","Deseja alterar os seguintes dados: <br><br>"+(0!=a.calendario_trabalho&&r.cbo_calendario_trabalho.val()!=a.calendario_trabalho?"-<b> Calendário de Trabalho</b>: "+e+"<br>":"")+(0!=a.area&&r.cbo_area.val()!=a.area?"-<b> Área</b>: "+t+"<br>":"")+(r.edt_nivel.val()!=a.nivel?"-<b> Nível</b>: "+a.nivel+"<br><br>":"")+"Suas permissões de acordo com o padrão "+r.cbo_tipo.find('option[value="'+o+'"]').text()+" ? ","Alterar",function(){r.setar_permissoes(r.cbo_tipo.val()),i()},!0,"Não",null,function(){i()}))}}}():i()},null,null,!0):i(),clearInterval(a)},500);else alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !',"Não é permitido caracteres especiais no nome de usuário !")}),this.btn_excluir.unbind("click"),this.btn_excluir.click(function(){WS.post("usuario/excluir",{usuario_id:r.usuario_id},function(a){alert_saved(a.nome+" excluido com sucesso"),r.unload()})}),this.btn_incluir_grupo_motivo.unbind("click"),this.btn_incluir_grupo_motivo.click(function(){View.load("grupo_motivo_chamado/selecionar",function(a,i){i.show(function(a){var i=!1;$(r.arr_grupo_motivo).each(function(e,o){o.grupo_id==a.grupo_id&&(i=!0,r.arr_grupo_motivo[e].removido=!1)}),i||r.arr_grupo_motivo.push(a),r.render_grupo_motivo()})})}),this.btn_incluir_cliente.unbind("click"),this.btn_incluir_cliente.click(function(){View.load("cliente/selecionar",function(a,i){i.show(function(a){var i=!1;$(r.arr_clientes).each(function(e,o){o.cliente_id==a.cliente_id&&(i=!0,r.arr_clientes[e].removido=!1)}),i||r.arr_clientes.push(a),r.render_clientes()})})}),this.edt_nivel.unbind("change"),this.edt_nivel.change(function(){"S"!=App.sessao.dados.admin&&1!=App.sessao.dados.admin&&parseInt(this.value,10)>parseInt(App.sessao.dados.nivel,10)&&r.edt_nivel.val(App.sessao.dados.nivel)}),this.btn_incluir_fornecedor.unbind("click"),this.btn_incluir_fornecedor.click(function(){View.load("fornecedor/selecionar",function(a,i){i.show(function(a){var i=!1;$(r.arr_fornecedores).each(function(e,o){o.fornecedor_id==a.fornecedor_id&&(i=!0,r.arr_fornecedores[e].removido=!1)}),i||r.arr_fornecedores.push(a),r.render_fornecedores()})})}),this.btn_incluir_prospect.unbind("click"),this.btn_incluir_prospect.click(function(){View.load("prospect/selecionar",function(a,i){i.show(function(a){var i=!1;$(r.arr_prospects).each(function(e,o){o.prospect_id==a.prospect_id&&(i=!0,r.arr_prospects[e].removido=!1)}),i||r.arr_prospects.push(a),r.render_prospects()})})}),this.btn_incluir_empresa.unbind("click"),this.btn_incluir_empresa.click(function(){View.load("empresa/selecionar",function(a,i){i.show(function(a){var i=!1;$(r.arr_empresa).each(function(e,o){o.empresa_id==a.empresa_id&&(i=!0,r.arr_empresa[e].removido=!1)}),i||r.arr_empresa.push(a),r.render_empresa()})})}),this.chk_admin.change(function(){if(r.chk_admin.prop("checked")){if(1!=App.sessao.dados.admin){var a=new Validation;return a.add(new ValidationMessage(Validation.CODES.ERR_FIELD,"Você não tem permissão para definir usuários administradores. Por favor, contate algum administrador do sistema")),alert_modal("Validação",a),$(this).prop("checked",!1),void $(this).prop("disabled",!0)}r.cbo_tipo.find('option[value="1"]').remove(),r.cbo_tipo.find('option[value="4"]').remove(),r.cbo_tipo.find('option[value="5"]').remove(),r.modal_usuario_cbo_area.find(".campo_obrigatorio").addClass("hidden"),r.modal_usuario_cbo_calendario_trabalho.find(".campo_obrigatorio").addClass("hidden"),r.lbl_tipo.find(".campo_obrigatorio").addClass("hidden")}else r.chk_admin.prop("checked")||1!=App.sessao.dados.admin||(add_option(r.cbo_tipo,1,"Cliente","selected"),add_option(r.cbo_tipo,4,"Fornecedor"),add_option(r.cbo_tipo,5,"Organização"),r.cbo_tipo.val(""),r.modal_usuario_cbo_area.find(".campo_obrigatorio").removeClass("hidden"),r.modal_usuario_cbo_calendario_trabalho.find(".campo_obrigatorio").removeClass("hidden"),r.lbl_tipo.find(".campo_obrigatorio").removeClass("hidden"));r.cbo_tipo.trigger("change")}),this.cbo_tipo.unbind("change"),this.cbo_tipo.change(function(){r.div_cliente.hide(),r.div_fornecedor.hide(),r.div_prospect.hide(),r.div_empresa.hide(),r.edt_data_admissao.parent().hide(),"1"==r.cbo_tipo.val()?r.div_cliente.show():"4"==r.cbo_tipo.val()?r.div_fornecedor.show():"5"==r.cbo_tipo.val()?r.div_prospect.show():"2"==r.cbo_tipo.val()&&(r.div_empresa.show(),r.edt_data_admissao.parent().show())}),this.btn_listar_usuarios_ldap.unbind("click"),this.btn_listar_usuarios_ldap.click(function(){View.load("servidor_ldap/login",function(a,i){i.onclose=null,i.show(r,!0)})}),this.btn_limpar.unbind("click"),this.btn_limpar.click(function(){alert_modal('<i class="fa fa-exclamation-triangle pull-left" aria-hidden="true"></i> Atenção !','<div class="alert alert-info" style="text-align: center"> <span href="#" class="alert-link"><strong>Deseja remover o usuário vinculado ao LDAP ?</strong></span></div>','<i class="fa fa-check-square" aria-hidden="true"></i> Sim',function(){r.cbo_usuario_ldap.find("option").remove(),r.cbo_usuario_ldap.selectpicker("refresh"),r.servidor_ldap_id=null},!0,'<i class="fa fa-undo" aria-hidden="true"></i> Não')}),this.btn_fechar_modal.unbind("click"),this.btn_fechar_modal.click(function(){r.close(),View.unload(r.usuario_id)}),this.setar_permissoes=function(a){if(void 0!==r.perfis_padrao&&r.perfis_padrao)for(var i=0;i<r.perfis_padrao.length;i++)if(r.perfis_padrao[i].codigo==a)return null!==r.perfis_padrao[i].calendario_trabalho_id&&r.cbo_calendario_trabalho.val(r.perfis_padrao[i].calendario_trabalho_id),r.perfis_padrao[i].nivel>0&&r.edt_nivel.val(r.perfis_padrao[i].nivel),void(null!==r.perfis_padrao[i].area_id&&r.cbo_area.val(r.perfis_padrao[i].area_id))},r.files[0].addEventListener("change",r.preview_foto,!1)}});